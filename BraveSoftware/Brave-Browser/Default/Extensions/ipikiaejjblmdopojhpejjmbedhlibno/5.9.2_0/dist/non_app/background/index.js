/*! For license information please see index.js.LICENSE.txt */
(()=>{var t,e,n,r,i={9743:(t,e,n)=>{"use strict";n.r(e),n.d(e,{Headers:()=>o,Request:()=>a,Response:()=>c,default:()=>s,fetch:()=>i});var r=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("unable to locate global object")}();const i=r.fetch,s=r.fetch.bind(r),o=r.Headers,a=r.Request,c=r.Response},4283:(t,e,n)=>{"use strict";n.d(e,{eI:()=>ve});class r extends Error{constructor(t,e="FunctionsError",n){super(t),this.name=e,this.context=n}}class i extends r{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class s extends r{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class o extends r{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}class a{constructor(t,{headers:e={},customFetch:r}={}){this.url=t,this.headers=e,this.fetch=(t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>Promise.resolve().then(n.bind(n,9743)).then((({default:e})=>e(...t))):fetch),(...t)=>e(...t)})(r)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,e={}){var n,r,a,c,u;return r=this,a=void 0,u=function*(){try{const{headers:r,method:a,body:c}=e;let u,l={};c&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&("undefined"!=typeof Blob&&c instanceof Blob||c instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",u=c):"string"==typeof c?(l["Content-Type"]="text/plain",u=c):"undefined"!=typeof FormData&&c instanceof FormData?u=c:(l["Content-Type"]="application/json",u=JSON.stringify(c)));const h=yield this.fetch(`${this.url}/${t}`,{method:a||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),r),body:u}).catch((t=>{throw new i(t)})),d=h.headers.get("x-relay-error");if(d&&"true"===d)throw new s(h);if(!h.ok)throw new o(h);let f,p=(null!==(n=h.headers.get("Content-Type"))&&void 0!==n?n:"text/plain").split(";")[0].trim();return f="application/json"===p?yield h.json():"application/octet-stream"===p?yield h.blob():"multipart/form-data"===p?yield h.formData():yield h.text(),{data:f,error:null}}catch(t){return{data:null,error:t}}},new((c=void 0)||(c=Promise))((function(t,e){function n(t){try{s(u.next(t))}catch(t){e(t)}}function i(t){try{s(u.throw(t))}catch(t){e(t)}}function s(e){var r;e.done?t(e.value):(r=e.value,r instanceof c?r:new c((function(t){t(r)}))).then(n,i)}s((u=u.apply(r,a||[])).next())}))}}var c=n(9743);class u{constructor(t){this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=t.headers,this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=t.shouldThrowOnError,this.signal=t.signal,this.isMaybeSingle=t.isMaybeSingle,t.fetch?this.fetch=t.fetch:"undefined"==typeof fetch?this.fetch=c.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(t,e){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let n=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then((async t=>{var e,n,r;let i=null,s=null,o=null,a=t.status,c=t.statusText;if(t.ok){if("HEAD"!==this.method){const e=await t.text();""===e||(s="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?e:JSON.parse(e))}const r=null===(e=this.headers.Prefer)||void 0===e?void 0:e.match(/count=(exact|planned|estimated)/),u=null===(n=t.headers.get("content-range"))||void 0===n?void 0:n.split("/");r&&u&&u.length>1&&(o=parseInt(u[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(s)&&(s.length>1?(i={code:"PGRST116",details:`Results contain ${s.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},s=null,o=null,a=406,c="Not Acceptable"):s=1===s.length?s[0]:null)}else{const e=await t.text();try{i=JSON.parse(e),Array.isArray(i)&&404===t.status&&(s=[],i=null,a=200,c="OK")}catch(n){404===t.status&&""===e?(a=204,c="No Content"):i={message:e}}if(i&&this.isMaybeSingle&&(null===(r=null==i?void 0:i.details)||void 0===r?void 0:r.includes("0 rows"))&&(i=null,a=200,c="OK"),i&&this.shouldThrowOnError)throw i}return{error:i,data:s,count:o,status:a,statusText:c}}));return this.shouldThrowOnError||(n=n.catch((t=>{var e,n,r;return{error:{message:`${null!==(e=null==t?void 0:t.name)&&void 0!==e?e:"FetchError"}: ${null==t?void 0:t.message}`,details:`${null!==(n=null==t?void 0:t.stack)&&void 0!==n?n:""}`,hint:"",code:`${null!==(r=null==t?void 0:t.code)&&void 0!==r?r:""}`},data:null,count:null,status:0,statusText:""}}))),n.then(t,e)}}class l extends u{select(t){let e=!1;const n=(null!=t?t:"*").split("").map((t=>/\s/.test(t)&&!e?"":('"'===t&&(e=!e),t))).join("");return this.url.searchParams.set("select",n),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(t,{ascending:e=!0,nullsFirst:n,foreignTable:r,referencedTable:i=r}={}){const s=i?`${i}.order`:"order",o=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${o?`${o},`:""}${t}.${e?"asc":"desc"}${void 0===n?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:n=e}={}){const r=void 0===n?"limit":`${n}.limit`;return this.url.searchParams.set(r,`${t}`),this}range(t,e,{foreignTable:n,referencedTable:r=n}={}){const i=void 0===r?"offset":`${r}.offset`,s=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(i,`${t}`),this.url.searchParams.set(s,""+(e-t+1)),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:t=!1,verbose:e=!1,settings:n=!1,buffers:r=!1,wal:i=!1,format:s="text"}={}){var o;const a=[t?"analyze":null,e?"verbose":null,n?"settings":null,r?"buffers":null,i?"wal":null].filter(Boolean).join("|"),c=null!==(o=this.headers.Accept)&&void 0!==o?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${s}; for="${c}"; options=${a};`,this}rollback(){var t;return(null!==(t=this.headers.Prefer)&&void 0!==t?t:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class h extends l{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}in(t,e){const n=e.map((t=>"string"==typeof t&&new RegExp("[,()]").test(t)?`"${t}"`:`${t}`)).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}contains(t,e){return"string"==typeof e?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return"string"==typeof e?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return"string"==typeof e?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:n,type:r}={}){let i="";"plain"===r?i="pl":"phrase"===r?i="ph":"websearch"===r&&(i="w");const s=void 0===n?"":`(${n})`;return this.url.searchParams.append(t,`${i}fts${s}.${e}`),this}match(t){return Object.entries(t).forEach((([t,e])=>{this.url.searchParams.append(t,`eq.${e}`)})),this}not(t,e,n){return this.url.searchParams.append(t,`not.${e}.${n}`),this}or(t,{foreignTable:e,referencedTable:n=e}={}){const r=n?`${n}.or`:"or";return this.url.searchParams.append(r,`(${t})`),this}filter(t,e,n){return this.url.searchParams.append(t,`${e}.${n}`),this}}class d{constructor(t,{headers:e={},schema:n,fetch:r}){this.url=t,this.headers=e,this.schema=n,this.fetch=r}select(t,{head:e=!1,count:n}={}){const r=e?"HEAD":"GET";let i=!1;const s=(null!=t?t:"*").split("").map((t=>/\s/.test(t)&&!i?"":('"'===t&&(i=!i),t))).join("");return this.url.searchParams.set("select",s),n&&(this.headers.Prefer=`count=${n}`),new h({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(t,{count:e,defaultToNull:n=!0}={}){const r=[];if(this.headers.Prefer&&r.push(this.headers.Prefer),e&&r.push(`count=${e}`),n||r.push("missing=default"),this.headers.Prefer=r.join(","),Array.isArray(t)){const e=t.reduce(((t,e)=>t.concat(Object.keys(e))),[]);if(e.length>0){const t=[...new Set(e)].map((t=>`"${t}"`));this.url.searchParams.set("columns",t.join(","))}}return new h({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}upsert(t,{onConflict:e,ignoreDuplicates:n=!1,count:r,defaultToNull:i=!0}={}){const s=[`resolution=${n?"ignore":"merge"}-duplicates`];if(void 0!==e&&this.url.searchParams.set("on_conflict",e),this.headers.Prefer&&s.push(this.headers.Prefer),r&&s.push(`count=${r}`),i||s.push("missing=default"),this.headers.Prefer=s.join(","),Array.isArray(t)){const e=t.reduce(((t,e)=>t.concat(Object.keys(e))),[]);if(e.length>0){const t=[...new Set(e)].map((t=>`"${t}"`));this.url.searchParams.set("columns",t.join(","))}}return new h({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}update(t,{count:e}={}){const n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),e&&n.push(`count=${e}`),this.headers.Prefer=n.join(","),new h({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}delete({count:t}={}){const e=[];return t&&e.push(`count=${t}`),this.headers.Prefer&&e.unshift(this.headers.Prefer),this.headers.Prefer=e.join(","),new h({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const f={"X-Client-Info":"postgrest-js/1.9.1"};class p{constructor(t,{headers:e={},schema:n,fetch:r}={}){this.url=t,this.headers=Object.assign(Object.assign({},f),e),this.schemaName=n,this.fetch=r}from(t){const e=new URL(`${this.url}/${t}`);return new d(e,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new p(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,e={},{head:n=!1,count:r}={}){let i;const s=new URL(`${this.url}/rpc/${t}`);let o;n?(i="HEAD",Object.entries(e).forEach((([t,e])=>{s.searchParams.append(t,`${e}`)}))):(i="POST",o=e);const a=Object.assign({},this.headers);return r&&(a.Prefer=`count=${r}`),new h({method:i,url:s,headers:a,schema:this.schemaName,body:o,fetch:this.fetch,allowEmpty:!1})}}const g={"X-Client-Info":"realtime-js/2.9.3"};var m,y,v,_,w,b,E,S;!function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"}(m||(m={})),(S=y||(y={})).closed="closed",S.errored="errored",S.joined="joined",S.joining="joining",S.leaving="leaving",function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"}(v||(v={})),function(t){t.websocket="websocket"}(_||(_={})),function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"}(w||(w={}));class T{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout((()=>{this.tries=this.tries+1,this.callback()}),this.timerCalc(this.tries+1))}}class I{constructor(){this.HEADER_LENGTH=1}decode(t,e){return t.constructor===ArrayBuffer?e(this._binaryDecode(t)):e("string"==typeof t?JSON.parse(t):{})}_binaryDecode(t){const e=new DataView(t),n=new TextDecoder;return this._decodeBroadcast(t,e,n)}_decodeBroadcast(t,e,n){const r=e.getUint8(1),i=e.getUint8(2);let s=this.HEADER_LENGTH+2;const o=n.decode(t.slice(s,s+r));s+=r;const a=n.decode(t.slice(s,s+i));return s+=i,{ref:null,topic:o,event:a,payload:JSON.parse(n.decode(t.slice(s,t.byteLength)))}}}class O{constructor(t,e,n={},r=1e4){this.channel=t,this.event=e,this.payload=n,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var n;return this._hasReceived(t)&&e(null===(n=this.receivedResp)||void 0===n?void 0:n.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},(t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)})),this.timeoutTimer=setTimeout((()=>{this.trigger("timeout",{})}),this.timeout))}trigger(t,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:e}){this.recHooks.filter((e=>e.status===t)).forEach((t=>t.callback(e)))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}!function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"}(b||(b={}));class k{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(null==e?void 0:e.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},(t=>{const{onJoin:e,onLeave:n,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=k.syncState(this.state,t,e,n),this.pendingDiffs.forEach((t=>{this.state=k.syncDiff(this.state,t,e,n)})),this.pendingDiffs=[],r()})),this.channel._on(n.diff,{},(t=>{const{onJoin:e,onLeave:n,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(t):(this.state=k.syncDiff(this.state,t,e,n),r())})),this.onJoin(((t,e,n)=>{this.channel._trigger("presence",{event:"join",key:t,currentPresences:e,newPresences:n})})),this.onLeave(((t,e,n)=>{this.channel._trigger("presence",{event:"leave",key:t,currentPresences:e,leftPresences:n})})),this.onSync((()=>{this.channel._trigger("presence",{event:"sync"})}))}static syncState(t,e,n,r){const i=this.cloneDeep(t),s=this.transformState(e),o={},a={};return this.map(i,((t,e)=>{s[t]||(a[t]=e)})),this.map(s,((t,e)=>{const n=i[t];if(n){const r=e.map((t=>t.presence_ref)),i=n.map((t=>t.presence_ref)),s=e.filter((t=>i.indexOf(t.presence_ref)<0)),c=n.filter((t=>r.indexOf(t.presence_ref)<0));s.length>0&&(o[t]=s),c.length>0&&(a[t]=c)}else o[t]=e})),this.syncDiff(i,{joins:o,leaves:a},n,r)}static syncDiff(t,e,n,r){const{joins:i,leaves:s}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return n||(n=()=>{}),r||(r=()=>{}),this.map(i,((e,r)=>{var i;const s=null!==(i=t[e])&&void 0!==i?i:[];if(t[e]=this.cloneDeep(r),s.length>0){const n=t[e].map((t=>t.presence_ref)),r=s.filter((t=>n.indexOf(t.presence_ref)<0));t[e].unshift(...r)}n(e,s,r)})),this.map(s,((e,n)=>{let i=t[e];if(!i)return;const s=n.map((t=>t.presence_ref));i=i.filter((t=>s.indexOf(t.presence_ref)<0)),t[e]=i,r(e,i,n),0===i.length&&delete t[e]})),t}static map(t,e){return Object.getOwnPropertyNames(t).map((n=>e(n,t[n])))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce(((e,n)=>{const r=t[n];return e[n]="metas"in r?r.metas.map((t=>(t.presence_ref=t.phx_ref,delete t.phx_ref,delete t.phx_ref_prev,t))):r,e}),{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"}(E||(E={}));const C=(t,e,n={})=>{var r;const i=null!==(r=n.skipTypes)&&void 0!==r?r:[];return Object.keys(e).reduce(((n,r)=>(n[r]=A(r,t,e,i),n)),{})},A=(t,e,n,r)=>{const i=e.find((e=>e.name===t)),s=null==i?void 0:i.type,o=n[t];return s&&!r.includes(s)?R(s,o):N(o)},R=(t,e)=>{if("_"===t.charAt(0)){const n=t.slice(1,t.length);return L(e,n)}switch(t){case E.bool:return x(e);case E.float4:case E.float8:case E.int2:case E.int4:case E.int8:case E.numeric:case E.oid:return D(e);case E.json:case E.jsonb:return P(e);case E.timestamp:return j(e);case E.abstime:case E.date:case E.daterange:case E.int4range:case E.int8range:case E.money:case E.reltime:case E.text:case E.time:case E.timestamptz:case E.timetz:case E.tsrange:case E.tstzrange:default:return N(e)}},N=t=>t,x=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},D=t=>{if("string"==typeof t){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},P=t=>{if("string"==typeof t)try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},L=(t,e)=>{if("string"!=typeof t)return t;const n=t.length-1,r=t[n];if("{"===t[0]&&"}"===r){let r;const i=t.slice(1,n);try{r=JSON.parse("["+i+"]")}catch(t){r=i?i.split(","):[]}return r.map((t=>R(e,t)))}return t},j=t=>"string"==typeof t?t.replace(" ","T"):t;var U,M,F;!function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"}(U||(U={})),function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes"}(M||(M={})),function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"}(F||(F={}));class ${constructor(t,e={config:{}},n){this.topic=t,this.params=e,this.socket=n,this.bindings={},this.state=y.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},e.config),this.timeout=this.socket.timeout,this.joinPush=new O(this,v.join,this.params,this.timeout),this.rejoinTimer=new T((()=>this._rejoinUntilConnected()),this.socket.reconnectAfterMs),this.joinPush.receive("ok",(()=>{this.state=y.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach((t=>t.send())),this.pushBuffer=[]})),this._onClose((()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=y.closed,this.socket._remove(this)})),this._onError((t=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,t),this.state=y.errored,this.rejoinTimer.scheduleTimeout())})),this.joinPush.receive("timeout",(()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=y.errored,this.rejoinTimer.scheduleTimeout())})),this._on(v.reply,{},((t,e)=>{this._trigger(this._replyEventName(e),t)})),this.presence=new k(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(t,e=this.timeout){var n,r;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:s}}=this.params;this._onError((e=>t&&t("CHANNEL_ERROR",e))),this._onClose((()=>t&&t("CLOSED")));const o={},a={broadcast:i,presence:s,postgres_changes:null!==(r=null===(n=this.bindings.postgres_changes)||void 0===n?void 0:n.map((t=>t.filter)))&&void 0!==r?r:[]};this.socket.accessToken&&(o.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:a},o)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",(({postgres_changes:e})=>{var n;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),void 0!==e){const r=this.bindings.postgres_changes,i=null!==(n=null==r?void 0:r.length)&&void 0!==n?n:0,s=[];for(let n=0;n<i;n++){const i=r[n],{filter:{event:o,schema:a,table:c,filter:u}}=i,l=e&&e[n];if(!l||l.event!==o||l.schema!==a||l.table!==c||l.filter!==u)return this.unsubscribe(),void(t&&t("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes")));s.push(Object.assign(Object.assign({},i),{id:l.id}))}return this.bindings.postgres_changes=s,void(t&&t("SUBSCRIBED"))}t&&t("SUBSCRIBED")})).receive("error",(e=>{t&&t("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(e).join(", ")||"error")))})).receive("timeout",(()=>{t&&t("TIMED_OUT")}))}return this}presenceState(){return this.presence.state}async track(t,e={}){return await this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,e,n){return this._on(t,e,n)}async send(t,e={}){var n,r;if(this._canPush()||"broadcast"!==t.type)return new Promise((n=>{var r,i,s;const o=this._push(t.type,t,e.timeout||this.timeout);"broadcast"!==t.type||(null===(s=null===(i=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===i?void 0:i.broadcast)||void 0===s?void 0:s.ack)||n("ok"),o.receive("ok",(()=>n("ok"))),o.receive("timeout",(()=>n("timed out")))}));{const{event:i,payload:s}=t,o={method:"POST",headers:{apikey:null!==(n=this.socket.apiKey)&&void 0!==n?n:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:s}]})};try{return(await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(r=e.timeout)&&void 0!==r?r:this.timeout)).ok?"ok":"error"}catch(t){return"AbortError"===t.name?"timed out":"error"}}}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=y.leaving;const e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(v.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise((n=>{const r=new O(this,v.leave,{},t);r.receive("ok",(()=>{e(),n("ok")})).receive("timeout",(()=>{e(),n("timed out")})).receive("error",(()=>{n("error")})),r.send(),this._canPush()||r.trigger("ok",{})}))}_broadcastEndpointURL(){let t=this.socket.endPoint;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"}async _fetchWithTimeout(t,e,n){const r=new AbortController,i=setTimeout((()=>r.abort()),n),s=await this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:r.signal}));return clearTimeout(i),s}_push(t,e,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new O(this,t,e,n);return this._canPush()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}_onMessage(t,e,n){return e}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,e,n){var r,i;const s=t.toLocaleLowerCase(),{close:o,error:a,leave:c,join:u}=v;if(n&&[o,a,c,u].indexOf(s)>=0&&n!==this._joinRef())return;let l=this._onMessage(s,e,n);if(e&&!l)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(s)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter((t=>{var e,n,r;return"*"===(null===(e=t.filter)||void 0===e?void 0:e.event)||(null===(r=null===(n=t.filter)||void 0===n?void 0:n.event)||void 0===r?void 0:r.toLocaleLowerCase())===s})).map((t=>t.callback(l,n))):null===(i=this.bindings[s])||void 0===i||i.filter((t=>{var n,r,i,o,a,c;if(["broadcast","presence","postgres_changes"].includes(s)){if("id"in t){const s=t.id,o=null===(n=t.filter)||void 0===n?void 0:n.event;return s&&(null===(r=e.ids)||void 0===r?void 0:r.includes(s))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(i=e.data)||void 0===i?void 0:i.type.toLocaleLowerCase()))}{const n=null===(a=null===(o=null==t?void 0:t.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===n||n===(null===(c=null==e?void 0:e.event)||void 0===c?void 0:c.toLocaleLowerCase())}}return t.type.toLocaleLowerCase()===s})).map((t=>{if("object"==typeof l&&"ids"in l){const t=l.data,{schema:e,table:n,commit_timestamp:r,type:i,errors:s}=t,o={schema:e,table:n,commit_timestamp:r,eventType:i,new:{},old:{},errors:s};l=Object.assign(Object.assign({},o),this._getPayloadRecords(t))}t.callback(l,n)}))}_isClosed(){return this.state===y.closed}_isJoined(){return this.state===y.joined}_isJoining(){return this.state===y.joining}_isLeaving(){return this.state===y.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,e,n){const r=t.toLocaleLowerCase(),i={type:r,filter:e,callback:n};return this.bindings[r]?this.bindings[r].push(i):this.bindings[r]=[i],this}_off(t,e){const n=t.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter((t=>{var r;return!((null===(r=t.type)||void 0===r?void 0:r.toLocaleLowerCase())===n&&$.isEqual(t.filter,e))})),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(v.close,{},t)}_onError(t){this._on(v.error,{},(e=>t(e)))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=y.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const e={new:{},old:{}};return"INSERT"!==t.type&&"UPDATE"!==t.type||(e.new=C(t.columns,t.record)),"UPDATE"!==t.type&&"DELETE"!==t.type||(e.old=C(t.columns,t.old_record)),e}}const B=()=>{},V="undefined"!=typeof WebSocket;class G{constructor(t,e){var r;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.headers=g,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=B,this.conn=null,this.sendBuffer=[],this.serializer=new I,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>Promise.resolve().then(n.bind(n,9743)).then((({default:e})=>e(...t))):fetch),(...t)=>e(...t)},this.endPoint=`${t}/${_.websocket}`,(null==e?void 0:e.transport)?this.transport=e.transport:this.transport=null,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),e.headers)),(null==e?void 0:e.timeout)&&(this.timeout=e.timeout),(null==e?void 0:e.logger)&&(this.logger=e.logger),(null==e?void 0:e.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs);const i=null===(r=null==e?void 0:e.params)||void 0===r?void 0:r.apikey;i&&(this.accessToken=i,this.apiKey=i),this.reconnectAfterMs=(null==e?void 0:e.reconnectAfterMs)?e.reconnectAfterMs:t=>[1e3,2e3,5e3,1e4][t-1]||1e4,this.encode=(null==e?void 0:e.encode)?e.encode:(t,e)=>e(JSON.stringify(t)),this.decode=(null==e?void 0:e.decode)?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new T((async()=>{this.disconnect(),this.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(null==e?void 0:e.fetch)}connect(){if(!this.conn)if(this.transport)this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});else{if(V)return this.conn=new WebSocket(this._endPointURL()),void this.setupConnection();this.conn=new q(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),n.e(26).then(n.t.bind(n,7026,23)).then((({default:t})=>{this.conn=new t(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()}))}}disconnect(t,e){this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,null!=e?e:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(t){const e=await t.unsubscribe();return 0===this.channels.length&&this.disconnect(),e}async removeAllChannels(){const t=await Promise.all(this.channels.map((t=>t.unsubscribe())));return this.disconnect(),t}log(t,e,n){this.logger(t,e,n)}connectionState(){switch(this.conn&&this.conn.readyState){case m.connecting:return w.Connecting;case m.open:return w.Open;case m.closing:return w.Closing;default:return w.Closed}}isConnected(){return this.connectionState()===w.Open}channel(t,e={config:{}}){const n=new $(`realtime:${t}`,e,this);return this.channels.push(n),n}push(t){const{topic:e,event:n,payload:r,ref:i}=t,s=()=>{this.encode(t,(t=>{var e;null===(e=this.conn)||void 0===e||e.send(t)}))};this.log("push",`${e} ${n} (${i})`,r),this.isConnected()?s():this.sendBuffer.push(s)}setAuth(t){this.accessToken=t,this.channels.forEach((e=>{t&&e.updateJoinPayload({access_token:t}),e.joinedOnce&&e._isJoined()&&e._push(v.access_token,{access_token:t})}))}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let e=this.channels.find((e=>e.topic===t&&(e._isJoined()||e._isJoining())));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}_remove(t){this.channels=this.channels.filter((e=>e._joinRef()!==t._joinRef()))}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}_onConnMessage(t){this.decode(t.data,(t=>{let{topic:e,event:n,payload:r,ref:i}=t;(i&&i===this.pendingHeartbeatRef||n===(null==r?void 0:r.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${r.status||""} ${e} ${n} ${i&&"("+i+")"||""}`,r),this.channels.filter((t=>t._isMember(e))).forEach((t=>t._trigger(n,r,i))),this.stateChangeCallbacks.message.forEach((e=>e(t)))}))}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>this._sendHeartbeat()),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach((t=>t()))}_onConnClose(t){this.log("transport","close",t),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((e=>e(t)))}_onConnError(t){this.log("transport",t.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach((e=>e(t)))}_triggerChanError(){this.channels.forEach((t=>t._trigger(v.error)))}_appendParams(t,e){if(0===Object.keys(e).length)return t;const n=t.match(/\?/)?"&":"?";return`${t}${n}${new URLSearchParams(e)}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((t=>t())),this.sendBuffer=[])}_sendHeartbeat(){var t;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(t=this.conn)||void 0===t||t.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class q{constructor(t,e,n){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=m.connecting,this.send=()=>{},this.url=null,this.url=t,this.close=n.close}}class K extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function H(t){return"object"==typeof t&&null!==t&&"__isStorageError"in t}class z extends K{constructor(t,e){super(t),this.name="StorageApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class W extends K{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}}const Y=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>Promise.resolve().then(n.bind(n,9743)).then((({default:e})=>e(...t))):fetch),(...t)=>e(...t)};var J=function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};const X=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Q=(t,e)=>J(void 0,void 0,void 0,(function*(){const r=yield(i=void 0,s=void 0,o=void 0,a=function*(){return"undefined"==typeof Response?(yield Promise.resolve().then(n.bind(n,9743))).Response:Response},new(o||(o=Promise))((function(t,e){function n(t){try{c(a.next(t))}catch(t){e(t)}}function r(t){try{c(a.throw(t))}catch(t){e(t)}}function c(e){var i;e.done?t(e.value):(i=e.value,i instanceof o?i:new o((function(t){t(i)}))).then(n,r)}c((a=a.apply(i,s||[])).next())})));var i,s,o,a;t instanceof r?t.json().then((n=>{e(new z(X(n),t.status||500))})).catch((t=>{e(new W(X(t),t))})):e(new W(X(t),t))})),Z=(t,e,n,r)=>{const i={method:t,headers:(null==e?void 0:e.headers)||{}};return"GET"===t?i:(i.headers=Object.assign({"Content-Type":"application/json"},null==e?void 0:e.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),n))};function tt(t,e,n,r,i,s){return J(this,void 0,void 0,(function*(){return new Promise(((o,a)=>{t(n,Z(e,r,i,s)).then((t=>{if(!t.ok)throw t;return(null==r?void 0:r.noResolveJson)?t:t.json()})).then((t=>o(t))).catch((t=>Q(t,a)))}))}))}function et(t,e,n,r){return J(this,void 0,void 0,(function*(){return tt(t,"GET",e,n,r)}))}function nt(t,e,n,r,i){return J(this,void 0,void 0,(function*(){return tt(t,"POST",e,r,i,n)}))}function rt(t,e,n,r,i){return J(this,void 0,void 0,(function*(){return tt(t,"DELETE",e,r,i,n)}))}var it=function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};const st={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ot={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class at{constructor(t,e={},n,r){this.url=t,this.headers=e,this.bucketId=n,this.fetch=Y(r)}uploadOrUpdate(t,e,n,r){return it(this,void 0,void 0,(function*(){try{let i;const s=Object.assign(Object.assign({},ot),r),o=Object.assign(Object.assign({},this.headers),"POST"===t&&{"x-upsert":String(s.upsert)});"undefined"!=typeof Blob&&n instanceof Blob?(i=new FormData,i.append("cacheControl",s.cacheControl),i.append("",n)):"undefined"!=typeof FormData&&n instanceof FormData?(i=n,i.append("cacheControl",s.cacheControl)):(i=n,o["cache-control"]=`max-age=${s.cacheControl}`,o["content-type"]=s.contentType);const a=this._removeEmptyFolders(e),c=this._getFinalPath(a),u=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:t,body:i,headers:o},(null==s?void 0:s.duplex)?{duplex:s.duplex}:{})),l=yield u.json();return u.ok?{data:{path:a,id:l.Id,fullPath:l.Key},error:null}:{data:null,error:l}}catch(t){if(H(t))return{data:null,error:t};throw t}}))}upload(t,e,n){return it(this,void 0,void 0,(function*(){return this.uploadOrUpdate("POST",t,e,n)}))}uploadToSignedUrl(t,e,n,r){return it(this,void 0,void 0,(function*(){const i=this._removeEmptyFolders(t),s=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${s}`);o.searchParams.set("token",e);try{let t;const e=Object.assign({upsert:ot.upsert},r),s=Object.assign(Object.assign({},this.headers),{"x-upsert":String(e.upsert)});"undefined"!=typeof Blob&&n instanceof Blob?(t=new FormData,t.append("cacheControl",e.cacheControl),t.append("",n)):"undefined"!=typeof FormData&&n instanceof FormData?(t=n,t.append("cacheControl",e.cacheControl)):(t=n,s["cache-control"]=`max-age=${e.cacheControl}`,s["content-type"]=e.contentType);const a=yield this.fetch(o.toString(),{method:"PUT",body:t,headers:s}),c=yield a.json();return a.ok?{data:{path:i,fullPath:c.Key},error:null}:{data:null,error:c}}catch(t){if(H(t))return{data:null,error:t};throw t}}))}createSignedUploadUrl(t){return it(this,void 0,void 0,(function*(){try{let e=this._getFinalPath(t);const n=yield nt(this.fetch,`${this.url}/object/upload/sign/${e}`,{},{headers:this.headers}),r=new URL(this.url+n.url),i=r.searchParams.get("token");if(!i)throw new K("No token returned by API");return{data:{signedUrl:r.toString(),path:t,token:i},error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}))}update(t,e,n){return it(this,void 0,void 0,(function*(){return this.uploadOrUpdate("PUT",t,e,n)}))}move(t,e){return it(this,void 0,void 0,(function*(){try{return{data:yield nt(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e},{headers:this.headers}),error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}))}copy(t,e){return it(this,void 0,void 0,(function*(){try{return{data:{path:(yield nt(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e},{headers:this.headers})).Key},error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}))}createSignedUrl(t,e,n){return it(this,void 0,void 0,(function*(){try{let r=this._getFinalPath(t),i=yield nt(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:e},(null==n?void 0:n.transform)?{transform:n.transform}:{}),{headers:this.headers});const s=(null==n?void 0:n.download)?`&download=${!0===n.download?"":n.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${s}`)},{data:i,error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}))}createSignedUrls(t,e,n){return it(this,void 0,void 0,(function*(){try{const r=yield nt(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:t},{headers:this.headers}),i=(null==n?void 0:n.download)?`&download=${!0===n.download?"":n.download}`:"";return{data:r.map((t=>Object.assign(Object.assign({},t),{signedUrl:t.signedURL?encodeURI(`${this.url}${t.signedURL}${i}`):null}))),error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}))}download(t,e){return it(this,void 0,void 0,(function*(){const n=void 0!==(null==e?void 0:e.transform)?"render/image/authenticated":"object",r=this.transformOptsToQueryString((null==e?void 0:e.transform)||{}),i=r?`?${r}`:"";try{const e=this._getFinalPath(t),r=yield et(this.fetch,`${this.url}/${n}/${e}${i}`,{headers:this.headers,noResolveJson:!0});return{data:yield r.blob(),error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}))}getPublicUrl(t,e){const n=this._getFinalPath(t),r=[],i=(null==e?void 0:e.download)?`download=${!0===e.download?"":e.download}`:"";""!==i&&r.push(i);const s=void 0!==(null==e?void 0:e.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==e?void 0:e.transform)||{});""!==o&&r.push(o);let a=r.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${s}/public/${n}${a}`)}}}remove(t){return it(this,void 0,void 0,(function*(){try{return{data:yield rt(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}))}list(t,e,n){return it(this,void 0,void 0,(function*(){try{const r=Object.assign(Object.assign(Object.assign({},st),e),{prefix:t||""});return{data:yield nt(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},n),error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}))}_getFinalPath(t){return`${this.bucketId}/${t}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}}const ct={"X-Client-Info":"storage-js/2.5.5"};var ut=function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class lt{constructor(t,e={},n){this.url=t,this.headers=Object.assign(Object.assign({},ct),e),this.fetch=Y(n)}listBuckets(){return ut(this,void 0,void 0,(function*(){try{return{data:yield et(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}))}getBucket(t){return ut(this,void 0,void 0,(function*(){try{return{data:yield et(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}))}createBucket(t,e={public:!1}){return ut(this,void 0,void 0,(function*(){try{return{data:yield nt(this.fetch,`${this.url}/bucket`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}))}updateBucket(t,e){return ut(this,void 0,void 0,(function*(){try{const n=yield function(t,e,n,r,i){return J(this,void 0,void 0,(function*(){return tt(t,"PUT",e,r,undefined,n)}))}(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers});return{data:n,error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}))}emptyBucket(t){return ut(this,void 0,void 0,(function*(){try{return{data:yield nt(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}))}deleteBucket(t){return ut(this,void 0,void 0,(function*(){try{return{data:yield rt(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}))}}class ht extends lt{constructor(t,e={},n){super(t,e,n)}from(t){return new at(this.url,this.headers,t,this.fetch)}}let dt="";dt="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const ft={"X-Client-Info":`supabase-js-${dt}/2.39.3`};const pt=t=>{let e;return e=t||("undefined"==typeof fetch?c.default:fetch),(...t)=>e(...t)},gt=(t,e,n)=>{const r=pt(n),i="undefined"==typeof Headers?c.Headers:Headers;return(n,s)=>{return o=void 0,a=void 0,u=function*(){var o;const a=null!==(o=yield e())&&void 0!==o?o:t;let c=new i(null==s?void 0:s.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${a}`),r(n,Object.assign(Object.assign({},s),{headers:c}))},new((c=void 0)||(c=Promise))((function(t,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function r(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){var i;e.done?t(e.value):(i=e.value,i instanceof c?i:new c((function(t){t(i)}))).then(n,r)}i((u=u.apply(o,a||[])).next())}));var o,a,c,u}},mt=()=>"undefined"!=typeof document,yt={tested:!1,writable:!1},vt=()=>{if(!mt())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(yt.tested)return yt.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),yt.tested=!0,yt.writable=!0}catch(t){yt.tested=!0,yt.writable=!1}return yt.writable};function _t(t){const e={},n=new URL(t);if(n.hash&&"#"===n.hash[0])try{new URLSearchParams(n.hash.substring(1)).forEach(((t,n)=>{e[n]=t}))}catch(t){}return n.searchParams.forEach(((t,n)=>{e[n]=t})),e}const wt=t=>{let e;return e=t||("undefined"==typeof fetch?(...t)=>Promise.resolve().then(n.bind(n,9743)).then((({default:e})=>e(...t))):fetch),(...t)=>e(...t)},bt=t=>"object"==typeof t&&null!==t&&"status"in t&&"ok"in t&&"json"in t&&"function"==typeof t.json,Et=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},St=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch(t){return n}},Tt=async(t,e)=>{await t.removeItem(e)};class It{constructor(){this.promise=new It.promiseConstructor(((t,e)=>{this.resolve=t,this.reject=e}))}}function Ot(t){const e=t.split(".");if(3!==e.length)throw new Error("JWT is not valid: not a JWT structure");if(!/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i.test(e[1]))throw new Error("JWT is not valid: payload is not in base64url format");const n=e[1];return JSON.parse(function(t){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let n,r,i,s,o,a,c,u="",l=0;for(t=t.replace("-","+").replace("_","/");l<t.length;)s=e.indexOf(t.charAt(l++)),o=e.indexOf(t.charAt(l++)),a=e.indexOf(t.charAt(l++)),c=e.indexOf(t.charAt(l++)),n=s<<2|o>>4,r=(15&o)<<4|a>>2,i=(3&a)<<6|c,u+=String.fromCharCode(n),64!=a&&0!=r&&(u+=String.fromCharCode(r)),64!=c&&0!=i&&(u+=String.fromCharCode(i));return u}(n))}function kt(t){return("0"+t.toString(16)).substr(-2)}function Ct(){const t=new Uint32Array(56);if("undefined"==typeof crypto){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",e=t.length;let n="";for(let r=0;r<56;r++)n+=t.charAt(Math.floor(Math.random()*e));return n}return crypto.getRandomValues(t),Array.from(t,kt).join("")}async function At(t){if("undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder)return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const e=await async function(t){const e=(new TextEncoder).encode(t),n=await crypto.subtle.digest("SHA-256",e),r=new Uint8Array(n);return Array.from(r).map((t=>String.fromCharCode(t))).join("")}(t);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}It.promiseConstructor=Promise;class Rt extends Error{constructor(t,e){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=e}}function Nt(t){return"object"==typeof t&&null!==t&&"__isAuthError"in t}class xt extends Rt{constructor(t,e){super(t,e),this.name="AuthApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Dt extends Rt{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}}class Pt extends Rt{constructor(t,e,n){super(t),this.name=e,this.status=n}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Lt extends Pt{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class jt extends Pt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class Ut extends Pt{constructor(t){super(t,"AuthInvalidCredentialsError",400)}}class Mt extends Pt{constructor(t,e=null){super(t,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ft extends Pt{constructor(t,e=null){super(t,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class $t extends Pt{constructor(t,e){super(t,"AuthRetryableFetchError",e)}}function Bt(t){return Nt(t)&&"AuthRetryableFetchError"===t.name}class Vt extends Pt{constructor(t,e,n){super(t,"AuthWeakPasswordError",e),this.reasons=n}}const Gt=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),qt=[502,503,504];async function Kt(t){if(!bt(t))throw new $t(Gt(t),0);if(qt.includes(t.status))throw new $t(Gt(t),t.status);let e;try{e=await t.json()}catch(t){throw new Dt(Gt(t),t)}if("object"==typeof e&&e&&"object"==typeof e.weak_password&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce(((t,e)=>t&&"string"==typeof e),!0))throw new Vt(Gt(e),t.status,e.weak_password.reasons);throw new xt(Gt(e),t.status||500)}async function Ht(t,e,n,r){var i;const s=Object.assign({},null==r?void 0:r.headers);(null==r?void 0:r.jwt)&&(s.Authorization=`Bearer ${r.jwt}`);const o=null!==(i=null==r?void 0:r.query)&&void 0!==i?i:{};(null==r?void 0:r.redirectTo)&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await async function(t,e,n,r,i,s){const o=((t,e,n,r)=>{const i={method:t,headers:(null==e?void 0:e.headers)||{}};return"GET"===t?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==e?void 0:e.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),n))})(e,r,{},s);let a;try{a=await t(n,o)}catch(t){throw console.error(t),new $t(Gt(t),0)}if(a.ok||await Kt(a),null==r?void 0:r.noResolveJson)return a;try{return await a.json()}catch(t){await Kt(t)}}(t,e,n+a,{headers:s,noResolveJson:null==r?void 0:r.noResolveJson},0,null==r?void 0:r.body);return(null==r?void 0:r.xform)?null==r?void 0:r.xform(c):{data:Object.assign({},c),error:null}}function zt(t){var e;let n=null;var r;return function(t){return t.access_token&&t.refresh_token&&t.expires_in}(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=(r=t.expires_in,Math.round(Date.now()/1e3)+r))),{data:{session:n,user:null!==(e=t.user)&&void 0!==e?e:t},error:null}}function Wt(t){const e=zt(t);return!e.error&&t.weak_password&&"object"==typeof t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&"string"==typeof t.weak_password.message&&t.weak_password.reasons.reduce(((t,e)=>t&&"string"==typeof e),!0)&&(e.data.weak_password=t.weak_password),e}function Yt(t){var e;return{data:{user:null!==(e=t.user)&&void 0!==e?e:t},error:null}}function Jt(t){return{data:t,error:null}}function Xt(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:i,verification_type:s}=t,o=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:e,email_otp:n,hashed_token:r,redirect_to:i,verification_type:s},user:Object.assign({},o)},error:null}}function Qt(t){return t}class Zt{constructor({url:t="",headers:e={},fetch:n}){this.url=t,this.headers=e,this.fetch=wt(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(t,e="global"){try{return await Ht(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(t){if(Nt(t))return{data:null,error:t};throw t}}async inviteUserByEmail(t,e={}){try{return await Ht(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:Yt})}catch(t){if(Nt(t))return{data:{user:null},error:t};throw t}}async generateLink(t){try{const{options:e}=t,n=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}(t,["options"]),r=Object.assign(Object.assign({},n),e);return"newEmail"in n&&(r.new_email=null==n?void 0:n.newEmail,delete r.newEmail),await Ht(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:Xt,redirectTo:null==e?void 0:e.redirectTo})}catch(t){if(Nt(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(t){try{return await Ht(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Yt})}catch(t){if(Nt(t))return{data:{user:null},error:t};throw t}}async listUsers(t){var e,n,r,i,s,o,a;try{const c={nextPage:null,lastPage:0,total:0},u=await Ht(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(n=null===(e=null==t?void 0:t.page)||void 0===e?void 0:e.toString())&&void 0!==n?n:"",per_page:null!==(i=null===(r=null==t?void 0:t.perPage)||void 0===r?void 0:r.toString())&&void 0!==i?i:""},xform:Qt});if(u.error)throw u.error;const l=await u.json(),h=null!==(s=u.headers.get("x-total-count"))&&void 0!==s?s:0,d=null!==(a=null===(o=u.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach((t=>{const e=parseInt(t.split(";")[0].split("=")[1].substring(0,1)),n=JSON.parse(t.split(";")[1].split("=")[1]);c[`${n}Page`]=e})),c.total=parseInt(h)),{data:Object.assign(Object.assign({},l),c),error:null}}catch(t){if(Nt(t))return{data:{users:[]},error:t};throw t}}async getUserById(t){try{return await Ht(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Yt})}catch(t){if(Nt(t))return{data:{user:null},error:t};throw t}}async updateUserById(t,e){try{return await Ht(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:e,headers:this.headers,xform:Yt})}catch(t){if(Nt(t))return{data:{user:null},error:t};throw t}}async deleteUser(t,e=!1){try{return await Ht(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:e},xform:Yt})}catch(t){if(Nt(t))return{data:{user:null},error:t};throw t}}async _listFactors(t){try{const{data:e,error:n}=await Ht(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:t=>({data:{factors:t},error:null})});return{data:e,error:n}}catch(t){if(Nt(t))return{data:null,error:t};throw t}}async _deleteFactor(t){try{return{data:await Ht(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(t){if(Nt(t))return{data:null,error:t};throw t}}}const te="2.62.0",ee={"X-Client-Info":`gotrue-js/${te}`},ne={getItem:t=>vt()?globalThis.localStorage.getItem(t):null,setItem:(t,e)=>{vt()&&globalThis.localStorage.setItem(t,e)},removeItem:t=>{vt()&&globalThis.localStorage.removeItem(t)}};function re(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const ie=!!(globalThis&&vt()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class se extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class oe extends se{}async function ae(t,e,n){ie&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout((()=>{r.abort(),ie&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)}),e),await globalThis.navigator.locks.request(t,0===e?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},(async r=>{if(!r){if(0===e)throw ie&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new oe(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(ie)try{const t=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(t,null,"  "))}catch(t){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",t)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}ie&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,r.name);try{return await n()}finally{ie&&console.log("@supabase/gotrue-js: navigatorLock: released",t,r.name)}}))}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(t){"undefined"!=typeof self&&(self.globalThis=self)}}();const ce={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ee,flowType:"implicit",debug:!1},ue=3e4;async function le(t,e,n){return await n()}class he{constructor(t){var e,n;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=he.nextInstanceID,he.nextInstanceID+=1,this.instanceID>0&&mt()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},ce),t);if(this.logDebugMessages=!!r.debug,"function"==typeof r.debug&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new Zt({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=wt(r.fetch),this.lock=r.lock||le,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,r.lock?this.lock=r.lock:mt()&&(null===(e=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===e?void 0:e.locks)?this.lock=ae:this.lock=le,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?r.storage?this.storage=r.storage:vt()?this.storage=ne:(this.memoryStorage={},this.storage=re(this.memoryStorage)):(this.memoryStorage={},this.storage=re(this.memoryStorage)),mt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(t){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",t)}null===(n=this.broadcastChannel)||void 0===n||n.addEventListener("message",(async t=>{this._debug("received broadcast notification from other tab or client",t),await this._notifyAllSubscribers(t.data.event,t.data.session,!1)}))}this.initialize()}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${te}) ${(new Date).toISOString()}`,...t),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,(async()=>await this._initialize())))()),await this.initializePromise}async _initialize(){try{const t=!!mt()&&await this._isPKCEFlow();if(this._debug("#_initialize()","begin","is PKCE flow",t),t||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:e,error:n}=await this._getSessionFromURL(t);if(n)return this._debug("#_initialize()","error detecting session from URL",n),"Identity is already linked"===(null==n?void 0:n.message)||"Identity is already linked to another user"===(null==n?void 0:n.message)||await this._removeSession(),{error:n};const{session:r,redirectType:i}=e;return this._debug("#_initialize()","detected session in URL",r,"redirect type",i),await this._saveSession(r),setTimeout((async()=>{"recovery"===i?await this._notifyAllSubscribers("PASSWORD_RECOVERY",r):await this._notifyAllSubscribers("SIGNED_IN",r)}),0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Nt(t)?{error:t}:{error:new Dt("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signUp(t){var e,n,r;try{let i;if(await this._removeSession(),"email"in t){const{email:n,password:r,options:s}=t;let o=null,a=null;if("pkce"===this.flowType){const t=Ct();await Et(this.storage,`${this.storageKey}-code-verifier`,t),o=await At(t),a=t===o?"plain":"s256"}i=await Ht(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==s?void 0:s.emailRedirectTo,body:{email:n,password:r,data:null!==(e=null==s?void 0:s.data)&&void 0!==e?e:{},gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},code_challenge:o,code_challenge_method:a},xform:zt})}else{if(!("phone"in t))throw new Ut("You must provide either an email or phone number and a password");{const{phone:e,password:s,options:o}=t;i=await Ht(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:e,password:s,data:null!==(n=null==o?void 0:o.data)&&void 0!==n?n:{},channel:null!==(r=null==o?void 0:o.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:zt})}}const{data:s,error:o}=i;if(o||!s)return{data:{user:null,session:null},error:o};const a=s.session,c=s.user;return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:c,session:a},error:null}}catch(t){if(Nt(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithPassword(t){try{let e;if(await this._removeSession(),"email"in t){const{email:n,password:r,options:i}=t;e=await Ht(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:Wt})}else{if(!("phone"in t))throw new Ut("You must provide either an email or phone number and a password");{const{phone:n,password:r,options:i}=t;e=await Ht(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:Wt})}}const{data:n,error:r}=e;return r?{data:{user:null,session:null},error:r}:n&&n.session&&n.user?(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:r}):{data:{user:null,session:null},error:new jt}}catch(t){if(Nt(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(t){var e,n,r,i;return await this._removeSession(),await this._handleProviderSignIn(t.provider,{redirectTo:null===(e=t.options)||void 0===e?void 0:e.redirectTo,scopes:null===(n=t.options)||void 0===n?void 0:n.scopes,queryParams:null===(r=t.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(i=t.options)||void 0===i?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,(async()=>this._exchangeCodeForSession(t)))}async _exchangeCodeForSession(t){const e=await St(this.storage,`${this.storageKey}-code-verifier`),[n,r]=(null!=e?e:"").split("/"),{data:i,error:s}=await Ht(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:zt});return await Tt(this.storage,`${this.storageKey}-code-verifier`),s?{data:{user:null,session:null,redirectType:null},error:s}:i&&i.session&&i.user?(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:null!=r?r:null}),error:s}):{data:{user:null,session:null,redirectType:null},error:new jt}}async signInWithIdToken(t){await this._removeSession();try{const{options:e,provider:n,token:r,access_token:i,nonce:s}=t,o=await Ht(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:r,access_token:i,nonce:s,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},xform:zt}),{data:a,error:c}=o;return c?{data:{user:null,session:null},error:c}:a&&a.session&&a.user?(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:c}):{data:{user:null,session:null},error:new jt}}catch(t){if(Nt(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(t){var e,n,r,i,s;try{if(await this._removeSession(),"email"in t){const{email:r,options:i}=t;let s=null,o=null;if("pkce"===this.flowType){const t=Ct();await Et(this.storage,`${this.storageKey}-code-verifier`,t),s=await At(t),o=t===s?"plain":"s256"}const{error:a}=await Ht(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!==(e=null==i?void 0:i.data)&&void 0!==e?e:{},create_user:null===(n=null==i?void 0:i.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:s,code_challenge_method:o},redirectTo:null==i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in t){const{phone:e,options:n}=t,{data:o,error:a}=await Ht(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:e,data:null!==(r=null==n?void 0:n.data)&&void 0!==r?r:{},create_user:null===(i=null==n?void 0:n.shouldCreateUser)||void 0===i||i,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},channel:null!==(s=null==n?void 0:n.channel)&&void 0!==s?s:"sms"}});return{data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:a}}throw new Ut("You must provide either an email or phone number.")}catch(t){if(Nt(t))return{data:{user:null,session:null},error:t};throw t}}async verifyOtp(t){var e,n;try{let r,i;"email_change"!==t.type&&"phone_change"!==t.type&&await this._removeSession(),"options"in t&&(r=null===(e=t.options)||void 0===e?void 0:e.redirectTo,i=null===(n=t.options)||void 0===n?void 0:n.captchaToken);const{data:s,error:o}=await Ht(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:i}}),redirectTo:r,xform:zt});if(o)throw o;if(!s)throw new Error("An error occurred on token verification.");const a=s.session,c=s.user;return(null==a?void 0:a.access_token)&&(await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:c,session:a},error:null}}catch(t){if(Nt(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithSSO(t){var e,n,r;try{await this._removeSession();let i=null,s=null;if("pkce"===this.flowType){const t=Ct();await Et(this.storage,`${this.storageKey}-code-verifier`,t),i=await At(t),s=t===i?"plain":"s256"}return await Ht(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:null!==(n=null===(e=t.options)||void 0===e?void 0:e.redirectTo)&&void 0!==n?n:void 0}),(null===(r=null==t?void 0:t.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:s}),headers:this.headers,xform:Jt})}catch(t){if(Nt(t))return{data:null,error:t};throw t}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._reauthenticate()))}async _reauthenticate(){try{return await this._useSession((async t=>{const{data:{session:e},error:n}=t;if(n)throw n;if(!e)throw new Lt;const{error:r}=await Ht(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return{data:{user:null,session:null},error:r}}))}catch(t){if(Nt(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{"email_change"!=t.type&&"phone_change"!=t.type&&await this._removeSession();const e=`${this.url}/resend`;if("email"in t){const{email:n,type:r,options:i}=t,{error:s}=await Ht(this.fetch,"POST",e,{headers:this.headers,body:{email:n,type:r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},redirectTo:null==i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:s}}if("phone"in t){const{phone:n,type:r,options:i}=t,{data:s,error:o}=await Ht(this.fetch,"POST",e,{headers:this.headers,body:{phone:n,type:r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:null==s?void 0:s.message_id},error:o}}throw new Ut("You must provide either an email or phone number and a type")}catch(t){if(Nt(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,this._acquireLock(-1,(async()=>this._useSession((async t=>t))))}async _acquireLock(t,e){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const t=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await t,await e()))();return this.pendingInLock.push((async()=>{try{await n}catch(t){}})()),n}return await this.lock(`lock:${this.storageKey}`,t,(async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const t=e();for(this.pendingInLock.push((async()=>{try{await t}catch(t){}})()),await t;this.pendingInLock.length;){const t=[...this.pendingInLock];await Promise.all(t),this.pendingInLock.splice(0,t.length)}return await t}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const e=await this.__loadSession();return await t(e)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let t=null;const e=await St(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",e),null!==e&&(this._isValidSession(e)?t=e:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=!!t.expires_at&&t.expires_at<=Date.now()/1e3;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n)return{data:{session:t},error:null};const{session:r,error:i}=await this._callRefreshToken(t.refresh_token);return i?{data:{session:null},error:i}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,this._acquireLock(-1,(async()=>await this._getUser())))}async _getUser(t){try{return t?await Ht(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Yt}):await this._useSession((async t=>{var e,n;const{data:r,error:i}=t;if(i)throw i;return await Ht(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(n=null===(e=r.session)||void 0===e?void 0:e.access_token)&&void 0!==n?n:void 0,xform:Yt})}))}catch(t){if(Nt(t))return{data:{user:null},error:t};throw t}}async updateUser(t,e={}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._updateUser(t,e)))}async _updateUser(t,e={}){try{return await this._useSession((async n=>{const{data:r,error:i}=n;if(i)throw i;if(!r.session)throw new Lt;const s=r.session;let o=null,a=null;if("pkce"===this.flowType&&null!=t.email){const t=Ct();await Et(this.storage,`${this.storageKey}-code-verifier`,t),o=await At(t),a=t===o?"plain":"s256"}const{data:c,error:u}=await Ht(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==e?void 0:e.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:a}),jwt:s.access_token,xform:Yt});if(u)throw u;return s.user=c.user,await this._saveSession(s),await this._notifyAllSubscribers("USER_UPDATED",s),{data:{user:s.user},error:null}}))}catch(t){if(Nt(t))return{data:{user:null},error:t};throw t}}_decodeJWT(t){return Ot(t)}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._setSession(t)))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Lt;const e=Date.now()/1e3;let n=e,r=!0,i=null;const s=Ot(t.access_token);if(s.exp&&(n=s.exp,r=n<=e),r){const{session:e,error:n}=await this._callRefreshToken(t.refresh_token);if(n)return{data:{user:null,session:null},error:n};if(!e)return{data:{user:null,session:null},error:null};i=e}else{const{data:r,error:s}=await this._getUser(t.access_token);if(s)throw s;i={access_token:t.access_token,refresh_token:t.refresh_token,user:r.user,token_type:"bearer",expires_in:n-e,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(Nt(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._refreshSession(t)))}async _refreshSession(t){try{return await this._useSession((async e=>{var n;if(!t){const{data:r,error:i}=e;if(i)throw i;t=null!==(n=r.session)&&void 0!==n?n:void 0}if(!(null==t?void 0:t.refresh_token))throw new Lt;const{session:r,error:i}=await this._callRefreshToken(t.refresh_token);return i?{data:{user:null,session:null},error:i}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}}))}catch(t){if(Nt(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(t){try{if(!mt())throw new Mt("No browser detected.");if("implicit"===this.flowType&&!this._isImplicitGrantFlow())throw new Mt("Not a valid implicit grant flow url.");if("pkce"==this.flowType&&!t)throw new Ft("Not a valid PKCE flow url.");const e=_t(window.location.href);if(t){if(!e.code)throw new Ft("No code detected.");const{data:t,error:n}=await this._exchangeCodeForSession(e.code);if(n)throw n;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}if(e.error||e.error_description||e.error_code)throw new Mt(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});const{provider_token:n,provider_refresh_token:r,access_token:i,refresh_token:s,expires_in:o,expires_at:a,token_type:c}=e;if(!(i&&o&&s&&c))throw new Mt("No session defined in URL");const u=Math.round(Date.now()/1e3),l=parseInt(o);let h=u+l;a&&(h=parseInt(a));const d=h-u;1e3*d<=ue&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${l}s`);const f=h-l;u-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,h,u):u-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",f,h,u);const{data:p,error:g}=await this._getUser(i);if(g)throw g;const m={provider_token:n,provider_refresh_token:r,access_token:i,expires_in:l,expires_at:h,refresh_token:s,token_type:c,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:m,redirectType:e.type},error:null}}catch(t){if(Nt(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){const t=_t(window.location.href);return!(!mt()||!t.access_token&&!t.error_description)}async _isPKCEFlow(){const t=_t(window.location.href),e=await St(this.storage,`${this.storageKey}-code-verifier`);return!(!t.code||!e)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._signOut(t)))}async _signOut({scope:t}={scope:"global"}){return await this._useSession((async e=>{var n;const{data:r,error:i}=e;if(i)return{error:i};const s=null===(n=r.session)||void 0===n?void 0:n.access_token;if(s){const{error:e}=await this.admin.signOut(s,t);if(e&&(!function(t){return Nt(t)&&"AuthApiError"===t.name}(e)||404!==e.status&&401!==e.status))return{error:e}}return"others"!==t&&(await this._removeSession(),await Tt(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}}))}onAuthStateChange(t){const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})),n={id:e,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",e),this.stateChangeEmitters.delete(e)}};return this._debug("#onAuthStateChange()","registered callback with id",e),this.stateChangeEmitters.set(e,n),(async()=>{await this.initializePromise,await this._acquireLock(-1,(async()=>{this._emitInitialSession(e)}))})(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession((async e=>{var n,r;try{const{data:{session:r},error:i}=e;if(i)throw i;await(null===(n=this.stateChangeEmitters.get(t))||void 0===n?void 0:n.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",t,"session",r)}catch(e){await(null===(r=this.stateChangeEmitters.get(t))||void 0===r?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",e),console.error(e)}}))}async resetPasswordForEmail(t,e={}){let n=null,r=null;if("pkce"===this.flowType){const t=Ct();await Et(this.storage,`${this.storageKey}-code-verifier`,`${t}/PASSWORD_RECOVERY`),n=await At(t),r=t===n?"plain":"s256"}try{return await Ht(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:r,gotrue_meta_security:{captcha_token:e.captchaToken}},headers:this.headers,redirectTo:e.redirectTo})}catch(t){if(Nt(t))return{data:null,error:t};throw t}}async getUserIdentities(){var t;try{const{data:e,error:n}=await this.getUser();if(n)throw n;return{data:{identities:null!==(t=e.user.identities)&&void 0!==t?t:[]},error:null}}catch(t){if(Nt(t))return{data:null,error:t};throw t}}async linkIdentity(t){var e;try{const{data:n,error:r}=await this._useSession((async e=>{var n,r,i,s,o;const{data:a,error:c}=e;if(c)throw c;const u=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:null===(n=t.options)||void 0===n?void 0:n.redirectTo,scopes:null===(r=t.options)||void 0===r?void 0:r.scopes,queryParams:null===(i=t.options)||void 0===i?void 0:i.queryParams,skipBrowserRedirect:!0});return await Ht(this.fetch,"GET",u,{headers:this.headers,jwt:null!==(o=null===(s=a.session)||void 0===s?void 0:s.access_token)&&void 0!==o?o:void 0})}));if(r)throw r;return mt()&&!(null===(e=t.options)||void 0===e?void 0:e.skipBrowserRedirect)&&window.location.assign(null==n?void 0:n.url),{data:{provider:t.provider,url:null==n?void 0:n.url},error:null}}catch(e){if(Nt(e))return{data:{provider:t.provider,url:null},error:e};throw e}}async unlinkIdentity(t){try{return await this._useSession((async e=>{var n,r;const{data:i,error:s}=e;if(s)throw s;return await Ht(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:null!==(r=null===(n=i.session)||void 0===n?void 0:n.access_token)&&void 0!==r?r:void 0})}))}catch(t){if(Nt(t))return{data:null,error:t};throw t}}async _refreshAccessToken(t){const e=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(e,"begin");try{const i=Date.now();return await(n=async n=>(await async function(t){return await new Promise((e=>{setTimeout((()=>e(null)),t)}))}(200*n),this._debug(e,"refreshing attempt",n),await Ht(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:zt})),r=(t,e,n)=>n&&n.error&&Bt(n.error)&&Date.now()+200*(t+1)-i<ue,new Promise(((t,e)=>{(async()=>{for(let i=0;i<1/0;i++)try{const e=await n(i);if(!r(i,0,e))return void t(e)}catch(t){if(!r(i))return void e(t)}})()})))}catch(t){if(this._debug(e,"error",t),Nt(t))return{data:{session:null,user:null},error:t};throw t}finally{this._debug(e,"end")}var n,r}_isValidSession(t){return"object"==typeof t&&null!==t&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,e){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:e.redirectTo,scopes:e.scopes,queryParams:e.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",e,"url",n),mt()&&!e.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t;const e="#_recoverAndRefresh()";this._debug(e,"begin");try{const n=await St(this.storage,this.storageKey);if(this._debug(e,"session from storage",n),!this._isValidSession(n))return this._debug(e,"session is not valid"),void(null!==n&&await this._removeSession());const r=Math.round(Date.now()/1e3),i=(null!==(t=n.expires_at)&&void 0!==t?t:1/0)<r+10;if(this._debug(e,`session has${i?"":" not"} expired with margin of 10s`),i){if(this.autoRefreshToken&&n.refresh_token){const{error:t}=await this._callRefreshToken(n.refresh_token);t&&(console.error(t),Bt(t)||(this._debug(e,"refresh failed with a non-retryable error, removing the session",t),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(t){return this._debug(e,"error",t),void console.error(t)}finally{this._debug(e,"end")}}async _callRefreshToken(t){var e,n;if(!t)throw new Lt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new It;const{data:e,error:n}=await this._refreshAccessToken(t);if(n)throw n;if(!e.session)throw new Lt;await this._saveSession(e.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",e.session);const r={session:e.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(t){if(this._debug(r,"error",t),Nt(t)){const n={session:null,error:t};return Bt(t)||(await this._removeSession(),await this._notifyAllSubscribers("SIGNED_OUT",null)),null===(e=this.refreshingDeferred)||void 0===e||e.resolve(n),n}throw null===(n=this.refreshingDeferred)||void 0===n||n.reject(t),t}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(t,e,n=!0){const r=`#_notifyAllSubscribers(${t})`;this._debug(r,"begin",e,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:e});const r=[],i=Array.from(this.stateChangeEmitters.values()).map((async n=>{try{await n.callback(t,e)}catch(t){r.push(t)}}));if(await Promise.all(i),r.length>0){for(let t=0;t<r.length;t+=1)console.error(r[t]);throw r[0]}}finally{this._debug(r,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),await Et(this.storage,this.storageKey,t)}async _removeSession(){this._debug("#_removeSession()"),await Tt(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&mt()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval((()=>this._autoRefreshTokenTick()),ue);this.autoRefreshTicker=t,t&&"object"==typeof t&&"function"==typeof t.unref?t.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(t),setTimeout((async()=>{await this.initializePromise,await this._autoRefreshTokenTick()}),0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,(async()=>{try{const t=Date.now();try{return await this._useSession((async e=>{const{data:{session:n}}=e;if(!n||!n.refresh_token||!n.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*n.expires_at-t)/ue);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&await this._callRefreshToken(n.refresh_token)}))}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(t){if(!(t.isAcquireTimeout||t instanceof se))throw t;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!mt()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const e=`#_onVisibilityChanged(${t})`;this._debug(e,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,(async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(e,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,e,n){const r=[`provider=${encodeURIComponent(e)}`];if((null==n?void 0:n.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),(null==n?void 0:n.scopes)&&r.push(`scopes=${encodeURIComponent(n.scopes)}`),"pkce"===this.flowType){const t=Ct();await Et(this.storage,`${this.storageKey}-code-verifier`,t);const e=await At(t),n=t===e?"plain":"s256";this._debug("PKCE","code verifier",`${t.substring(0,5)}...`,"code challenge",e,"method",n);const i=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(n)}`});r.push(i.toString())}if(null==n?void 0:n.queryParams){const t=new URLSearchParams(n.queryParams);r.push(t.toString())}return(null==n?void 0:n.skipBrowserRedirect)&&r.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${r.join("&")}`}async _unenroll(t){try{return await this._useSession((async e=>{var n;const{data:r,error:i}=e;return i?{data:null,error:i}:await Ht(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:null===(n=null==r?void 0:r.session)||void 0===n?void 0:n.access_token})}))}catch(t){if(Nt(t))return{data:null,error:t};throw t}}async _enroll(t){try{return await this._useSession((async e=>{var n,r;const{data:i,error:s}=e;if(s)return{data:null,error:s};const{data:o,error:a}=await Ht(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:t.friendlyName,factor_type:t.factorType,issuer:t.issuer},headers:this.headers,jwt:null===(n=null==i?void 0:i.session)||void 0===n?void 0:n.access_token});return a?{data:null,error:a}:((null===(r=null==o?void 0:o.totp)||void 0===r?void 0:r.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})}))}catch(t){if(Nt(t))return{data:null,error:t};throw t}}async _verify(t){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async e=>{var n;const{data:r,error:i}=e;if(i)return{data:null,error:i};const{data:s,error:o}=await Ht(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:null===(n=null==r?void 0:r.session)||void 0===n?void 0:n.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+s.expires_in},s)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",s),{data:s,error:o})}))}catch(t){if(Nt(t))return{data:null,error:t};throw t}}))}async _challenge(t){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async e=>{var n;const{data:r,error:i}=e;return i?{data:null,error:i}:await Ht(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{headers:this.headers,jwt:null===(n=null==r?void 0:r.session)||void 0===n?void 0:n.access_token})}))}catch(t){if(Nt(t))return{data:null,error:t};throw t}}))}async _challengeAndVerify(t){const{data:e,error:n}=await this._challenge({factorId:t.factorId});return n?{data:null,error:n}:await this._verify({factorId:t.factorId,challengeId:e.id,code:t.code})}async _listFactors(){const{data:{user:t},error:e}=await this.getUser();if(e)return{data:null,error:e};const n=(null==t?void 0:t.factors)||[],r=n.filter((t=>"totp"===t.factor_type&&"verified"===t.status));return{data:{all:n,totp:r},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,(async()=>await this._useSession((async t=>{var e,n;const{data:{session:r},error:i}=t;if(i)return{data:null,error:i};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const s=this._decodeJWT(r.access_token);let o=null;s.aal&&(o=s.aal);let a=o;return(null!==(n=null===(e=r.user.factors)||void 0===e?void 0:e.filter((t=>"verified"===t.status)))&&void 0!==n?n:[]).length>0&&(a="aal2"),{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:s.amr||[]},error:null}}))))}}he.nextInstanceID=0;class de extends he{constructor(t){super(t)}}const fe={headers:ft},pe={schema:"public"},ge={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},me={};class ye{constructor(t,e,n){var r,i,s,o,a,c,u,l;if(this.supabaseUrl=t,this.supabaseKey=e,this.from=t=>this.rest.from(t),this.schema=t=>this.rest.schema(t),this.rpc=(t,e={},n)=>this.rest.rpc(t,e,n),!t)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");const h=t.replace(/\/$/,"");this.realtimeUrl=`${h}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${h}/auth/v1`,this.storageUrl=`${h}/storage/v1`,this.functionsUrl=`${h}/functions/v1`;const d=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,f=function(t,e){const{db:n,auth:r,realtime:i,global:s}=t,{db:o,auth:a,realtime:c,global:u}=e;return{db:Object.assign(Object.assign({},o),n),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},c),i),global:Object.assign(Object.assign({},u),s)}}(null!=n?n:{},{db:pe,realtime:me,auth:Object.assign(Object.assign({},ge),{storageKey:d}),global:fe});this.storageKey=null!==(i=null===(r=f.auth)||void 0===r?void 0:r.storageKey)&&void 0!==i?i:"",this.headers=null!==(o=null===(s=f.global)||void 0===s?void 0:s.headers)&&void 0!==o?o:{},this.auth=this._initSupabaseAuthClient(null!==(a=f.auth)&&void 0!==a?a:{},this.headers,null===(c=f.global)||void 0===c?void 0:c.fetch),this.fetch=gt(e,this._getAccessToken.bind(this),null===(u=f.global)||void 0===u?void 0:u.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},f.realtime)),this.rest=new p(`${h}/rest/v1`,{headers:this.headers,schema:null===(l=f.db)||void 0===l?void 0:l.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new a(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new ht(this.storageUrl,this.headers,this.fetch)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,e,n,r,i,s;return n=this,r=void 0,s=function*(){const{data:n}=yield this.auth.getSession();return null!==(e=null===(t=n.session)||void 0===t?void 0:t.access_token)&&void 0!==e?e:null},new((i=void 0)||(i=Promise))((function(t,e){function o(t){try{c(s.next(t))}catch(t){e(t)}}function a(t){try{c(s.throw(t))}catch(t){e(t)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(t){t(n)}))).then(o,a)}c((s=s.apply(n,r||[])).next())}))}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:r,storageKey:i,flowType:s,debug:o},a,c){const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new de({url:this.authUrl,headers:Object.assign(Object.assign({},u),a),storageKey:i,autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:r,flowType:s,debug:o,fetch:c})}_initRealtimeClient(t){return new G(this.realtimeUrl,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},null==t?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange(((t,e)=>{this._handleTokenChanged(t,"CLIENT",null==e?void 0:e.access_token)}))}_handleTokenChanged(t,e,n){"TOKEN_REFRESHED"!==t&&"SIGNED_IN"!==t||this.changedAccessToken===n?"SIGNED_OUT"===t&&(this.realtime.setAuth(this.supabaseKey),"STORAGE"==e&&this.auth.signOut(),this.changedAccessToken=void 0):(this.realtime.setAuth(null!=n?n:null),this.changedAccessToken=n)}}const ve=(t,e,n)=>new ye(t,e,n)},9282:(t,e,n)=>{"use strict";function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==r(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i.key),"symbol"===r(s)?s:String(s)),i)}var s}function s(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var o,a,c=n(2136).codes,u=c.ERR_AMBIGUOUS_ARGUMENT,l=c.ERR_INVALID_ARG_TYPE,h=c.ERR_INVALID_ARG_VALUE,d=c.ERR_INVALID_RETURN_VALUE,f=c.ERR_MISSING_ARGS,p=n(5961),g=n(9539).inspect,m=n(9539).types,y=m.isPromise,v=m.isRegExp,_=n(8162)(),w=n(5624)(),b=n(1924)("RegExp.prototype.test");function E(){var t=n(9158);o=t.isDeepEqual,a=t.isDeepStrictEqual}new Map;var S=!1,T=t.exports=C,I={};function O(t){if(t.message instanceof Error)throw t.message;throw new p(t)}function k(t,e,n,r){if(!n){var i=!1;if(0===e)i=!0,r="No value argument passed to `assert.ok()`";else if(r instanceof Error)throw r;var s=new p({actual:n,expected:!0,message:r,operator:"==",stackStartFn:t});throw s.generatedMessage=i,s}}function C(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];k.apply(void 0,[C,e.length].concat(e))}T.fail=function t(e,n,r,i,s){var o,a=arguments.length;if(0===a?o="Failed":1===a?(r=e,e=void 0):(!1===S&&(S=!0,(process.emitWarning?process.emitWarning:console.warn.bind(console))("assert.fail() with more than one argument is deprecated. Please use assert.strictEqual() instead or only pass a message.","DeprecationWarning","DEP0094")),2===a&&(i="!=")),r instanceof Error)throw r;var c={actual:e,expected:n,operator:void 0===i?"fail":i,stackStartFn:s||t};void 0!==r&&(c.message=r);var u=new p(c);throw o&&(u.message=o,u.generatedMessage=!0),u},T.AssertionError=p,T.ok=C,T.equal=function t(e,n,r){if(arguments.length<2)throw new f("actual","expected");e!=n&&O({actual:e,expected:n,message:r,operator:"==",stackStartFn:t})},T.notEqual=function t(e,n,r){if(arguments.length<2)throw new f("actual","expected");e==n&&O({actual:e,expected:n,message:r,operator:"!=",stackStartFn:t})},T.deepEqual=function t(e,n,r){if(arguments.length<2)throw new f("actual","expected");void 0===o&&E(),o(e,n)||O({actual:e,expected:n,message:r,operator:"deepEqual",stackStartFn:t})},T.notDeepEqual=function t(e,n,r){if(arguments.length<2)throw new f("actual","expected");void 0===o&&E(),o(e,n)&&O({actual:e,expected:n,message:r,operator:"notDeepEqual",stackStartFn:t})},T.deepStrictEqual=function t(e,n,r){if(arguments.length<2)throw new f("actual","expected");void 0===o&&E(),a(e,n)||O({actual:e,expected:n,message:r,operator:"deepStrictEqual",stackStartFn:t})},T.notDeepStrictEqual=function t(e,n,r){if(arguments.length<2)throw new f("actual","expected");void 0===o&&E(),a(e,n)&&O({actual:e,expected:n,message:r,operator:"notDeepStrictEqual",stackStartFn:t})},T.strictEqual=function t(e,n,r){if(arguments.length<2)throw new f("actual","expected");w(e,n)||O({actual:e,expected:n,message:r,operator:"strictEqual",stackStartFn:t})},T.notStrictEqual=function t(e,n,r){if(arguments.length<2)throw new f("actual","expected");w(e,n)&&O({actual:e,expected:n,message:r,operator:"notStrictEqual",stackStartFn:t})};var A=s((function t(e,n,r){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n.forEach((function(t){t in e&&(void 0!==r&&"string"==typeof r[t]&&v(e[t])&&b(e[t],r[t])?i[t]=r[t]:i[t]=e[t])}))}));function R(t,e,n,i){if("function"!=typeof e){if(v(e))return b(e,t);if(2===arguments.length)throw new l("expected",["Function","RegExp"],e);if("object"!==r(t)||null===t){var s=new p({actual:t,expected:e,message:n,operator:"deepStrictEqual",stackStartFn:i});throw s.operator=i.name,s}var c=Object.keys(e);if(e instanceof Error)c.push("name","message");else if(0===c.length)throw new h("error",e,"may not be an empty object");return void 0===o&&E(),c.forEach((function(r){"string"==typeof t[r]&&v(e[r])&&b(e[r],t[r])||function(t,e,n,r,i,s){if(!(n in t)||!a(t[n],e[n])){if(!r){var o=new A(t,i),c=new A(e,i,t),u=new p({actual:o,expected:c,operator:"deepStrictEqual",stackStartFn:s});throw u.actual=t,u.expected=e,u.operator=s.name,u}O({actual:t,expected:e,message:r,operator:s.name,stackStartFn:s})}}(t,e,r,n,c,i)})),!0}return void 0!==e.prototype&&t instanceof e||!Error.isPrototypeOf(e)&&!0===e.call({},t)}function N(t){if("function"!=typeof t)throw new l("fn","Function",t);try{t()}catch(t){return t}return I}function x(t){return y(t)||null!==t&&"object"===r(t)&&"function"==typeof t.then&&"function"==typeof t.catch}function D(t){return Promise.resolve().then((function(){var e;if("function"==typeof t){if(!x(e=t()))throw new d("instance of Promise","promiseFn",e)}else{if(!x(t))throw new l("promiseFn",["Function","Promise"],t);e=t}return Promise.resolve().then((function(){return e})).then((function(){return I})).catch((function(t){return t}))}))}function P(t,e,n,i){if("string"==typeof n){if(4===arguments.length)throw new l("error",["Object","Error","Function","RegExp"],n);if("object"===r(e)&&null!==e){if(e.message===n)throw new u("error/message",'The error message "'.concat(e.message,'" is identical to the message.'))}else if(e===n)throw new u("error/message",'The error "'.concat(e,'" is identical to the message.'));i=n,n=void 0}else if(null!=n&&"object"!==r(n)&&"function"!=typeof n)throw new l("error",["Object","Error","Function","RegExp"],n);if(e===I){var s="";n&&n.name&&(s+=" (".concat(n.name,")")),s+=i?": ".concat(i):".";var o="rejects"===t.name?"rejection":"exception";O({actual:void 0,expected:n,operator:t.name,message:"Missing expected ".concat(o).concat(s),stackStartFn:t})}if(n&&!R(e,n,i,t))throw e}function L(t,e,n,r){if(e!==I){if("string"==typeof n&&(r=n,n=void 0),!n||R(e,n)){var i=r?": ".concat(r):".",s="doesNotReject"===t.name?"rejection":"exception";O({actual:e,expected:n,operator:t.name,message:"Got unwanted ".concat(s).concat(i,"\n")+'Actual message: "'.concat(e&&e.message,'"'),stackStartFn:t})}throw e}}function j(t,e,n,i,s){if(!v(e))throw new l("regexp","RegExp",e);var o="match"===s;if("string"!=typeof t||b(e,t)!==o){if(n instanceof Error)throw n;var a=!n;n=n||("string"!=typeof t?'The "string" argument must be of type string. Received type '+"".concat(r(t)," (").concat(g(t),")"):(o?"The input did not match the regular expression ":"The input was expected to not match the regular expression ")+"".concat(g(e),". Input:\n\n").concat(g(t),"\n"));var c=new p({actual:t,expected:e,message:n,operator:s,stackStartFn:i});throw c.generatedMessage=a,c}}function U(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];k.apply(void 0,[U,e.length].concat(e))}T.throws=function t(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];P.apply(void 0,[t,N(e)].concat(r))},T.rejects=function t(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return D(e).then((function(e){return P.apply(void 0,[t,e].concat(r))}))},T.doesNotThrow=function t(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];L.apply(void 0,[t,N(e)].concat(r))},T.doesNotReject=function t(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return D(e).then((function(e){return L.apply(void 0,[t,e].concat(r))}))},T.ifError=function t(e){if(null!=e){var n="ifError got unwanted exception: ";"object"===r(e)&&"string"==typeof e.message?0===e.message.length&&e.constructor?n+=e.constructor.name:n+=e.message:n+=g(e);var i=new p({actual:e,expected:null,operator:"ifError",message:n,stackStartFn:t}),s=e.stack;if("string"==typeof s){var o=s.split("\n");o.shift();for(var a=i.stack.split("\n"),c=0;c<o.length;c++){var u=a.indexOf(o[c]);if(-1!==u){a=a.slice(0,u);break}}i.stack="".concat(a.join("\n"),"\n").concat(o.join("\n"))}throw i}},T.match=function t(e,n,r){j(e,n,r,t,"match")},T.doesNotMatch=function t(e,n,r){j(e,n,r,t,"doesNotMatch")},T.strict=_(U,T,{equal:T.strictEqual,deepEqual:T.deepStrictEqual,notEqual:T.notStrictEqual,notDeepEqual:T.notDeepStrictEqual}),T.strict.strict=T.strict},5961:(t,e,n)=>{"use strict";function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){var r,i,s;r=t,i=e,s=n[e],(i=o(i))in r?Object.defineProperty(r,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[i]=s})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,o(r.key),r)}}function o(t){var e=function(t,e){if("object"!==p(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==p(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===p(e)?e:String(e)}function a(t,e){if(e&&("object"===p(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return c(t)}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t){var e="function"==typeof Map?new Map:void 0;return u=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return l(t,arguments,f(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),d(r,t)},u(t)}function l(t,e,n){return l=h()?Reflect.construct.bind():function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&d(i,n.prototype),i},l.apply(null,arguments)}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function d(t,e){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},d(t,e)}function f(t){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},f(t)}function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}var g=n(9539).inspect,m=n(2136).codes.ERR_INVALID_ARG_TYPE;function y(t,e,n){return(void 0===n||n>t.length)&&(n=t.length),t.substring(n-e.length,n)===e}var v="",_="",w="",b="",E={deepStrictEqual:"Expected values to be strictly deep-equal:",strictEqual:"Expected values to be strictly equal:",strictEqualObject:'Expected "actual" to be reference-equal to "expected":',deepEqual:"Expected values to be loosely deep-equal:",equal:"Expected values to be loosely equal:",notDeepStrictEqual:'Expected "actual" not to be strictly deep-equal to:',notStrictEqual:'Expected "actual" to be strictly unequal to:',notStrictEqualObject:'Expected "actual" not to be reference-equal to "expected":',notDeepEqual:'Expected "actual" not to be loosely deep-equal to:',notEqual:'Expected "actual" to be loosely unequal to:',notIdentical:"Values identical but not reference-equal:"};function S(t){var e=Object.keys(t),n=Object.create(Object.getPrototypeOf(t));return e.forEach((function(e){n[e]=t[e]})),Object.defineProperty(n,"message",{value:t.message}),n}function T(t){return g(t,{compact:!1,customInspect:!1,depth:1e3,maxArrayLength:1/0,showHidden:!1,breakLength:1/0,showProxy:!1,sorted:!0,getters:!0})}var I=function(t,e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&d(t,e)}(I,t);var n,r,o,u,l=(n=I,r=h(),function(){var t,e=f(n);if(r){var i=f(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return a(this,t)});function I(t){var e;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,I),"object"!==p(t)||null===t)throw new m("options","Object",t);var n=t.message,r=t.operator,i=t.stackStartFn,s=t.actual,o=t.expected,u=Error.stackTraceLimit;if(Error.stackTraceLimit=0,null!=n)e=l.call(this,String(n));else if(process.stderr&&process.stderr.isTTY&&(process.stderr&&process.stderr.getColorDepth&&1!==process.stderr.getColorDepth()?(v="[34m",_="[32m",b="[39m",w="[31m"):(v="",_="",b="",w="")),"object"===p(s)&&null!==s&&"object"===p(o)&&null!==o&&"stack"in s&&s instanceof Error&&"stack"in o&&o instanceof Error&&(s=S(s),o=S(o)),"deepStrictEqual"===r||"strictEqual"===r)e=l.call(this,function(t,e,n){var r="",i="",s=0,o="",a=!1,c=T(t),u=c.split("\n"),l=T(e).split("\n"),h=0,d="";if("strictEqual"===n&&"object"===p(t)&&"object"===p(e)&&null!==t&&null!==e&&(n="strictEqualObject"),1===u.length&&1===l.length&&u[0]!==l[0]){var f=u[0].length+l[0].length;if(f<=10){if(!("object"===p(t)&&null!==t||"object"===p(e)&&null!==e||0===t&&0===e))return"".concat(E[n],"\n\n")+"".concat(u[0]," !== ").concat(l[0],"\n")}else if("strictEqualObject"!==n&&f<(process.stderr&&process.stderr.isTTY?process.stderr.columns:80)){for(;u[0][h]===l[0][h];)h++;h>2&&(d="\n  ".concat(function(t,e){if(e=Math.floor(e),0==t.length||0==e)return"";var n=t.length*e;for(e=Math.floor(Math.log(e)/Math.log(2));e;)t+=t,e--;return t+t.substring(0,n-t.length)}(" ",h),"^"),h=0)}}for(var g=u[u.length-1],m=l[l.length-1];g===m&&(h++<2?o="\n  ".concat(g).concat(o):r=g,u.pop(),l.pop(),0!==u.length&&0!==l.length);)g=u[u.length-1],m=l[l.length-1];var S=Math.max(u.length,l.length);if(0===S){var I=c.split("\n");if(I.length>30)for(I[26]="".concat(v,"...").concat(b);I.length>27;)I.pop();return"".concat(E.notIdentical,"\n\n").concat(I.join("\n"),"\n")}h>3&&(o="\n".concat(v,"...").concat(b).concat(o),a=!0),""!==r&&(o="\n  ".concat(r).concat(o),r="");var O=0,k=E[n]+"\n".concat(_,"+ actual").concat(b," ").concat(w,"- expected").concat(b),C=" ".concat(v,"...").concat(b," Lines skipped");for(h=0;h<S;h++){var A=h-s;if(u.length<h+1)A>1&&h>2&&(A>4?(i+="\n".concat(v,"...").concat(b),a=!0):A>3&&(i+="\n  ".concat(l[h-2]),O++),i+="\n  ".concat(l[h-1]),O++),s=h,r+="\n".concat(w,"-").concat(b," ").concat(l[h]),O++;else if(l.length<h+1)A>1&&h>2&&(A>4?(i+="\n".concat(v,"...").concat(b),a=!0):A>3&&(i+="\n  ".concat(u[h-2]),O++),i+="\n  ".concat(u[h-1]),O++),s=h,i+="\n".concat(_,"+").concat(b," ").concat(u[h]),O++;else{var R=l[h],N=u[h],x=N!==R&&(!y(N,",")||N.slice(0,-1)!==R);x&&y(R,",")&&R.slice(0,-1)===N&&(x=!1,N+=","),x?(A>1&&h>2&&(A>4?(i+="\n".concat(v,"...").concat(b),a=!0):A>3&&(i+="\n  ".concat(u[h-2]),O++),i+="\n  ".concat(u[h-1]),O++),s=h,i+="\n".concat(_,"+").concat(b," ").concat(N),r+="\n".concat(w,"-").concat(b," ").concat(R),O+=2):(i+=r,r="",1!==A&&0!==h||(i+="\n  ".concat(N),O++))}if(O>20&&h<S-2)return"".concat(k).concat(C,"\n").concat(i,"\n").concat(v,"...").concat(b).concat(r,"\n")+"".concat(v,"...").concat(b)}return"".concat(k).concat(a?C:"","\n").concat(i).concat(r).concat(o).concat(d)}(s,o,r));else if("notDeepStrictEqual"===r||"notStrictEqual"===r){var h=E[r],d=T(s).split("\n");if("notStrictEqual"===r&&"object"===p(s)&&null!==s&&(h=E.notStrictEqualObject),d.length>30)for(d[26]="".concat(v,"...").concat(b);d.length>27;)d.pop();e=1===d.length?l.call(this,"".concat(h," ").concat(d[0])):l.call(this,"".concat(h,"\n\n").concat(d.join("\n"),"\n"))}else{var f=T(s),g="",O=E[r];"notDeepEqual"===r||"notEqual"===r?(f="".concat(E[r],"\n\n").concat(f)).length>1024&&(f="".concat(f.slice(0,1021),"...")):(g="".concat(T(o)),f.length>512&&(f="".concat(f.slice(0,509),"...")),g.length>512&&(g="".concat(g.slice(0,509),"...")),"deepEqual"===r||"equal"===r?f="".concat(O,"\n\n").concat(f,"\n\nshould equal\n\n"):g=" ".concat(r," ").concat(g)),e=l.call(this,"".concat(f).concat(g))}return Error.stackTraceLimit=u,e.generatedMessage=!n,Object.defineProperty(c(e),"name",{value:"AssertionError [ERR_ASSERTION]",enumerable:!1,writable:!0,configurable:!0}),e.code="ERR_ASSERTION",e.actual=s,e.expected=o,e.operator=r,Error.captureStackTrace&&Error.captureStackTrace(c(e),i),e.stack,e.name="AssertionError",a(e)}return o=I,(u=[{key:"toString",value:function(){return"".concat(this.name," [").concat(this.code,"]: ").concat(this.message)}},{key:e,value:function(t,e){return g(this,i(i({},e),{},{customInspect:!1,depth:0}))}}])&&s(o.prototype,u),Object.defineProperty(o,"prototype",{writable:!1}),I}(u(Error),g.custom);t.exports=I},2136:(t,e,n)=>{"use strict";function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},i(t,e)}function s(t){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},s(t)}var o,a,c={};function u(t,e,n){n||(n=Error);var o=function(n){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&i(t,e)}(l,n);var o,a,c,u=(a=l,c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=s(a);if(c){var n=s(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function l(n,r,i){var s;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,l),s=u.call(this,function(t,n,r){return"string"==typeof e?e:e(t,n,r)}(n,r,i)),s.code=t,s}return o=l,Object.defineProperty(o,"prototype",{writable:!1}),o}(n);c[t]=o}function l(t,e){if(Array.isArray(t)){var n=t.length;return t=t.map((function(t){return String(t)})),n>2?"one of ".concat(e," ").concat(t.slice(0,n-1).join(", "),", or ")+t[n-1]:2===n?"one of ".concat(e," ").concat(t[0]," or ").concat(t[1]):"of ".concat(e," ").concat(t[0])}return"of ".concat(e," ").concat(String(t))}u("ERR_AMBIGUOUS_ARGUMENT",'The "%s" argument is ambiguous. %s',TypeError),u("ERR_INVALID_ARG_TYPE",(function(t,e,i){var s,a,c,u,h;if(void 0===o&&(o=n(9282)),o("string"==typeof t,"'name' must be a string"),"string"==typeof e&&(a="not ",e.substr(0,4)===a)?(s="must not be",e=e.replace(/^not /,"")):s="must be",function(t,e,n){return(void 0===n||n>t.length)&&(n=t.length),t.substring(n-9,n)===e}(t," argument"))c="The ".concat(t," ").concat(s," ").concat(l(e,"type"));else{var d=("number"!=typeof h&&(h=0),h+1>(u=t).length||-1===u.indexOf(".",h)?"argument":"property");c='The "'.concat(t,'" ').concat(d," ").concat(s," ").concat(l(e,"type"))}return c+". Received type ".concat(r(i))}),TypeError),u("ERR_INVALID_ARG_VALUE",(function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"is invalid";void 0===a&&(a=n(9539));var i=a.inspect(e);return i.length>128&&(i="".concat(i.slice(0,128),"...")),"The argument '".concat(t,"' ").concat(r,". Received ").concat(i)}),TypeError,RangeError),u("ERR_INVALID_RETURN_VALUE",(function(t,e,n){var i;return i=n&&n.constructor&&n.constructor.name?"instance of ".concat(n.constructor.name):"type ".concat(r(n)),"Expected ".concat(t,' to be returned from the "').concat(e,'"')+" function but got ".concat(i,".")}),TypeError),u("ERR_MISSING_ARGS",(function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];void 0===o&&(o=n(9282)),o(e.length>0,"At least one arg needs to be specified");var i="The ",s=e.length;switch(e=e.map((function(t){return'"'.concat(t,'"')})),s){case 1:i+="".concat(e[0]," argument");break;case 2:i+="".concat(e[0]," and ").concat(e[1]," arguments");break;default:i+=e.slice(0,s-1).join(", "),i+=", and ".concat(e[s-1]," arguments")}return"".concat(i," must be specified")}),TypeError),t.exports.codes=c},9158:(t,e,n)=>{"use strict";function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],c=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(t){u=!0,i=t}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}var o=void 0!==/a/g.flags,a=function(t){var e=[];return t.forEach((function(t){return e.push(t)})),e},c=function(t){var e=[];return t.forEach((function(t,n){return e.push([n,t])})),e},u=Object.is?Object.is:n(609),l=Object.getOwnPropertySymbols?Object.getOwnPropertySymbols:function(){return[]},h=Number.isNaN?Number.isNaN:n(360);function d(t){return t.call.bind(t)}var f=d(Object.prototype.hasOwnProperty),p=d(Object.prototype.propertyIsEnumerable),g=d(Object.prototype.toString),m=n(9539).types,y=m.isAnyArrayBuffer,v=m.isArrayBufferView,_=m.isDate,w=m.isMap,b=m.isRegExp,E=m.isSet,S=m.isNativeError,T=m.isBoxedPrimitive,I=m.isNumberObject,O=m.isStringObject,k=m.isBooleanObject,C=m.isBigIntObject,A=m.isSymbolObject,R=m.isFloat32Array,N=m.isFloat64Array;function x(t){if(0===t.length||t.length>10)return!0;for(var e=0;e<t.length;e++){var n=t.charCodeAt(e);if(n<48||n>57)return!0}return 10===t.length&&t>=Math.pow(2,32)}function D(t){return Object.keys(t).filter(x).concat(l(t).filter(Object.prototype.propertyIsEnumerable.bind(t)))}function P(t,e){if(t===e)return 0;for(var n=t.length,r=e.length,i=0,s=Math.min(n,r);i<s;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0}var L=0,j=1,U=2,M=3;function F(t,e,n,r){if(t===e)return 0!==t||!n||u(t,e);if(n){if("object"!==s(t))return"number"==typeof t&&h(t)&&h(e);if("object"!==s(e)||null===t||null===e)return!1;if(Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1}else{if(null===t||"object"!==s(t))return(null===e||"object"!==s(e))&&t==e;if(null===e||"object"!==s(e))return!1}var i,a,c,l,d=g(t);if(d!==g(e))return!1;if(Array.isArray(t)){if(t.length!==e.length)return!1;var f=D(t),p=D(e);return f.length===p.length&&B(t,e,n,r,j,f)}if("[object Object]"===d&&(!w(t)&&w(e)||!E(t)&&E(e)))return!1;if(_(t)){if(!_(e)||Date.prototype.getTime.call(t)!==Date.prototype.getTime.call(e))return!1}else if(b(t)){if(!b(e)||(c=t,l=e,!(o?c.source===l.source&&c.flags===l.flags:RegExp.prototype.toString.call(c)===RegExp.prototype.toString.call(l))))return!1}else if(S(t)||t instanceof Error){if(t.message!==e.message||t.name!==e.name)return!1}else{if(v(t)){if(n||!R(t)&&!N(t)){if(!function(t,e){return t.byteLength===e.byteLength&&0===P(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}(t,e))return!1}else if(!function(t,e){if(t.byteLength!==e.byteLength)return!1;for(var n=0;n<t.byteLength;n++)if(t[n]!==e[n])return!1;return!0}(t,e))return!1;var m=D(t),x=D(e);return m.length===x.length&&B(t,e,n,r,L,m)}if(E(t))return!(!E(e)||t.size!==e.size)&&B(t,e,n,r,U);if(w(t))return!(!w(e)||t.size!==e.size)&&B(t,e,n,r,M);if(y(t)){if(a=e,(i=t).byteLength!==a.byteLength||0!==P(new Uint8Array(i),new Uint8Array(a)))return!1}else if(T(t)&&!function(t,e){return I(t)?I(e)&&u(Number.prototype.valueOf.call(t),Number.prototype.valueOf.call(e)):O(t)?O(e)&&String.prototype.valueOf.call(t)===String.prototype.valueOf.call(e):k(t)?k(e)&&Boolean.prototype.valueOf.call(t)===Boolean.prototype.valueOf.call(e):C(t)?C(e)&&BigInt.prototype.valueOf.call(t)===BigInt.prototype.valueOf.call(e):A(e)&&Symbol.prototype.valueOf.call(t)===Symbol.prototype.valueOf.call(e)}(t,e))return!1}return B(t,e,n,r,L)}function $(t,e){return e.filter((function(e){return p(t,e)}))}function B(t,e,n,i,o,u){if(5===arguments.length){u=Object.keys(t);var h=Object.keys(e);if(u.length!==h.length)return!1}for(var d=0;d<u.length;d++)if(!f(e,u[d]))return!1;if(n&&5===arguments.length){var g=l(t);if(0!==g.length){var m=0;for(d=0;d<g.length;d++){var y=g[d];if(p(t,y)){if(!p(e,y))return!1;u.push(y),m++}else if(p(e,y))return!1}var v=l(e);if(g.length!==v.length&&$(e,v).length!==m)return!1}else{var _=l(e);if(0!==_.length&&0!==$(e,_).length)return!1}}if(0===u.length&&(o===L||o===j&&0===t.length||0===t.size))return!0;if(void 0===i)i={val1:new Map,val2:new Map,position:0};else{var w=i.val1.get(t);if(void 0!==w){var b=i.val2.get(e);if(void 0!==b)return w===b}i.position++}i.val1.set(t,i.position),i.val2.set(e,i.position);var E=function(t,e,n,i,o,u){var l=0;if(u===U){if(!function(t,e,n,r){for(var i=null,o=a(t),c=0;c<o.length;c++){var u=o[c];if("object"===s(u)&&null!==u)null===i&&(i=new Set),i.add(u);else if(!e.has(u)){if(n)return!1;if(!q(t,e,u))return!1;null===i&&(i=new Set),i.add(u)}}if(null!==i){for(var l=a(e),h=0;h<l.length;h++){var d=l[h];if("object"===s(d)&&null!==d){if(!V(i,d,n,r))return!1}else if(!n&&!t.has(d)&&!V(i,d,n,r))return!1}return 0===i.size}return!0}(t,e,n,o))return!1}else if(u===M){if(!function(t,e,n,i){for(var o=null,a=c(t),u=0;u<a.length;u++){var l=r(a[u],2),h=l[0],d=l[1];if("object"===s(h)&&null!==h)null===o&&(o=new Set),o.add(h);else{var f=e.get(h);if(void 0===f&&!e.has(h)||!F(d,f,n,i)){if(n)return!1;if(!K(t,e,h,d,i))return!1;null===o&&(o=new Set),o.add(h)}}}if(null!==o){for(var p=c(e),g=0;g<p.length;g++){var m=r(p[g],2),y=m[0],v=m[1];if("object"===s(y)&&null!==y){if(!H(o,t,y,v,n,i))return!1}else if(!(n||t.has(y)&&F(t.get(y),v,!1,i)||H(o,t,y,v,!1,i)))return!1}return 0===o.size}return!0}(t,e,n,o))return!1}else if(u===j)for(;l<t.length;l++){if(!f(t,l)){if(f(e,l))return!1;for(var h=Object.keys(t);l<h.length;l++){var d=h[l];if(!f(e,d)||!F(t[d],e[d],n,o))return!1}return h.length===Object.keys(e).length}if(!f(e,l)||!F(t[l],e[l],n,o))return!1}for(l=0;l<i.length;l++){var p=i[l];if(!F(t[p],e[p],n,o))return!1}return!0}(t,e,n,u,i,o);return i.val1.delete(t),i.val2.delete(e),E}function V(t,e,n,r){for(var i=a(t),s=0;s<i.length;s++){var o=i[s];if(F(e,o,n,r))return t.delete(o),!0}return!1}function G(t){switch(s(t)){case"undefined":return null;case"object":return;case"symbol":return!1;case"string":t=+t;case"number":if(h(t))return!1}return!0}function q(t,e,n){var r=G(n);return null!=r?r:e.has(r)&&!t.has(r)}function K(t,e,n,r,i){var s=G(n);if(null!=s)return s;var o=e.get(s);return!(void 0===o&&!e.has(s)||!F(r,o,!1,i))&&!t.has(s)&&F(r,o,!1,i)}function H(t,e,n,r,i,s){for(var o=a(t),c=0;c<o.length;c++){var u=o[c];if(F(n,u,i,s)&&F(r,e.get(u),i,s))return t.delete(u),!0}return!1}t.exports={isDeepEqual:function(t,e){return F(t,e,!1)},isDeepStrictEqual:function(t,e){return F(t,e,!0)}}},1924:(t,e,n)=>{"use strict";var r=n(210),i=n(5559),s=i(r("String.prototype.indexOf"));t.exports=function(t,e){var n=r(t,!!e);return"function"==typeof n&&s(t,".prototype.")>-1?i(n):n}},5559:(t,e,n)=>{"use strict";var r=n(8612),i=n(210),s=n(7771),o=i("%TypeError%"),a=i("%Function.prototype.apply%"),c=i("%Function.prototype.call%"),u=i("%Reflect.apply%",!0)||r.call(c,a),l=i("%Object.defineProperty%",!0),h=i("%Math.max%");if(l)try{l({},"a",{value:1})}catch(t){l=null}t.exports=function(t){if("function"!=typeof t)throw new o("a function is required");var e=u(r,c,arguments);return s(e,1+h(0,t.length-(arguments.length-1)),!0)};var d=function(){return u(r,a,arguments)};l?l(t.exports,"apply",{value:d}):t.exports.apply=d},2296:(t,e,n)=>{"use strict";var r=n(1044)(),i=n(210),s=r&&i("%Object.defineProperty%",!0);if(s)try{s({},"a",{value:1})}catch(t){s=!1}var o=i("%SyntaxError%"),a=i("%TypeError%"),c=n(7296);t.exports=function(t,e,n){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new a("`obj` must be an object or a function`");if("string"!=typeof e&&"symbol"!=typeof e)throw new a("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new a("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new a("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new a("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new a("`loose`, if provided, must be a boolean");var r=arguments.length>3?arguments[3]:null,i=arguments.length>4?arguments[4]:null,u=arguments.length>5?arguments[5]:null,l=arguments.length>6&&arguments[6],h=!!c&&c(t,e);if(s)s(t,e,{configurable:null===u&&h?h.configurable:!u,enumerable:null===r&&h?h.enumerable:!r,value:n,writable:null===i&&h?h.writable:!i});else{if(!l&&(r||i||u))throw new o("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");t[e]=n}}},4289:(t,e,n)=>{"use strict";var r=n(2215),i="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),s=Object.prototype.toString,o=Array.prototype.concat,a=n(2296),c=n(1044)(),u=function(t,e,n,r){if(e in t)if(!0===r){if(t[e]===n)return}else if("function"!=typeof(i=r)||"[object Function]"!==s.call(i)||!r())return;var i;c?a(t,e,n,!0):a(t,e,n)},l=function(t,e){var n=arguments.length>2?arguments[2]:{},s=r(e);i&&(s=o.call(s,Object.getOwnPropertySymbols(e)));for(var a=0;a<s.length;a+=1)u(t,s[a],e[s[a]],n[s[a]])};l.supportsDescriptors=!!c,t.exports=l},4029:(t,e,n)=>{"use strict";var r=n(5320),i=Object.prototype.toString,s=Object.prototype.hasOwnProperty;t.exports=function(t,e,n){if(!r(e))throw new TypeError("iterator must be a function");var o;arguments.length>=3&&(o=n),"[object Array]"===i.call(t)?function(t,e,n){for(var r=0,i=t.length;r<i;r++)s.call(t,r)&&(null==n?e(t[r],r,t):e.call(n,t[r],r,t))}(t,e,o):"string"==typeof t?function(t,e,n){for(var r=0,i=t.length;r<i;r++)null==n?e(t.charAt(r),r,t):e.call(n,t.charAt(r),r,t)}(t,e,o):function(t,e,n){for(var r in t)s.call(t,r)&&(null==n?e(t[r],r,t):e.call(n,t[r],r,t))}(t,e,o)}},7648:t=>{"use strict";var e=Object.prototype.toString,n=Math.max,r=function(t,e){for(var n=[],r=0;r<t.length;r+=1)n[r]=t[r];for(var i=0;i<e.length;i+=1)n[i+t.length]=e[i];return n};t.exports=function(t){var i=this;if("function"!=typeof i||"[object Function]"!==e.apply(i))throw new TypeError("Function.prototype.bind called on incompatible "+i);for(var s,o=function(t,e){for(var n=[],r=1,i=0;r<t.length;r+=1,i+=1)n[i]=t[r];return n}(arguments),a=n(0,i.length-o.length),c=[],u=0;u<a;u++)c[u]="$"+u;if(s=Function("binder","return function ("+function(t,e){for(var n="",r=0;r<t.length;r+=1)n+=t[r],r+1<t.length&&(n+=",");return n}(c)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof s){var e=i.apply(this,r(o,arguments));return Object(e)===e?e:this}return i.apply(t,r(o,arguments))})),i.prototype){var l=function(){};l.prototype=i.prototype,s.prototype=new l,l.prototype=null}return s}},8612:(t,e,n)=>{"use strict";var r=n(7648);t.exports=Function.prototype.bind||r},210:(t,e,n)=>{"use strict";var r,i=SyntaxError,s=Function,o=TypeError,a=function(t){try{return s('"use strict"; return ('+t+").constructor;")()}catch(t){}},c=Object.getOwnPropertyDescriptor;if(c)try{c({},"")}catch(t){c=null}var u=function(){throw new o},l=c?function(){try{return u}catch(t){try{return c(arguments,"callee").get}catch(t){return u}}}():u,h=n(1405)(),d=n(8185)(),f=Object.getPrototypeOf||(d?function(t){return t.__proto__}:null),p={},g="undefined"!=typeof Uint8Array&&f?f(Uint8Array):r,m={"%AggregateError%":"undefined"==typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":h&&f?f([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"==typeof Atomics?r:Atomics,"%BigInt%":"undefined"==typeof BigInt?r:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?r:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?r:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":s,"%GeneratorFunction%":p,"%Int8Array%":"undefined"==typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":h&&f?f(f([][Symbol.iterator]())):r,"%JSON%":"object"==typeof JSON?JSON:r,"%Map%":"undefined"==typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&h&&f?f((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?r:Promise,"%Proxy%":"undefined"==typeof Proxy?r:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&h&&f?f((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":h&&f?f(""[Symbol.iterator]()):r,"%Symbol%":h?Symbol:r,"%SyntaxError%":i,"%ThrowTypeError%":l,"%TypedArray%":g,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?r:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?r:WeakSet};if(f)try{null.error}catch(t){var y=f(f(t));m["%Error.prototype%"]=y}var v=function t(e){var n;if("%AsyncFunction%"===e)n=a("async function () {}");else if("%GeneratorFunction%"===e)n=a("function* () {}");else if("%AsyncGeneratorFunction%"===e)n=a("async function* () {}");else if("%AsyncGenerator%"===e){var r=t("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===e){var i=t("%AsyncGenerator%");i&&f&&(n=f(i.prototype))}return m[e]=n,n},_={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},w=n(8612),b=n(8824),E=w.call(Function.call,Array.prototype.concat),S=w.call(Function.apply,Array.prototype.splice),T=w.call(Function.call,String.prototype.replace),I=w.call(Function.call,String.prototype.slice),O=w.call(Function.call,RegExp.prototype.exec),k=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,C=/\\(\\)?/g,A=function(t,e){var n,r=t;if(b(_,r)&&(r="%"+(n=_[r])[0]+"%"),b(m,r)){var s=m[r];if(s===p&&(s=v(r)),void 0===s&&!e)throw new o("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:s}}throw new i("intrinsic "+t+" does not exist!")};t.exports=function(t,e){if("string"!=typeof t||0===t.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new o('"allowMissing" argument must be a boolean');if(null===O(/^%?[^%]*%?$/,t))throw new i("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=function(t){var e=I(t,0,1),n=I(t,-1);if("%"===e&&"%"!==n)throw new i("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==e)throw new i("invalid intrinsic syntax, expected opening `%`");var r=[];return T(t,k,(function(t,e,n,i){r[r.length]=n?T(i,C,"$1"):e||t})),r}(t),r=n.length>0?n[0]:"",s=A("%"+r+"%",e),a=s.name,u=s.value,l=!1,h=s.alias;h&&(r=h[0],S(n,E([0,1],h)));for(var d=1,f=!0;d<n.length;d+=1){var p=n[d],g=I(p,0,1),y=I(p,-1);if(('"'===g||"'"===g||"`"===g||'"'===y||"'"===y||"`"===y)&&g!==y)throw new i("property names with quotes must have matching quotes");if("constructor"!==p&&f||(l=!0),b(m,a="%"+(r+="."+p)+"%"))u=m[a];else if(null!=u){if(!(p in u)){if(!e)throw new o("base intrinsic for "+t+" exists, but the property is not available.");return}if(c&&d+1>=n.length){var v=c(u,p);u=(f=!!v)&&"get"in v&&!("originalValue"in v.get)?v.get:u[p]}else f=b(u,p),u=u[p];f&&!l&&(m[a]=u)}}return u}},7296:(t,e,n)=>{"use strict";var r=n(210)("%Object.getOwnPropertyDescriptor%",!0);if(r)try{r([],"length")}catch(t){r=null}t.exports=r},1044:(t,e,n)=>{"use strict";var r=n(210)("%Object.defineProperty%",!0),i=function(){if(r)try{return r({},"a",{value:1}),!0}catch(t){return!1}return!1};i.hasArrayLengthDefineBug=function(){if(!i())return null;try{return 1!==r([],"length",{value:1}).length}catch(t){return!0}},t.exports=i},8185:t=>{"use strict";var e={foo:{}},n=Object;t.exports=function(){return{__proto__:e}.foo===e.foo&&!({__proto__:null}instanceof n)}},1405:(t,e,n)=>{"use strict";var r="undefined"!=typeof Symbol&&Symbol,i=n(5419);t.exports=function(){return"function"==typeof r&&"function"==typeof Symbol&&"symbol"==typeof r("foo")&&"symbol"==typeof Symbol("bar")&&i()}},5419:t=>{"use strict";t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),n=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var r=Object.getOwnPropertySymbols(t);if(1!==r.length||r[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(t,e);if(42!==i.value||!0!==i.enumerable)return!1}return!0}},6410:(t,e,n)=>{"use strict";var r=n(5419);t.exports=function(){return r()&&!!Symbol.toStringTag}},8824:(t,e,n)=>{"use strict";var r=Function.prototype.call,i=Object.prototype.hasOwnProperty,s=n(8612);t.exports=s.call(r,i)},5717:t=>{"function"==typeof Object.create?t.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(t,e){if(e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}},2584:(t,e,n)=>{"use strict";var r=n(6410)(),i=n(1924)("Object.prototype.toString"),s=function(t){return!(r&&t&&"object"==typeof t&&Symbol.toStringTag in t)&&"[object Arguments]"===i(t)},o=function(t){return!!s(t)||null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Array]"!==i(t)&&"[object Function]"===i(t.callee)},a=function(){return s(arguments)}();s.isLegacyArguments=o,t.exports=a?s:o},5320:t=>{"use strict";var e,n,r=Function.prototype.toString,i="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof i&&"function"==typeof Object.defineProperty)try{e=Object.defineProperty({},"length",{get:function(){throw n}}),n={},i((function(){throw 42}),null,e)}catch(t){t!==n&&(i=null)}else i=null;var s=/^\s*class\b/,o=function(t){try{var e=r.call(t);return s.test(e)}catch(t){return!1}},a=function(t){try{return!o(t)&&(r.call(t),!0)}catch(t){return!1}},c=Object.prototype.toString,u="function"==typeof Symbol&&!!Symbol.toStringTag,l=!(0 in[,]),h=function(){return!1};if("object"==typeof document){var d=document.all;c.call(d)===c.call(document.all)&&(h=function(t){if((l||!t)&&(void 0===t||"object"==typeof t))try{var e=c.call(t);return("[object HTMLAllCollection]"===e||"[object HTML document.all class]"===e||"[object HTMLCollection]"===e||"[object Object]"===e)&&null==t("")}catch(t){}return!1})}t.exports=i?function(t){if(h(t))return!0;if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;try{i(t,null,e)}catch(t){if(t!==n)return!1}return!o(t)&&a(t)}:function(t){if(h(t))return!0;if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;if(u)return a(t);if(o(t))return!1;var e=c.call(t);return!("[object Function]"!==e&&"[object GeneratorFunction]"!==e&&!/^\[object HTML/.test(e))&&a(t)}},8662:(t,e,n)=>{"use strict";var r,i=Object.prototype.toString,s=Function.prototype.toString,o=/^\s*(?:function)?\*/,a=n(6410)(),c=Object.getPrototypeOf;t.exports=function(t){if("function"!=typeof t)return!1;if(o.test(s.call(t)))return!0;if(!a)return"[object GeneratorFunction]"===i.call(t);if(!c)return!1;if(void 0===r){var e=function(){if(!a)return!1;try{return Function("return function*() {}")()}catch(t){}}();r=!!e&&c(e)}return c(t)===r}},8611:t=>{"use strict";t.exports=function(t){return t!=t}},360:(t,e,n)=>{"use strict";var r=n(5559),i=n(4289),s=n(8611),o=n(9415),a=n(3194),c=r(o(),Number);i(c,{getPolyfill:o,implementation:s,shim:a}),t.exports=c},9415:(t,e,n)=>{"use strict";var r=n(8611);t.exports=function(){return Number.isNaN&&Number.isNaN(NaN)&&!Number.isNaN("a")?Number.isNaN:r}},3194:(t,e,n)=>{"use strict";var r=n(4289),i=n(9415);t.exports=function(){var t=i();return r(Number,{isNaN:t},{isNaN:function(){return Number.isNaN!==t}}),t}},5692:(t,e,n)=>{"use strict";var r=n(6430);t.exports=function(t){return!!r(t)}},4244:t=>{"use strict";var e=function(t){return t!=t};t.exports=function(t,n){return 0===t&&0===n?1/t==1/n:t===n||!(!e(t)||!e(n))}},609:(t,e,n)=>{"use strict";var r=n(4289),i=n(5559),s=n(4244),o=n(5624),a=n(2281),c=i(o(),Object);r(c,{getPolyfill:o,implementation:s,shim:a}),t.exports=c},5624:(t,e,n)=>{"use strict";var r=n(4244);t.exports=function(){return"function"==typeof Object.is?Object.is:r}},2281:(t,e,n)=>{"use strict";var r=n(5624),i=n(4289);t.exports=function(){var t=r();return i(Object,{is:t},{is:function(){return Object.is!==t}}),t}},8987:(t,e,n)=>{"use strict";var r;if(!Object.keys){var i=Object.prototype.hasOwnProperty,s=Object.prototype.toString,o=n(1414),a=Object.prototype.propertyIsEnumerable,c=!a.call({toString:null},"toString"),u=a.call((function(){}),"prototype"),l=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],h=function(t){var e=t.constructor;return e&&e.prototype===t},d={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!d["$"+t]&&i.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{h(window[t])}catch(t){return!0}}catch(t){return!0}return!1}();r=function(t){var e=null!==t&&"object"==typeof t,n="[object Function]"===s.call(t),r=o(t),a=e&&"[object String]"===s.call(t),d=[];if(!e&&!n&&!r)throw new TypeError("Object.keys called on a non-object");var p=u&&n;if(a&&t.length>0&&!i.call(t,0))for(var g=0;g<t.length;++g)d.push(String(g));if(r&&t.length>0)for(var m=0;m<t.length;++m)d.push(String(m));else for(var y in t)p&&"prototype"===y||!i.call(t,y)||d.push(String(y));if(c)for(var v=function(t){if("undefined"==typeof window||!f)return h(t);try{return h(t)}catch(t){return!1}}(t),_=0;_<l.length;++_)v&&"constructor"===l[_]||!i.call(t,l[_])||d.push(l[_]);return d}}t.exports=r},2215:(t,e,n)=>{"use strict";var r=Array.prototype.slice,i=n(1414),s=Object.keys,o=s?function(t){return s(t)}:n(8987),a=Object.keys;o.shim=function(){if(Object.keys){var t=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);t||(Object.keys=function(t){return i(t)?a(r.call(t)):a(t)})}else Object.keys=o;return Object.keys||o},t.exports=o},1414:t=>{"use strict";var e=Object.prototype.toString;t.exports=function(t){var n=e.call(t),r="[object Arguments]"===n;return r||(r="[object Array]"!==n&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===e.call(t.callee)),r}},2837:(t,e,n)=>{"use strict";var r=n(2215),i=n(5419)(),s=n(1924),o=Object,a=s("Array.prototype.push"),c=s("Object.prototype.propertyIsEnumerable"),u=i?Object.getOwnPropertySymbols:null;t.exports=function(t,e){if(null==t)throw new TypeError("target must be an object");var n=o(t);if(1===arguments.length)return n;for(var s=1;s<arguments.length;++s){var l=o(arguments[s]),h=r(l),d=i&&(Object.getOwnPropertySymbols||u);if(d)for(var f=d(l),p=0;p<f.length;++p){var g=f[p];c(l,g)&&a(h,g)}for(var m=0;m<h.length;++m){var y=h[m];if(c(l,y)){var v=l[y];n[y]=v}}}return n}},8162:(t,e,n)=>{"use strict";var r=n(2837);t.exports=function(){return Object.assign?function(){if(!Object.assign)return!1;for(var t="abcdefghijklmnopqrst",e=t.split(""),n={},r=0;r<e.length;++r)n[e[r]]=e[r];var i=Object.assign({},n),s="";for(var o in i)s+=o;return t!==s}()||function(){if(!Object.assign||!Object.preventExtensions)return!1;var t=Object.preventExtensions({1:2});try{Object.assign(t,"xy")}catch(e){return"y"===t[1]}return!1}()?r:Object.assign:r}},7771:(t,e,n)=>{"use strict";var r=n(210),i=n(2296),s=n(1044)(),o=n(7296),a=r("%TypeError%"),c=r("%Math.floor%");t.exports=function(t,e){if("function"!=typeof t)throw new a("`fn` is not a function");if("number"!=typeof e||e<0||e>4294967295||c(e)!==e)throw new a("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],r=!0,u=!0;if("length"in t&&o){var l=o(t,"length");l&&!l.configurable&&(r=!1),l&&!l.writable&&(u=!1)}return(r||u||!n)&&(s?i(t,"length",e,!0,!0):i(t,"length",e)),t}},6322:(t,e,n)=>{"use strict";n.d(e,{u:()=>D});class r extends Error{constructor(t){super(t),this.name="ObservableAbortError",Object.setPrototypeOf(this,r.prototype)}}function i(t){return t}function s(t){const e={subscribe(e){let n=null,r=!1,i=!1,s=!1;function o(){null!==n?i||(i=!0,"function"==typeof n?n():n&&n.unsubscribe()):s=!0}return n=t({next(t){r||e.next?.(t)},error(t){r||(r=!0,e.error?.(t),o())},complete(){r||(r=!0,e.complete?.(),o())}}),s&&o(),{unsubscribe:o}},pipe(...t){return(0===(n=t).length?i:1===n.length?n[0]:function(t){return n.reduce(((t,e)=>e(t)),t)})(e);var n}};return e}function o(t){return!!t&&!Array.isArray(t)&&"object"==typeof t}class a extends Error{constructor(){super("Unable to transform response from server")}}function c(t,e){let n;try{n=function(t,e){if("error"in t){const n=e.transformer.deserialize(t.error);return{ok:!1,error:{...t,error:n}}}return{ok:!0,result:{...t.result,...(!t.result.type||"data"===t.result.type)&&{type:"data",data:e.transformer.deserialize(t.result.data)}}}}(t,e)}catch(t){throw new a}if(!(n.ok||o(n.error.error)&&"number"==typeof n.error.error.code))throw new a;if(n.ok&&!o(n.result))throw new a;return n}class u extends Error{static from(t,e={}){const n=t;return function(t){return t instanceof u||t instanceof Error&&"TRPCClientError"===t.name}(n)?(e.meta&&(n.meta={...n.meta,...e.meta}),n):o(r=n)&&o(r.error)&&"number"==typeof r.error.code&&"string"==typeof r.error.message?new u(n.error.message,{...e,result:n}):n instanceof Error?new u(n.message,{...e,cause:n}):new u("Unknown error",{...e,cause:n});var r}constructor(t,e){const n=e?.cause;super(t,{cause:n}),this.meta=e?.meta,this.cause=n,this.shape=e?.result?.error,this.data=e?.result?.error.data,this.name="TRPCClientError",Object.setPrototypeOf(this,u.prototype)}}function l(t){const e=Object.create(null);for(const n in t)e[t[n]]=n;return e}const h={PARSE_ERROR:-32700,BAD_REQUEST:-32600,INTERNAL_SERVER_ERROR:-32603,NOT_IMPLEMENTED:-32603,UNAUTHORIZED:-32001,FORBIDDEN:-32003,NOT_FOUND:-32004,METHOD_NOT_SUPPORTED:-32005,TIMEOUT:-32008,CONFLICT:-32009,PRECONDITION_FAILED:-32012,PAYLOAD_TOO_LARGE:-32013,UNPROCESSABLE_CONTENT:-32022,TOO_MANY_REQUESTS:-32029,CLIENT_CLOSED_REQUEST:-32099};l(h),l(h);const d=()=>{};function f(t,e){return new Proxy(d,{get(n,r){if("string"==typeof r&&"then"!==r)return f(t,[...e,r])},apply(n,r,i){const s="apply"===e[e.length-1];return t({args:s?i.length>=2?i[1]:[]:i,path:s?e.slice(0,-1):e})}})}const p=t=>f(t,[]),g=t=>"function"==typeof t;function m(t){return{url:t.url.toString().replace(/\/$/,""),fetch:t.fetch,AbortController:(e=t.AbortController,e||("undefined"!=typeof window&&window.AbortController?window.AbortController:"undefined"!=typeof globalThis&&globalThis.AbortController?globalThis.AbortController:null))};var e}const y={query:"GET",mutation:"POST"};function v(t){return"input"in t?t.runtime.transformer.serialize(t.input):function(t){const e={};for(let n=0;n<t.length;n++){const r=t[n];e[n]=r}return e}(t.inputs.map((e=>t.runtime.transformer.serialize(e))))}const _=t=>{let e=t.url+"/"+t.path;const n=[];if("inputs"in t&&n.push("batch=1"),"query"===t.type){const e=v(t);void 0!==e&&n.push(`input=${encodeURIComponent(JSON.stringify(e))}`)}return n.length&&(e+="?"+n.join("&")),e},w=t=>{if("query"===t.type)return;const e=v(t);return void 0!==e?JSON.stringify(e):void 0},b=t=>S({...t,contentTypeHeader:"application/json",getUrl:_,getBody:w});async function E(t,e){const n=t.getUrl(t),r=t.getBody(t),{type:i}=t,s=await t.headers();if("subscription"===i)throw new Error("Subscriptions should use wsLink");const o={...t.contentTypeHeader?{"content-type":t.contentTypeHeader}:{},...t.batchModeHeader?{"trpc-batch-mode":t.batchModeHeader}:{},...s};return function(t){if(t)return t;if("undefined"!=typeof window&&g(window.fetch))return window.fetch;if("undefined"!=typeof globalThis&&g(globalThis.fetch))return globalThis.fetch;throw new Error("No fetch implementation found")}(t.fetch)(n,{method:y[i],signal:e?.signal,body:r,headers:o})}function S(t){const e=t.AbortController?new t.AbortController:null,n={};let r=!1;return{promise:new Promise(((i,s)=>{E(t,e).then((t=>(n.response=t,r=!0,t.json()))).then((t=>{n.responseJSON=t,i({json:t,meta:n})})).catch((t=>{r=!0,s(u.from(t,{meta:n}))}))})),cancel:()=>{r||e?.abort()}}}const T=()=>{throw new Error("Something went wrong. Please submit an issue at https://github.com/trpc/trpc/issues/new")};function I(t){let e=null,n=null;function r(){const r=function(e){const n=[[]];let r=0;for(;;){const i=e[r];if(!i)break;const s=n[n.length-1];i.aborted?(i.reject?.(new Error("Aborted")),r++):t.validate(s.concat(i).map((t=>t.key)))?(s.push(i),r++):0!==s.length?n.push([]):(i.reject?.(new Error("Input is too big for a single dispatch")),r++)}return n}(e);clearTimeout(n),n=null,e=null;for(const e of r){if(!e.length)continue;const n={items:e,cancel:T};for(const t of e)t.batch=n;const r=(t,e)=>{const r=n.items[t];r.resolve?.(e),r.batch=null,r.reject=null,r.resolve=null},{promise:i,cancel:s}=t.fetch(n.items.map((t=>t.key)),r);n.cancel=s,i.then((t=>{for(let e=0;e<t.length;e++){const n=t[e];r(e,n)}for(const t of n.items)t.reject?.(new Error("Missing result")),t.batch=null})).catch((t=>{for(const e of n.items)e.reject?.(t),e.batch=null}))}}return{load:function(t){const i={aborted:!1,key:t,batch:null,resolve:T,reject:T},s=new Promise(((t,n)=>{i.reject=n,i.resolve=t,e||(e=[]),e.push(i)}));return n||(n=setTimeout(r)),{promise:s,cancel:()=>{i.aborted=!0,i.batch?.items.every((t=>t.aborted))&&(i.batch.cancel(),i.batch=null)}}}}}function O(t){return function(e){const n=m(e),r=e.maxURLLength??1/0;return i=>{const o=s=>({validate:t=>{if(r===1/0)return!0;const e=t.map((t=>t.path)).join(","),o=t.map((t=>t.input));return _({...n,runtime:i,type:s,path:e,inputs:o}).length<=r},fetch:t({...n,runtime:i,type:s,opts:e})}),a=I(o("query")),l=I(o("mutation")),h={query:a,subscription:I(o("subscription")),mutation:l};return({op:t})=>s((e=>{const n=h[t.type],{promise:r,cancel:s}=n.load(t);let o;return r.then((t=>{o=t;const n=c(t.json,i);n.ok?(e.next({context:t.meta,result:n.result}),e.complete()):e.error(u.from(n.error,{meta:t.meta}))})).catch((t=>{e.error(u.from(t,{meta:o?.meta}))})),()=>{s()}}))}}}const k=O((t=>e=>{const n=e.map((t=>t.path)).join(","),r=e.map((t=>t.input)),{promise:i,cancel:s}=b({...t,path:n,inputs:r,headers:()=>t.opts.headers?"function"==typeof t.opts.headers?t.opts.headers({opList:e}):t.opts.headers:{}});return{promise:i.then((t=>(Array.isArray(t.json)?t.json:e.map((()=>t.json))).map((e=>({meta:t.meta,json:e}))))),cancel:s}}));function C(t){return e=>{const n=m(e);return r=>({op:i})=>s((s=>{const{path:o,input:a,type:l}=i,{promise:h,cancel:d}=t.requester({...n,runtime:r,type:l,path:o,input:a,headers:()=>e.headers?"function"==typeof e.headers?e.headers({op:i}):e.headers:{}});let f;return h.then((t=>{f=t.meta;const e=c(t.json,r);e.ok?(s.next({context:t.meta,result:e.result}),s.complete()):s.error(u.from(e.error,{meta:f}))})).catch((t=>{s.error(u.from(t,{meta:f}))})),()=>{d()}}))}}C({requester:b});const A={query:"query",mutate:"mutation",subscribe:"subscription"};O((t=>{const e=function(t){if(t)return t;if("undefined"!=typeof window&&window.TextDecoder)return new window.TextDecoder;if("undefined"!=typeof globalThis&&globalThis.TextDecoder)return new globalThis.TextDecoder;throw new Error("No TextDecoder implementation found")}(t.opts.textDecoder);return(n,r)=>{const i=n.map((t=>t.path)).join(","),s=n.map((t=>t.input)),{cancel:o,promise:a}=((t,e)=>{const n=t.AbortController?new t.AbortController:null;return{cancel:()=>n?.abort(),promise:E({...t,contentTypeHeader:"application/json",batchModeHeader:"stream",getUrl:_,getBody:w},n).then((async r=>{if(!r.body)throw new Error("Received response without body");const i={response:r};return async function(t){const e=t.parse??JSON.parse;await async function(t,e,n){let r="";const i=t=>{const i=n.decode(t).split("\n");if(1===i.length)r+=i[0];else if(i.length>1){e(r+i[0]);for(let t=1;t<i.length-1;t++)e(i[t]);r=i[i.length-1]}};"getReader"in t?await async function(t,e){const n=t.getReader();let r=await n.read();for(;!r.done;)e(r.value),r=await n.read()}(t,i):await function(t,e){return new Promise((n=>{t.on("data",e),t.on("end",n)}))}(t,i),e(r)}(t.readableStream,(n=>{if(t.signal?.aborted)return;if(!n||"}"===n)return;const r=n.indexOf(":"),i=n.substring(2,r-1),s=n.substring(r+1);t.onSingle(Number(i),e(s))}),t.textDecoder)}({readableStream:r.body,onSingle:e,parse:t=>({json:JSON.parse(t),meta:i}),signal:n?.signal,textDecoder:t.textDecoder})}))}})({...t,textDecoder:e,path:i,inputs:s,headers:()=>t.opts.headers?"function"==typeof t.opts.headers?t.opts.headers({opList:n}):t.opts.headers:{}},((t,e)=>{r(t,e)}));return{promise:a.then((()=>[])),cancel:o}}}));const R=t=>{if("input"in t){if(!(t.input instanceof FormData))throw new Error("Input is not FormData");return t.input}};C({requester:t=>{if("mutation"!==t.type)throw new Error("We only handle mutations with formdata");return S({...t,getUrl:()=>`${t.url}/${t.path}`,getBody:R})}});var N=n(9862);const x=new(n(6153).gx),D=(j={links:[k({url:`${N.Bf}/trpc`,headers:("extension",async function(){const t=new Map;t.set("x-trpc-source","extension");const e=(await x.client.auth.getSession()).data.session;return e?.access_token&&(t.set("Authorization",`Bearer ${e.access_token}`),t.set("Refresh-Token",`${e.refresh_token}`)),Object.fromEntries(t)})})]},L=new class{$request({type:t,input:e,path:n,context:r={}}){return function(t){return s((e=>function e(n=0,r=t.op){const i=t.links[n];if(!i)throw new Error("No more links to execute - did you forget to add an ending link?");return i({op:r,next:t=>e(n+1,t)})}().subscribe(e)))}({links:this.links,op:{id:++this.requestId,type:t,path:n,input:e,context:r}}).pipe((t=>{let e=0,n=null;const r=[];return{subscribe:i=>(e++,r.push(i),n||(n=t.subscribe({next(t){for(const e of r)e.next?.(t)},error(t){for(const e of r)e.error?.(t)},complete(){for(const t of r)t.complete?.()}})),{unsubscribe(){e--,function(){if(0===e&&n){const t=n;n=null,t.unsubscribe()}}();const t=r.findIndex((t=>t===i));t>-1&&r.splice(t,1)}})}}))}requestAsPromise(t){const e=this.$request(t),{promise:n,abort:i}=function(t){let e;return{promise:new Promise(((n,i)=>{let s=!1;function o(){s||(s=!0,i(new r("This operation was aborted.")),a.unsubscribe())}const a=t.subscribe({next(t){s=!0,n(t),o()},error(t){s=!0,i(t),o()},complete(){s=!0,o()}});e=o})),abort:e}}(e);return new Promise(((e,r)=>{t.signal?.addEventListener("abort",i),n.then((t=>{e(t.result.data)})).catch((t=>{r(u.from(t))}))}))}query(t,e,n){return this.requestAsPromise({type:"query",path:t,input:e,context:n?.context,signal:n?.signal})}mutation(t,e,n){return this.requestAsPromise({type:"mutation",path:t,input:e,context:n?.context,signal:n?.signal})}subscription(t,e,n){return this.$request({type:"subscription",path:t,input:e,context:n?.context}).subscribe({next(t){"started"===t.result.type?n.onStarted?.():"stopped"===t.result.type?n.onStopped?.():n.onData?.(t.result.data)},error(t){n.onError?.(t)},complete(){n.onComplete?.()}})}constructor(t){this.requestId=0;const e=(()=>{const e=t.transformer;return e?"input"in e?t.transformer:{input:e,output:e}:{input:{serialize:t=>t,deserialize:t=>t},output:{serialize:t=>t,deserialize:t=>t}}})();this.runtime={transformer:{serialize:t=>e.input.serialize(t),deserialize:t=>e.output.deserialize(t)},combinedTransformer:e},this.links=t.links.map((t=>t(this.runtime)))}}(j),P=t=>L.hasOwnProperty(t)?L[t]:"__untypedClient"===t?L:p((({path:e,args:n})=>{const r=[t,...e],i=(o=r.pop(),A[o]),s=r.join(".");var o;return L[i](s,...n)})),new Proxy(d,{get(t,e){if("string"==typeof e&&"then"!==e)return P(e)}}));var P,L,j},6153:(t,e,n)=>{"use strict";n.d(e,{gx:()=>a});var r=n(4283),i=n(5248),s=n(9862);const o={auth:{debug:!1,persistSession:!0,storage:{getItem:async t=>await(async t=>(await chrome.storage.local.get(t))[t])(t),setItem:async(t,e)=>await(async t=>await chrome.storage.local.set(t))({[t]:e}),removeItem:async t=>await(async t=>await chrome.storage.local.remove(t))(t)}}};class a{constructor(){this.signingIn=!1,this.signInTabId=null,this.client=(0,r.eI)(s.mF,s.F3,o)}async session(){const{data:t,error:e}=await this.client.auth.getSession();if(e)throw this._isNotSigningIn(),e;return t.session}async setSession(t,e){console.log("setting session with tokens: ",t,e);const{data:n,error:r}=await this.client.auth.setSession({access_token:t,refresh_token:e});if(r)throw this._isNotSigningIn(),r;return console.log("setting session successful: ",n),n}async signOut(){console.log("Signing out of app");const{error:t}=await this.client.auth.signOut();if(t)throw t}async signInToApp(){console.log("signing in to app");const t=async(e,n)=>{e===this.signInTabId&&(console.log("app sign in tab was closed"),chrome.tabs.onRemoved.removeListener(t),this._isNotSigningIn())},e=async(t,n)=>{if(t.accessToken?.newValue&&t.refreshToken?.newValue){console.log("got new accessToken and refreshToken");const{user:n,session:r}=await this.setSession(t.accessToken.newValue,t.refreshToken.newValue);if(console.log("attempting to close sign in tab: ",this.signInTabId),await(0,i.Dc)(1e3),this.signInTabId)try{await chrome.tabs.remove(this.signInTabId)}catch(t){console.warn("Error closing sign in tab: ",t)}chrome.storage.onChanged.removeListener(e),this._isNotSigningIn()}};chrome.tabs.onRemoved.removeListener(t),chrome.storage.onChanged.removeListener(e),chrome.storage.onChanged.addListener(e),chrome.tabs.onRemoved.addListener(t);const n=await chrome.tabs.create({url:`${s.FX}/auth/sign-in?close=true&message=benefits`,active:!0});if(!n.id)throw"Could not create sign in tab";return await chrome.windows.update(n.windowId,{focused:!0}),this._isSigningIn(n.id),this._waitUntilSignedIn()}_isSigningIn(t){console.log("signing in..."),this.signingIn=!0,this.signInTabId=t,console.log("signing in tab id: ",this.signInTabId)}_isNotSigningIn(){console.log("sign in ended"),this.signingIn=!1,this.signInTabId=null}async _waitUntilSignedIn(t=12e4){if(!this.signingIn)return console.warn("Was supposed to wait until signed in, but not currently signing in"),!1;const e=Date.now();for(;this.signingIn;){if(Date.now()-e>t)return console.error("Timed out waiting for sign in"),!1;await new Promise((t=>setTimeout(t,100)))}return!0}}},5248:(t,e,n)=>{"use strict";n.d(e,{Dc:()=>a,U5:()=>s,f0:()=>i,qo:()=>o});var r=n(4131);async function i(){var t=new r.SettingsStore;return await t.isInitialized,t}async function s(){var t=await i();return t.getSettingFromStorage(t.USER_LICENSE_KEY)}async function o(){const t=await async function(){var t=await i();return t.getSettingFromStorage(t.USER_SETTINGS_JSON_KEY)}(),e=await async function(){var t=await i();return t.getDefaultSettings()[t.USER_SETTINGS_JSON_KEY]}(),n=await s();return console.log("userFeatures:",t),console.log("defaultUserFeatures:",e),console.log("userLicense:",n),JSON.stringify(t).length!==JSON.stringify(e).length&&null!==n}function a(t){return new Promise((function(e){setTimeout(e,t)}))}},9862:(t,e,n)=>{"use strict";n.d(e,{Bc:()=>i,Bf:()=>o,F3:()=>c,FX:()=>s,Mw:()=>r,mF:()=>a});const r=!0,i=!0===r?"https://swiftread-ext-api.herokuapp.com/api/":"http://localhost:8081/api/",s=!0===r?"https://app.swiftread.com":"http://localhost:3000",o=!0===r?"https://swiftread-app-api-4f19e2bc1fde.herokuapp.com":"http://localhost:8888",a=!0===r?"https://uclskwetrppbodtcelol.supabase.co":"http://localhost:54321",c=!0===r?"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVjbHNrd2V0cnBwYm9kdGNlbG9sIiwicm9sZSI6ImFub24iLCJpYXQiOjE2Njc3ODI1NDEsImV4cCI6MTk4MzM1ODU0MX0.FMoZFrDpQB6oGht9VTVcdS695SUoi-NpzawahVrLae0":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0"},384:t=>{t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},5955:(t,e,n)=>{"use strict";var r=n(2584),i=n(8662),s=n(6430),o=n(5692);function a(t){return t.call.bind(t)}var c="undefined"!=typeof BigInt,u="undefined"!=typeof Symbol,l=a(Object.prototype.toString),h=a(Number.prototype.valueOf),d=a(String.prototype.valueOf),f=a(Boolean.prototype.valueOf);if(c)var p=a(BigInt.prototype.valueOf);if(u)var g=a(Symbol.prototype.valueOf);function m(t,e){if("object"!=typeof t)return!1;try{return e(t),!0}catch(t){return!1}}function y(t){return"[object Map]"===l(t)}function v(t){return"[object Set]"===l(t)}function _(t){return"[object WeakMap]"===l(t)}function w(t){return"[object WeakSet]"===l(t)}function b(t){return"[object ArrayBuffer]"===l(t)}function E(t){return"undefined"!=typeof ArrayBuffer&&(b.working?b(t):t instanceof ArrayBuffer)}function S(t){return"[object DataView]"===l(t)}function T(t){return"undefined"!=typeof DataView&&(S.working?S(t):t instanceof DataView)}e.isArgumentsObject=r,e.isGeneratorFunction=i,e.isTypedArray=o,e.isPromise=function(t){return"undefined"!=typeof Promise&&t instanceof Promise||null!==t&&"object"==typeof t&&"function"==typeof t.then&&"function"==typeof t.catch},e.isArrayBufferView=function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):o(t)||T(t)},e.isUint8Array=function(t){return"Uint8Array"===s(t)},e.isUint8ClampedArray=function(t){return"Uint8ClampedArray"===s(t)},e.isUint16Array=function(t){return"Uint16Array"===s(t)},e.isUint32Array=function(t){return"Uint32Array"===s(t)},e.isInt8Array=function(t){return"Int8Array"===s(t)},e.isInt16Array=function(t){return"Int16Array"===s(t)},e.isInt32Array=function(t){return"Int32Array"===s(t)},e.isFloat32Array=function(t){return"Float32Array"===s(t)},e.isFloat64Array=function(t){return"Float64Array"===s(t)},e.isBigInt64Array=function(t){return"BigInt64Array"===s(t)},e.isBigUint64Array=function(t){return"BigUint64Array"===s(t)},y.working="undefined"!=typeof Map&&y(new Map),e.isMap=function(t){return"undefined"!=typeof Map&&(y.working?y(t):t instanceof Map)},v.working="undefined"!=typeof Set&&v(new Set),e.isSet=function(t){return"undefined"!=typeof Set&&(v.working?v(t):t instanceof Set)},_.working="undefined"!=typeof WeakMap&&_(new WeakMap),e.isWeakMap=function(t){return"undefined"!=typeof WeakMap&&(_.working?_(t):t instanceof WeakMap)},w.working="undefined"!=typeof WeakSet&&w(new WeakSet),e.isWeakSet=function(t){return w(t)},b.working="undefined"!=typeof ArrayBuffer&&b(new ArrayBuffer),e.isArrayBuffer=E,S.working="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView&&S(new DataView(new ArrayBuffer(1),0,1)),e.isDataView=T;var I="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:void 0;function O(t){return"[object SharedArrayBuffer]"===l(t)}function k(t){return void 0!==I&&(void 0===O.working&&(O.working=O(new I)),O.working?O(t):t instanceof I)}function C(t){return m(t,h)}function A(t){return m(t,d)}function R(t){return m(t,f)}function N(t){return c&&m(t,p)}function x(t){return u&&m(t,g)}e.isSharedArrayBuffer=k,e.isAsyncFunction=function(t){return"[object AsyncFunction]"===l(t)},e.isMapIterator=function(t){return"[object Map Iterator]"===l(t)},e.isSetIterator=function(t){return"[object Set Iterator]"===l(t)},e.isGeneratorObject=function(t){return"[object Generator]"===l(t)},e.isWebAssemblyCompiledModule=function(t){return"[object WebAssembly.Module]"===l(t)},e.isNumberObject=C,e.isStringObject=A,e.isBooleanObject=R,e.isBigIntObject=N,e.isSymbolObject=x,e.isBoxedPrimitive=function(t){return C(t)||A(t)||R(t)||N(t)||x(t)},e.isAnyArrayBuffer=function(t){return"undefined"!=typeof Uint8Array&&(E(t)||k(t))},["isProxy","isExternal","isModuleNamespaceObject"].forEach((function(t){Object.defineProperty(e,t,{enumerable:!1,value:function(){throw new Error(t+" is not supported in userland")}})}))},9539:(t,e,n)=>{var r=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),n={},r=0;r<e.length;r++)n[e[r]]=Object.getOwnPropertyDescriptor(t,e[r]);return n},i=/%[sdj%]/g;e.format=function(t){if(!v(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(c(arguments[n]));return e.join(" ")}n=1;for(var r=arguments,s=r.length,o=String(t).replace(i,(function(t){if("%%"===t)return"%";if(n>=s)return t;switch(t){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}default:return t}})),a=r[n];n<s;a=r[++n])m(a)||!b(a)?o+=" "+a:o+=" "+c(a);return o},e.deprecate=function(t,n){if("undefined"!=typeof process&&!0===process.noDeprecation)return t;if("undefined"==typeof process)return function(){return e.deprecate(t,n).apply(this,arguments)};var r=!1;return function(){if(!r){if(process.throwDeprecation)throw new Error(n);process.traceDeprecation?console.trace(n):console.error(n),r=!0}return t.apply(this,arguments)}};var s={},o=/^$/;if({}.NODE_DEBUG){var a={}.NODE_DEBUG;a=a.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),o=new RegExp("^"+a+"$","i")}function c(t,n){var r={seen:[],stylize:l};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),g(n)?r.showHidden=n:n&&e._extend(r,n),_(r.showHidden)&&(r.showHidden=!1),_(r.depth)&&(r.depth=2),_(r.colors)&&(r.colors=!1),_(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=u),h(r,t,r.depth)}function u(t,e){var n=c.styles[e];return n?"["+c.colors[n][0]+"m"+t+"["+c.colors[n][1]+"m":t}function l(t,e){return t}function h(t,n,r){if(t.customInspect&&n&&T(n.inspect)&&n.inspect!==e.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,t);return v(i)||(i=h(t,i,r)),i}var s=function(t,e){if(_(e))return t.stylize("undefined","undefined");if(v(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}return y(e)?t.stylize(""+e,"number"):g(e)?t.stylize(""+e,"boolean"):m(e)?t.stylize("null","null"):void 0}(t,n);if(s)return s;var o=Object.keys(n),a=function(t){var e={};return t.forEach((function(t,n){e[t]=!0})),e}(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(n)),S(n)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return d(n);if(0===o.length){if(T(n)){var c=n.name?": "+n.name:"";return t.stylize("[Function"+c+"]","special")}if(w(n))return t.stylize(RegExp.prototype.toString.call(n),"regexp");if(E(n))return t.stylize(Date.prototype.toString.call(n),"date");if(S(n))return d(n)}var u,l="",b=!1,I=["{","}"];return p(n)&&(b=!0,I=["[","]"]),T(n)&&(l=" [Function"+(n.name?": "+n.name:"")+"]"),w(n)&&(l=" "+RegExp.prototype.toString.call(n)),E(n)&&(l=" "+Date.prototype.toUTCString.call(n)),S(n)&&(l=" "+d(n)),0!==o.length||b&&0!=n.length?r<0?w(n)?t.stylize(RegExp.prototype.toString.call(n),"regexp"):t.stylize("[Object]","special"):(t.seen.push(n),u=b?function(t,e,n,r,i){for(var s=[],o=0,a=e.length;o<a;++o)C(e,String(o))?s.push(f(t,e,n,r,String(o),!0)):s.push("");return i.forEach((function(i){i.match(/^\d+$/)||s.push(f(t,e,n,r,i,!0))})),s}(t,n,r,a,o):o.map((function(e){return f(t,n,r,a,e,b)})),t.seen.pop(),function(t,e,n){return t.reduce((function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1]:n[0]+e+" "+t.join(", ")+" "+n[1]}(u,l,I)):I[0]+l+I[1]}function d(t){return"["+Error.prototype.toString.call(t)+"]"}function f(t,e,n,r,i,s){var o,a,c;if((c=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]}).get?a=c.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):c.set&&(a=t.stylize("[Setter]","special")),C(r,i)||(o="["+i+"]"),a||(t.seen.indexOf(c.value)<0?(a=m(n)?h(t,c.value,null):h(t,c.value,n-1)).indexOf("\n")>-1&&(a=s?a.split("\n").map((function(t){return"  "+t})).join("\n").slice(2):"\n"+a.split("\n").map((function(t){return"   "+t})).join("\n")):a=t.stylize("[Circular]","special")),_(o)){if(s&&i.match(/^\d+$/))return a;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.slice(1,-1),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"))}return o+": "+a}function p(t){return Array.isArray(t)}function g(t){return"boolean"==typeof t}function m(t){return null===t}function y(t){return"number"==typeof t}function v(t){return"string"==typeof t}function _(t){return void 0===t}function w(t){return b(t)&&"[object RegExp]"===I(t)}function b(t){return"object"==typeof t&&null!==t}function E(t){return b(t)&&"[object Date]"===I(t)}function S(t){return b(t)&&("[object Error]"===I(t)||t instanceof Error)}function T(t){return"function"==typeof t}function I(t){return Object.prototype.toString.call(t)}function O(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(t=t.toUpperCase(),!s[t])if(o.test(t)){var n=process.pid;s[t]=function(){var r=e.format.apply(e,arguments);console.error("%s %d: %s",t,n,r)}}else s[t]=function(){};return s[t]},e.inspect=c,c.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},c.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.types=n(5955),e.isArray=p,e.isBoolean=g,e.isNull=m,e.isNullOrUndefined=function(t){return null==t},e.isNumber=y,e.isString=v,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=_,e.isRegExp=w,e.types.isRegExp=w,e.isObject=b,e.isDate=E,e.types.isDate=E,e.isError=S,e.types.isNativeError=S,e.isFunction=T,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=n(384);var k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function C(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){var t,n;console.log("%s - %s",(n=[O((t=new Date).getHours()),O(t.getMinutes()),O(t.getSeconds())].join(":"),[t.getDate(),k[t.getMonth()],n].join(" ")),e.format.apply(e,arguments))},e.inherits=n(5717),e._extend=function(t,e){if(!e||!b(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t};var A="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function R(t,e){if(!t){var n=new Error("Promise was rejected with a falsy value");n.reason=t,t=n}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(A&&t[A]){var e;if("function"!=typeof(e=t[A]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,A,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,n,r=new Promise((function(t,r){e=t,n=r})),i=[],s=0;s<arguments.length;s++)i.push(arguments[s]);i.push((function(t,r){t?n(t):e(r)}));try{t.apply(this,i)}catch(t){n(t)}return r}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),A&&Object.defineProperty(e,A,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,r(t))},e.promisify.custom=A,e.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function e(){for(var e=[],n=0;n<arguments.length;n++)e.push(arguments[n]);var r=e.pop();if("function"!=typeof r)throw new TypeError("The last argument must be of type Function");var i=this,s=function(){return r.apply(i,arguments)};t.apply(this,e).then((function(t){process.nextTick(s.bind(null,null,t))}),(function(t){process.nextTick(R.bind(null,t,s))}))}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),Object.defineProperties(e,r(t)),e}},6430:(t,e,n)=>{"use strict";var r=n(4029),i=n(3083),s=n(5559),o=n(1924),a=n(7296),c=o("Object.prototype.toString"),u=n(6410)(),l="undefined"==typeof globalThis?n.g:globalThis,h=i(),d=o("String.prototype.slice"),f=Object.getPrototypeOf,p=o("Array.prototype.indexOf",!0)||function(t,e){for(var n=0;n<t.length;n+=1)if(t[n]===e)return n;return-1},g={__proto__:null};r(h,u&&a&&f?function(t){var e=new l[t];if(Symbol.toStringTag in e){var n=f(e),r=a(n,Symbol.toStringTag);if(!r){var i=f(n);r=a(i,Symbol.toStringTag)}g["$"+t]=s(r.get)}}:function(t){var e=new l[t],n=e.slice||e.set;n&&(g["$"+t]=s(n))}),t.exports=function(t){if(!t||"object"!=typeof t)return!1;if(!u){var e=d(c(t),8,-1);return p(h,e)>-1?e:"Object"===e&&function(t){var e=!1;return r(g,(function(n,r){if(!e)try{n(t),e=d(r,1)}catch(t){}})),e}(t)}return a?function(t){var e=!1;return r(g,(function(n,r){if(!e)try{"$"+n(t)===r&&(e=d(r,1))}catch(t){}})),e}(t):null}},756:t=>{t.exports={pushEvent:async function(t,e,n,r){void 0===n&&(n=null),void 0===r&&(r=null);const i=await new Promise(((t,e)=>{chrome.storage.sync.get("clientid",(function(e){var n=e.clientid;function r(e){t(e)}n?r(n):(n=function(){var t=new Uint8Array(32);crypto.getRandomValues(t);for(var e="",n=0;n<t.length;++n)e+=t[n].toString(16);return e}(),chrome.storage.sync.set({clientid:n},(function(){r(n)})))}))}));if(void 0!==i)try{let s="v=1&tid=UA-35748958-3&cid= "+i+"&t=event&ec="+t+"&ea="+e;null!=n&&(s+="&el="+n),null!=r&&(s+="&ev="+r),await fetch("https://www.google-analytics.com/collect",{method:"POST",body:s})}catch(t){console.warn("Error sending event to Google Analytics.\n"+t)}else console.warn("Cannot send event, clientId not set: ",i)}}},7266:t=>{var e=class{constructor(){this.CURRENT_DOMAIN="currentDomain",this.CURRENT_TAB_ID="currentTabId",this.SELECTED_TEXT="selectedText",this.KEEP_RAW="keepRaw",this.OPEN_MODE="openMode",this.READER_WINDOW_ID="readerWindowId",this.NEXT_PAGE_SELECTED_TEXT="nextPageSelectedText",this.PREVIOUS_PAGE_SELECTED_TEXT="previousPageSelectedText",this.LOCATION_STRING="locationString",this.CURRENT_URL="curUrl",this.ACTIVE_TAB_ID="activeTabId",this.READER_WINDOW_X="readerWindowX",this.READER_WINDOW_Y="readerWindowY",this.READER_WINDOW_WIDTH="readerWindowWidth",this.READER_WINDOW_HEIGHT="readerWindowHeight",this.TO_TRACK_FIRST_INSTALL="toTrackFirstInstall",this.SAVE_TO_APP_ON_READER_OPEN="saveToAppOnReaderOpen",this.CURRENT_TITLE="curTitle",this.OPENED_PRO_WINDOW_ID="openedProWindowId",this.OPENED_PRO_TAB_ID="openedProTabId";var t={};t[this.CURRENT_DOMAIN]=void 0,t[this.CURRENT_TAB_ID]=void 0,t[this.SELECTED_TEXT]=void 0,t[this.KEEP_RAW]=!1,t[this.OPEN_MODE]=void 0,t[this.READER_WINDOW_ID]=void 0,t[this.NEXT_PAGE_SELECTED_TEXT]=void 0,t[this.PREVIOUS_PAGE_SELECTED_TEXT]=void 0,t[this.LOCATION_STRING]=void 0,t[this.CURRENT_URL]=void 0,t[this.ACTIVE_TAB_ID]=void 0,t[this.READER_WINDOW_X]=void 0,t[this.READER_WINDOW_Y]=void 0,t[this.READER_WINDOW_WIDTH]=1e3,t[this.READER_WINDOW_HEIGHT]=600,t[this.TO_TRACK_FIRST_INSTALL]=!0,t[this.SAVE_TO_APP_ON_READER_OPEN]=!1,t[this.CURRENT_TITLE]=void 0,t[this.OPENED_PRO_WINDOW_ID]=void 0,t[this.OPENED_PRO_TAB_ID]=void 0;var e=null;this.getAllSettings=function(){if(null!==e)return e;throw"Background storage cache not yet initialized. Use its 'isInitialized' promise."},this.getSetting=function(t){if(null!==e)return e[t];throw"Background storage cache not yet initialized. Use its 'isInitialized' promise."},this.getSettingFromStorage=function(t){return new Promise(((n,r)=>{chrome.storage.local.get([t],(function(i){const s=i[t];void 0===s?null!==e?n(e[t]):r(`Background storage key '${t}' not in storage or default settings.`):n(s)}))}))},this.setSetting=function(t,n){return new Promise(((r,i)=>{if(null===e)return i("Background storage cache not yet initialized. Use its 'isInitialized' promise.");e[t]=n;var s={};s[t]=n,chrome.storage.local.set(s,(function(){if(chrome.runtime.lastError)return i(chrome.runtime.lastError);r()}))}))},this.getSettingKey=function(t){return this[t]},this.getDefaultSettings=function(){return t},this.removeSetting=function(n){return new Promise(((r,i)=>{if(null===e)throw"Background storage cache not yet initialized. Use its 'isInitialized' promise.";e[n]=t[n],chrome.storage.local.remove(n,(function(){if(chrome.runtime.lastError)return i(chrome.runtime.lastError);r()}))}))},this.isInitialized=new Promise((function(n,r){chrome.storage.local.get(null,(function(i){if(chrome.runtime.lastError)return r(chrome.runtime.lastError);var s={...t,...i};e=s,n()}))}))}clear(t=null){chrome.storage.local.clear(t)}};t.exports={BackgroundStorageCache:e,initializeBackgroundStorage:async function(){var t=new e;return await t.isInitialized,t}}},4131:t=>{t.exports={SettingsStore:class{constructor(){this.DEFAULT_HIGHLIGHT_COLOR="#f6861f",this.DEFAULT_BACKGROUND_COLOR="#272727",this.DEFAULT_FONT_COLOR="#ffffff",this.DEFAULT_COLOR_SCHEME="white-on-black",this.DEFAULT_FONT="georgia",this.DEFAULT_LETTER_SPACING="1.5",this.SETTING_WPM="wpm",this.SETTING_CHUNK_SIZE="chunkSize",this.SETTING_HIHGLIGHT_ENABLED_KEY="highlightColorEnabled",this.SETTING_HIHGLIGHT_COLOR_KEY="highlightColor",this.SETTING_HIGHLIGHT_COLOR_USE_CUSTOM_KEY="highlightColorUseCustom",this.SETTING_START_TIMER_ENABLED_KEY="startTimerEnabled",this.SETTING_START_TIMER_LENGTH_KEY="startTimerLength",this.SETTING_MICROPAUSE_NUMBERS_ENABLED_KEY="micropauseNumbersEnabled",this.SETTING_MICROPAUSE_PUNCTUATION_ENABLED_KEY="micropausePunctuationEnabled",this.SETTING_MICROPAUSE_LONGWORDS_ENABLED_KEY="micropauseLongWordsEnabled",this.SETTING_MICROPAUSE_PARAGRAPH_ENABLED_KEY="micropauseParagraphEnabled",this.SETTING_MICROPAUSE_NUMBERS_FACTOR_KEY="micropauseNumbersFactor",this.SETTING_MICROPAUSE_PUNCTUATION_FACTOR_KEY="micropausePunctuationFactor",this.SETTING_MICROPAUSE_ENDING_PUNCTUATION_FACTOR_KEY="micropauseEndingPunctuationFactor",this.SETTING_MICROPAUSE_LONGWORDS_FACTOR_KEY="micropauseLongWordsFactor",this.SETTING_MICROPAUSE_PARGRAPH_FACTOR_KEY="micropauseParagraphFactor",this.SETTING_BACKGROUND_COLOR_ENABLED_KEY="backgroundColorEnabled",this.SETTING_BACKGROUND_COLOR_KEY="backgroundColor",this.SETTING_FONT_COLOR_ENABLED_KEY="fontColorEnabled",this.SETTING_FONT_COLOR_KEY="fontColor",this.SETTING_WPM_INTERVAL_KEY="wpmInterval",this.SETTING_CONTEXT_DISPLAY_KEY="contextDisplayStyle",this.SETTING_COMBINE_BIGWORD_WITH_CONTEXT_KEY="combineBigwordWithContextEnabled",this.SETTING_CONTEXT_OPACITY_KEY="contextOpacity",this.SETTING_AUTO_PAGE_TURN_ENABLED_KEY="autoPageTurnEnabled",this.SETTING_SANITIZATION_RULE_KEY="sanitizationRule",this.SETTING_FOCUS_LETTER_INDICATOR_ENABLED_KEY="focusLetterIndicatorEnabled",this.SETTING_CONTEXT_FROM_RIGHT_ENABLED_KEY="contextFromRightEnabled",this.SETTING_SANITIZE_INLINE_CITATIONS_ENABLED_KEY="sanitizeInlineCitationsEnabled",this.SETTING_SANITIZE_URLS_ENABLED_KEY="sanitizeURLsEnabled",this.SETTING_HOTKEY_PLAY_KEY="hotkeyPlay",this.SETTING_HOTKEY_REWIND_KEY="hotkeyRewind",this.SETTING_HOTKEY_FORWARD_KEY="hotkeyForward",this.SETTING_HOTKEY_RESET_KEY="hotkeyReset",this.SETTING_HOTKEY_QUIT_KEY="hotkeyQuit",this.SETTING_HOTKEY_HIDE_KEY="hotkeyHide",this.SETTING_HOTKEY_WPM_INCREASE_KEY="hotkeyWPMIncrease",this.SETTING_HOTKEY_WPM_DECREASE_KEY="hotkeyWPMDecrease",this.SETTING_HOTKEY_CHUNK_SIZE_INCREASE_KEY="hotkeyChunkSizeIncrease",this.SETTING_HOTKEY_CHUNK_SIZE_DECREASE_KEY="hotkeyChunkSizeDecrease",this.SETTING_HOTKEY_FONT_SIZE_INCREASE_KEY="hotkeyFontSizeIncrease",this.SETTING_HOTKEY_FONT_SIZE_DECREASE_KEY="hotkeyFontSizeDecrease",this.SETTING_HOTKEY_FULLSCREEN_KEY="hotkeyFullscreen",this.SETTING_HOTKEY_PAGE_LEFT="hotkeyPageLeft",this.SETTING_HOTKEY_PAGE_RIGHT="hotkeyPageRight",this.SETTING_TOGGLE_CONTEXT_MODE="hotkeyToggleContextMode",this.SETTING_HOTKEY_TOGGLE_LISTEN_KEY="hotkeyToggleListen",this.SETTING_COLOR_SCHEMES_KEY="colorSchemes",this.SETTING_COLOR_SCHEME_FONT_COLOR_KEY="colorSchemeFontColor",this.SETTING_COLOR_SCHEME_BACKGROUND_COLOR_KEY="colorSchemeBackgroundColor",this.SETTING_COLOR_SCHEME_HIGHLIGHT_COLOR_KEY="colorSchemeHighlightColor",this.SETTING_CURRENT_COLOR_SCHEME_KEY="currentColorScheme",this.SETTING_FONTS_KEY="fonts",this.SETTING_FONT_NAME_KEY="fontName",this.SETTING_FONT_BACKUP_KEY="fontBackup",this.SETTING_CURRENT_FONT_KEY="currentFont",this.SETTING_TEXT_SCROLLER_ENABLED_KEY="textScrollerEnabled",this.SETTING_LETTER_SPACING_KEY="letterSpacing",this.SETTING_LISTEN_ENABLED_KEY="listenEnabled",this.SETTING_AUDIO_WPM_KEY="audioWPM",this.SETTING_VOICES_KEY="voices",this.SETTING_CURRENT_VOICE_KEY="currentVoice",this.DEFAULT_VOICE="OzBV1TXMSeKHzrMVayZl",this.USER_LICENSE_KEY="licenseKey",this.USER_SETTINGS_JSON_KEY="settingsJson";var t={};t[this.SETTING_WPM]=275,t[this.SETTING_CHUNK_SIZE]=1,t[this.SETTING_HIHGLIGHT_ENABLED_KEY]="true",t[this.SETTING_HIGHLIGHT_COLOR_USE_CUSTOM_KEY]="false",t[this.SETTING_HIHGLIGHT_COLOR_KEY]=this.DEFAULT_HIGHLIGHT_COLOR,t[this.SETTING_START_TIMER_ENABLED_KEY]="false",t[this.SETTING_START_TIMER_LENGTH_KEY]=2,t[this.SETTING_MICROPAUSE_NUMBERS_ENABLED_KEY]="true",t[this.SETTING_MICROPAUSE_PUNCTUATION_ENABLED_KEY]="true",t[this.SETTING_MICROPAUSE_LONGWORDS_ENABLED_KEY]="true",t[this.SETTING_MICROPAUSE_PARAGRAPH_ENABLED_KEY]="true",t[this.SETTING_MICROPAUSE_NUMBERS_FACTOR_KEY]=.5,t[this.SETTING_MICROPAUSE_PUNCTUATION_FACTOR_KEY]=.9,t[this.SETTING_MICROPAUSE_ENDING_PUNCTUATION_FACTOR_KEY]=1.1,t[this.SETTING_MICROPAUSE_LONGWORDS_FACTOR_KEY]=.5,t[this.SETTING_MICROPAUSE_PARGRAPH_FACTOR_KEY]=1.1,t[this.SETTING_BACKGROUND_COLOR_ENABLED_KEY]="false",t[this.SETTING_BACKGROUND_COLOR_KEY]=this.DEFAULT_BACKGROUND_COLOR,t[this.SETTING_FONT_COLOR_ENABLED_KEY]="false",t[this.SETTING_FONT_COLOR_KEY]=this.DEFAULT_FONT_COLOR,t[this.SETTING_TEXT_SCROLLER_ENABLED_KEY]="true",t[this.SETTING_LETTER_SPACING_KEY]=this.DEFAULT_LETTER_SPACING,t[this.SETTING_WPM_INTERVAL_KEY]=25,t[this.SETTING_CONTEXT_DISPLAY_KEY]="on-pause",t[this.SETTING_COMBINE_BIGWORD_WITH_CONTEXT_KEY]="true",t[this.SETTING_CONTEXT_OPACITY_KEY]=.5,t[this.SETTING_AUTO_PAGE_TURN_ENABLED_KEY]="true",t[this.SETTING_SANITIZATION_RULE_KEY]="",t[this.SETTING_FOCUS_LETTER_INDICATOR_ENABLED_KEY]="false",t[this.SETTING_CONTEXT_FROM_RIGHT_ENABLED_KEY]="false",t[this.SETTING_SANITIZE_INLINE_CITATIONS_ENABLED_KEY]="true",t[this.SETTING_SANITIZE_URLS_ENABLED_KEY]="true",t[this.SETTING_HOTKEY_PLAY_KEY]="Space",t[this.SETTING_HOTKEY_REWIND_KEY]="J",t[this.SETTING_HOTKEY_RESET_KEY]=";",t[this.SETTING_HOTKEY_FORWARD_KEY]="L",t[this.SETTING_HOTKEY_QUIT_KEY]="Q",t[this.SETTING_HOTKEY_HIDE_KEY]="H",t[this.SETTING_HOTKEY_WPM_INCREASE_KEY]="=",t[this.SETTING_HOTKEY_WPM_DECREASE_KEY]="-",t[this.SETTING_HOTKEY_CHUNK_SIZE_INCREASE_KEY]="]",t[this.SETTING_HOTKEY_CHUNK_SIZE_DECREASE_KEY]="[",t[this.SETTING_HOTKEY_FONT_SIZE_INCREASE_KEY]="Up",t[this.SETTING_HOTKEY_FONT_SIZE_DECREASE_KEY]="Down",t[this.SETTING_HOTKEY_FULLSCREEN_KEY]="F",t[this.SETTING_HOTKEY_PAGE_LEFT]="N",t[this.SETTING_HOTKEY_PAGE_RIGHT]="M",t[this.SETTING_TOGGLE_CONTEXT_MODE]="C",t[this.SETTING_HOTKEY_TOGGLE_LISTEN_KEY]="Z",t[this.SETTING_LISTEN_ENABLED_KEY]="false",t[this.SETTING_AUDIO_WPM_KEY]=200,t[this.SETTING_CURRENT_VOICE_KEY]=this.DEFAULT_VOICE,t[this.USER_LICENSE_KEY]=null,t[this.USER_SETTINGS_JSON_KEY]={highlightColor:{},highlightColorEnabled:{updateFunction:"updateCustomStyleElements",handleClickFunction:"handleCheckboxClick"},highlightColorUseCustom:{},backgroundColor:{},backgroundColorEnabled:{},fontColor:{},fontColorEnabled:{},startTimerEnabled:{updateFunction:"getTimerDelay",handleClickFunction:"handleCheckboxClick"},startTimerLength:{},micropauseNumbersEnabled:{updateFunction:"getMicropauseSettings",handleClickFunction:"handleCheckboxClick"},micropausePunctuationEnabled:{updateFunction:"getMicropauseSettings",handleClickFunction:"handleCheckboxClick"},micropauseLongWordsEnabled:{updateFunction:"getMicropauseSettings",handleClickFunction:"handleCheckboxClick"},micropauseParagraphEnabled:{updateFunction:"getMicropauseSettings",handleClickFunction:"handleCheckboxClick"},micropauseNumbersFactor:{},micropausePunctuationFactor:{},micropauseEndingPunctuationFactor:{},micropauseLongWordsFactor:{},micropauseParagraphFactor:{},contextDisplayStyle:{updateFunction:"updateContextDisplayStyle",handleClickFunction:"handleRadioClick"},combineBigwordWithContextEnabled:{updateFunction:"updateContextDisplayStyle",handleClickFunction:"handleRadioClick"},contextOpacity:{updateFunction:"updateCustomStyleElements",handleClickFunction:"handleRangeChange"},autoPageTurnEnabled:{},sanitizationRule:{},focusLetterIndicatorEnabled:{updateFunction:"getFocusLetterIndicatorSettings",handleClickFunction:"handleCheckboxClick"},contextFromRightEnabled:{updateFunction:"updateContextDisplayStyle",handleClickFunction:"handleCheckboxClick"},sanitizeInlineCitationsEnabled:{updateFunction:"getHarcodedSanitizationSetting",handleClickFunction:"handleCheckboxClick"},sanitizeURLsEnabled:{updateFunction:"getHarcodedSanitizationSetting",handleClickFunction:"handleCheckboxClick"},hotkeyPlay:{},hotkeyRewind:{},hotkeyReset:{},hotkeyForward:{},hotkeyQuit:{},hotkeyWPMIncrease:{},hotkeyWPMDecrease:{},hotkeyChunkSizeIncrease:{},hotkeyChunkSizeDecrease:{},hotkeyFontSizeIncrease:{},hotkeyFontSizeDecrease:{},hotkeyFullscreen:{},hotkeyPageLeft:{},hotkeyPageRight:{},hotkeyToggleContextMode:{},hotkeyToggleListen:{},textScrollerEnabled:{},letterSpacing:{},wpmInterval:{updateFunction:"getWPMInterval",handleClickFunction:"handleRangeChange"},currentColorScheme:{updateFunction:"updateCustomStyleElements",handleClickFunction:"handleRadioClick"},currentFont:{updateFunction:"updateCustomStyleElements",handleClickFunction:"handleRadioClick"},listenEnabled:{},audioWPM:{},currentVoice:{}},t[this.SETTING_COLOR_SCHEMES_KEY]={"white-on-black":{colorSchemeFontColor:"#ffffff",colorSchemeBackgroundColor:"#272727",colorSchemeHighlightColor:"#f6861f",type:"free"},"black-on-white":{colorSchemeFontColor:"#222222",colorSchemeBackgroundColor:"#fafafa",colorSchemeHighlightColor:"#f6861f",type:"free"},beige:{colorSchemeBackgroundColor:"#f8eed4",colorSchemeFontColor:"#836f5e",colorSchemeHighlightColor:"#f6861f",type:"free"},"black-on-white-max":{colorSchemeFontColor:"#000000",colorSchemeBackgroundColor:"#ffffff",colorSchemeHighlightColor:"#205B6F",type:"paid"},"black-on-white-9":{colorSchemeFontColor:"#454545",colorSchemeBackgroundColor:"#fafafa",colorSchemeHighlightColor:"#204765",type:"paid"},"black-on-white-45":{colorSchemeFontColor:"#6B6B6B",colorSchemeBackgroundColor:"#fafafa",colorSchemeHighlightColor:"#537180",type:"paid"},"white-on-black-45":{colorSchemeFontColor:"#fafafa",colorSchemeBackgroundColor:"#6B6B6B",colorSchemeHighlightColor:"#E1D39C",type:"paid"},"white-on-blue":{colorSchemeFontColor:"#ffffff",colorSchemeBackgroundColor:"#0b3045",colorSchemeHighlightColor:"#E1D39C",type:"paid"},"white-on-blue-45":{colorSchemeFontColor:"#CCCCCC",colorSchemeBackgroundColor:"#205B6F",colorSchemeHighlightColor:"#DFC882",type:"paid"},"blue-on-yellow-45":{colorSchemeFontColor:"#107876",colorSchemeBackgroundColor:"#FFF3A8",colorSchemeHighlightColor:"#467750",type:"paid"},"blue-on-blue-45":{colorSchemeFontColor:"#155A7E",colorSchemeBackgroundColor:"#A9D3E5",colorSchemeHighlightColor:"#355F3D",type:"paid"},"blue-on-white-45":{colorSchemeFontColor:"#1D79AA",colorSchemeBackgroundColor:"#fafafa",colorSchemeHighlightColor:"#487F52",type:"paid"},"black-on-yellow-45":{colorSchemeFontColor:"#6B6B6B",colorSchemeBackgroundColor:"#FFF3A8",colorSchemeHighlightColor:"#447474",type:"paid"},"black-on-blue-45":{colorSchemeFontColor:"#616161",colorSchemeBackgroundColor:"#A9D3E5",colorSchemeHighlightColor:"#466372",type:"paid"},"black-on-blue":{colorSchemeFontColor:"#333333",colorSchemeBackgroundColor:"#A9D3E5",colorSchemeHighlightColor:"#00346B",type:"paid"}},t[this.SETTING_CURRENT_COLOR_SCHEME_KEY]=this.DEFAULT_COLOR_SCHEME,t[this.SETTING_FONTS_KEY]={georgia:{fontName:"Georgia",fontBackup:"serif",type:"free"},"open-sans":{fontName:"Open Sans",fontBackup:"sans-serif",type:"paid"},bookerly:{fontName:"Bookerly",fontBackup:"serif",type:"paid"},garamond:{fontName:"Garamond",fontBackup:"serif",type:"paid"},"helvetica-neue":{fontName:"Helvetica Neue",fontBackup:"sans-serif",type:"paid"},merriweather:{fontName:"Merriweather",fontBackup:"serif",type:"paid"},minion:{fontName:"Minion",fontBackup:"serif",type:"paid"},tisa:{fontName:"Tisa",fontBackup:"serif",type:"paid"},dyslexie:{fontName:"Dyslexie",fontBackup:"sans-serif",type:"paid"},arial:{fontName:"Arial",fontBackup:"sans-serif",type:"free"}},t[this.SETTING_CURRENT_FONT_KEY]=this.DEFAULT_FONT,t[this.SETTING_VOICES_KEY]=[],t[this.SETTING_CURRENT_VOICE_KEY]=this.DEFAULT_VOICE;var e=null;this.getAllSettings=function(){if(null!==e)return e;throw"Settings store not yet initialized. Use its 'isInitialized' promise."},this.getSetting=function(t){if(null!==e)return e[t];throw"Settings store not yet initialized. Use its 'isInitialized' promise."},this.getSettingFromStorage=function(t){return new Promise(((n,r)=>{chrome.storage.sync.get([t],(function(i){const s=i[t];void 0===s?null!==e?n(e[t]):r(`Setting key '${t}' not in storage or default settings.`):n(s)}))}))},this.setSetting=function(t,n,r=null){if(null===e)throw"Settings store not yet initialized. Use its 'isInitialized' promise.";e[t]=n;var i={};i[t]=n,chrome.storage.sync.set(i,r)},this.getSettingKey=function(t){return this[t]},this.getDefaultSettings=function(){return t},this.isInitialized=new Promise((function(n,r){chrome.storage.sync.get(null,(function(r){var i={...t,...r};e=i,n()}))}))}clear(t=null){chrome.storage.sync.clear(t)}}}},3083:(t,e,n)=>{"use strict";var r=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],i="undefined"==typeof globalThis?n.g:globalThis;t.exports=function(){for(var t=[],e=0;e<r.length;e++)"function"==typeof i[r[e]]&&(t[t.length]=r[e]);return t}}},s={};function o(t){var e=s[t];if(void 0!==e)return e.exports;var n=s[t]={exports:{}};return i[t](n,n.exports,o),n.exports}o.m=i,o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,o.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"==typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"==typeof n.then)return n}var i=Object.create(null);o.r(i);var s={};t=t||[null,e({}),e([]),e(e)];for(var a=2&r&&n;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach((t=>s[t]=()=>n[t]));return s.default=()=>n,o.d(i,s),i},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.f={},o.e=t=>Promise.all(Object.keys(o.f).reduce(((e,n)=>(o.f[n](t,e),e)),[])),o.u=t=>""+t,o.miniCssF=t=>{},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n={},r="extension:",o.l=(t,e,i,s)=>{if(n[t])n[t].push(e);else{var a,c;if(void 0!==i)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var h=u[l];if(h.getAttribute("src")==t||h.getAttribute("data-webpack")==r+i){a=h;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",r+i),a.src=t),n[t]=[e];var d=(e,r)=>{a.onerror=a.onload=null,clearTimeout(f);var i=n[t];if(delete n[t],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((t=>t(r))),e)return e(r)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),c&&document.head.appendChild(a)}},o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;o.g.importScripts&&(t=o.g.location+"");var e=o.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&!t;)t=n[r--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=t+"../../"})(),(()=>{var t={909:0,289:0,603:0};o.f.j=(e,n)=>{var r=o.o(t,e)?t[e]:void 0;if(0!==r)if(r)n.push(r[2]);else{var i=new Promise(((n,i)=>r=t[e]=[n,i]));n.push(r[2]=i);var s=o.p+o.u(e),a=new Error;o.l(s,(n=>{if(o.o(t,e)&&(0!==(r=t[e])&&(t[e]=void 0),r)){var i=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;a.message="Loading chunk "+e+" failed.\n("+i+": "+s+")",a.name="ChunkLoadError",a.type=i,a.request=s,r[1](a)}}),"chunk-"+e,e)}};var e=(e,n)=>{var r,i,[s,a,c]=n,u=0;if(s.some((e=>0!==t[e]))){for(r in a)o.o(a,r)&&(o.m[r]=a[r]);c&&c(o)}for(e&&e(n);u<s.length;u++)i=s[u],o.o(t,i)&&t[i]&&t[i][0](),t[i]=0},n=self.webpackChunkextension=self.webpackChunkextension||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),("undefined"!=typeof window?window:void 0!==o.g?o.g:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"5.9.2+71eff9c"},(()=>{"use strict";var t=o(756),e=o(7266);const n=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const i=t[e],s=e+1<t.length,o=s?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(n(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==o||null==a||null==c)throw new i;const u=s<<2|o>>4;if(r.push(u),64!==a){const t=o<<4&240|a>>2;if(r.push(t),64!==c){const t=a<<6&192|c;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class i extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const s=function(t){return function(t){const e=n(t);return r.encodeByteArray(e,!0)}(t).replace(/\./g,"")},a=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==o.g)return o.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0==={})return;const t={}.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return r.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},c=t=>{const e=(t=>{var e,n;return null===(n=null===(e=a())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]},u=()=>{var t;return null===(t=a())||void 0===t?void 0:t.config};class l{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function h(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t);return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(o)),""].join(".")}class d extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,d.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,f.prototype.create)}}class f{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,i=this.errors[t],s=i?function(t,e){return t.replace(p,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new d(r,o,n)}}const p=/\{\$([^}]+)}/g;function g(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const n=t[i],s=e[i];if(m(n)&&m(s)){if(!g(n,s))return!1}else if(n!==s)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function m(t){return null!==t&&"object"==typeof t}function y(t){return t&&t._delegate?t._delegate:t}class v{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const _="[DEFAULT]";class w{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new l;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:_})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=_){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=_){return this.instances.has(t)}getOptions(t=_){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&t(s,r),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===_?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t=_){return this.component?this.component.multipleInstances?t:_:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class b{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new w(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const E=[];var S,T;(T=S||(S={}))[T.DEBUG=0]="DEBUG",T[T.VERBOSE=1]="VERBOSE",T[T.INFO=2]="INFO",T[T.WARN=3]="WARN",T[T.ERROR=4]="ERROR",T[T.SILENT=5]="SILENT";const I={debug:S.DEBUG,verbose:S.VERBOSE,info:S.INFO,warn:S.WARN,error:S.ERROR,silent:S.SILENT},O=S.INFO,k={[S.DEBUG]:"log",[S.VERBOSE]:"log",[S.INFO]:"info",[S.WARN]:"warn",[S.ERROR]:"error"},C=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),i=k[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${r}]  ${t.name}:`,...n)};class A{constructor(t){this.name=t,this._logLevel=O,this._logHandler=C,this._userLogHandler=null,E.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in S))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?I[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,S.DEBUG,...t),this._logHandler(this,S.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,S.VERBOSE,...t),this._logHandler(this,S.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,S.INFO,...t),this._logHandler(this,S.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,S.WARN,...t),this._logHandler(this,S.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,S.ERROR,...t),this._logHandler(this,S.ERROR,...t)}}const R=(t,e)=>e.some((e=>t instanceof e));let N,x;const D=new WeakMap,P=new WeakMap,L=new WeakMap,j=new WeakMap,U=new WeakMap;let M={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return P.get(t);if("objectStoreNames"===e)return t.objectStoreNames||L.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return $(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function F(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(x||(x=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(B(this),t),$(D.get(this))}:function(...t){return $(e.apply(B(this),t))}:function(t,...n){const r=e.call(B(this),t,...n);return L.set(r,t.sort?t.sort():[t]),$(r)}:(t instanceof IDBTransaction&&function(t){if(P.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{e(),r()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)}));P.set(t,e)}(t),R(t,N||(N=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,M):t);var e}function $(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{e($(t.result)),r()},s=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&D.set(e,t)})).catch((()=>{})),U.set(e,t),e}(t);if(j.has(t))return j.get(t);const e=F(t);return e!==t&&(j.set(t,e),U.set(e,t)),e}const B=t=>U.get(t),V=["get","getKey","getAll","getAllKeys","count"],G=["put","add","delete","clear"],q=new Map;function K(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(q.get(e))return q.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=G.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!V.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),i&&s.done]))[0]};return q.set(e,s),s}var H;H=M,M={...H,get:(t,e,n)=>K(t,e)||H.get(t,e,n),has:(t,e)=>!!K(t,e)||H.has(t,e)};class z{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const W="@firebase/app",Y="0.9.13",J=new A("@firebase/app"),X="[DEFAULT]",Q={[W]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},Z=new Map,tt=new Map;function et(t,e){try{t.container.addComponent(e)}catch(n){J.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function nt(t){const e=t.name;if(tt.has(e))return J.debug(`There were multiple attempts to register component ${e}.`),!1;tt.set(e,t);for(const e of Z.values())et(e,t);return!0}function rt(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}const it=new f("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class st{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new v("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw it.create("app-deleted",{appName:this._name})}}const ot="9.23.0";function at(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:X,automaticDataCollectionEnabled:!1},e),i=r.name;if("string"!=typeof i||!i)throw it.create("bad-app-name",{appName:String(i)});if(n||(n=u()),!n)throw it.create("no-options");const s=Z.get(i);if(s){if(g(n,s.options)&&g(r,s.config))return s;throw it.create("duplicate-app",{appName:i})}const o=new b(i);for(const t of tt.values())o.addComponent(t);const a=new st(n,r,o);return Z.set(i,a),a}function ct(t=X){const e=Z.get(t);if(!e&&t===X&&u())return at();if(!e)throw it.create("no-app",{appName:t});return e}function ut(t,e,n){var r;let i=null!==(r=Q[t])&&void 0!==r?r:t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const t=[`Unable to register library "${i}" with version "${e}":`];return s&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void J.warn(t.join(" "))}nt(new v(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}const lt="firebase-heartbeat-database",ht=1,dt="firebase-heartbeat-store";let ft=null;function pt(){return ft||(ft=function(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=$(o);return r&&o.addEventListener("upgradeneeded",(t=>{r($(o.result),t.oldVersion,t.newVersion,$(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{s&&t.addEventListener("close",(()=>s())),i&&t.addEventListener("versionchange",(t=>i(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(lt,ht,{upgrade:(t,e)=>{0===e&&t.createObjectStore(dt)}}).catch((t=>{throw it.create("idb-open",{originalErrorMessage:t.message})}))),ft}async function gt(t,e){try{const n=(await pt()).transaction(dt,"readwrite"),r=n.objectStore(dt);await r.put(e,mt(t)),await n.done}catch(t){if(t instanceof d)J.warn(t.message);else{const e=it.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});J.warn(e.message)}}}function mt(t){return`${t.name}!${t.options.appId}`}class yt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new _t(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=vt();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=vt(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let r=t.slice();for(const i of t){const t=n.find((t=>t.agent===i.agent));if(t){if(t.dates.push(i.date),wt(n)>e){t.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),wt(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=s(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function vt(){return(new Date).toISOString().substring(0,10)}class _t{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(t){return!1}}()&&new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=await pt();return await e.transaction(dt).objectStore(dt).get(mt(t))}catch(t){if(t instanceof d)J.warn(t.message);else{const e=it.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});J.warn(e.message)}}}(this.app);return t||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return gt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return gt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function wt(t){return s(JSON.stringify({version:2,heartbeats:t})).length}nt(new v("platform-logger",(t=>new z(t)),"PRIVATE")),nt(new v("heartbeat",(t=>new yt(t)),"PRIVATE")),ut(W,Y,""),ut(W,Y,"esm2017"),ut("fire-js",""),ut("firebase","9.23.0","app");var bt,Et="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},St={},Tt=Tt||{},It=Et||self;function Ot(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function kt(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Ct="closure_uid_"+(1e9*Math.random()>>>0),At=0;function Rt(t,e,n){return t.call.apply(t.bind,arguments)}function Nt(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function xt(t,e,n){return(xt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Rt:Nt).apply(null,arguments)}function Dt(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Pt(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}function Lt(){this.s=this.s,this.o=this.o}Lt.prototype.s=!1,Lt.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,Ct)&&t[Ct]||(t[Ct]=++At))},Lt.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const jt=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function Ut(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function Mt(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(Ot(n)){const e=t.length||0,r=n.length||0;t.length=e+r;for(let i=0;i<r;i++)t[e+i]=n[i]}else t.push(n)}}function Ft(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Ft.prototype.h=function(){this.defaultPrevented=!0};var $t=function(){if(!It.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{It.addEventListener("test",(()=>{}),e),It.removeEventListener("test",(()=>{}),e)}catch(t){}return t}();function Bt(t){return/^[\s\xa0]*$/.test(t)}function Vt(){var t=It.navigator;return t&&(t=t.userAgent)?t:""}function Gt(t){return-1!=Vt().indexOf(t)}function qt(t){return qt[" "](t),t}qt[" "]=function(){};var Kt,Ht,zt,Wt=Gt("Opera"),Yt=Gt("Trident")||Gt("MSIE"),Jt=Gt("Edge"),Xt=Jt||Yt,Qt=Gt("Gecko")&&!(-1!=Vt().toLowerCase().indexOf("webkit")&&!Gt("Edge"))&&!(Gt("Trident")||Gt("MSIE"))&&!Gt("Edge"),Zt=-1!=Vt().toLowerCase().indexOf("webkit")&&!Gt("Edge");function te(){var t=It.document;return t?t.documentMode:void 0}t:{var ee="",ne=(Ht=Vt(),Qt?/rv:([^\);]+)(\)|;)/.exec(Ht):Jt?/Edge\/([\d\.]+)/.exec(Ht):Yt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Ht):Zt?/WebKit\/(\S+)/.exec(Ht):Wt?/(?:Version)[ \/]?(\S+)/.exec(Ht):void 0);if(ne&&(ee=ne?ne[1]:""),Yt){var re=te();if(null!=re&&re>parseFloat(ee)){Kt=String(re);break t}}Kt=ee}It.document&&Yt?zt=te()||parseInt(Kt,10)||void 0:zt=void 0;var ie=zt;function se(t,e){if(Ft.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Qt){t:{try{qt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:oe[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&se.$.h.call(this)}}Pt(se,Ft);var oe={2:"touch",3:"pen",4:"mouse"};se.prototype.h=function(){se.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var ae="closure_listenable_"+(1e6*Math.random()|0),ce=0;function ue(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.la=i,this.key=++ce,this.fa=this.ia=!1}function le(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function he(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function de(t){const e={};for(const n in t)e[n]=t[n];return e}const fe="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function pe(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<fe.length;e++)n=fe[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function ge(t){this.src=t,this.g={},this.h=0}function me(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],s=jt(i,e);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(le(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function ye(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.fa&&s.listener==e&&s.capture==!!n&&s.la==r)return i}return-1}ge.prototype.add=function(t,e,n,r,i){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=ye(t,e,r,i);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new ue(e,this.src,s,!!r,i)).ia=n,t.push(e)),e};var ve="closure_lm_"+(1e6*Math.random()|0),_e={};function we(t,e,n,r,i){if(r&&r.once)return Ee(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)we(t,e[s],n,r,i);return null}return n=Ae(n),t&&t[ae]?t.O(e,n,kt(r)?!!r.capture:!!r,i):be(t,e,n,!1,r,i)}function be(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var o=kt(i)?!!i.capture:!!i,a=ke(t);if(a||(t[ve]=a=new ge(t)),(n=a.add(e,n,r,o,s)).proxy)return n;if(r=function(){const t=Oe;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)$t||(i=o),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ie(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ee(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Ee(t,e[s],n,r,i);return null}return n=Ae(n),t&&t[ae]?t.P(e,n,kt(r)?!!r.capture:!!r,i):be(t,e,n,!0,r,i)}function Se(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Se(t,e[s],n,r,i);else r=kt(r)?!!r.capture:!!r,n=Ae(n),t&&t[ae]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=ye(s=t.g[e],n,r,i))&&(le(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.g[e],t.h--))):t&&(t=ke(t))&&(e=t.g[e.toString()],t=-1,e&&(t=ye(e,n,r,i)),(n=-1<t?e[t]:null)&&Te(n))}function Te(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[ae])me(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ie(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=ke(e))?(me(n,t),0==n.h&&(n.src=null,e[ve]=null)):le(t)}}}function Ie(t){return t in _e?_e[t]:_e[t]="on"+t}function Oe(t,e){if(t.fa)t=!0;else{e=new se(e,this);var n=t.listener,r=t.la||t.src;t.ia&&Te(t),t=n.call(r,e)}return t}function ke(t){return(t=t[ve])instanceof ge?t:null}var Ce="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ae(t){return"function"==typeof t?t:(t[Ce]||(t[Ce]=function(e){return t.handleEvent(e)}),t[Ce])}function Re(){Lt.call(this),this.i=new ge(this),this.S=this,this.J=null}function Ne(t,e){var n,r=t.J;if(r)for(n=[];r;r=r.J)n.push(r);if(t=t.S,r=e.type||e,"string"==typeof e)e=new Ft(e,t);else if(e instanceof Ft)e.target=e.target||t;else{var i=e;pe(e=new Ft(r,t),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=xe(o,r,!0,e)&&i}if(i=xe(o=e.g=t,r,!0,e)&&i,i=xe(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)i=xe(o=e.g=n[s],r,!1,e)&&i}function xe(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&me(t.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}Pt(Re,Lt),Re.prototype[ae]=!0,Re.prototype.removeEventListener=function(t,e,n,r){Se(this,t,e,n,r)},Re.prototype.N=function(){if(Re.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)le(n[r]);delete e.g[t],e.h--}}this.J=null},Re.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Re.prototype.P=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var De=It.JSON.stringify;function Pe(){var t=Be;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Le=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new je),(t=>t.reset()));class je{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Ue(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function Me(t){It.setTimeout((()=>{throw t}),0)}let Fe,$e=!1,Be=new class{constructor(){this.h=this.g=null}add(t,e){const n=Le.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},Ve=()=>{const t=It.Promise.resolve(void 0);Fe=()=>{t.then(Ge)}};var Ge=()=>{for(var t;t=Pe();){try{t.h.call(t.g)}catch(t){Me(t)}var e=Le;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}$e=!1};function qe(t,e){Re.call(this),this.h=t||1,this.g=e||It,this.j=xt(this.qb,this),this.l=Date.now()}function Ke(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function He(t,e,n){if("function"==typeof t)n&&(t=xt(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=xt(t.handleEvent,t)}return 2147483647<Number(e)?-1:It.setTimeout(t,e||0)}function ze(t){t.g=He((()=>{t.g=null,t.i&&(t.i=!1,ze(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}Pt(qe,Re),(bt=qe.prototype).ga=!1,bt.T=null,bt.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Ne(this,"tick"),this.ga&&(Ke(this),this.start()))}},bt.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},bt.N=function(){qe.$.N.call(this),Ke(this),delete this.g};class We extends Lt{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:ze(this)}N(){super.N(),this.g&&(It.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ye(t){Lt.call(this),this.h=t,this.g={}}Pt(Ye,Lt);var Je=[];function Xe(t,e,n,r){Array.isArray(n)||(n&&(Je[0]=n.toString()),n=Je);for(var i=0;i<n.length;i++){var s=we(e,n[i],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function Qe(t){he(t.g,(function(t,e){this.g.hasOwnProperty(e)&&Te(t)}),t),t.g={}}function Ze(){this.g=!0}function tn(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return De(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}Ye.prototype.N=function(){Ye.$.N.call(this),Qe(this)},Ye.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ze.prototype.Ea=function(){this.g=!1},Ze.prototype.info=function(){};var en={},nn=null;function rn(){return nn=nn||new Re}function sn(t){Ft.call(this,en.Ta,t)}function on(t){const e=rn();Ne(e,new sn(e))}function an(t,e){Ft.call(this,en.STAT_EVENT,t),this.stat=e}function cn(t){const e=rn();Ne(e,new an(e,t))}function un(t,e){Ft.call(this,en.Ua,t),this.size=e}function ln(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return It.setTimeout((function(){t()}),e)}en.Ta="serverreachability",Pt(sn,Ft),en.STAT_EVENT="statevent",Pt(an,Ft),en.Ua="timingevent",Pt(un,Ft);var hn={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},dn={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function fn(){}function pn(t){return t.h||(t.h=t.i())}function gn(){}fn.prototype.h=null;var mn,yn={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function vn(){Ft.call(this,"d")}function _n(){Ft.call(this,"c")}function wn(){}function bn(t,e,n,r){this.l=t,this.j=e,this.m=n,this.W=r||1,this.U=new Ye(this),this.P=Sn,t=Xt?125:void 0,this.V=new qe(t),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new En}function En(){this.i=null,this.g="",this.h=!1}Pt(vn,Ft),Pt(_n,Ft),Pt(wn,fn),wn.prototype.g=function(){return new XMLHttpRequest},wn.prototype.i=function(){return{}},mn=new wn;var Sn=45e3,Tn={},In={};function On(t,e,n){t.L=1,t.v=Kn($n(e)),t.s=n,t.S=!0,kn(t,null)}function kn(t,e){t.G=Date.now(),Nn(t),t.A=$n(t.v);var n=t.A,r=t.W;Array.isArray(r)||(r=[String(r)]),ir(n.i,"t",r),t.C=0,n=t.l.J,t.h=new En,t.g=ii(t.l,n?e:null,!t.s),0<t.O&&(t.M=new We(xt(t.Pa,t,t.g),t.O)),Xe(t.U,t.g,"readystatechange",t.nb),e=t.I?de(t.I):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.A,t.u,t.s,e)):(t.u="GET",t.g.ha(t.A,t.u,null,e)),on(),function(t,e,n,r,i,s){t.info((function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.W,t.s)}function Cn(t){return!!t.g&&"GET"==t.u&&2!=t.L&&t.l.Ha}function An(t,e,n){let r,i=!0;for(;!t.J&&t.C<n.length;){if(r=Rn(t,n),r==In){4==e&&(t.o=4,cn(14),i=!1),tn(t.j,t.m,null,"[Incomplete Response]");break}if(r==Tn){t.o=4,cn(15),tn(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}tn(t.j,t.m,r,null),jn(t,r)}Cn(t)&&r!=In&&r!=Tn&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,cn(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Jr(e),e.M=!0,cn(11))):(tn(t.j,t.m,n,"[Invalid Chunked Response]"),Ln(t),Pn(t))}function Rn(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?In:(n=Number(e.substring(n,r)),isNaN(n)?Tn:(r+=1)+n>e.length?In:(e=e.slice(r,r+n),t.C=r+n,e))}function Nn(t){t.Y=Date.now()+t.P,xn(t,t.P)}function xn(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=ln(xt(t.lb,t),e)}function Dn(t){t.B&&(It.clearTimeout(t.B),t.B=null)}function Pn(t){0==t.l.H||t.J||Zr(t.l,t)}function Ln(t){Dn(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,Ke(t.V),Qe(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function jn(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||hr(n.i,t)))if(!t.K&&hr(n.i,t)&&3==n.H){try{var r=n.Ja.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;Qr(n),Vr(n)}Yr(n),cn(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=ln(xt(n.ib,n),6e3));if(1>=lr(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else ei(n,11)}else if((t.K||n.g==t)&&Qr(n),!Bt(e))for(i=n.Ja.g.parse(e),e=0;e<i.length;e++){let u=i[e];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const e=u[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const i=u[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=t.g;if(h){const t=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=r.i;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(dr(s,s.h),s.h=null))}if(r.F){const t=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.Da=t,qn(r.I,r.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((r=n).wa=ri(r,r.J?r.pa:null,r.Y),o.K){fr(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.B&&(Dn(a),Nn(a)),r.g=o}else Wr(r);0<n.j.length&&qr(n)}else"stop"!=u[0]&&"close"!=u[0]||ei(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?ei(n,7):Br(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}on()}catch(t){}}function Un(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Ot(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(Ot(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(Ot(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],n&&n[s],t)}(bt=bn.prototype).setTimeout=function(t){this.P=t},bt.nb=function(t){t=t.target;const e=this.M;e&&3==Lr(t)?e.l():this.Pa(t)},bt.Pa=function(t){try{if(t==this.g)t:{const l=Lr(this.g);var e=this.g.Ia();if(this.g.da(),!(3>l)&&(3!=l||Xt||this.g&&(this.h.h||this.g.ja()||jr(this.g)))){this.J||4!=l||7==e||on(),Dn(this);var n=this.g.da();this.ca=n;e:if(Cn(this)){var r=jr(this.g);t="";var i=r.length,s=4==Lr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ln(this),Pn(this);var o="";break e}this.h.i=new It.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.splice(0,i),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,r,i,s,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.W,l,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Bt(a)){var u=a;break e}}u=null}if(!(n=u)){this.i=!1,this.o=3,cn(12),Ln(this),Pn(this);break t}tn(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,jn(this,n)}this.S?(An(this,l,o),Xt&&this.i&&3==l&&(Xe(this.U,this.V,"tick",this.mb),this.V.start())):(tn(this.j,this.m,o,null),jn(this,o)),4==l&&Ln(this),this.i&&!this.J&&(4==l?Zr(this.l,this):(this.i=!1,Nn(this)))}else(function(t){const e={};t=(t.g&&2<=Lr(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(Bt(t[r]))continue;var n=Ue(t[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=e[i]||[];e[i]=s,s.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,cn(12)):(this.o=0,cn(13)),Ln(this),Pn(this)}}}catch(t){}},bt.mb=function(){if(this.g){var t=Lr(this.g),e=this.g.ja();this.C<e.length&&(Dn(this),An(this,t,e),this.i&&4!=t&&Nn(this))}},bt.cancel=function(){this.J=!0,Ln(this)},bt.lb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.L&&(on(),cn(17)),Ln(this),this.o=2,Pn(this)):xn(this,this.Y-t)};var Mn=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Fn(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Fn){this.h=t.h,Bn(this,t.j),this.s=t.s,this.g=t.g,Vn(this,t.m),this.l=t.l;var e=t.i,n=new tr;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),Gn(this,n),this.o=t.o}else t&&(e=String(t).match(Mn))?(this.h=!1,Bn(this,e[1]||"",!0),this.s=Hn(e[2]||""),this.g=Hn(e[3]||"",!0),Vn(this,e[4]),this.l=Hn(e[5]||"",!0),Gn(this,e[6]||"",!0),this.o=Hn(e[7]||"")):(this.h=!1,this.i=new tr(null,this.h))}function $n(t){return new Fn(t)}function Bn(t,e,n){t.j=n?Hn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Vn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Gn(t,e,n){e instanceof tr?(t.i=e,function(t,e){e&&!t.j&&(er(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(nr(this,e),ir(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=zn(e,Qn)),t.i=new tr(e,t.h))}function qn(t,e,n){t.i.set(e,n)}function Kn(t){return qn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Hn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function zn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Wn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Wn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Fn.prototype.toString=function(){var t=[],e=this.j;e&&t.push(zn(e,Yn,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(zn(e,Yn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(zn(n,"/"==n.charAt(0)?Xn:Jn,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",zn(n,Zn)),t.join("")};var Yn=/[#\/\?@]/g,Jn=/[#\?:]/g,Xn=/[#\?]/g,Qn=/[#\?@]/g,Zn=/#/g;function tr(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function er(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function nr(t,e){er(t),e=sr(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function rr(t,e){return er(t),e=sr(t,e),t.g.has(e)}function ir(t,e,n){nr(t,e),0<n.length&&(t.i=null,t.g.set(sr(t,e),Ut(n)),t.h+=n.length)}function sr(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(bt=tr.prototype).add=function(t,e){er(this),this.i=null,t=sr(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},bt.forEach=function(t,e){er(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},bt.ta=function(){er(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const i=t[r];for(let t=0;t<i.length;t++)n.push(e[r])}return n},bt.Z=function(t){er(this);let e=[];if("string"==typeof t)rr(this,t)&&(e=e.concat(this.g.get(sr(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},bt.set=function(t,e){return er(this),this.i=null,rr(this,t=sr(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},bt.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},bt.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),t.push(i)}}return this.i=t.join("&")};var or=class{constructor(t,e){this.g=t,this.map=e}};function ar(t){this.l=t||cr,t=It.PerformanceNavigationTiming?0<(t=It.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(It.g&&It.g.Ka&&It.g.Ka()&&It.g.Ka().ec),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var cr=10;function ur(t){return!!t.h||!!t.g&&t.g.size>=t.j}function lr(t){return t.h?1:t.g?t.g.size:0}function hr(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function dr(t,e){t.g?t.g.add(e):t.h=e}function fr(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function pr(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return Ut(t.i)}ar.prototype.cancel=function(){if(this.i=pr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var gr=class{stringify(t){return It.JSON.stringify(t,void 0)}parse(t){return It.JSON.parse(t,void 0)}};function mr(){this.g=new gr}function yr(t,e,n){const r=n||"";try{Un(t,(function(t,n){let i=t;kt(t)&&(i=De(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function vr(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}function _r(t){this.l=t.fc||null,this.j=t.ob||!1}function wr(t,e){Re.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=br,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Pt(_r,fn),_r.prototype.g=function(){return new wr(this.l,this.j)},_r.prototype.i=function(t){return function(){return t}}({}),Pt(wr,Re);var br=0;function Er(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function Sr(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Tr(t)}function Tr(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(bt=wr.prototype).open=function(t,e){if(this.readyState!=br)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Tr(this)},bt.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||It).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},bt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Sr(this)),this.readyState=br},bt.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Tr(this)),this.g&&(this.readyState=3,Tr(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==It.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Er(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},bt.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Sr(this):Tr(this),3==this.readyState&&Er(this)}},bt.Za=function(t){this.g&&(this.response=this.responseText=t,Sr(this))},bt.Ya=function(t){this.g&&(this.response=t,Sr(this))},bt.ka=function(){this.g&&Sr(this)},bt.setRequestHeader=function(t,e){this.v.append(t,e)},bt.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},bt.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(wr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Ir=It.JSON.parse;function Or(t){Re.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=kr,this.L=this.M=!1}Pt(Or,Re);var kr="",Cr=/^https?$/i,Ar=["POST","PUT"];function Rr(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Nr(t),Dr(t)}function Nr(t){t.F||(t.F=!0,Ne(t,"complete"),Ne(t,"error"))}function xr(t){if(t.h&&void 0!==Tt&&(!t.C[1]||4!=Lr(t)||2!=t.da()))if(t.v&&4==Lr(t))He(t.La,0,t);else if(Ne(t,"readystatechange"),4==Lr(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===o){var i=String(t.I).match(Mn)[1]||null;!i&&It.self&&It.self.location&&(i=It.self.location.protocol.slice(0,-1)),r=!Cr.test(i?i.toLowerCase():"")}n=r}if(n)Ne(t,"complete"),Ne(t,"success");else{t.m=6;try{var s=2<Lr(t)?t.g.statusText:""}catch(t){s=""}t.j=s+" ["+t.da()+"]",Nr(t)}}finally{Dr(t)}}}function Dr(t,e){if(t.g){Pr(t);const n=t.g,r=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||Ne(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Pr(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(It.clearTimeout(t.A),t.A=null)}function Lr(t){return t.g?t.g.readyState:0}function jr(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case kr:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Ur(t){let e="";return he(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Mr(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Ur(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):qn(t,e,n))}function Fr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function $r(t){this.Ga=0,this.j=[],this.l=new Ze,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Fr("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Fr("baseRetryDelayMs",5e3,t),this.hb=Fr("retryDelaySeedMs",1e4,t),this.eb=Fr("forwardChannelMaxRetries",2,t),this.xa=Fr("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.dc||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new ar(t&&t.concurrentRequestLimit),this.Ja=new mr,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Br(t){if(Gr(t),3==t.H){var e=t.W++,n=$n(t.I);if(qn(n,"SID",t.K),qn(n,"RID",e),qn(n,"TYPE","terminate"),Hr(t,n),(e=new bn(t,t.l,e)).L=2,e.v=Kn($n(n)),n=!1,It.navigator&&It.navigator.sendBeacon)try{n=It.navigator.sendBeacon(e.v.toString(),"")}catch(t){}!n&&It.Image&&((new Image).src=e.v,n=!0),n||(e.g=ii(e.l,null),e.g.ha(e.v)),e.G=Date.now(),Nn(e)}ni(t)}function Vr(t){t.g&&(Jr(t),t.g.cancel(),t.g=null)}function Gr(t){Vr(t),t.u&&(It.clearTimeout(t.u),t.u=null),Qr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&It.clearTimeout(t.m),t.m=null)}function qr(t){if(!ur(t.i)&&!t.m){t.m=!0;var e=t.Na;Fe||Ve(),$e||(Fe(),$e=!0),Be.add(e,t),t.C=0}}function Kr(t,e){var n;n=e?e.m:t.W++;const r=$n(t.I);qn(r,"SID",t.K),qn(r,"RID",n),qn(r,"AID",t.V),Hr(t,r),t.o&&t.s&&Mr(r,t.o,t.s),n=new bn(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=zr(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),dr(t.i,n),On(n,r,e)}function Hr(t,e){t.na&&he(t.na,(function(t,n){qn(e,n,t)})),t.h&&Un({},(function(t,n){qn(e,n,t)}))}function zr(t,e,n){n=Math.min(t.j.length,n);var r=t.h?xt(t.h.Va,t.h,t):null;t:{var i=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=i[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=e,0>n)e=Math.max(0,i[o].g-100),s=!1;else try{yr(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(s){r=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,r}function Wr(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Fe||Ve(),$e||(Fe(),$e=!0),Be.add(e,t),t.A=0}}function Yr(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=ln(xt(t.Ma,t),ti(t,t.A)),t.A++,0))}function Jr(t){null!=t.B&&(It.clearTimeout(t.B),t.B=null)}function Xr(t){t.g=new bn(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=$n(t.wa);qn(e,"RID","rpc"),qn(e,"SID",t.K),qn(e,"AID",t.V),qn(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&qn(e,"TO",t.qa),qn(e,"TYPE","xmlhttp"),Hr(t,e),t.o&&t.s&&Mr(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.v=Kn($n(e)),n.s=null,n.S=!0,kn(n,t)}function Qr(t){null!=t.v&&(It.clearTimeout(t.v),t.v=null)}function Zr(t,e){var n=null;if(t.g==e){Qr(t),Jr(t),t.g=null;var r=2}else{if(!hr(t.i,e))return;n=e.F,fr(t.i,e),r=1}if(0!=t.H)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.G;var i=t.C;Ne(r=rn(),new un(r,n)),qr(t)}else Wr(t);else if(3==(i=e.o)||0==i&&0<e.ca||!(1==r&&function(t,e){return!(lr(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=ln(xt(t.Na,t,e),ti(t,t.C)),t.C++,0)))}(t,e)||2==r&&Yr(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:ei(t,5);break;case 4:ei(t,10);break;case 3:ei(t,6);break;default:ei(t,2)}}function ti(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function ei(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var r=xt(t.pb,t);n||(n=new Fn("//www.google.com/images/cleardot.gif"),It.location&&"http"==It.location.protocol||Bn(n,"https"),Kn(n)),function(t,e){const n=new Ze;if(It.Image){const r=new Image;r.onload=Dt(vr,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Dt(vr,n,r,"TestLoadImage: error",!1,e),r.onabort=Dt(vr,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Dt(vr,n,r,"TestLoadImage: timeout",!1,e),It.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else cn(2);t.H=0,t.h&&t.h.za(e),ni(t),Gr(t)}function ni(t){if(t.H=0,t.ma=[],t.h){const e=pr(t.i);0==e.length&&0==t.j.length||(Mt(t.ma,e),Mt(t.ma,t.j),t.i.i.length=0,Ut(t.j),t.j.length=0),t.h.ya()}}function ri(t,e,n){var r=n instanceof Fn?$n(n):new Fn(n);if(""!=r.g)e&&(r.g=e+"."+r.g),Vn(r,r.m);else{var i=It.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Fn(null);r&&Bn(s,r),e&&(s.g=e),i&&Vn(s,i),n&&(s.l=n),r=s}return n=t.F,e=t.Da,n&&e&&qn(r,n,e),qn(r,"VER",t.ra),Hr(t,r),r}function ii(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ha&&!t.va?new Or(new _r({ob:!0})):new Or(t.va)).Oa(t.J),e}function si(){}function oi(){if(Yt&&!(10<=Number(ie)))throw Error("Environmental error: no available transport.")}function ai(t,e){Re.call(this),this.g=new $r(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!Bt(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Bt(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new li(this)}function ci(t){vn.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function ui(){_n.call(this),this.status=1}function li(t){this.g=t}function hi(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function di(t,e,n){n||(n=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];var s=t.g[3],o=e+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=n+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=n+((o=e+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+s&4294967295}function fi(t,e){this.h=e;for(var n=[],r=!0,i=t.length-1;0<=i;i--){var s=0|t[i];r&&s==e||(n[i]=s,r=!1)}this.g=n}(bt=Or.prototype).Oa=function(t){this.M=t},bt.ha=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():mn.g(),this.C=this.u?pn(this.u):pn(mn),this.g.onreadystatechange=xt(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void Rr(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),i=It.FormData&&t instanceof It.FormData,!(0<=jt(Ar,e))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Pr(this),0<this.B&&((this.L=function(t){return Yt&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=xt(this.ua,this)):this.A=He(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Rr(this,t)}},bt.ua=function(){void 0!==Tt&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ne(this,"timeout"),this.abort(8))},bt.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Ne(this,"complete"),Ne(this,"abort"),Dr(this))},bt.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Dr(this,!0)),Or.$.N.call(this)},bt.La=function(){this.s||(this.G||this.v||this.l?xr(this):this.kb())},bt.kb=function(){xr(this)},bt.isActive=function(){return!!this.g},bt.da=function(){try{return 2<Lr(this)?this.g.status:-1}catch(t){return-1}},bt.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},bt.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Ir(e)}},bt.Ia=function(){return this.m},bt.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(bt=$r.prototype).ra=8,bt.H=1,bt.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const i=new bn(this,this.l,t);let s=this.s;if(this.U&&(s?(s=de(s),pe(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=zr(this,i,e),qn(n=$n(this.I),"RID",t),qn(n,"CVER",22),this.F&&qn(n,"X-HTTP-Session-Id",this.F),Hr(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(Ur(s)))+"&"+e:this.o&&Mr(n,this.o,s)),dr(this.i,i),this.bb&&qn(n,"TYPE","init"),this.P?(qn(n,"$req",e),qn(n,"SID","null"),i.aa=!0,On(i,n,null)):On(i,n,e),this.H=2}}else 3==this.H&&(t?Kr(this,t):0==this.j.length||ur(this.i)||Kr(this))},bt.Ma=function(){if(this.u=null,Xr(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=ln(xt(this.jb,this),t)}},bt.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,cn(10),Vr(this),Xr(this))},bt.ib=function(){null!=this.v&&(this.v=null,Vr(this),Yr(this),cn(19))},bt.pb=function(t){t?(this.l.info("Successfully pinged google.com"),cn(2)):(this.l.info("Failed to ping google.com"),cn(1))},bt.isActive=function(){return!!this.h&&this.h.isActive(this)},(bt=si.prototype).Ba=function(){},bt.Aa=function(){},bt.za=function(){},bt.ya=function(){},bt.isActive=function(){return!0},bt.Va=function(){},oi.prototype.g=function(t,e){return new ai(t,e)},Pt(ai,Re),ai.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;cn(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=ri(t,null,t.Y),qr(t)},ai.prototype.close=function(){Br(this.g)},ai.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=De(t),t=n);e.j.push(new or(e.fb++,t)),3==e.H&&qr(e)},ai.prototype.N=function(){this.g.h=null,delete this.j,Br(this.g),delete this.g,ai.$.N.call(this)},Pt(ci,vn),Pt(ui,_n),Pt(li,si),li.prototype.Ba=function(){Ne(this.g,"a")},li.prototype.Aa=function(t){Ne(this.g,new ci(t))},li.prototype.za=function(t){Ne(this.g,new ui)},li.prototype.ya=function(){Ne(this.g,"b")},Pt(hi,(function(){this.blockSize=-1})),hi.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},hi.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=n;)di(this,t,s),s+=this.blockSize;if("string"==typeof t){for(;s<e;)if(r[i++]=t.charCodeAt(s++),i==this.blockSize){di(this,r),i=0;break}}else for(;s<e;)if(r[i++]=t[s++],i==this.blockSize){di(this,r),i=0;break}}this.h=i,this.i+=e},hi.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var pi={};function gi(t){return-128<=t&&128>t?function(t,e){var n=pi;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=function(t){return new fi([0|t],0>t?-1:0)}(t)}(t):new fi([0|t],0>t?-1:0)}function mi(t){if(isNaN(t)||!isFinite(t))return vi;if(0>t)return Si(mi(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=yi;return new fi(e,0)}var yi=4294967296,vi=gi(0),_i=gi(1),wi=gi(16777216);function bi(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function Ei(t){return-1==t.h}function Si(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new fi(n,~t.h).add(_i)}function Ti(t,e){return t.add(Si(e))}function Ii(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function Oi(t,e){this.g=t,this.h=e}function ki(t,e){if(bi(e))throw Error("division by zero");if(bi(t))return new Oi(vi,vi);if(Ei(t))return e=ki(Si(t),e),new Oi(Si(e.g),Si(e.h));if(Ei(e))return e=ki(t,Si(e)),new Oi(Si(e.g),e.h);if(30<t.g.length){if(Ei(t)||Ei(e))throw Error("slowDivide_ only works with positive integers.");for(var n=_i,r=e;0>=r.X(t);)n=Ci(n),r=Ci(r);var i=Ai(n,1),s=Ai(r,1);for(r=Ai(r,2),n=Ai(n,2);!bi(r);){var o=s.add(r);0>=o.X(t)&&(i=i.add(n),s=o),r=Ai(r,1),n=Ai(n,1)}return e=Ti(t,i.R(e)),new Oi(i,e)}for(i=vi;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=mi(n)).R(e);Ei(o)||0<o.X(t);)o=(s=mi(n-=r)).R(e);bi(s)&&(s=_i),i=i.add(s),t=Ti(t,o)}return new Oi(i,t)}function Ci(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.D(r)<<1|t.D(r-1)>>>31;return new fi(n,t.h)}function Ai(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,i=[],s=0;s<r;s++)i[s]=0<e?t.D(s+n)>>>e|t.D(s+n+1)<<32-e:t.D(s+n);return new fi(i,t.h)}(bt=fi.prototype).ea=function(){if(Ei(this))return-Si(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.D(n);t+=(0<=r?r:yi+r)*e,e*=yi}return t},bt.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(bi(this))return"0";if(Ei(this))return"-"+Si(this).toString(t);for(var e=mi(Math.pow(t,6)),n=this,r="";;){var i=ki(n,e).g,s=((0<(n=Ti(n,i.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(bi(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},bt.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},bt.X=function(t){return Ei(t=Ti(this,t))?-1:bi(t)?0:1},bt.abs=function(){return Ei(this)?Si(this):this},bt.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&t.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(t.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new fi(n,-2147483648&n[n.length-1]?-1:0)},bt.R=function(t){if(bi(this)||bi(t))return vi;if(Ei(this))return Ei(t)?Si(this).R(Si(t)):Si(Si(this).R(t));if(Ei(t))return Si(this.R(Si(t)));if(0>this.X(wi)&&0>t.X(wi))return mi(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<t.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=t.D(i)>>>16,c=65535&t.D(i);n[2*r+2*i]+=o*c,Ii(n,2*r+2*i),n[2*r+2*i+1]+=s*c,Ii(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,Ii(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,Ii(n,2*r+2*i+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new fi(n,0)},bt.gb=function(t){return ki(this,t).h},bt.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)&t.D(r);return new fi(n,this.h&t.h)},bt.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)|t.D(r);return new fi(n,this.h|t.h)},bt.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)^t.D(r);return new fi(n,this.h^t.h)},oi.prototype.createWebChannel=oi.prototype.g,ai.prototype.send=ai.prototype.u,ai.prototype.open=ai.prototype.m,ai.prototype.close=ai.prototype.close,hn.NO_ERROR=0,hn.TIMEOUT=8,hn.HTTP_ERROR=6,dn.COMPLETE="complete",gn.EventType=yn,yn.OPEN="a",yn.CLOSE="b",yn.ERROR="c",yn.MESSAGE="d",Re.prototype.listen=Re.prototype.O,Or.prototype.listenOnce=Or.prototype.P,Or.prototype.getLastError=Or.prototype.Sa,Or.prototype.getLastErrorCode=Or.prototype.Ia,Or.prototype.getStatus=Or.prototype.da,Or.prototype.getResponseJson=Or.prototype.Wa,Or.prototype.getResponseText=Or.prototype.ja,Or.prototype.send=Or.prototype.ha,Or.prototype.setWithCredentials=Or.prototype.Oa,hi.prototype.digest=hi.prototype.l,hi.prototype.reset=hi.prototype.reset,hi.prototype.update=hi.prototype.j,fi.prototype.add=fi.prototype.add,fi.prototype.multiply=fi.prototype.R,fi.prototype.modulo=fi.prototype.gb,fi.prototype.compare=fi.prototype.X,fi.prototype.toNumber=fi.prototype.ea,fi.prototype.toString=fi.prototype.toString,fi.prototype.getBits=fi.prototype.D,fi.fromNumber=mi,fi.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return Si(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=mi(Math.pow(n,8)),i=vi,s=0;s<e.length;s+=8){var o=Math.min(8,e.length-s),a=parseInt(e.substring(s,s+o),n);8>o?(o=mi(Math.pow(n,o)),i=i.R(o).add(mi(a))):i=(i=i.R(r)).add(mi(a))}return i};var Ri=St.createWebChannelTransport=function(){return new oi},Ni=St.getStatEventTarget=function(){return rn()},xi=St.ErrorCode=hn,Di=St.EventType=dn,Pi=St.Event=en,Li=St.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},ji=St.FetchXmlHttpFactory=_r,Ui=St.WebChannel=gn,Mi=St.XhrIo=Or,Fi=St.Md5=hi,$i=St.Integer=fi;const Bi="@firebase/firestore";class Vi{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Vi.UNAUTHENTICATED=new Vi(null),Vi.GOOGLE_CREDENTIALS=new Vi("google-credentials-uid"),Vi.FIRST_PARTY=new Vi("first-party-uid"),Vi.MOCK_USER=new Vi("mock-user");let Gi="9.23.0";const qi=new A("@firebase/firestore");function Ki(){return qi.logLevel}function Hi(t,...e){if(qi.logLevel<=S.DEBUG){const n=e.map(Yi);qi.debug(`Firestore (${Gi}): ${t}`,...n)}}function zi(t,...e){if(qi.logLevel<=S.ERROR){const n=e.map(Yi);qi.error(`Firestore (${Gi}): ${t}`,...n)}}function Wi(t,...e){if(qi.logLevel<=S.WARN){const n=e.map(Yi);qi.warn(`Firestore (${Gi}): ${t}`,...n)}}function Yi(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Ji(t="Unexpected state"){const e=`FIRESTORE (${Gi}) INTERNAL ASSERTION FAILED: `+t;throw zi(e),new Error(e)}function Xi(t,e){t||Ji()}function Qi(t,e){return t}const Zi={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ts extends d{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class es{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class ns{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class rs{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Vi.UNAUTHENTICATED)))}shutdown(){}}class is{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class ss{constructor(t){this.t=t,this.currentUser=Vi.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new es;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new es,t.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{Hi("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Hi("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new es)}}),0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Hi("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Xi("string"==typeof e.accessToken),new ns(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Xi(null===t||"string"==typeof t),new Vi(t)}}class os{constructor(t,e,n){this.h=t,this.l=e,this.m=n,this.type="FirstParty",this.user=Vi.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const t=this.p();return t&&this.g.set("Authorization",t),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class as{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new os(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable((()=>e(Vi.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class cs{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class us{constructor(t){this.I=t,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(t,e){const n=t=>{null!=t.error&&Hi("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.T;return this.T=t.token,Hi("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{Hi("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.I.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.I.getImmediate({optional:!0});t?r(t):Hi("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Xi("string"==typeof t.token),this.T=t.token,new cs(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function ls(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class hs{static A(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=ls(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function ds(t,e){return t<e?-1:t>e?1:0}function fs(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}class ps{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new ts(Zi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new ts(Zi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new ts(Zi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new ts(Zi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return ps.fromMillis(Date.now())}static fromDate(t){return ps.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new ps(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?ds(this.nanoseconds,t.nanoseconds):ds(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class gs{constructor(t){this.timestamp=t}static fromTimestamp(t){return new gs(t)}static min(){return new gs(new ps(0,0))}static max(){return new gs(new ps(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ms{constructor(t,e,n){void 0===e?e=0:e>t.length&&Ji(),void 0===n?n=t.length-e:n>t.length-e&&Ji(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===ms.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof ms?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),i=e.get(r);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class ys extends ms{construct(t,e,n){return new ys(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new ts(Zi.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new ys(e)}static emptyPath(){return new ys([])}}const vs=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class _s extends ms{construct(t,e,n){return new _s(t,e,n)}static isValidIdentifier(t){return vs.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),_s.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new _s(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const i=()=>{if(0===n.length)throw new ts(Zi.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new ts(Zi.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new ts(Zi.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(s=!s,r++):"."!==e||s?(n+=e,r++):(i(),r++)}if(i(),s)throw new ts(Zi.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new _s(e)}static emptyPath(){return new _s([])}}class ws{constructor(t){this.path=t}static fromPath(t){return new ws(ys.fromString(t))}static fromName(t){return new ws(ys.fromString(t).popFirst(5))}static empty(){return new ws(ys.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===ys.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return ys.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new ws(new ys(t.slice()))}}function bs(t){return new Es(t.readTime,t.key,-1)}class Es{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Es(gs.min(),ws.empty(),-1)}static max(){return new Es(gs.max(),ws.empty(),-1)}}function Ss(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=ws.comparator(t.documentKey,e.documentKey),0!==n?n:ds(t.largestBatchId,e.largestBatchId))}const Ts="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Is{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Os(t){if(t.code!==Zi.FAILED_PRECONDITION||t.message!==Ts)throw t;Hi("LocalStore","Unexpectedly lost primary lease")}class ks{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Ji(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new ks(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof ks?e:ks.resolve(e)}catch(t){return ks.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):ks.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):ks.reject(e)}static resolve(t){return new ks(((e,n)=>{e(t)}))}static reject(t){return new ks(((e,n)=>{n(t)}))}static waitFor(t){return new ks(((e,n)=>{let r=0,i=0,s=!1;t.forEach((t=>{++r,t.next((()=>{++i,s&&i===r&&e()}),(t=>n(t)))})),s=!0,i===r&&e()}))}static or(t){let e=ks.resolve(!1);for(const n of t)e=e.next((t=>t?ks.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new ks(((n,r)=>{const i=t.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;e(t[c]).next((t=>{s[c]=t,++o,o===i&&n(s)}),(t=>r(t)))}}))}static doWhile(t,e){return new ks(((n,r)=>{const i=()=>{!0===t()?e().next((()=>{i()}),r):n()};i()}))}}function Cs(t){return"IndexedDbTransactionError"===t.name}class As{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ot(t),this.ut=t=>e.writeSequenceNumber(t))}ot(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ut&&this.ut(t),t}}function Rs(t){return null==t}function Ns(t){return 0===t&&1/t==-1/0}As.ct=-1;function xs(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ds(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}class Ps{constructor(t,e){this.comparator=t,this.root=e||js.EMPTY}insert(t,e){return new Ps(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,js.BLACK,null,null))}remove(t){return new Ps(this.comparator,this.root.remove(t,this.comparator).copy(null,null,js.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ls(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ls(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ls(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ls(this.root,t,this.comparator,!0)}}class Ls{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class js{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:js.RED,this.left=null!=r?r:js.EMPTY,this.right=null!=i?i:js.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,i){return new js(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const i=n(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return js.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return js.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,js.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,js.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ji();if(this.right.isRed())throw Ji();const t=this.left.check();if(t!==this.right.check())throw Ji();return t+(this.isRed()?0:1)}}js.EMPTY=null,js.RED=!0,js.BLACK=!1,js.EMPTY=new class{constructor(){this.size=0}get key(){throw Ji()}get value(){throw Ji()}get color(){throw Ji()}get left(){throw Ji()}get right(){throw Ji()}copy(t,e,n,r,i){return this}insert(t,e,n){return new js(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Us{constructor(t){this.comparator=t,this.data=new Ps(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Ms(this.data.getIterator())}getIteratorFrom(t){return new Ms(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Us))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Us(this.comparator);return e.data=t,e}}class Ms{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Fs{constructor(t){this.fields=t,t.sort(_s.comparator)}static empty(){return new Fs([])}unionWith(t){let e=new Us(_s.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new Fs(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return fs(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class $s extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Bs{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new $s("Invalid base64 string: "+t):t}}(t);return new Bs(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Bs(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return ds(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Bs.EMPTY_BYTE_STRING=new Bs("");const Vs=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Gs(t){if(Xi(!!t),"string"==typeof t){let e=0;const n=Vs.exec(t);if(Xi(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:qs(t.seconds),nanos:qs(t.nanos)}}function qs(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Ks(t){return"string"==typeof t?Bs.fromBase64String(t):Bs.fromUint8Array(t)}function Hs(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function zs(t){const e=t.mapValue.fields.__previous_value__;return Hs(e)?zs(e):e}function Ws(t){const e=Gs(t.mapValue.fields.__local_write_time__.timestampValue);return new ps(e.seconds,e.nanos)}class Ys{constructor(t,e,n,r,i,s,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class Js{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Js("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Js&&t.projectId===this.projectId&&t.database===this.database}}const Xs={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Qs(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Hs(t)?4:ho(t)?9007199254740991:10:Ji()}function Zs(t,e){if(t===e)return!0;const n=Qs(t);if(n!==Qs(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Ws(t).isEqual(Ws(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Gs(t.timestampValue),r=Gs(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Ks(t.bytesValue).isEqual(Ks(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return qs(t.geoPointValue.latitude)===qs(e.geoPointValue.latitude)&&qs(t.geoPointValue.longitude)===qs(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return qs(t.integerValue)===qs(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=qs(t.doubleValue),r=qs(e.doubleValue);return n===r?Ns(n)===Ns(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return fs(t.arrayValue.values||[],e.arrayValue.values||[],Zs);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(xs(n)!==xs(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!Zs(n[t],r[t])))return!1;return!0}(t,e);default:return Ji()}}function to(t,e){return void 0!==(t.values||[]).find((t=>Zs(t,e)))}function eo(t,e){if(t===e)return 0;const n=Qs(t),r=Qs(e);if(n!==r)return ds(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ds(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=qs(t.integerValue||t.doubleValue),r=qs(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return no(t.timestampValue,e.timestampValue);case 4:return no(Ws(t),Ws(e));case 5:return ds(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Ks(t),r=Ks(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=ds(n[t],r[t]);if(0!==e)return e}return ds(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=ds(qs(t.latitude),qs(e.latitude));return 0!==n?n:ds(qs(t.longitude),qs(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=eo(n[t],r[t]);if(e)return e}return ds(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===Xs.mapValue&&e===Xs.mapValue)return 0;if(t===Xs.mapValue)return 1;if(e===Xs.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let t=0;t<r.length&&t<s.length;++t){const e=ds(r[t],s[t]);if(0!==e)return e;const o=eo(n[r[t]],i[s[t]]);if(0!==o)return o}return ds(r.length,s.length)}(t.mapValue,e.mapValue);default:throw Ji()}}function no(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ds(t,e);const n=Gs(t),r=Gs(e),i=ds(n.seconds,r.seconds);return 0!==i?i:ds(n.nanos,r.nanos)}function ro(t){return io(t)}function io(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Gs(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Ks(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,ws.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=io(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const i of e)r?r=!1:n+=",",n+=`${i}:${io(t.fields[i])}`;return n+"}"}(t.mapValue):Ji();var e,n}function so(t){return!!t&&"integerValue"in t}function oo(t){return!!t&&"arrayValue"in t}function ao(t){return!!t&&"nullValue"in t}function co(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function uo(t){return!!t&&"mapValue"in t}function lo(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Ds(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=lo(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=lo(t.arrayValue.values[n]);return e}return Object.assign({},t)}function ho(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class fo{constructor(t){this.value=t}static empty(){return new fo({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!uo(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=lo(e)}setAll(t){let e=_s.emptyPath(),n={},r=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=i.popLast()}t?n[i.lastSegment()]=lo(t):r.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,r)}delete(t){const e=this.field(t.popLast());uo(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Zs(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];uo(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){Ds(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new fo(lo(this.value))}}class po{constructor(t,e,n,r,i,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(t){return new po(t,0,gs.min(),gs.min(),gs.min(),fo.empty(),0)}static newFoundDocument(t,e,n,r){return new po(t,1,e,gs.min(),n,r,0)}static newNoDocument(t,e){return new po(t,2,e,gs.min(),gs.min(),fo.empty(),0)}static newUnknownDocument(t,e){return new po(t,3,e,gs.min(),gs.min(),fo.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(gs.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=fo.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=fo.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=gs.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof po&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new po(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class go{constructor(t,e){this.position=t,this.inclusive=e}}function mo(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(r=s.field.isKeyField()?ws.comparator(ws.fromName(o.referenceValue),n.key):eo(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function yo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Zs(t.position[n],e.position[n]))return!1;return!0}class vo{constructor(t,e="asc"){this.field=t,this.dir=e}}function _o(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class wo{}class bo extends wo{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Co(t,e,n):"array-contains"===e?new xo(t,n):"in"===e?new Do(t,n):"not-in"===e?new Po(t,n):"array-contains-any"===e?new Lo(t,n):new bo(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Ao(t,n):new Ro(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(eo(e,this.value)):null!==e&&Qs(this.value)===Qs(e)&&this.matchesComparison(eo(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Ji()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class Eo extends wo{constructor(t,e){super(),this.filters=t,this.op=e,this.lt=null}static create(t,e){return new Eo(t,e)}matches(t){return So(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const t=this.ft((t=>t.isInequality()));return null!==t?t.field:null}ft(t){for(const e of this.getFlattenedFilters())if(t(e))return e;return null}}function So(t){return"and"===t.op}function To(t){return function(t){for(const e of t.filters)if(e instanceof Eo)return!1;return!0}(t)&&So(t)}function Io(t){if(t instanceof bo)return t.field.canonicalString()+t.op.toString()+ro(t.value);if(To(t))return t.filters.map((t=>Io(t))).join(",");{const e=t.filters.map((t=>Io(t))).join(",");return`${t.op}(${e})`}}function Oo(t,e){return t instanceof bo?function(t,e){return e instanceof bo&&t.op===e.op&&t.field.isEqual(e.field)&&Zs(t.value,e.value)}(t,e):t instanceof Eo?function(t,e){return e instanceof Eo&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&Oo(n,e.filters[r])),!0)}(t,e):void Ji()}function ko(t){return t instanceof bo?function(t){return`${t.field.canonicalString()} ${t.op} ${ro(t.value)}`}(t):t instanceof Eo?function(t){return t.op.toString()+" {"+t.getFilters().map(ko).join(" ,")+"}"}(t):"Filter"}class Co extends bo{constructor(t,e,n){super(t,e,n),this.key=ws.fromName(n.referenceValue)}matches(t){const e=ws.comparator(t.key,this.key);return this.matchesComparison(e)}}class Ao extends bo{constructor(t,e){super(t,"in",e),this.keys=No(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Ro extends bo{constructor(t,e){super(t,"not-in",e),this.keys=No(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function No(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>ws.fromName(t.referenceValue)))}class xo extends bo{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return oo(e)&&to(e.arrayValue,this.value)}}class Do extends bo{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&to(this.value.arrayValue,e)}}class Po extends bo{constructor(t,e){super(t,"not-in",e)}matches(t){if(to(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!to(this.value.arrayValue,e)}}class Lo extends bo{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!oo(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>to(this.value.arrayValue,t)))}}class jo{constructor(t,e=null,n=[],r=[],i=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.dt=null}}function Uo(t,e=null,n=[],r=[],i=null,s=null,o=null){return new jo(t,e,n,r,i,s,o)}function Mo(t){const e=Qi(t);if(null===e.dt){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>Io(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Rs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>ro(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>ro(t))).join(",")),e.dt=t}return e.dt}function Fo(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!_o(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Oo(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!yo(t.startAt,e.startAt)&&yo(t.endAt,e.endAt)}function $o(t){return ws.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Bo{constructor(t,e=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.wt=null,this._t=null,this.startAt,this.endAt}}function Vo(t){return new Bo(t)}function Go(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function qo(t){const e=Qi(t);if(null===e.wt){e.wt=[];const t=function(t){for(const e of t.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}(e),n=function(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}(e);if(null!==t&&null===n)t.isKeyField()||e.wt.push(new vo(t)),e.wt.push(new vo(_s.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.wt.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new vo(_s.keyField(),t))}}}return e.wt}function Ko(t){const e=Qi(t);if(!e._t)if("F"===e.limitType)e._t=Uo(e.path,e.collectionGroup,qo(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of qo(e)){const e="desc"===n.dir?"asc":"desc";t.push(new vo(n.field,e))}const n=e.endAt?new go(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new go(e.startAt.position,e.startAt.inclusive):null;e._t=Uo(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}return e._t}function Ho(t,e,n){return new Bo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function zo(t,e){return Fo(Ko(t),Ko(e))&&t.limitType===e.limitType}function Wo(t){return`${Mo(Ko(t))}|lt:${t.limitType}`}function Yo(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>ko(t))).join(", ")}]`),Rs(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>ro(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>ro(t))).join(",")),`Target(${e})`}(Ko(t))}; limitType=${t.limitType})`}function Jo(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):ws.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of qo(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=mo(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,qo(t),e)||t.endAt&&!function(t,e,n){const r=mo(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,qo(t),e))}(t,e)}function Xo(t){return(e,n)=>{let r=!1;for(const i of qo(t)){const t=Qo(i,e,n);if(0!==t)return t;r=r||i.field.isKeyField()}return 0}}function Qo(t,e,n){const r=t.field.isKeyField()?ws.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?eo(r,i):Ji()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ji()}}class Zo{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){Ds(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(this.inner)}size(){return this.innerSize}}const ta=new Ps(ws.comparator);function ea(){return ta}const na=new Ps(ws.comparator);function ra(...t){let e=na;for(const n of t)e=e.insert(n.key,n);return e}function ia(t){let e=na;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function sa(){return aa()}function oa(){return aa()}function aa(){return new Zo((t=>t.toString()),((t,e)=>t.isEqual(e)))}new Ps(ws.comparator);const ca=new Us(ws.comparator);function ua(...t){let e=ca;for(const n of t)e=e.add(n);return e}const la=new Us(ds);class ha{constructor(){this._=void 0}}function da(t,e,n){return t instanceof pa?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Hs(e)&&(e=zs(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof ga?ma(t,e):t instanceof ya?va(t,e):function(t,e){const n=function(t,e){return t instanceof _a?so(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}(t,e),r=wa(n)+wa(t.gt);return so(n)&&so(t.gt)?function(t){return{integerValue:""+t}}(r):function(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ns(e)?"-0":e}}(t.serializer,r)}(t,e)}function fa(t,e,n){return t instanceof ga?ma(t,e):t instanceof ya?va(t,e):n}class pa extends ha{}class ga extends ha{constructor(t){super(),this.elements=t}}function ma(t,e){const n=ba(e);for(const e of t.elements)n.some((t=>Zs(t,e)))||n.push(e);return{arrayValue:{values:n}}}class ya extends ha{constructor(t){super(),this.elements=t}}function va(t,e){let n=ba(e);for(const e of t.elements)n=n.filter((t=>!Zs(t,e)));return{arrayValue:{values:n}}}class _a extends ha{constructor(t,e){super(),this.serializer=t,this.gt=e}}function wa(t){return qs(t.integerValue||t.doubleValue)}function ba(t){return oo(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Ea{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Ea}static exists(t){return new Ea(void 0,t)}static updateTime(t){return new Ea(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Sa(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Ta{}function Ia(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Pa(t.key,Ea.none()):new Aa(t.key,t.data,Ea.none());{const n=t.data,r=fo.empty();let i=new Us(_s.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),i=i.add(t)}return new Ra(t.key,r,new Fs(i.toArray()),Ea.none())}}function Oa(t,e,n){t instanceof Aa?function(t,e,n){const r=t.value.clone(),i=xa(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Ra?function(t,e,n){if(!Sa(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=xa(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Na(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function ka(t,e,n,r){return t instanceof Aa?function(t,e,n,r){if(!Sa(t.precondition,e))return n;const i=t.value.clone(),s=Da(t.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,r):t instanceof Ra?function(t,e,n,r){if(!Sa(t.precondition,e))return n;const i=Da(t.fieldTransforms,r,e),s=e.data;return s.setAll(Na(t)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return Sa(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Ca(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&fs(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof ga&&e instanceof ga||t instanceof ya&&e instanceof ya?fs(t.elements,e.elements,Zs):t instanceof _a&&e instanceof _a?Zs(t.gt,e.gt):t instanceof pa&&e instanceof pa}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Aa extends Ta{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Ra extends Ta{constructor(t,e,n,r,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Na(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function xa(t,e,n){const r=new Map;Xi(t.length===n.length);for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,fa(o,a,n[i]))}return r}function Da(t,e,n){const r=new Map;for(const i of t){const t=i.transform,s=n.data.field(i.field);r.set(i.field,da(t,s,e))}return r}class Pa extends Ta{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class La{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&Oa(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=ka(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=ka(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=oa();return this.mutations.forEach((r=>{const i=t.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=e.has(r.key)?null:o;const a=Ia(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(gs.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),ua())}isEqual(t){return this.batchId===t.batchId&&fs(this.mutations,t.mutations,((t,e)=>Ca(t,e)))&&fs(this.baseMutations,t.baseMutations,((t,e)=>Ca(t,e)))}}class ja{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ua{constructor(t,e){this.count=t,this.unchangedNames=e}}var Ma,Fa;function $a(t){if(void 0===t)return zi("GRPC error has no .code"),Zi.UNKNOWN;switch(t){case Ma.OK:return Zi.OK;case Ma.CANCELLED:return Zi.CANCELLED;case Ma.UNKNOWN:return Zi.UNKNOWN;case Ma.DEADLINE_EXCEEDED:return Zi.DEADLINE_EXCEEDED;case Ma.RESOURCE_EXHAUSTED:return Zi.RESOURCE_EXHAUSTED;case Ma.INTERNAL:return Zi.INTERNAL;case Ma.UNAVAILABLE:return Zi.UNAVAILABLE;case Ma.UNAUTHENTICATED:return Zi.UNAUTHENTICATED;case Ma.INVALID_ARGUMENT:return Zi.INVALID_ARGUMENT;case Ma.NOT_FOUND:return Zi.NOT_FOUND;case Ma.ALREADY_EXISTS:return Zi.ALREADY_EXISTS;case Ma.PERMISSION_DENIED:return Zi.PERMISSION_DENIED;case Ma.FAILED_PRECONDITION:return Zi.FAILED_PRECONDITION;case Ma.ABORTED:return Zi.ABORTED;case Ma.OUT_OF_RANGE:return Zi.OUT_OF_RANGE;case Ma.UNIMPLEMENTED:return Zi.UNIMPLEMENTED;case Ma.DATA_LOSS:return Zi.DATA_LOSS;default:return Ji()}}(Fa=Ma||(Ma={}))[Fa.OK=0]="OK",Fa[Fa.CANCELLED=1]="CANCELLED",Fa[Fa.UNKNOWN=2]="UNKNOWN",Fa[Fa.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Fa[Fa.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Fa[Fa.NOT_FOUND=5]="NOT_FOUND",Fa[Fa.ALREADY_EXISTS=6]="ALREADY_EXISTS",Fa[Fa.PERMISSION_DENIED=7]="PERMISSION_DENIED",Fa[Fa.UNAUTHENTICATED=16]="UNAUTHENTICATED",Fa[Fa.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Fa[Fa.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Fa[Fa.ABORTED=10]="ABORTED",Fa[Fa.OUT_OF_RANGE=11]="OUT_OF_RANGE",Fa[Fa.UNIMPLEMENTED=12]="UNIMPLEMENTED",Fa[Fa.INTERNAL=13]="INTERNAL",Fa[Fa.UNAVAILABLE=14]="UNAVAILABLE",Fa[Fa.DATA_LOSS=15]="DATA_LOSS";class Ba{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return Va}static getOrCreateInstance(){return null===Va&&(Va=new Ba),Va}onExistenceFilterMismatch(t){const e=Symbol();return this.onExistenceFilterMismatchCallbacks.set(e,t),()=>this.onExistenceFilterMismatchCallbacks.delete(e)}notifyOnExistenceFilterMismatch(t){this.onExistenceFilterMismatchCallbacks.forEach((e=>e(t)))}}let Va=null;const Ga=new $i([4294967295,4294967295],0);function qa(t){const e=(new TextEncoder).encode(t),n=new Fi;return n.update(e),new Uint8Array(n.digest())}function Ka(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new $i([n,r],0),new $i([i,s],0)]}class Ha{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new za(`Invalid padding: ${e}`);if(n<0)throw new za(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new za(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new za(`Invalid padding when bitmap length is 0: ${e}`);this.It=8*t.length-e,this.Tt=$i.fromNumber(this.It)}Et(t,e,n){let r=t.add(e.multiply($i.fromNumber(n)));return 1===r.compare(Ga)&&(r=new $i([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Tt).toNumber()}At(t){return 0!=(this.bitmap[Math.floor(t/8)]&1<<t%8)}vt(t){if(0===this.It)return!1;const e=qa(t),[n,r]=Ka(e);for(let t=0;t<this.hashCount;t++){const e=this.Et(n,r,t);if(!this.At(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),s=new Ha(i,r,e);return n.forEach((t=>s.insert(t))),s}insert(t){if(0===this.It)return;const e=qa(t),[n,r]=Ka(e);for(let t=0;t<this.hashCount;t++){const e=this.Et(n,r,t);this.Rt(e)}}Rt(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class za extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Wa{constructor(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,Ya.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Wa(gs.min(),r,new Ps(ds),ea(),ua())}}class Ya{constructor(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Ya(n,e,ua(),ua(),ua())}}class Ja{constructor(t,e,n,r){this.Pt=t,this.removedTargetIds=e,this.key=n,this.bt=r}}class Xa{constructor(t,e){this.targetId=t,this.Vt=e}}class Qa{constructor(t,e,n=Bs.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class Za{constructor(){this.St=0,this.Dt=nc(),this.Ct=Bs.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(t){t.approximateByteSize()>0&&(this.Nt=!0,this.Ct=t)}Ot(){let t=ua(),e=ua(),n=ua();return this.Dt.forEach(((r,i)=>{switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Ji()}})),new Ya(this.Ct,this.xt,t,e,n)}Ft(){this.Nt=!1,this.Dt=nc()}Bt(t,e){this.Nt=!0,this.Dt=this.Dt.insert(t,e)}Lt(t){this.Nt=!0,this.Dt=this.Dt.remove(t)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class tc{constructor(t){this.Gt=t,this.Qt=new Map,this.jt=ea(),this.zt=ec(),this.Wt=new Ps(ds)}Ht(t){for(const e of t.Pt)t.bt&&t.bt.isFoundDocument()?this.Jt(e,t.bt):this.Yt(e,t.key,t.bt);for(const e of t.removedTargetIds)this.Yt(e,t.key,t.bt)}Xt(t){this.forEachTarget(t,(e=>{const n=this.Zt(e);switch(t.state){case 0:this.te(e)&&n.$t(t.resumeToken);break;case 1:n.Ut(),n.kt||n.Ft(),n.$t(t.resumeToken);break;case 2:n.Ut(),n.kt||this.removeTarget(e);break;case 3:this.te(e)&&(n.Kt(),n.$t(t.resumeToken));break;case 4:this.te(e)&&(this.ee(e),n.$t(t.resumeToken));break;default:Ji()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Qt.forEach(((t,n)=>{this.te(n)&&e(n)}))}ne(t){var e;const n=t.targetId,r=t.Vt.count,i=this.se(n);if(i){const s=i.target;if($o(s))if(0===r){const t=new ws(s.path);this.Yt(n,t,po.newNoDocument(t,gs.min()))}else Xi(1===r);else{const i=this.ie(n);if(i!==r){const r=this.re(t,i);if(0!==r){this.ee(n);const t=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(n,t)}null===(e=Ba.instance)||void 0===e||e.notifyOnExistenceFilterMismatch(function(t,e,n){var r,i,s,o,a,c;const u={localCacheCount:e,existenceFilterCount:n.count},l=n.unchangedNames;return l&&(u.bloomFilter={applied:0===t,hashCount:null!==(r=null==l?void 0:l.hashCount)&&void 0!==r?r:0,bitmapLength:null!==(o=null===(s=null===(i=null==l?void 0:l.bits)||void 0===i?void 0:i.bitmap)||void 0===s?void 0:s.length)&&void 0!==o?o:0,padding:null!==(c=null===(a=null==l?void 0:l.bits)||void 0===a?void 0:a.padding)&&void 0!==c?c:0}),u}(r,i,t.Vt))}}}}re(t,e){const{unchangedNames:n,count:r}=t.Vt;if(!n||!n.bits)return 1;const{bits:{bitmap:i="",padding:s=0},hashCount:o=0}=n;let a,c;try{a=Ks(i).toUint8Array()}catch(t){if(t instanceof $s)return Wi("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw t}try{c=new Ha(a,s,o)}catch(t){return Wi(t instanceof za?"BloomFilter error: ":"Applying bloom filter failed: ",t),1}return 0===c.It?1:r!==e-this.oe(t.targetId,c)?2:0}oe(t,e){const n=this.Gt.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const i=this.Gt.ue(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.vt(s)||(this.Yt(t,n,null),r++)})),r}ce(t){const e=new Map;this.Qt.forEach(((n,r)=>{const i=this.se(r);if(i){if(n.current&&$o(i.target)){const e=new ws(i.target.path);null!==this.jt.get(e)||this.ae(r,e)||this.Yt(r,e,po.newNoDocument(e,t))}n.Mt&&(e.set(r,n.Ot()),n.Ft())}}));let n=ua();this.zt.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.se(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.jt.forEach(((e,n)=>n.setReadTime(t)));const r=new Wa(t,e,this.Wt,this.jt,n);return this.jt=ea(),this.zt=ec(),this.Wt=new Ps(ds),r}Jt(t,e){if(!this.te(t))return;const n=this.ae(t,e.key)?2:0;this.Zt(t).Bt(e.key,n),this.jt=this.jt.insert(e.key,e),this.zt=this.zt.insert(e.key,this.he(e.key).add(t))}Yt(t,e,n){if(!this.te(t))return;const r=this.Zt(t);this.ae(t,e)?r.Bt(e,1):r.Lt(e),this.zt=this.zt.insert(e,this.he(e).delete(t)),n&&(this.jt=this.jt.insert(e,n))}removeTarget(t){this.Qt.delete(t)}ie(t){const e=this.Zt(t).Ot();return this.Gt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}qt(t){this.Zt(t).qt()}Zt(t){let e=this.Qt.get(t);return e||(e=new Za,this.Qt.set(t,e)),e}he(t){let e=this.zt.get(t);return e||(e=new Us(ds),this.zt=this.zt.insert(t,e)),e}te(t){const e=null!==this.se(t);return e||Hi("WatchChangeAggregator","Detected inactive target",t),e}se(t){const e=this.Qt.get(t);return e&&e.kt?null:this.Gt.le(t)}ee(t){this.Qt.set(t,new Za),this.Gt.getRemoteKeysForTarget(t).forEach((e=>{this.Yt(t,e,null)}))}ae(t,e){return this.Gt.getRemoteKeysForTarget(t).has(e)}}function ec(){return new Ps(ws.comparator)}function nc(){return new Ps(ws.comparator)}const rc={asc:"ASCENDING",desc:"DESCENDING"},ic={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},sc={and:"AND",or:"OR"};class oc{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function ac(t,e){return t.useProto3Json||Rs(e)?e:{value:e}}function cc(t){return Xi(!!t),gs.fromTimestamp(function(t){const e=Gs(t);return new ps(e.seconds,e.nanos)}(t))}function uc(t){const e=ys.fromString(t);return Xi(Tc(e)),e}function lc(t,e){const n=uc(e);if(n.get(1)!==t.databaseId.projectId)throw new ts(Zi.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new ts(Zi.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ws(fc(n))}function hc(t,e){return function(t,e){return function(t){return new ys(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}(t.databaseId,e)}function dc(t){return new ys(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function fc(t){return Xi(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function pc(t,e){return{documents:[hc(t,e.path)]}}function gc(t,e){const n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=hc(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=hc(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(t){if(0!==t.length)return Sc(Eo.create(t,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const s=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:bc(t.field),direction:vc(t.dir)}}(t)))}(e.orderBy);s&&(n.structuredQuery.orderBy=s);const o=ac(t,e.limit);var a;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function mc(t){let e=function(t){const e=uc(t);return 4===e.length?ys.emptyPath():fc(e)}(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Xi(1===r);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function(t){const e=yc(t);return e instanceof Eo&&To(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new vo(Ec(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Rs(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new go(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new go(n,e)}(n.endAt)),function(t,e,n,r,i,s,o,a){return new Bo(t,e,n,r,i,s,o,a)}(e,i,o,s,a,"F",c,u)}function yc(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Ec(t.unaryFilter.field);return bo.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Ec(t.unaryFilter.field);return bo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Ec(t.unaryFilter.field);return bo.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Ec(t.unaryFilter.field);return bo.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Ji()}}(t):void 0!==t.fieldFilter?function(t){return bo.create(Ec(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ji()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return Eo.create(t.compositeFilter.filters.map((t=>yc(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Ji()}}(t.compositeFilter.op))}(t):Ji()}function vc(t){return rc[t]}function _c(t){return ic[t]}function wc(t){return sc[t]}function bc(t){return{fieldPath:t.canonicalString()}}function Ec(t){return _s.fromServerFormat(t.fieldPath)}function Sc(t){return t instanceof bo?function(t){if("=="===t.op){if(co(t.value))return{unaryFilter:{field:bc(t.field),op:"IS_NAN"}};if(ao(t.value))return{unaryFilter:{field:bc(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(co(t.value))return{unaryFilter:{field:bc(t.field),op:"IS_NOT_NAN"}};if(ao(t.value))return{unaryFilter:{field:bc(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:bc(t.field),op:_c(t.op),value:t.value}}}(t):t instanceof Eo?function(t){const e=t.getFilters().map((t=>Sc(t)));return 1===e.length?e[0]:{compositeFilter:{op:wc(t.op),filters:e}}}(t):Ji()}function Tc(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Ic{constructor(t,e,n,r,i=gs.min(),s=gs.min(),o=Bs.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Ic(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Ic(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Ic(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Ic(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Oc{constructor(t){this.fe=t}}function kc(t){const e=mc({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Ho(e,e.limit,"L"):e}class Cc{constructor(){}_e(t,e){this.me(t,e),e.ge()}me(t,e){if("nullValue"in t)this.ye(e,5);else if("booleanValue"in t)this.ye(e,10),e.pe(t.booleanValue?1:0);else if("integerValue"in t)this.ye(e,15),e.pe(qs(t.integerValue));else if("doubleValue"in t){const n=qs(t.doubleValue);isNaN(n)?this.ye(e,13):(this.ye(e,15),Ns(n)?e.pe(0):e.pe(n))}else if("timestampValue"in t){const n=t.timestampValue;this.ye(e,20),"string"==typeof n?e.Ie(n):(e.Ie(`${n.seconds||""}`),e.pe(n.nanos||0))}else if("stringValue"in t)this.Te(t.stringValue,e),this.Ee(e);else if("bytesValue"in t)this.ye(e,30),e.Ae(Ks(t.bytesValue)),this.Ee(e);else if("referenceValue"in t)this.ve(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.ye(e,45),e.pe(n.latitude||0),e.pe(n.longitude||0)}else"mapValue"in t?ho(t)?this.ye(e,Number.MAX_SAFE_INTEGER):(this.Re(t.mapValue,e),this.Ee(e)):"arrayValue"in t?(this.Pe(t.arrayValue,e),this.Ee(e)):Ji()}Te(t,e){this.ye(e,25),this.be(t,e)}be(t,e){e.Ie(t)}Re(t,e){const n=t.fields||{};this.ye(e,55);for(const t of Object.keys(n))this.Te(t,e),this.me(n[t],e)}Pe(t,e){const n=t.values||[];this.ye(e,50);for(const t of n)this.me(t,e)}ve(t,e){this.ye(e,37),ws.fromName(t).path.forEach((t=>{this.ye(e,60),this.be(t,e)}))}ye(t,e){t.pe(e)}Ee(t){t.pe(2)}}Cc.Ve=new Cc;class Ac{constructor(){this.rn=new Rc}addToCollectionParentIndex(t,e){return this.rn.add(e),ks.resolve()}getCollectionParents(t,e){return ks.resolve(this.rn.getEntries(e))}addFieldIndex(t,e){return ks.resolve()}deleteFieldIndex(t,e){return ks.resolve()}getDocumentsMatchingTarget(t,e){return ks.resolve(null)}getIndexType(t,e){return ks.resolve(0)}getFieldIndexes(t,e){return ks.resolve([])}getNextCollectionGroupToUpdate(t){return ks.resolve(null)}getMinOffset(t,e){return ks.resolve(Es.min())}getMinOffsetFromCollectionGroup(t,e){return ks.resolve(Es.min())}updateCollectionGroup(t,e,n){return ks.resolve()}updateIndexEntries(t,e){return ks.resolve()}}class Rc{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Us(ys.comparator),i=!r.has(n);return this.index[e]=r.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new Us(ys.comparator)).toArray()}}new Uint8Array(0);class Nc{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Nc(t,Nc.DEFAULT_COLLECTION_PERCENTILE,Nc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Nc.DEFAULT_COLLECTION_PERCENTILE=10,Nc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Nc.DEFAULT=new Nc(41943040,Nc.DEFAULT_COLLECTION_PERCENTILE,Nc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Nc.DISABLED=new Nc(-1,0,0);class xc{constructor(t){this.Nn=t}next(){return this.Nn+=2,this.Nn}static kn(){return new xc(0)}static Mn(){return new xc(-1)}}class Dc{constructor(){this.changes=new Zo((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,po.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?ks.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Pc{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Lc{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&ka(n.mutation,t,Fs.empty(),ps.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,ua()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=ua()){const r=sa();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=ra();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=sa();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,ua())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let i=ea();const s=aa(),o=aa();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof Ra)?i=i.insert(e.key,e):void 0!==o?(s.set(e.key,o.mutation.getFieldMask()),ka(o.mutation,e,o.mutation.getFieldMask(),ps.now())):s.set(e.key,Fs.empty())})),this.recalculateAndSaveOverlays(t,i).next((t=>(t.forEach(((t,e)=>s.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new Pc(e,null!==(n=s.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=aa();let r=new Ps(((t,e)=>t-e)),i=ua();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const i of t)i.keys().forEach((t=>{const s=e.get(t);if(null===s)return;let o=n.get(t)||Fs.empty();o=i.applyToLocalView(s,o),n.set(t,o);const a=(r.get(i.batchId)||ua()).add(t);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=oa();c.forEach((t=>{if(!i.has(t)){const r=Ia(e.get(t),n.get(t));null!==r&&u.set(t,r),i=i.add(t)}})),s.push(this.documentOverlayCache.saveOverlays(t,a,u))}return ks.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n){return function(t){return ws.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-i.size):ks.resolve(sa());let o=-1,a=i;return s.next((e=>ks.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?ks.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,i))).next((()=>this.computeViews(t,a,e,ua()))).next((t=>({batchId:o,changes:ia(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new ws(e)).next((t=>{let e=ra();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n){const r=e.collectionGroup;let i=ra();return this.indexManager.getCollectionParents(t,r).next((s=>ks.forEach(s,(s=>{const o=function(t,e){return new Bo(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(r));return this.getDocumentsMatchingCollectionQuery(t,o,n).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(t,e,n){let r;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,r)))).next((t=>{r.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,po.newInvalidDocument(r)))}));let n=ra();return t.forEach(((t,i)=>{const s=r.get(t);void 0!==s&&ka(s.mutation,i,Fs.empty(),ps.now()),Jo(e,i)&&(n=n.insert(t,i))})),n}))}}class jc{constructor(t){this.serializer=t,this.cs=new Map,this.hs=new Map}getBundleMetadata(t,e){return ks.resolve(this.cs.get(e))}saveBundleMetadata(t,e){var n;return this.cs.set(e.id,{id:(n=e).id,version:n.version,createTime:cc(n.createTime)}),ks.resolve()}getNamedQuery(t,e){return ks.resolve(this.hs.get(e))}saveNamedQuery(t,e){return this.hs.set(e.name,function(t){return{name:t.name,query:kc(t.bundledQuery),readTime:cc(t.readTime)}}(e)),ks.resolve()}}class Uc{constructor(){this.overlays=new Ps(ws.comparator),this.ls=new Map}getOverlay(t,e){return ks.resolve(this.overlays.get(e))}getOverlays(t,e){const n=sa();return ks.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.we(t,e,r)})),ks.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.ls.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.ls.delete(n)),ks.resolve()}getOverlaysForCollection(t,e,n){const r=sa(),i=e.length+1,s=new ws(e.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const t=o.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===i&&t.largestBatchId>n&&r.set(t.getKey(),t)}return ks.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new Ps(((t,e)=>t-e));const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=sa(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=sa(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return ks.resolve(o)}we(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.ls.get(r.largestBatchId).delete(n.key);this.ls.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new ja(e,n));let i=this.ls.get(e);void 0===i&&(i=ua(),this.ls.set(e,i)),this.ls.set(e,i.add(n.key))}}class Mc{constructor(){this.fs=new Us(Fc.ds),this.ws=new Us(Fc._s)}isEmpty(){return this.fs.isEmpty()}addReference(t,e){const n=new Fc(t,e);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}gs(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.ys(new Fc(t,e))}ps(t,e){t.forEach((t=>this.removeReference(t,e)))}Is(t){const e=new ws(new ys([])),n=new Fc(e,t),r=new Fc(e,t+1),i=[];return this.ws.forEachInRange([n,r],(t=>{this.ys(t),i.push(t.key)})),i}Ts(){this.fs.forEach((t=>this.ys(t)))}ys(t){this.fs=this.fs.delete(t),this.ws=this.ws.delete(t)}Es(t){const e=new ws(new ys([])),n=new Fc(e,t),r=new Fc(e,t+1);let i=ua();return this.ws.forEachInRange([n,r],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new Fc(t,0),n=this.fs.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Fc{constructor(t,e){this.key=t,this.As=e}static ds(t,e){return ws.comparator(t.key,e.key)||ds(t.As,e.As)}static _s(t,e){return ds(t.As,e.As)||ws.comparator(t.key,e.key)}}class $c{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.vs=1,this.Rs=new Us(Fc.ds)}checkEmpty(t){return ks.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const i=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new La(i,e,n,r);this.mutationQueue.push(s);for(const e of r)this.Rs=this.Rs.add(new Fc(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return ks.resolve(s)}lookupMutationBatch(t,e){return ks.resolve(this.Ps(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.bs(n),i=r<0?0:r;return ks.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ks.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(t){return ks.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Fc(e,0),r=new Fc(e,Number.POSITIVE_INFINITY),i=[];return this.Rs.forEachInRange([n,r],(t=>{const e=this.Ps(t.As);i.push(e)})),ks.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Us(ds);return e.forEach((t=>{const e=new Fc(t,0),r=new Fc(t,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([e,r],(t=>{n=n.add(t.As)}))})),ks.resolve(this.Vs(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let i=n;ws.isDocumentKey(i)||(i=i.child(""));const s=new Fc(new ws(i),0);let o=new Us(ds);return this.Rs.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.As)),!0)}),s),ks.resolve(this.Vs(o))}Vs(t){const e=[];return t.forEach((t=>{const n=this.Ps(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Xi(0===this.Ss(e.batchId,"removed")),this.mutationQueue.shift();let n=this.Rs;return ks.forEach(e.mutations,(r=>{const i=new Fc(r.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.Rs=n}))}Cn(t){}containsKey(t,e){const n=new Fc(e,0),r=this.Rs.firstAfterOrEqual(n);return ks.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,ks.resolve()}Ss(t,e){return this.bs(t)}bs(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Ps(t){const e=this.bs(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Bc{constructor(t){this.Ds=t,this.docs=new Ps(ws.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),i=r?r.size:0,s=this.Ds(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return ks.resolve(n?n.document.mutableCopy():po.newInvalidDocument(e))}getEntries(t,e){let n=ea();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():po.newInvalidDocument(t))})),ks.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let i=ea();const s=e.path,o=new ws(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!s.isPrefixOf(t.path))break;t.path.length>s.length+1||Ss(bs(o),n)<=0||(r.has(o.key)||Jo(e,o))&&(i=i.insert(o.key,o.mutableCopy()))}return ks.resolve(i)}getAllFromCollectionGroup(t,e,n,r){Ji()}Cs(t,e){return ks.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Vc(this)}getSize(t){return ks.resolve(this.size)}}class Vc extends Dc{constructor(t){super(),this.os=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.os.addEntry(t,r)):this.os.removeEntry(n)})),ks.waitFor(e)}getFromCache(t,e){return this.os.getEntry(t,e)}getAllFromCache(t,e){return this.os.getEntries(t,e)}}class Gc{constructor(t){this.persistence=t,this.xs=new Zo((t=>Mo(t)),Fo),this.lastRemoteSnapshotVersion=gs.min(),this.highestTargetId=0,this.Ns=0,this.ks=new Mc,this.targetCount=0,this.Ms=xc.kn()}forEachTarget(t,e){return this.xs.forEach(((t,n)=>e(n))),ks.resolve()}getLastRemoteSnapshotVersion(t){return ks.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return ks.resolve(this.Ns)}allocateTargetId(t){return this.highestTargetId=this.Ms.next(),ks.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Ns&&(this.Ns=e),ks.resolve()}Fn(t){this.xs.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Ms=new xc(e),this.highestTargetId=e),t.sequenceNumber>this.Ns&&(this.Ns=t.sequenceNumber)}addTargetData(t,e){return this.Fn(e),this.targetCount+=1,ks.resolve()}updateTargetData(t,e){return this.Fn(e),ks.resolve()}removeTargetData(t,e){return this.xs.delete(e.target),this.ks.Is(e.targetId),this.targetCount-=1,ks.resolve()}removeTargets(t,e,n){let r=0;const i=[];return this.xs.forEach(((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.xs.delete(s),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),ks.waitFor(i).next((()=>r))}getTargetCount(t){return ks.resolve(this.targetCount)}getTargetData(t,e){const n=this.xs.get(e)||null;return ks.resolve(n)}addMatchingKeys(t,e,n){return this.ks.gs(e,n),ks.resolve()}removeMatchingKeys(t,e,n){this.ks.ps(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((e=>{i.push(r.markPotentiallyOrphaned(t,e))})),ks.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.ks.Is(e),ks.resolve()}getMatchingKeysForTargetId(t,e){const n=this.ks.Es(e);return ks.resolve(n)}containsKey(t,e){return ks.resolve(this.ks.containsKey(e))}}class qc{constructor(t,e){this.$s={},this.overlays={},this.Os=new As(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=t(this),this.Bs=new Gc(this),this.indexManager=new Ac,this.remoteDocumentCache=function(t){return new Bc(t)}((t=>this.referenceDelegate.Ls(t))),this.serializer=new Oc(e),this.qs=new jc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Uc,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.$s[t.toKey()];return n||(n=new $c(e,this.referenceDelegate),this.$s[t.toKey()]=n),n}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(t,e,n){Hi("MemoryPersistence","Starting transaction:",t);const r=new Kc(this.Os.next());return this.referenceDelegate.Us(),n(r).next((t=>this.referenceDelegate.Ks(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Gs(t,e){return ks.or(Object.values(this.$s).map((n=>()=>n.containsKey(t,e))))}}class Kc extends Is{constructor(t){super(),this.currentSequenceNumber=t}}class Hc{constructor(t){this.persistence=t,this.Qs=new Mc,this.js=null}static zs(t){return new Hc(t)}get Ws(){if(this.js)return this.js;throw Ji()}addReference(t,e,n){return this.Qs.addReference(n,e),this.Ws.delete(n.toString()),ks.resolve()}removeReference(t,e,n){return this.Qs.removeReference(n,e),this.Ws.add(n.toString()),ks.resolve()}markPotentiallyOrphaned(t,e){return this.Ws.add(e.toString()),ks.resolve()}removeTarget(t,e){this.Qs.Is(e.targetId).forEach((t=>this.Ws.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Ws.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Us(){this.js=new Set}Ks(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ks.forEach(this.Ws,(n=>{const r=ws.fromPath(n);return this.Hs(t,r).next((t=>{t||e.removeEntry(r,gs.min())}))})).next((()=>(this.js=null,e.apply(t))))}updateLimboDocument(t,e){return this.Hs(t,e).next((t=>{t?this.Ws.delete(e.toString()):this.Ws.add(e.toString())}))}Ls(t){return 0}Hs(t,e){return ks.or([()=>ks.resolve(this.Qs.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gs(t,e)])}}class zc{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.Fi=n,this.Bi=r}static Li(t,e){let n=ua(),r=ua();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new zc(t,e.fromCache,n,r)}}class Wc{constructor(){this.qi=!1}initialize(t,e){this.Ui=t,this.indexManager=e,this.qi=!0}getDocumentsMatchingQuery(t,e,n,r){return this.Ki(t,e).next((i=>i||this.Gi(t,e,r,n))).next((n=>n||this.Qi(t,e)))}Ki(t,e){if(Go(e))return ks.resolve(null);let n=Ko(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=Ho(e,null,"F"),n=Ko(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const i=ua(...r);return this.Ui.getDocuments(t,i).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const s=this.ji(e,r);return this.zi(e,s,i,n.readTime)?this.Ki(t,Ho(e,null,"F")):this.Wi(t,s,e,n)}))))})))))}Gi(t,e,n,r){return Go(e)||r.isEqual(gs.min())?this.Qi(t,e):this.Ui.getDocuments(t,n).next((i=>{const s=this.ji(e,i);return this.zi(e,s,n,r)?this.Qi(t,e):(Ki()<=S.DEBUG&&Hi("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Yo(e)),this.Wi(t,s,e,function(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=gs.fromTimestamp(1e9===r?new ps(n+1,0):new ps(n,r));return new Es(i,ws.empty(),e)}(r,-1)))}))}ji(t,e){let n=new Us(Xo(t));return e.forEach(((e,r)=>{Jo(t,r)&&(n=n.add(r))})),n}zi(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Qi(t,e){return Ki()<=S.DEBUG&&Hi("QueryEngine","Using full collection scan to execute query:",Yo(e)),this.Ui.getDocumentsMatchingQuery(t,e,Es.min())}Wi(t,e,n,r){return this.Ui.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class Yc{constructor(t,e,n,r){this.persistence=t,this.Hi=e,this.serializer=r,this.Ji=new Ps(ds),this.Yi=new Zo((t=>Mo(t)),Fo),this.Xi=new Map,this.Zi=t.getRemoteDocumentCache(),this.Bs=t.getTargetCache(),this.qs=t.getBundleCache(),this.tr(n)}tr(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Lc(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ji)))}}async function Jc(t,e){const n=Qi(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((i=>(r=i,n.tr(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const i=[],s=[];let o=ua();for(const t of r){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({er:t,removedBatchIds:i,addedBatchIds:s})))}))}))}function Xc(t){const e=Qi(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Bs.getLastRemoteSnapshotVersion(t)))}async function Qc(t,e,n){const r=Qi(t),i=r.Ji.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(t=>r.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!Cs(t))throw t;Hi("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.Ji=r.Ji.remove(e),r.Yi.delete(i.target)}function Zc(t,e,n){const r=Qi(t);let i=gs.min(),s=ua();return r.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const r=Qi(t),i=r.Yi.get(n);return void 0!==i?ks.resolve(r.Ji.get(i)):r.Bs.getTargetData(e,n)}(r,t,Ko(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,r.Bs.getMatchingKeysForTargetId(t,e.targetId).next((t=>{s=t}))})).next((()=>r.Hi.getDocumentsMatchingQuery(t,e,n?i:gs.min(),n?s:ua()))).next((t=>(function(t,e,n){let r=t.Xi.get(e)||gs.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.Xi.set(e,r)}(r,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,ir:s})))))}class tu{constructor(){this.activeTargetIds=la}lr(t){this.activeTargetIds=this.activeTargetIds.add(t)}dr(t){this.activeTargetIds=this.activeTargetIds.delete(t)}hr(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class eu{constructor(){this.Hr=new tu,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Hr.lr(t),this.Jr[t]||"not-current"}updateQueryState(t,e,n){this.Jr[t]=e}removeLocalQueryTarget(t){this.Hr.dr(t)}isLocalQueryTarget(t){return this.Hr.activeTargetIds.has(t)}clearQueryState(t){delete this.Jr[t]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(t){return this.Hr.activeTargetIds.has(t)}start(){return this.Hr=new tu,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class nu{Yr(t){}shutdown(){}}class ru{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(t){this.so.push(t)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){Hi("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.so)t(0)}no(){Hi("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.so)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let iu=null;function su(){return null===iu?iu=268435456+Math.round(2147483648*Math.random()):iu++,"0x"+iu.toString(16)}const ou={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class au{constructor(t){this.ro=t.ro,this.oo=t.oo}uo(t){this.co=t}ao(t){this.ho=t}onMessage(t){this.lo=t}close(){this.oo()}send(t){this.ro(t)}fo(){this.co()}wo(t){this.ho(t)}_o(t){this.lo(t)}}const cu="WebChannelConnection";class uu extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.mo=e+"://"+t.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(t,e,n,r,i){const s=su(),o=this.To(t,e);Hi("RestConnection",`Sending RPC '${t}' ${s}:`,o,n);const a={};return this.Eo(a,r,i),this.Ao(t,o,a,n).then((e=>(Hi("RestConnection",`Received RPC '${t}' ${s}: `,e),e)),(e=>{throw Wi("RestConnection",`RPC '${t}' ${s} failed with error: `,e,"url: ",o,"request:",n),e}))}vo(t,e,n,r,i,s){return this.Io(t,e,n,r,i)}Eo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+Gi,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}To(t,e){const n=ou[t];return`${this.mo}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Ao(t,e,n,r){const i=su();return new Promise(((s,o)=>{const a=new Mi;a.setWithCredentials(!0),a.listenOnce(Di.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case xi.NO_ERROR:const e=a.getResponseJson();Hi(cu,`XHR for RPC '${t}' ${i} received:`,JSON.stringify(e)),s(e);break;case xi.TIMEOUT:Hi(cu,`RPC '${t}' ${i} timed out`),o(new ts(Zi.DEADLINE_EXCEEDED,"Request time out"));break;case xi.HTTP_ERROR:const n=a.getStatus();if(Hi(cu,`RPC '${t}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Zi).indexOf(e)>=0?e:Zi.UNKNOWN}(e.status);o(new ts(t,e.message))}else o(new ts(Zi.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new ts(Zi.UNAVAILABLE,"Connection failed."));break;default:Ji()}}finally{Hi(cu,`RPC '${t}' ${i} completed.`)}}));const c=JSON.stringify(r);Hi(cu,`RPC '${t}' ${i} sending request:`,r),a.send(e,"POST",c,n,15)}))}Ro(t,e,n){const r=su(),i=[this.mo,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=Ri(),o=Ni(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.xmlHttpFactory=new ji({})),this.Eo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=i.join("");Hi(cu,`Creating RPC '${t}' stream ${r}: ${u}`,a);const l=s.createWebChannel(u,a);let h=!1,d=!1;const f=new au({ro:e=>{d?Hi(cu,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(h||(Hi(cu,`Opening RPC '${t}' stream ${r} transport.`),l.open(),h=!0),Hi(cu,`RPC '${t}' stream ${r} sending:`,e),l.send(e))},oo:()=>l.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(l,Ui.EventType.OPEN,(()=>{d||Hi(cu,`RPC '${t}' stream ${r} transport opened.`)})),p(l,Ui.EventType.CLOSE,(()=>{d||(d=!0,Hi(cu,`RPC '${t}' stream ${r} transport closed`),f.wo())})),p(l,Ui.EventType.ERROR,(e=>{d||(d=!0,Wi(cu,`RPC '${t}' stream ${r} transport errored:`,e),f.wo(new ts(Zi.UNAVAILABLE,"The operation could not be completed")))})),p(l,Ui.EventType.MESSAGE,(e=>{var n;if(!d){const i=e.data[0];Xi(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){Hi(cu,`RPC '${t}' stream ${r} received error:`,o);const e=o.status;let n=function(t){const e=Ma[t];if(void 0!==e)return $a(e)}(e),i=o.message;void 0===n&&(n=Zi.INTERNAL,i="Unknown error status: "+e+" with message "+o.message),d=!0,f.wo(new ts(n,i)),l.close()}else Hi(cu,`RPC '${t}' stream ${r} received:`,i),f._o(i)}})),p(o,Pi.STAT_EVENT,(e=>{e.stat===Li.PROXY?Hi(cu,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===Li.NOPROXY&&Hi(cu,`RPC '${t}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.fo()}),0),f}}function lu(){return"undefined"!=typeof document?document:null}function hu(t){return new oc(t,!0)}class du{constructor(t,e,n=1e3,r=1.5,i=6e4){this.ii=t,this.timerId=e,this.Po=n,this.bo=r,this.Vo=i,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(t){this.cancel();const e=Math.floor(this.So+this.ko()),n=Math.max(0,Date.now()-this.Co),r=Math.max(0,e-n);r>0&&Hi("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.So} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,r,(()=>(this.Co=Date.now(),t()))),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class fu{constructor(t,e,n,r,i,s,o,a){this.ii=t,this.$o=n,this.Oo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new du(t,e)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,(()=>this.zo())))}Wo(t){this.Ho(),this.stream.send(t)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(t,e){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==t?this.qo.reset():e&&e.code===Zi.RESOURCE_EXHAUSTED?(zi(e.toString()),zi("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):e&&e.code===Zi.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.ao(e)}Yo(){}auth(){this.state=1;const t=this.Xo(this.Fo),e=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Fo===e&&this.Zo(t,n)}),(e=>{t((()=>{const t=new ts(Zi.UNKNOWN,"Fetching auth token failed: "+e.message);return this.tu(t)}))}))}Zo(t,e){const n=this.Xo(this.Fo);this.stream=this.eu(t,e),this.stream.uo((()=>{n((()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,(()=>(this.Ko()&&(this.state=3),Promise.resolve()))),this.listener.uo())))})),this.stream.ao((t=>{n((()=>this.tu(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Go(){this.state=5,this.qo.No((async()=>{this.state=0,this.start()}))}tu(t){return Hi("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Xo(t){return e=>{this.ii.enqueueAndForget((()=>this.Fo===t?e():(Hi("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class pu extends fu{constructor(t,e,n,r,i,s){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}eu(t,e){return this.connection.Ro("Listen",t,e)}onMessage(t){this.qo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Ji()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(t,e){return t.useProto3Json?(Xi(void 0===e||"string"==typeof e),Bs.fromBase64String(e||"")):(Xi(void 0===e||e instanceof Uint8Array),Bs.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Zi.UNKNOWN:$a(t.code);return new ts(e,t.message||"")}(o);n=new Qa(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=lc(t,r.document.name),s=cc(r.document.updateTime),o=r.document.createTime?cc(r.document.createTime):gs.min(),a=new fo({mapValue:{fields:r.document.fields}}),c=po.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new Ja(u,l,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=lc(t,r.document),s=r.readTime?cc(r.readTime):gs.min(),o=po.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Ja([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=lc(t,r.document),s=r.removedTargetIds||[];n=new Ja([],s,i,null)}else{if(!("filter"in e))return Ji();{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:i}=t,s=new Ua(r,i),o=t.targetId;n=new Xa(o,s)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return gs.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?gs.min():e.readTime?cc(e.readTime):gs.min()}(t);return this.listener.nu(e,n)}su(t){const e={};e.database=dc(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=$o(r)?{documents:pc(t,r)}:{query:gc(t,r)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=function(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}(t,e.resumeToken);const r=ac(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(gs.min())>0){n.readTime=function(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}(t,e.snapshotVersion.toTimestamp());const r=ac(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ji()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.Wo(e)}iu(t){const e={};e.database=dc(this.serializer),e.removeTarget=t,this.Wo(e)}}class gu extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.lu=!1}fu(){if(this.lu)throw new ts(Zi.FAILED_PRECONDITION,"The client has already been terminated.")}Io(t,e,n){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.connection.Io(t,e,n,r,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Zi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new ts(Zi.UNKNOWN,t.toString())}))}vo(t,e,n,r){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.vo(t,e,n,i,s,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Zi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new ts(Zi.UNKNOWN,t.toString())}))}terminate(){this.lu=!0}}class mu{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve()))))}Iu(t){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.yu("Offline")))}set(t){this.Tu(),this.wu=0,"Online"===t&&(this.mu=!1),this.yu(t)}yu(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}pu(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(zi(e),this.mu=!1):Hi("OnlineStateTracker",e)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class yu{constructor(t,e,n,r,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=i,this.Pu.Yr((t=>{n.enqueueAndForget((async()=>{Ou(this)&&(Hi("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Qi(t);e.vu.add(4),await _u(e),e.bu.set("Unknown"),e.vu.delete(4),await vu(e)}(this))}))})),this.bu=new mu(n,r)}}async function vu(t){if(Ou(t))for(const e of t.Ru)await e(!0)}async function _u(t){for(const e of t.Ru)await e(!1)}function wu(t,e){const n=Qi(t);n.Au.has(e.targetId)||(n.Au.set(e.targetId,e),Iu(n)?Tu(n):Du(n).Ko()&&Eu(n,e))}function bu(t,e){const n=Qi(t),r=Du(n);n.Au.delete(e),r.Ko()&&Su(n,e),0===n.Au.size&&(r.Ko()?r.jo():Ou(n)&&n.bu.set("Unknown"))}function Eu(t,e){if(t.Vu.qt(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(gs.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Du(t).su(e)}function Su(t,e){t.Vu.qt(e),Du(t).iu(e)}function Tu(t){t.Vu=new tc({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),le:e=>t.Au.get(e)||null,ue:()=>t.datastore.serializer.databaseId}),Du(t).start(),t.bu.gu()}function Iu(t){return Ou(t)&&!Du(t).Uo()&&t.Au.size>0}function Ou(t){return 0===Qi(t).vu.size}function ku(t){t.Vu=void 0}async function Cu(t){t.Au.forEach(((e,n)=>{Eu(t,e)}))}async function Au(t,e){ku(t),Iu(t)?(t.bu.Iu(e),Tu(t)):t.bu.set("Unknown")}async function Ru(t,e,n){if(t.bu.set("Online"),e instanceof Qa&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.Au.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.Au.delete(r),t.Vu.removeTarget(r))}(t,e)}catch(n){Hi("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Nu(t,n)}else if(e instanceof Ja?t.Vu.Ht(e):e instanceof Xa?t.Vu.ne(e):t.Vu.Xt(e),!n.isEqual(gs.min()))try{const e=await Xc(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Vu.ce(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.Au.get(r);i&&t.Au.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.Au.get(e);if(!r)return;t.Au.set(e,r.withResumeToken(Bs.EMPTY_BYTE_STRING,r.snapshotVersion)),Su(t,e);const i=new Ic(r.target,e,n,r.sequenceNumber);Eu(t,i)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Hi("RemoteStore","Failed to raise snapshot:",e),await Nu(t,e)}}async function Nu(t,e,n){if(!Cs(e))throw e;t.vu.add(1),await _u(t),t.bu.set("Offline"),n||(n=()=>Xc(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Hi("RemoteStore","Retrying IndexedDB access"),await n(),t.vu.delete(1),await vu(t)}))}async function xu(t,e){const n=Qi(t);n.asyncQueue.verifyOperationInProgress(),Hi("RemoteStore","RemoteStore received new credentials");const r=Ou(n);n.vu.add(3),await _u(n),r&&n.bu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.vu.delete(3),await vu(n)}function Du(t){return t.Su||(t.Su=function(t,e,n){const r=Qi(t);return r.fu(),new pu(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{uo:Cu.bind(null,t),ao:Au.bind(null,t),nu:Ru.bind(null,t)}),t.Ru.push((async e=>{e?(t.Su.Qo(),Iu(t)?Tu(t):t.bu.set("Unknown")):(await t.Su.stop(),ku(t))}))),t.Su}class Pu{constructor(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new es,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,r,i){const s=Date.now()+n,o=new Pu(t,e,s,r,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ts(Zi.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Lu(t,e){if(zi("AsyncQueue",`${e}: ${t}`),Cs(t))return new ts(Zi.UNAVAILABLE,`${e}: ${t}`);throw t}class ju{constructor(t){this.comparator=t?(e,n)=>t(e,n)||ws.comparator(e.key,n.key):(t,e)=>ws.comparator(t.key,e.key),this.keyedMap=ra(),this.sortedSet=new Ps(this.comparator)}static emptySet(t){return new ju(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof ju))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new ju;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Uu{constructor(){this.Cu=new Ps(ws.comparator)}track(t){const e=t.doc.key,n=this.Cu.get(e);n?0!==t.type&&3===n.type?this.Cu=this.Cu.insert(e,t):3===t.type&&1!==n.type?this.Cu=this.Cu.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Cu=this.Cu.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Cu=this.Cu.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Cu=this.Cu.remove(e):1===t.type&&2===n.type?this.Cu=this.Cu.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Cu=this.Cu.insert(e,{type:2,doc:t.doc}):Ji():this.Cu=this.Cu.insert(e,t)}xu(){const t=[];return this.Cu.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Mu{constructor(t,e,n,r,i,s,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,i){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new Mu(t,e,ju.emptySet(e),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&zo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Fu{constructor(){this.Nu=void 0,this.listeners=[]}}class $u{constructor(){this.queries=new Zo((t=>Wo(t)),zo),this.onlineState="Unknown",this.ku=new Set}}function Bu(t,e){const n=Qi(t);let r=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.listeners)e.$u(t)&&(r=!0);i.Nu=t}}r&&Gu(n)}function Vu(t,e,n){const r=Qi(t),i=r.queries.get(e);if(i)for(const t of i.listeners)t.onError(n);r.queries.delete(e)}function Gu(t){t.ku.forEach((t=>{t.next()}))}class qu{constructor(t,e,n){this.query=t,this.Ou=e,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=n||{}}$u(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Mu(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Fu?this.Lu(t)&&(this.Ou.next(t),e=!0):this.qu(t,this.onlineState)&&(this.Uu(t),e=!0),this.Bu=t,e}onError(t){this.Ou.error(t)}Mu(t){this.onlineState=t;let e=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,t)&&(this.Uu(this.Bu),e=!0),e}qu(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.Ku||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Lu(t){if(t.docChanges.length>0)return!0;const e=this.Bu&&this.Bu.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Uu(t){t=Mu.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Fu=!0,this.Ou.next(t)}}class Ku{constructor(t){this.key=t}}class Hu{constructor(t){this.key=t}}class zu{constructor(t,e){this.query=t,this.Yu=e,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=ua(),this.mutatedKeys=ua(),this.tc=Xo(t),this.ec=new ju(this.tc)}get nc(){return this.Yu}sc(t,e){const n=e?e.ic:new Uu,r=e?e.ec:this.ec;let i=e?e.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const u=r.get(t),l=Jo(this.query,e)?e:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.rc(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.tc(l,a)>0||c&&this.tc(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(t):i.delete(t)):(s=s.delete(t),i=i.delete(t)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const t="F"===this.query.limitType?s.last():s.first();s=s.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{ec:s,ic:n,zi:o,mutatedKeys:i}}rc(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const r=this.ec;this.ec=t.ec,this.mutatedKeys=t.mutatedKeys;const i=t.ic.xu();i.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ji()}};return n(t)-n(e)}(t.type,e.type)||this.tc(t.doc,e.doc))),this.oc(n);const s=e?this.uc():[],o=0===this.Zu.size&&this.current?1:0,a=o!==this.Xu;return this.Xu=o,0!==i.length||a?{snapshot:new Mu(this.query,t.ec,r,i,t.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:s}:{cc:s}}Mu(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({ec:this.ec,ic:new Uu,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(t){return!this.Yu.has(t)&&!!this.ec.has(t)&&!this.ec.get(t).hasLocalMutations}oc(t){t&&(t.addedDocuments.forEach((t=>this.Yu=this.Yu.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Yu=this.Yu.delete(t))),this.current=t.current)}uc(){if(!this.current)return[];const t=this.Zu;this.Zu=ua(),this.ec.forEach((t=>{this.ac(t.key)&&(this.Zu=this.Zu.add(t.key))}));const e=[];return t.forEach((t=>{this.Zu.has(t)||e.push(new Hu(t))})),this.Zu.forEach((n=>{t.has(n)||e.push(new Ku(n))})),e}hc(t){this.Yu=t.ir,this.Zu=ua();const e=this.sc(t.documents);return this.applyChanges(e,!0)}lc(){return Mu.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class Wu{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Yu{constructor(t){this.key=t,this.fc=!1}}class Ju{constructor(t,e,n,r,i,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.dc={},this.wc=new Zo((t=>Wo(t)),zo),this._c=new Map,this.mc=new Set,this.gc=new Ps(ws.comparator),this.yc=new Map,this.Ic=new Mc,this.Tc={},this.Ec=new Map,this.Ac=xc.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}async function Xu(t,e){const n=function(t){const e=Qi(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Zu.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ul.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=el.bind(null,e),e.dc.nu=Bu.bind(null,e.eventManager),e.dc.Pc=Vu.bind(null,e.eventManager),e}(t);let r,i;const s=n.wc.get(e);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.lc();else{const t=await function(t,e){const n=Qi(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Bs.getTargetData(t,e).next((i=>i?(r=i,ks.resolve(r)):n.Bs.allocateTargetId(t).next((i=>(r=new Ic(e,i,"TargetPurposeListen",t.currentSequenceNumber),n.Bs.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.Ji.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(t.targetId,t),n.Yi.set(e,t.targetId)),t}))}(n.localStore,Ko(e)),s=n.sharedClientState.addLocalQueryTarget(t.targetId);r=t.targetId,i=await async function(t,e,n,r,i){t.Rc=(e,n,r)=>async function(t,e,n,r){let i=e.view.sc(n);i.zi&&(i=await Zc(t.localStore,e.query,!1).then((({documents:t})=>e.view.sc(t,i))));const s=r&&r.targetChanges.get(e.targetId),o=e.view.applyChanges(i,t.isPrimaryClient,s);return il(t,e.targetId,o.cc),o.snapshot}(t,e,n,r);const s=await Zc(t.localStore,e,!0),o=new zu(e,s.ir),a=o.sc(s.documents),c=Ya.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,i),u=o.applyChanges(a,t.isPrimaryClient,c);il(t,n,u.cc);const l=new Wu(e,n,o);return t.wc.set(e,l),t._c.has(n)?t._c.get(n).push(e):t._c.set(n,[e]),u.snapshot}(n,e,r,"current"===s,t.resumeToken),n.isPrimaryClient&&wu(n.remoteStore,t)}return i}async function Qu(t,e){const n=Qi(t),r=n.wc.get(e),i=n._c.get(r.targetId);if(i.length>1)return n._c.set(r.targetId,i.filter((t=>!zo(t,e)))),void n.wc.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Qc(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),bu(n.remoteStore,r.targetId),nl(n,r.targetId)})).catch(Os)):(nl(n,r.targetId),await Qc(n.localStore,r.targetId,!0))}async function Zu(t,e){const n=Qi(t);try{const t=await function(t,e){const n=Qi(t),r=e.snapshotVersion;let i=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const s=n.Zi.newChangeBuffer({trackRemovals:!0});i=n.Ji;const o=[];e.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Bs.removeMatchingKeys(t,s.removedDocuments,a).next((()=>n.Bs.addMatchingKeys(t,s.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(Bs.EMPTY_BYTE_STRING,gs.min()).withLastLimboFreeSnapshotVersion(gs.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Bs.updateTargetData(t,u))}));let a=ea(),c=ua();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(function(t,e,n){let r=ua(),i=ua();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=ea();return n.forEach(((n,s)=>{const o=t.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(gs.min())?(e.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(s),r=r.insert(n,s)):Hi("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{nr:r,sr:i}}))}(t,s,e.documentUpdates).next((t=>{a=t.nr,c=t.sr}))),!r.isEqual(gs.min())){const e=n.Bs.getLastRemoteSnapshotVersion(t).next((e=>n.Bs.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return ks.waitFor(o).next((()=>s.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.Ji=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.yc.get(e);r&&(Xi(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.fc=!0:t.modifiedDocuments.size>0?Xi(r.fc):t.removedDocuments.size>0&&(Xi(r.fc),r.fc=!1))})),await al(n,t,e)}catch(t){await Os(t)}}function tl(t,e,n){const r=Qi(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.wc.forEach(((n,r)=>{const i=r.view.Mu(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=Qi(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.Mu(e)&&(r=!0)})),r&&Gu(n)}(r.eventManager,e),t.length&&r.dc.nu(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function el(t,e,n){const r=Qi(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.yc.get(e),s=i&&i.key;if(s){let t=new Ps(ws.comparator);t=t.insert(s,po.newNoDocument(s,gs.min()));const n=ua().add(s),i=new Wa(gs.min(),new Map,new Ps(ds),t,n);await Zu(r,i),r.gc=r.gc.remove(s),r.yc.delete(e),ol(r)}else await Qc(r.localStore,e,!1).then((()=>nl(r,e,n))).catch(Os)}function nl(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t._c.get(e))t.wc.delete(r),n&&t.dc.Pc(r,n);t._c.delete(e),t.isPrimaryClient&&t.Ic.Is(e).forEach((e=>{t.Ic.containsKey(e)||rl(t,e)}))}function rl(t,e){t.mc.delete(e.path.canonicalString());const n=t.gc.get(e);null!==n&&(bu(t.remoteStore,n),t.gc=t.gc.remove(e),t.yc.delete(n),ol(t))}function il(t,e,n){for(const r of n)r instanceof Ku?(t.Ic.addReference(r.key,e),sl(t,r)):r instanceof Hu?(Hi("SyncEngine","Document no longer in limbo: "+r.key),t.Ic.removeReference(r.key,e),t.Ic.containsKey(r.key)||rl(t,r.key)):Ji()}function sl(t,e){const n=e.key,r=n.path.canonicalString();t.gc.get(n)||t.mc.has(r)||(Hi("SyncEngine","New document in limbo: "+n),t.mc.add(r),ol(t))}function ol(t){for(;t.mc.size>0&&t.gc.size<t.maxConcurrentLimboResolutions;){const e=t.mc.values().next().value;t.mc.delete(e);const n=new ws(ys.fromString(e)),r=t.Ac.next();t.yc.set(r,new Yu(n)),t.gc=t.gc.insert(n,r),wu(t.remoteStore,new Ic(Ko(Vo(n.path)),r,"TargetPurposeLimboResolution",As.ct))}}async function al(t,e,n){const r=Qi(t),i=[],s=[],o=[];r.wc.isEmpty()||(r.wc.forEach(((t,a)=>{o.push(r.Rc(a,e,n).then((t=>{if((t||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){i.push(t);const e=zc.Li(a.targetId,t);s.push(e)}})))})),await Promise.all(o),r.dc.nu(i),await async function(t,e){const n=Qi(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>ks.forEach(e,(e=>ks.forEach(e.Fi,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>ks.forEach(e.Bi,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!Cs(t))throw t;Hi("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ji.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.Ji=n.Ji.insert(e,i)}}}(r.localStore,s))}async function cl(t,e){const n=Qi(t);if(!n.currentUser.isEqual(e)){Hi("SyncEngine","User change. New user:",e.toKey());const t=await Jc(n.localStore,e);n.currentUser=e,function(t,e){t.Ec.forEach((t=>{t.forEach((t=>{t.reject(new ts(Zi.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Ec.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await al(n,t.er)}}function ul(t,e){const n=Qi(t),r=n.yc.get(e);if(r&&r.fc)return ua().add(r.key);{let t=ua();const r=n._c.get(e);if(!r)return t;for(const e of r){const r=n.wc.get(e);t=t.unionWith(r.view.nc)}return t}}class ll{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=hu(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,r){return new Yc(t,e,n,r)}(this.persistence,new Wc,t.initialUser,this.serializer)}createPersistence(t){return new qc(Hc.zs,this.serializer)}createSharedClientState(t){return new eu}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class hl{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>tl(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=cl.bind(null,this.syncEngine),await async function(t,e){const n=Qi(t);e?(n.vu.delete(2),await vu(n)):e||(n.vu.add(2),await _u(n),n.bu.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new $u}createDatastore(t){const e=hu(t.databaseInfo.databaseId),n=(r=t.databaseInfo,new uu(r));var r;return function(t,e,n,r){return new gu(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=t=>tl(this.syncEngine,t,0),s=ru.D()?new ru:new nu,new yu(e,n,r,i,s);var e,n,r,i,s}createSyncEngine(t,e){return function(t,e,n,r,i,s,o){const a=new Ju(t,e,n,r,i,s);return o&&(a.vc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=Qi(t);Hi("RemoteStore","RemoteStore shutting down."),e.vu.add(5),await _u(e),e.Pu.shutdown(),e.bu.set("Unknown")}(this.remoteStore)}}class dl{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Sc(this.observer.next,t)}error(t){this.observer.error?this.Sc(this.observer.error,t):zi("Uncaught Error in snapshot listener:",t.toString())}Dc(){this.muted=!0}Sc(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class fl{constructor(t,e,n,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=Vi.UNAUTHENTICATED,this.clientId=hs.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Hi("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Hi("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new ts(Zi.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new es;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Lu(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function pl(t,e){t.asyncQueue.verifyOperationInProgress(),Hi("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await Jc(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function gl(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Hi("FirestoreClient","Using user provided OfflineComponentProvider");try{await pl(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===Zi.FAILED_PRECONDITION||t.code===Zi.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;Wi("Error using user provided cache. Falling back to memory cache: "+n),await pl(t,new ll)}}else Hi("FirestoreClient","Using default OfflineComponentProvider"),await pl(t,new ll);return t._offlineComponents}(t);Hi("FirestoreClient","Initializing OnlineComponentProvider");const r=await t.getConfiguration();await e.initialize(n,r),t.setCredentialChangeListener((t=>xu(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>xu(e.remoteStore,n))),t._onlineComponents=e}async function ml(t){const e=await async function(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Hi("FirestoreClient","Using user provided OnlineComponentProvider"),await gl(t,t._uninitializedComponentsProvider._online)):(Hi("FirestoreClient","Using default OnlineComponentProvider"),await gl(t,new hl))),t._onlineComponents}(t),n=e.eventManager;return n.onListen=Xu.bind(null,e.syncEngine),n.onUnlisten=Qu.bind(null,e.syncEngine),n}function yl(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const vl=new Map;function _l(t){if(!ws.isDocumentKey(t))throw new ts(Zi.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function wl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ts(Zi.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=function(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Ji()}(t);throw new ts(Zi.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class bl{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new ts(Zi.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.cache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new ts(Zi.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new ts(Zi.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=yl(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new ts(Zi.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new ts(Zi.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new ts(Zi.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(e=this.experimentalLongPollingOptions,n=t.experimentalLongPollingOptions,e.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams;var e,n}}class El{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new bl({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new ts(Zi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new ts(Zi.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new bl(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new rs;switch(t.type){case"firstParty":return new as(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new ts(Zi.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=vl.get(t);e&&(Hi("ComponentProvider","Removing Datastore"),vl.delete(t),e.terminate())}(this),Promise.resolve()}}function Sl(t,e,n,r={}){var i;const s=(t=wl(t,El))._getSettings(),o=`${e}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&Wi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=Vi.MOCK_USER;else{e=h(r.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new ts(Zi.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Vi(s)}t._authCredentials=new is(new ns(e,n))}}class Tl{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ol(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Tl(this.firestore,t,this._key)}}class Il{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Il(this.firestore,t,this._query)}}class Ol extends Il{constructor(t,e,n){super(t,e,Vo(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Tl(this.firestore,null,new ws(t))}withConverter(t){return new Ol(this.firestore,t,this._path)}}function kl(t,e,...n){if(t=y(t),1===arguments.length&&(e=hs.A()),function(t,e,n){if(!n)throw new ts(Zi.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}("doc","path",e),t instanceof El){const r=ys.fromString(e,...n);return _l(r),new Tl(t,null,new ws(r))}{if(!(t instanceof Tl||t instanceof Ol))throw new ts(Zi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ys.fromString(e,...n));return _l(r),new Tl(t.firestore,t instanceof Ol?t.converter:null,new ws(r))}}class Cl{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new du(this,"async_queue_retry"),this.Xc=()=>{const t=lu();t&&Hi("AsyncQueue","Visibility state changed to "+t.visibilityState),this.qo.Mo()};const t=lu();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Zc(),this.ta(t)}enterRestrictedMode(t){if(!this.jc){this.jc=!0,this.Jc=t||!1;const e=lu();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Xc)}}enqueue(t){if(this.Zc(),this.jc)return new Promise((()=>{}));const e=new es;return this.ta((()=>this.jc&&this.Jc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Qc.push(t),this.ea())))}async ea(){if(0!==this.Qc.length){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(t){if(!Cs(t))throw t;Hi("AsyncQueue","Operation failed with retryable error: "+t)}this.Qc.length>0&&this.qo.No((()=>this.ea()))}}ta(t){const e=this.Gc.then((()=>(this.Hc=!0,t().catch((t=>{this.Wc=t,this.Hc=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw zi("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Hc=!1,t))))));return this.Gc=e,e}enqueueAfterDelay(t,e,n){this.Zc(),this.Yc.indexOf(t)>-1&&(e=0);const r=Pu.createAndSchedule(this,t,e,n,(t=>this.na(t)));return this.zc.push(r),r}Zc(){this.Wc&&Ji()}verifyOperationInProgress(){}async sa(){let t;do{t=this.Gc,await t}while(t!==this.Gc)}ia(t){for(const e of this.zc)if(e.timerId===t)return!0;return!1}ra(t){return this.sa().then((()=>{this.zc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.zc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.sa()}))}oa(t){this.Yc.push(t)}na(t){const e=this.zc.indexOf(t);this.zc.splice(e,1)}}function Al(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class Rl extends El{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new Cl,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Nl(this),this._firestoreClient.terminate()}}function Nl(t){var e,n,r;const i=t._freezeSettings(),s=function(t,e,n,r){return new Ys(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,yl(r.experimentalLongPollingOptions),r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,i);t._firestoreClient=new fl(t._authCredentials,t._appCheckCredentials,t._queue,s),(null===(n=i.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.cache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.cache.kind,_offline:i.cache._offlineComponentProvider,_online:i.cache._onlineComponentProvider})}class xl{constructor(t){this._byteString=t}static fromBase64String(t){try{return new xl(Bs.fromBase64String(t))}catch(t){throw new ts(Zi.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new xl(Bs.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Dl{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new ts(Zi.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new _s(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Pl{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new ts(Zi.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new ts(Zi.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return ds(this._lat,t._lat)||ds(this._long,t._long)}}const Ll=new RegExp("[~\\*/\\[\\]]");function jl(t,e,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new ts(Zi.INVALID_ARGUMENT,a+t+c)}class Ul{constructor(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Tl(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Ml(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Fl("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Ml extends Ul{data(){return super.data()}}function Fl(t,e){return"string"==typeof e?function(t,e,n){if(e.search(Ll)>=0)throw jl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Dl(...e.split("."))._internalPath}catch(r){throw jl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}(t,e):e instanceof Dl?e._internalPath:e._delegate._internalPath}class $l{convertValue(t,e="none"){switch(Qs(t)){case 0:return null;case 1:return t.booleanValue;case 2:return qs(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Ks(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Ji()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Ds(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new Pl(qs(t.latitude),qs(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=zs(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Ws(t));default:return null}}convertTimestamp(t){const e=Gs(t);return new ps(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=ys.fromString(t);Xi(Tc(n));const r=new Js(n.get(1),n.get(3)),i=new ws(n.popFirst(5));return r.isEqual(e)||zi(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}class Bl{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Vl extends Ul{constructor(t,e,n,r,i,s){super(t,e,n,r,s),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Gl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Fl("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Gl extends Vl{data(t={}){return super.data(t)}}class ql{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Bl(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Gl(this._firestore,this._userDataWriter,n.key,n,new Bl(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new ts(Zi.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const r=new Gl(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Bl(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new Gl(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Bl(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,s=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),s=n.indexOf(e.doc.key)),{type:Kl(e.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Kl(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ji()}}class Hl extends $l{constructor(t){super(),this.firestore=t}convertBytes(t){return new xl(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Tl(this.firestore,null,e)}}function zl(t,...e){var n,r,i;t=y(t);let s={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Al(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(Al(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(r=t.error)||void 0===r?void 0:r.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let c,u,l;if(t instanceof Tl)u=wl(t.firestore,Rl),l=Vo(t._key.path),c={next:n=>{e[o]&&e[o](function(t,e,n){const r=n.docs.get(e._key),i=new Hl(t);return new Vl(t,i,e._key,r,new Bl(n.hasPendingWrites,n.fromCache),e.converter)}(u,t,n))},error:e[o+1],complete:e[o+2]};else{const n=wl(t,Il);u=wl(n.firestore,Rl),l=n._query;const r=new Hl(u);c={next:t=>{e[o]&&e[o](new ql(u,r,n,t))},error:e[o+1],complete:e[o+2]},function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new ts(Zi.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query)}return function(t,e,n,r){const i=new dl(r),s=new qu(e,i,n);return t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const n=Qi(t),r=e.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Fu),i)try{s.Nu=await n.onListen(r)}catch(t){const n=Lu(t,`Initialization of query '${Yo(e.query)}' failed`);return void e.onError(n)}n.queries.set(r,s),s.listeners.push(e),e.Mu(n.onlineState),s.Nu&&e.$u(s.Nu)&&Gu(n)}(await ml(t),s))),()=>{i.Dc(),t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const n=Qi(t),r=e.query;let i=!1;const s=n.queries.get(r);if(s){const t=s.listeners.indexOf(e);t>=0&&(s.listeners.splice(t,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}(await ml(t),s)))}}(function(t){return t._firestoreClient||Nl(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}(u),l,a,c)}!function(t,e=!0){!function(t){Gi=t}(ot),nt(new v("firestore",((t,{instanceIdentifier:n,options:r})=>{const i=t.getProvider("app").getImmediate(),s=new Rl(new ss(t.getProvider("auth-internal")),new us(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new ts(Zi.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Js(t.options.projectId,e)}(i,n),i);return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),ut(Bi,"3.13.0",t),ut(Bi,"3.13.0","esm2017")}();const Wl="firebasestorage.googleapis.com";class Yl extends d{constructor(t,e,n=0){super(Ql(t),`Firebase Storage: ${e} (${Ql(t)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Yl.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return Ql(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var Jl,Xl;function Ql(t){return"storage/"+t}function Zl(t){return new Yl(Jl.INVALID_ARGUMENT,t)}function th(){return new Yl(Jl.APP_DELETED,"The Firebase app was deleted.")}!function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(Jl||(Jl={}));class eh{constructor(t,e){this.bucket=t,this.path_=e}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let n;try{n=eh.makeFromUrl(t,e)}catch(e){return new eh(t,"")}if(""===n.path)return n;throw r=t,new Yl(Jl.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(t,e){let n=null;const r="([A-Za-z0-9.\\-_]+)",i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(t){t.path_=decodeURIComponent(t.path)}const o=e.replace(/[.]/g,"\\."),a=[{regex:i,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${e===Wl?"(?:storage.googleapis.com|storage.cloud.google.com)":e}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let e=0;e<a.length;e++){const r=a[e],i=r.regex.exec(t);if(i){const t=i[r.indices.bucket];let e=i[r.indices.path];e||(e=""),n=new eh(t,e),r.postModify(n);break}}if(null==n)throw function(t){return new Yl(Jl.INVALID_URL,"Invalid URL '"+t+"'.")}(t);return n}}class nh{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}function rh(t,e,n,r){if(r<e)throw Zl(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw Zl(`Invalid value for '${t}'. Expected ${n} or less.`)}!function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"}(Xl||(Xl={}));class ih{constructor(t,e,n,r,i,s,o,a,c,u,l,h=!0){this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=l,this.retry=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((t,e)=>{this.resolve_=t,this.reject_=e,this.start_()}))}start_(){const t=(t,e)=>{const n=this.resolve_,r=this.reject_,i=e.connection;if(e.wasSuccessCode)try{const t=this.callback_(i,i.getResponse());!function(t){return void 0!==t}(t)?n():n(t)}catch(t){r(t)}else if(null!==i){const t=new Yl(Jl.UNKNOWN,"An unknown error occurred, please check the error payload for server response.");t.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,t)):r(t)}else e.canceled?r(this.appDelete_?th():new Yl(Jl.CANCELED,"User canceled the upload/download.")):r(new Yl(Jl.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?t(0,new sh(!1,null,!0)):this.backoffId_=function(t,e,n){let r=1,i=null,s=null,o=!1,a=0;function c(){return 2===a}let u=!1;function l(...t){u||(u=!0,e.apply(null,t))}function h(e){i=setTimeout((()=>{i=null,t(f,c())}),e)}function d(){s&&clearTimeout(s)}function f(t,...e){if(u)return void d();if(t)return d(),void l.call(null,t,...e);if(c()||o)return d(),void l.call(null,t,...e);let n;r<64&&(r*=2),1===a?(a=2,n=0):n=1e3*(r+Math.random()),h(n)}let p=!1;function g(t){p||(p=!0,d(),u||(null!==i?(t||(a=2),clearTimeout(i),h(0)):t||(a=1)))}return h(0),s=setTimeout((()=>{o=!0,g(!0)}),n),g}(((t,e)=>{if(e)return void t(!1,new sh(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=t=>{const e=t.loaded,n=t.lengthComputable?t.total:-1;null!==this.progressCallback_&&this.progressCallback_(e,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const e=n.getErrorCode()===Xl.NO_ERROR,i=n.getStatus();if(!e||function(t,e){const n=t>=500&&t<600,r=-1!==[408,429].indexOf(t),i=-1!==e.indexOf(t);return n||r||i}(i,this.additionalRetryCodes_)&&this.retry){const e=n.getErrorCode()===Xl.ABORT;return void t(!1,new sh(!1,null,e))}const s=-1!==this.successCodes_.indexOf(i);t(!0,new sh(s,n))}))}),t,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&function(t){t(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class sh{constructor(t,e,n){this.wasSuccessCode=t,this.connection=e,this.canceled=!!n}}class oh{constructor(t,e){this._service=t,this._location=e instanceof eh?e:eh.makeFromUrl(e,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,e){return new oh(t,e)}get root(){const t=new eh(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return function(t){const e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}(this._location.path)}get storage(){return this._service}get parent(){const t=function(t){if(0===t.length)return null;const e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this._location.path);if(null===t)return null;const e=new eh(this._location.bucket,t);return new oh(this._service,e)}_throwIfRoot(t){if(""===this._location.path)throw function(t){return new Yl(Jl.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)}}function ah(t,e){const n=null==e?void 0:e.storageBucket;return null==n?null:eh.makeFromBucketSpec(n,t)}class ch{constructor(t,e,n,r,i){this.app=t,this._authProvider=e,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=Wl,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?eh.makeFromBucketSpec(r,this._host):ah(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,null!=this._url?this._bucket=eh.makeFromBucketSpec(this._url,t):this._bucket=ah(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){rh("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){rh("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const e=await t.getToken();if(null!==e)return e.accessToken}return null}async _getAppCheckToken(){const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((t=>t.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new oh(this,t)}_makeRequest(t,e,n,r,i=!0){if(this._deleted)return new nh(th());{const s=function(t,e,n,r,i,s,o=!0){const a=function(t){const e=encodeURIComponent;let n="?";for(const r in t)t.hasOwnProperty(r)&&(n=n+(e(r)+"=")+e(t[r])+"&");return n=n.slice(0,-1),n}(t.urlParams),c=t.url+a,u=Object.assign({},t.headers);return function(t,e){e&&(t["X-Firebase-GMPID"]=e)}(u,e),function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(u,n),function(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(null!=e?e:"AppManager")}(u,s),function(t,e){null!==e&&(t["X-Firebase-AppCheck"]=e)}(u,r),new ih(c,t.method,u,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i,o)}(t,this._appId,n,r,e,this._firebaseVersion,i);return this._requests.add(s),s.getPromise().then((()=>this._requests.delete(s)),(()=>this._requests.delete(s))),s}}async makeRequestWithTokens(t,e){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,e,n,r).getPromise()}}const uh="@firebase/storage",lh="0.11.2",hh="storage";function dh(t,e,n,r={}){!function(t,e,n,r={}){t.host=`${e}:${n}`,t._protocol="http";const{mockUserToken:i}=r;i&&(t._overrideAuthToken="string"==typeof i?i:h(i,t.app.options.projectId))}(t,e,n,r)}nt(new v(hh,(function(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),i=t.getProvider("app-check-internal");return new ch(n,r,i,e,ot)}),"PUBLIC").setMultipleInstances(!0)),ut(uh,lh,""),ut(uh,lh,"esm2017");const fh="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__;function ph(t){return t&&t.Math==Math?t:void 0}const gh="object"==typeof globalThis&&ph(globalThis)||"object"==typeof window&&ph(window)||"object"==typeof self&&ph(self)||"object"==typeof o.g&&ph(o.g)||function(){return this}()||{};function mh(){return gh}function yh(t,e,n){const r=n||gh,i=r.__SENTRY__=r.__SENTRY__||{};return i[t]||(i[t]=e())}const vh=["debug","info","warn","error","log","assert","trace"],_h={};function wh(t){if(!("console"in gh))return t();const e=gh.console,n={},r=Object.keys(_h);r.forEach((t=>{const r=_h[t];n[t]=e[t],e[t]=r}));try{return t()}finally{r.forEach((t=>{e[t]=n[t]}))}}const bh=function(){let t=!1;const e={enable:()=>{t=!0},disable:()=>{t=!1},isEnabled:()=>t};return fh?vh.forEach((n=>{e[n]=(...e)=>{t&&wh((()=>{gh.console[n](`Sentry Logger [${n}]:`,...e)}))}})):vh.forEach((t=>{e[t]=()=>{}})),e}(),Eh=Object.prototype.toString;function Sh(t){switch(Eh.call(t)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return Dh(t,Error)}}function Th(t,e){return Eh.call(t)===`[object ${e}]`}function Ih(t){return Th(t,"ErrorEvent")}function Oh(t){return Th(t,"DOMError")}function kh(t){return Th(t,"String")}function Ch(t){return"object"==typeof t&&null!==t&&"__sentry_template_string__"in t&&"__sentry_template_values__"in t}function Ah(t){return null===t||Ch(t)||"object"!=typeof t&&"function"!=typeof t}function Rh(t){return Th(t,"Object")}function Nh(t){return"undefined"!=typeof Event&&Dh(t,Event)}function xh(t){return Boolean(t&&t.then&&"function"==typeof t.then)}function Dh(t,e){try{return t instanceof e}catch(t){return!1}}function Ph(t){return!("object"!=typeof t||null===t||!t.__isVue&&!t._isVue)}const Lh=mh(),jh=80;function Uh(t,e={}){if(!t)return"<unknown>";try{let n=t;const r=5,i=[];let s=0,o=0;const a=" > ",c=a.length;let u;const l=Array.isArray(e)?e:e.keyAttrs,h=!Array.isArray(e)&&e.maxStringLength||jh;for(;n&&s++<r&&(u=Mh(n,l),!("html"===u||s>1&&o+i.length*c+u.length>=h));)i.push(u),o+=u.length,n=n.parentNode;return i.reverse().join(a)}catch(t){return"<unknown>"}}function Mh(t,e){const n=t,r=[];let i,s,o,a,c;if(!n||!n.tagName)return"";if(Lh.HTMLElement&&n instanceof HTMLElement&&n.dataset&&n.dataset.sentryComponent)return n.dataset.sentryComponent;r.push(n.tagName.toLowerCase());const u=e&&e.length?e.filter((t=>n.getAttribute(t))).map((t=>[t,n.getAttribute(t)])):null;if(u&&u.length)u.forEach((t=>{r.push(`[${t[0]}="${t[1]}"]`)}));else if(n.id&&r.push(`#${n.id}`),i=n.className,i&&kh(i))for(s=i.split(/\s+/),c=0;c<s.length;c++)r.push(`.${s[c]}`);const l=["aria-label","type","name","title","alt"];for(c=0;c<l.length;c++)o=l[c],a=n.getAttribute(o),a&&r.push(`[${o}="${a}"]`);return r.join("")}function Fh(t,e=0){return"string"!=typeof t||0===e||t.length<=e?t:`${t.slice(0,e)}...`}function $h(t,e){if(!Array.isArray(t))return"";const n=[];for(let e=0;e<t.length;e++){const r=t[e];try{Ph(r)?n.push("[VueViewModel]"):n.push(String(r))}catch(t){n.push("[value cannot be serialized]")}}return n.join(e)}function Bh(t,e=[],n=!1){return e.some((e=>function(t,e,n=!1){return!!kh(t)&&(Th(e,"RegExp")?e.test(t):!!kh(e)&&(n?t===e:t.includes(e)))}(t,e,n)))}function Vh(t,e,n){if(!(e in t))return;const r=t[e],i=n(r);"function"==typeof i&&qh(i,r),t[e]=i}function Gh(t,e,n){try{Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0})}catch(n){fh&&bh.log(`Failed to add non-enumerable property "${e}" to object`,t)}}function qh(t,e){try{const n=e.prototype||{};t.prototype=e.prototype=n,Gh(t,"__sentry_original__",e)}catch(t){}}function Kh(t){return t.__sentry_original__}function Hh(t){if(Sh(t))return{message:t.message,name:t.name,stack:t.stack,...Wh(t)};if(Nh(t)){const e={type:t.type,target:zh(t.target),currentTarget:zh(t.currentTarget),...Wh(t)};return"undefined"!=typeof CustomEvent&&Dh(t,CustomEvent)&&(e.detail=t.detail),e}return t}function zh(t){try{return"undefined"!=typeof Element&&Dh(t,Element)?Uh(t):Object.prototype.toString.call(t)}catch(t){return"<unknown>"}}function Wh(t){if("object"==typeof t&&null!==t){const e={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}return{}}function Yh(t){return Jh(t,new Map)}function Jh(t,e){if(Rh(t)){const n=e.get(t);if(void 0!==n)return n;const r={};e.set(t,r);for(const n of Object.keys(t))void 0!==t[n]&&(r[n]=Jh(t[n],e));return r}if(Array.isArray(t)){const n=e.get(t);if(void 0!==n)return n;const r=[];return e.set(t,r),t.forEach((t=>{r.push(Jh(t,e))})),r}return t}function Xh(){const t=gh,e=t.crypto||t.msCrypto;let n=()=>16*Math.random();try{if(e&&e.randomUUID)return e.randomUUID().replace(/-/g,"");e&&e.getRandomValues&&(n=()=>{const t=new Uint8Array(1);return e.getRandomValues(t),t[0]})}catch(t){}return([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,(t=>(t^(15&n())>>t/4).toString(16)))}function Qh(t){return t.exception&&t.exception.values?t.exception.values[0]:void 0}function Zh(t){const{message:e,event_id:n}=t;if(e)return e;const r=Qh(t);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function td(t,e,n){const r=t.exception=t.exception||{},i=r.values=r.values||[],s=i[0]=i[0]||{};s.value||(s.value=e||""),s.type||(s.type=n||"Error")}function ed(t,e){const n=Qh(t);if(!n)return;const r=n.mechanism;if(n.mechanism={type:"generic",handled:!0,...r,...e},e&&"data"in e){const t={...r&&r.data,...e.data};n.mechanism.data=t}}function nd(t){if(t&&t.__sentry_captured__)return!0;try{Gh(t,"__sentry_captured__",!0)}catch(t){}return!1}function rd(t){return Array.isArray(t)?t:[t]}const id="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__;var sd;function od(t){return new cd((e=>{e(t)}))}function ad(t){return new cd(((e,n)=>{n(t)}))}!function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"}(sd||(sd={}));class cd{constructor(t){cd.prototype.__init.call(this),cd.prototype.__init2.call(this),cd.prototype.__init3.call(this),cd.prototype.__init4.call(this),this._state=sd.PENDING,this._handlers=[];try{t(this._resolve,this._reject)}catch(t){this._reject(t)}}then(t,e){return new cd(((n,r)=>{this._handlers.push([!1,e=>{if(t)try{n(t(e))}catch(t){r(t)}else n(e)},t=>{if(e)try{n(e(t))}catch(t){r(t)}else r(t)}]),this._executeHandlers()}))}catch(t){return this.then((t=>t),t)}finally(t){return new cd(((e,n)=>{let r,i;return this.then((e=>{i=!1,r=e,t&&t()}),(e=>{i=!0,r=e,t&&t()})).then((()=>{i?n(r):e(r)}))}))}__init(){this._resolve=t=>{this._setResult(sd.RESOLVED,t)}}__init2(){this._reject=t=>{this._setResult(sd.REJECTED,t)}}__init3(){this._setResult=(t,e)=>{this._state===sd.PENDING&&(xh(e)?e.then(this._resolve,this._reject):(this._state=t,this._value=e,this._executeHandlers()))}}__init4(){this._executeHandlers=()=>{if(this._state===sd.PENDING)return;const t=this._handlers.slice();this._handlers=[],t.forEach((t=>{t[0]||(this._state===sd.RESOLVED&&t[1](this._value),this._state===sd.REJECTED&&t[2](this._value),t[0]=!0)}))}}}function ud(){return yh("globalEventProcessors",(()=>[]))}function ld(t){ud().push(t)}function hd(t,e,n,r=0){return new cd(((i,s)=>{const o=t[r];if(null===e||"function"!=typeof o)i(e);else{const a=o({...e},n);id&&o.id&&null===a&&bh.log(`Event processor "${o.id}" dropped event`),xh(a)?a.then((e=>hd(t,e,n,r+1).then(i))).then(null,s):hd(t,a,n,r+1).then(i).then(null,s)}}))}const dd=1e3;function fd(){return Date.now()/dd}const pd=function(){const{performance:t}=gh;if(!t||!t.now)return fd;const e=Date.now()-t.now(),n=null==t.timeOrigin?e:t.timeOrigin;return()=>(n+t.now())/dd}();let gd;(()=>{const{performance:t}=gh;if(!t||!t.now)return void(gd="none");const e=36e5,n=t.now(),r=Date.now(),i=t.timeOrigin?Math.abs(t.timeOrigin+n-r):e,s=i<e,o=t.timing&&t.timing.navigationStart,a="number"==typeof o?Math.abs(o+n-r):e;s||a<e?i<=a?(gd="timeOrigin",t.timeOrigin):gd="navigationStart":gd="dateNow"})();const md="production";function yd(t){const e=pd(),n={sid:Xh(),init:!0,timestamp:e,started:e,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>function(t){return Yh({sid:`${t.sid}`,init:t.init,started:new Date(1e3*t.started).toISOString(),timestamp:new Date(1e3*t.timestamp).toISOString(),status:t.status,errors:t.errors,did:"number"==typeof t.did||"string"==typeof t.did?`${t.did}`:void 0,duration:t.duration,abnormal_mechanism:t.abnormal_mechanism,attrs:{release:t.release,environment:t.environment,ip_address:t.ipAddress,user_agent:t.userAgent}})}(n)};return t&&vd(n,t),n}function vd(t,e={}){if(e.user&&(!t.ipAddress&&e.user.ip_address&&(t.ipAddress=e.user.ip_address),t.did||e.did||(t.did=e.user.id||e.user.email||e.user.username)),t.timestamp=e.timestamp||pd(),e.abnormal_mechanism&&(t.abnormal_mechanism=e.abnormal_mechanism),e.ignoreDuration&&(t.ignoreDuration=e.ignoreDuration),e.sid&&(t.sid=32===e.sid.length?e.sid:Xh()),void 0!==e.init&&(t.init=e.init),!t.did&&e.did&&(t.did=`${e.did}`),"number"==typeof e.started&&(t.started=e.started),t.ignoreDuration)t.duration=void 0;else if("number"==typeof e.duration)t.duration=e.duration;else{const e=t.timestamp-t.started;t.duration=e>=0?e:0}e.release&&(t.release=e.release),e.environment&&(t.environment=e.environment),!t.ipAddress&&e.ipAddress&&(t.ipAddress=e.ipAddress),!t.userAgent&&e.userAgent&&(t.userAgent=e.userAgent),"number"==typeof e.errors&&(t.errors=e.errors),e.status&&(t.status=e.status)}function _d(t,e){let n={};e?n={status:e}:"ok"===t.status&&(n={status:"exited"}),vd(t,n)}const wd=/\(error: (.*)\)/,bd=/captureMessage|captureException/;function Ed(...t){const e=t.sort(((t,e)=>t[0]-e[0])).map((t=>t[1]));return(t,n=0)=>{const r=[],i=t.split("\n");for(let t=n;t<i.length;t++){const n=i[t];if(n.length>1024)continue;const s=wd.test(n)?n.replace(wd,"$1"):n;if(!s.match(/\S*Error: /)){for(const t of e){const e=t(s);if(e){r.push(e);break}}if(r.length>=50)break}}return function(t){if(!t.length)return[];const e=Array.from(t);return/sentryWrapped/.test(e[e.length-1].function||"")&&e.pop(),e.reverse(),bd.test(e[e.length-1].function||"")&&(e.pop(),bd.test(e[e.length-1].function||"")&&e.pop()),e.slice(0,50).map((t=>({...t,filename:t.filename||e[e.length-1].filename,function:t.function||"?"})))}(r)}}const Sd="<anonymous>";function Td(t){try{return t&&"function"==typeof t&&t.name||Sd}catch(t){return Sd}}function Id(t,e=100,n=1/0){try{return kd("",t,e,n)}catch(t){return{ERROR:`**non-serializable** (${t})`}}}function Od(t,e=3,n=102400){const r=Id(t,e);return i=r,function(t){return~-encodeURI(t).split(/%..|./).length}(JSON.stringify(i))>n?Od(t,e-1,n):r;var i}function kd(t,e,n=1/0,r=1/0,i=function(){const t="function"==typeof WeakSet,e=t?new WeakSet:[];return[function(n){if(t)return!!e.has(n)||(e.add(n),!1);for(let t=0;t<e.length;t++)if(e[t]===n)return!0;return e.push(n),!1},function(n){if(t)e.delete(n);else for(let t=0;t<e.length;t++)if(e[t]===n){e.splice(t,1);break}}]}()){const[s,a]=i;if(null==e||["number","boolean","string"].includes(typeof e)&&("number"!=typeof(c=e)||c==c))return e;var c;const u=function(t,e){try{if("domain"===t&&e&&"object"==typeof e&&e._events)return"[Domain]";if("domainEmitter"===t)return"[DomainEmitter]";if(void 0!==o.g&&e===o.g)return"[Global]";if("undefined"!=typeof window&&e===window)return"[Window]";if("undefined"!=typeof document&&e===document)return"[Document]";if(Ph(e))return"[VueViewModel]";if(function(t){return Rh(t)&&"nativeEvent"in t&&"preventDefault"in t&&"stopPropagation"in t}(e))return"[SyntheticEvent]";if("number"==typeof e&&e!=e)return"[NaN]";if("function"==typeof e)return`[Function: ${Td(e)}]`;if("symbol"==typeof e)return`[${String(e)}]`;if("bigint"==typeof e)return`[BigInt: ${String(e)}]`;const n=function(t){const e=Object.getPrototypeOf(t);return e?e.constructor.name:"null prototype"}(e);return/^HTML(\w*)Element$/.test(n)?`[HTMLElement: ${n}]`:`[object ${n}]`}catch(t){return`**non-serializable** (${t})`}}(t,e);if(!u.startsWith("[object "))return u;if(e.__sentry_skip_normalization__)return e;const l="number"==typeof e.__sentry_override_normalization_depth__?e.__sentry_override_normalization_depth__:n;if(0===l)return u.replace("object ","");if(s(e))return"[Circular ~]";const h=e;if(h&&"function"==typeof h.toJSON)try{return kd("",h.toJSON(),l-1,r,i)}catch(t){}const d=Array.isArray(e)?[]:{};let f=0;const p=Hh(e);for(const t in p){if(!Object.prototype.hasOwnProperty.call(p,t))continue;if(f>=r){d[t]="[MaxProperties ~]";break}const e=p[t];d[t]=kd(t,e,l-1,r,i),f++}return a(e),d}const Cd=1;function Ad(t){const{spanId:e,traceId:n}=t.spanContext(),{data:r,op:i,parent_span_id:s,status:o,tags:a,origin:c}=Rd(t);return Yh({data:r,op:i,parent_span_id:s,span_id:e,status:o,tags:a,trace_id:n,origin:c})}function Rd(t){return function(t){return"function"==typeof t.getSpanJSON}(t)?t.getSpanJSON():"function"==typeof t.toJSON?t.toJSON():{}}const Nd=new WeakMap;const xd=["user","level","extra","contexts","tags","fingerprint","requestSession","propagationContext"];function Dd(t,e){return ef().captureEvent(t,e)}function Pd(t,e){ef().addBreadcrumb(t,e)}function Ld(){return ef().getClient()}function jd(){return ef().getScope()}function Ud(t){const e=Ld(),n=nf(),r=jd(),{release:i,environment:s=md}=e&&e.getOptions()||{},{userAgent:o}=gh.navigator||{},a=yd({release:i,environment:s,user:n.getUser(),...o&&{userAgent:o},...t}),c=n.getSession();return c&&"ok"===c.status&&vd(c,{status:"exited"}),Md(),n.setSession(a),r.setSession(a),a}function Md(){const t=nf(),e=jd(),n=t.getSession();n&&_d(n),Fd(),t.setSession(),e.setSession()}function Fd(){const t=nf(),e=jd(),n=Ld(),r=e.getSession()||t.getSession();r&&n&&n.captureSession&&n.captureSession(r)}function $d(t=!1){t?Md():Fd()}function Bd(t,e,n){const r=e.getOptions(),{publicKey:i}=e.getDsn()||{},{segment:s}=n&&n.getUser()||{},o=Yh({environment:r.environment||md,release:r.release,user_segment:s,public_key:i,trace_id:t});return e.emit&&e.emit("createDsc",o),o}function Vd(t){const e=Ld();if(!e)return{};const n=Bd(Rd(t).trace_id||"",e,jd()),r=t.transaction;if(!r)return n;const i=r&&r._frozenDynamicSamplingContext;if(i)return i;const{sampleRate:s,source:o}=r.metadata;null!=s&&(n.sample_rate=`${s}`);const a=Rd(r);return o&&"url"!==o&&(n.transaction=a.description),n.sampled=String(function(t){const{traceFlags:e}=t.spanContext();return Boolean(e&Cd)}(r)),e.emit&&e.emit("createDsc",n),n}function Gd(t,e){const{fingerprint:n,span:r,breadcrumbs:i,sdkProcessingMetadata:s,propagationContext:o}=e;!function(t,e){const{extra:n,tags:r,user:i,contexts:s,level:o,transactionName:a}=e;n&&Object.keys(n).length&&(t.extra={...n,...t.extra}),r&&Object.keys(r).length&&(t.tags={...r,...t.tags}),i&&Object.keys(i).length&&(t.user={...i,...t.user}),s&&Object.keys(s).length&&(t.contexts={...s,...t.contexts}),o&&(t.level=o),a&&(t.transaction=a)}(t,e),r&&function(t,e){t.contexts={trace:Ad(e),...t.contexts};const n=e.transaction;if(n){t.sdkProcessingMetadata={dynamicSamplingContext:Vd(e),...t.sdkProcessingMetadata};const r=Rd(n).description;r&&(t.tags={transaction:r,...t.tags})}}(t,r),function(t,e){t.fingerprint=t.fingerprint?rd(t.fingerprint):[],e&&(t.fingerprint=t.fingerprint.concat(e)),t.fingerprint&&!t.fingerprint.length&&delete t.fingerprint}(t,n),function(t,e){const n=[...t.breadcrumbs||[],...e];t.breadcrumbs=n.length?n:void 0}(t,i),function(t,e,n){t.sdkProcessingMetadata={...t.sdkProcessingMetadata,...e,propagationContext:n}}(t,s,o)}function qd(t,e){const{extra:n,tags:r,user:i,contexts:s,level:o,sdkProcessingMetadata:a,breadcrumbs:c,fingerprint:u,eventProcessors:l,attachments:h,propagationContext:d,transactionName:f,span:p}=e;Kd(t,"extra",n),Kd(t,"tags",r),Kd(t,"user",i),Kd(t,"contexts",s),Kd(t,"sdkProcessingMetadata",a),o&&(t.level=o),f&&(t.transactionName=f),p&&(t.span=p),c.length&&(t.breadcrumbs=[...t.breadcrumbs,...c]),u.length&&(t.fingerprint=[...t.fingerprint,...u]),l.length&&(t.eventProcessors=[...t.eventProcessors,...l]),h.length&&(t.attachments=[...t.attachments,...h]),t.propagationContext={...t.propagationContext,...d}}function Kd(t,e,n){n&&Object.keys(n).length&&(t[e]={...t[e],...n})}let Hd;class zd{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext=Wd()}static clone(t){return t?t.clone():new zd}clone(){const t=new zd;return t._breadcrumbs=[...this._breadcrumbs],t._tags={...this._tags},t._extra={...this._extra},t._contexts={...this._contexts},t._user=this._user,t._level=this._level,t._span=this._span,t._session=this._session,t._transactionName=this._transactionName,t._fingerprint=this._fingerprint,t._eventProcessors=[...this._eventProcessors],t._requestSession=this._requestSession,t._attachments=[...this._attachments],t._sdkProcessingMetadata={...this._sdkProcessingMetadata},t._propagationContext={...this._propagationContext},t._client=this._client,t}setClient(t){this._client=t}getClient(){return this._client}addScopeListener(t){this._scopeListeners.push(t)}addEventProcessor(t){return this._eventProcessors.push(t),this}setUser(t){return this._user=t||{},this._session&&vd(this._session,{user:t}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(t){return this._requestSession=t,this}setTags(t){return this._tags={...this._tags,...t},this._notifyScopeListeners(),this}setTag(t,e){return this._tags={...this._tags,[t]:e},this._notifyScopeListeners(),this}setExtras(t){return this._extra={...this._extra,...t},this._notifyScopeListeners(),this}setExtra(t,e){return this._extra={...this._extra,[t]:e},this._notifyScopeListeners(),this}setFingerprint(t){return this._fingerprint=t,this._notifyScopeListeners(),this}setLevel(t){return this._level=t,this._notifyScopeListeners(),this}setTransactionName(t){return this._transactionName=t,this._notifyScopeListeners(),this}setContext(t,e){return null===e?delete this._contexts[t]:this._contexts[t]=e,this._notifyScopeListeners(),this}setSpan(t){return this._span=t,this._notifyScopeListeners(),this}getSpan(){return this._span}getTransaction(){const t=this._span;return t&&t.transaction}setSession(t){return t?this._session=t:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(t){if(!t)return this;if("function"==typeof t){const e=t(this);return e instanceof zd?e:this}return t instanceof zd?(this._tags={...this._tags,...t._tags},this._extra={...this._extra,...t._extra},this._contexts={...this._contexts,...t._contexts},t._user&&Object.keys(t._user).length&&(this._user=t._user),t._level&&(this._level=t._level),t._fingerprint&&(this._fingerprint=t._fingerprint),t._requestSession&&(this._requestSession=t._requestSession),t._propagationContext&&(this._propagationContext=t._propagationContext)):Rh(t)&&(this._tags={...this._tags,...t.tags},this._extra={...this._extra,...t.extra},this._contexts={...this._contexts,...t.contexts},t.user&&(this._user=t.user),t.level&&(this._level=t.level),t.fingerprint&&(this._fingerprint=t.fingerprint),t.requestSession&&(this._requestSession=t.requestSession),t.propagationContext&&(this._propagationContext=t.propagationContext)),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._span=void 0,this._session=void 0,this._notifyScopeListeners(),this._attachments=[],this._propagationContext=Wd(),this}addBreadcrumb(t,e){const n="number"==typeof e?e:100;if(n<=0)return this;const r={timestamp:fd(),...t},i=this._breadcrumbs;return i.push(r),this._breadcrumbs=i.length>n?i.slice(-n):i,this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(t){return this._attachments.push(t),this}getAttachments(){return this.getScopeData().attachments}clearAttachments(){return this._attachments=[],this}getScopeData(){const{_breadcrumbs:t,_attachments:e,_contexts:n,_tags:r,_extra:i,_user:s,_level:o,_fingerprint:a,_eventProcessors:c,_propagationContext:u,_sdkProcessingMetadata:l,_transactionName:h,_span:d}=this;return{breadcrumbs:t,attachments:e,contexts:n,tags:r,extra:i,user:s,level:o,fingerprint:a||[],eventProcessors:c,propagationContext:u,sdkProcessingMetadata:l,transactionName:h,span:d}}applyToEvent(t,e={},n=[]){return Gd(t,this.getScopeData()),hd([...n,...ud(),...this._eventProcessors],t,e)}setSDKProcessingMetadata(t){return this._sdkProcessingMetadata={...this._sdkProcessingMetadata,...t},this}setPropagationContext(t){return this._propagationContext=t,this}getPropagationContext(){return this._propagationContext}captureException(t,e){const n=e&&e.event_id?e.event_id:Xh();if(!this._client)return bh.warn("No client configured on scope - will not capture exception!"),n;const r=new Error("Sentry syntheticException");return this._client.captureException(t,{originalException:t,syntheticException:r,...e,event_id:n},this),n}captureMessage(t,e,n){const r=n&&n.event_id?n.event_id:Xh();if(!this._client)return bh.warn("No client configured on scope - will not capture message!"),r;const i=new Error(t);return this._client.captureMessage(t,e,{originalException:t,syntheticException:i,...n,event_id:r},this),r}captureEvent(t,e){const n=e&&e.event_id?e.event_id:Xh();return this._client?(this._client.captureEvent(t,{...e,event_id:n},this),n):(bh.warn("No client configured on scope - will not capture event!"),n)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach((t=>{t(this)})),this._notifyingListeners=!1)}}function Wd(){return{traceId:Xh(),spanId:Xh().substring(16)}}const Yd="7.93.0",Jd=parseFloat(Yd),Xd=100;class Qd{constructor(t,e,n,r=Jd){let i,s;this._version=r,e?i=e:(i=new zd,i.setClient(t)),n?s=n:(s=new zd,s.setClient(t)),this._stack=[{scope:i}],t&&this.bindClient(t),this._isolationScope=s}isOlderThan(t){return this._version<t}bindClient(t){const e=this.getStackTop();e.client=t,e.scope.setClient(t),t&&t.setupIntegrations&&t.setupIntegrations()}pushScope(){const t=this.getScope().clone();return this.getStack().push({client:this.getClient(),scope:t}),t}popScope(){return!(this.getStack().length<=1||!this.getStack().pop())}withScope(t){const e=this.pushScope();let n;try{n=t(e)}catch(t){throw this.popScope(),t}return xh(n)?n.then((t=>(this.popScope(),t)),(t=>{throw this.popScope(),t})):(this.popScope(),n)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStack(){return this._stack}getStackTop(){return this._stack[this._stack.length-1]}captureException(t,e){const n=this._lastEventId=e&&e.event_id?e.event_id:Xh(),r=new Error("Sentry syntheticException");return this.getScope().captureException(t,{originalException:t,syntheticException:r,...e,event_id:n}),n}captureMessage(t,e,n){const r=this._lastEventId=n&&n.event_id?n.event_id:Xh(),i=new Error(t);return this.getScope().captureMessage(t,e,{originalException:t,syntheticException:i,...n,event_id:r}),r}captureEvent(t,e){const n=e&&e.event_id?e.event_id:Xh();return t.type||(this._lastEventId=n),this.getScope().captureEvent(t,{...e,event_id:n}),n}lastEventId(){return this._lastEventId}addBreadcrumb(t,e){const{scope:n,client:r}=this.getStackTop();if(!r)return;const{beforeBreadcrumb:i=null,maxBreadcrumbs:s=Xd}=r.getOptions&&r.getOptions()||{};if(s<=0)return;const o={timestamp:fd(),...t},a=i?wh((()=>i(o,e))):o;null!==a&&(r.emit&&r.emit("beforeAddBreadcrumb",a,e),n.addBreadcrumb(a,s))}setUser(t){this.getScope().setUser(t)}setTags(t){this.getScope().setTags(t)}setExtras(t){this.getScope().setExtras(t)}setTag(t,e){this.getScope().setTag(t,e)}setExtra(t,e){this.getScope().setExtra(t,e)}setContext(t,e){this.getScope().setContext(t,e)}configureScope(t){const{scope:e,client:n}=this.getStackTop();n&&t(e)}run(t){const e=tf(this);try{t(this)}finally{tf(e)}}getIntegration(t){const e=this.getClient();if(!e)return null;try{return e.getIntegration(t)}catch(e){return id&&bh.warn(`Cannot retrieve integration ${t.id} from the current Hub`),null}}startTransaction(t,e){const n=this._callExtensionMethod("startTransaction",t,e);return id&&!n&&(this.getClient()?bh.warn("Tracing extension 'startTransaction' has not been added. Call 'addTracingExtensions' before calling 'init':\nSentry.addTracingExtensions();\nSentry.init({...});\n"):bh.warn("Tracing extension 'startTransaction' is missing. You should 'init' the SDK before calling 'startTransaction'")),n}traceHeaders(){return this._callExtensionMethod("traceHeaders")}captureSession(t=!1){if(t)return this.endSession();this._sendSessionUpdate()}endSession(){const t=this.getStackTop().scope,e=t.getSession();e&&_d(e),this._sendSessionUpdate(),t.setSession()}startSession(t){const{scope:e,client:n}=this.getStackTop(),{release:r,environment:i=md}=n&&n.getOptions()||{},{userAgent:s}=gh.navigator||{},o=yd({release:r,environment:i,user:e.getUser(),...s&&{userAgent:s},...t}),a=e.getSession&&e.getSession();return a&&"ok"===a.status&&vd(a,{status:"exited"}),this.endSession(),e.setSession(o),o}shouldSendDefaultPii(){const t=this.getClient(),e=t&&t.getOptions();return Boolean(e&&e.sendDefaultPii)}_sendSessionUpdate(){const{scope:t,client:e}=this.getStackTop(),n=t.getSession();n&&e&&e.captureSession&&e.captureSession(n)}_withClient(t){const{scope:e,client:n}=this.getStackTop();n&&t(n,e)}_callExtensionMethod(t,...e){const n=Zd().__SENTRY__;if(n&&n.extensions&&"function"==typeof n.extensions[t])return n.extensions[t].apply(this,e);id&&bh.warn(`Extension method ${t} couldn't be found, doing nothing.`)}}function Zd(){return gh.__SENTRY__=gh.__SENTRY__||{extensions:{},hub:void 0},gh}function tf(t){const e=Zd(),n=rf(e);return sf(e,t),n}function ef(){const t=Zd();if(t.__SENTRY__&&t.__SENTRY__.acs){const e=t.__SENTRY__.acs.getCurrentHub();if(e)return e}return function(t=Zd()){return e=t,!!(e&&e.__SENTRY__&&e.__SENTRY__.hub)&&!rf(t).isOlderThan(Jd)||sf(t,new Qd),rf(t);var e}(t)}function nf(){return ef().getIsolationScope()}function rf(t){return yh("hub",(()=>new Qd),t)}function sf(t,e){return!!t&&((t.__SENTRY__=t.__SENTRY__||{}).hub=e,!0)}const of=[];function af(t){const e=t.defaultIntegrations||[],n=t.integrations;let r;e.forEach((t=>{t.isDefaultInstance=!0})),r=Array.isArray(n)?[...e,...n]:"function"==typeof n?rd(n(e)):e;const i=function(t){const e={};return t.forEach((t=>{const{name:n}=t,r=e[n];r&&!r.isDefaultInstance&&t.isDefaultInstance||(e[n]=t)})),Object.keys(e).map((t=>e[t]))}(r),s=function(t,e){for(let e=0;e<t.length;e++)if(!0==("Debug"===t[e].name))return e;return-1}(i);if(-1!==s){const[t]=i.splice(s,1);i.push(t)}return i}function cf(t,e,n){if(n[e.name])id&&bh.log(`Integration skipped because it was already installed: ${e.name}`);else{if(n[e.name]=e,-1===of.indexOf(e.name)&&(e.setupOnce(ld,ef),of.push(e.name)),e.setup&&"function"==typeof e.setup&&e.setup(t),t.on&&"function"==typeof e.preprocessEvent){const n=e.preprocessEvent.bind(e);t.on("preprocessEvent",((e,r)=>n(e,r,t)))}if(t.addEventProcessor&&"function"==typeof e.processEvent){const n=e.processEvent.bind(e),r=Object.assign(((e,r)=>n(e,r,t)),{id:e.name});t.addEventProcessor(r)}id&&bh.log(`Integration installed: ${e.name}`)}}function uf(t,e){return Object.assign((function(...t){return{setupOnce:()=>{},...e(...t)}}),{id:t})}const lf=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/],hf=[/^.*\/healthcheck$/,/^.*\/healthy$/,/^.*\/live$/,/^.*\/ready$/,/^.*\/heartbeat$/,/^.*\/health$/,/^.*\/healthz$/],df="InboundFilters",ff=uf(df,(t=>({name:df,processEvent(e,n,r){const i=r.getOptions(),s=function(t={},e={}){return{allowUrls:[...t.allowUrls||[],...e.allowUrls||[]],denyUrls:[...t.denyUrls||[],...e.denyUrls||[]],ignoreErrors:[...t.ignoreErrors||[],...e.ignoreErrors||[],...t.disableErrorDefaults?[]:lf],ignoreTransactions:[...t.ignoreTransactions||[],...e.ignoreTransactions||[],...t.disableTransactionDefaults?[]:hf],ignoreInternal:void 0===t.ignoreInternal||t.ignoreInternal}}(t,i);return function(t,e){return e.ignoreInternal&&function(t){try{return"SentryError"===t.exception.values[0].type}catch(t){}return!1}(t)?(id&&bh.warn(`Event dropped due to being internal Sentry Error.\nEvent: ${Zh(t)}`),!0):function(t,e){return!(t.type||!e||!e.length)&&function(t){const e=[];let n;t.message&&e.push(t.message);try{n=t.exception.values[t.exception.values.length-1]}catch(t){}return n&&n.value&&(e.push(n.value),n.type&&e.push(`${n.type}: ${n.value}`)),id&&0===e.length&&bh.error(`Could not extract message for event ${Zh(t)}`),e}(t).some((t=>Bh(t,e)))}(t,e.ignoreErrors)?(id&&bh.warn(`Event dropped due to being matched by \`ignoreErrors\` option.\nEvent: ${Zh(t)}`),!0):function(t,e){if("transaction"!==t.type||!e||!e.length)return!1;const n=t.transaction;return!!n&&Bh(n,e)}(t,e.ignoreTransactions)?(id&&bh.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.\nEvent: ${Zh(t)}`),!0):function(t,e){if(!e||!e.length)return!1;const n=pf(t);return!!n&&Bh(n,e)}(t,e.denyUrls)?(id&&bh.warn(`Event dropped due to being matched by \`denyUrls\` option.\nEvent: ${Zh(t)}.\nUrl: ${pf(t)}`),!0):!function(t,e){if(!e||!e.length)return!0;const n=pf(t);return!n||Bh(n,e)}(t,e.allowUrls)&&(id&&bh.warn(`Event dropped due to not being matched by \`allowUrls\` option.\nEvent: ${Zh(t)}.\nUrl: ${pf(t)}`),!0)}(e,s)?null:e}})));function pf(t){try{let e;try{e=t.exception.values[0].stacktrace.frames}catch(t){}return e?function(t=[]){for(let e=t.length-1;e>=0;e--){const n=t[e];if(n&&"<anonymous>"!==n.filename&&"[native code]"!==n.filename)return n.filename||null}return null}(e):null}catch(e){return id&&bh.error(`Cannot extract url for event ${Zh(t)}`),null}}let gf;const mf="FunctionToString",yf=uf(mf,(()=>({name:mf,setupOnce(){gf=Function.prototype.toString;try{Function.prototype.toString=function(...t){const e=Kh(this)||this;return gf.apply(e,t)}}catch(t){}}}))),vf=mh();function _f(){if(!("fetch"in vf))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch(t){return!1}}function wf(t){return t&&/^function fetch\(\)\s+\{\s+\[native code\]\s+\}$/.test(t.toString())}const bf=mh(),Ef={},Sf={};function Tf(t,e){Ef[t]=Ef[t]||[],Ef[t].push(e)}function If(t,e){Sf[t]||(e(),Sf[t]=!0)}function Of(t,e){const n=t&&Ef[t];if(n)for(const r of n)try{r(e)}catch(e){fh&&bh.error(`Error while triggering instrumentation handler.\nType: ${t}\nName: ${Td(r)}\nError:`,e)}}const kf=gh;let Cf;function Af(t){const e="history";Tf(e,t),If(e,Rf)}function Rf(){if(!function(){const t=bf.chrome,e=t&&t.app&&t.app.runtime,n="history"in bf&&!!bf.history.pushState&&!!bf.history.replaceState;return!e&&n}())return;const t=kf.onpopstate;function e(t){return function(...e){const n=e.length>2?e[2]:void 0;if(n){const t=Cf,e=String(n);Cf=e,Of("history",{from:t,to:e})}return t.apply(this,e)}}kf.onpopstate=function(...e){const n=kf.location.href,r=Cf;if(Cf=n,Of("history",{from:r,to:n}),t)try{return t.apply(this,e)}catch(t){}},Vh(kf.history,"pushState",e),Vh(kf.history,"replaceState",e)}const Nf=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function xf(t,e=!1){const{host:n,path:r,pass:i,port:s,projectId:o,protocol:a,publicKey:c}=t;return`${a}://${c}${e&&i?`:${i}`:""}@${n}${s?`:${s}`:""}/${r?`${r}/`:r}${o}`}function Df(t){return{protocol:t.protocol,publicKey:t.publicKey||"",pass:t.pass||"",host:t.host,port:t.port||"",path:t.path||"",projectId:t.projectId}}function Pf(t,e=[]){return[t,e]}function Lf(t,e){const[n,r]=t;return[n,[...r,e]]}function jf(t,e){const n=t[1];for(const t of n)if(e(t,t[0].type))return!0;return!1}function Uf(t,e){return(e||new TextEncoder).encode(t)}function Mf(t,e){const[n,r]=t;let i=JSON.stringify(n);function s(t){"string"==typeof i?i="string"==typeof t?i+t:[Uf(i,e),t]:i.push("string"==typeof t?Uf(t,e):t)}for(const t of r){const[e,n]=t;if(s(`\n${JSON.stringify(e)}\n`),"string"==typeof n||n instanceof Uint8Array)s(n);else{let t;try{t=JSON.stringify(n)}catch(e){t=JSON.stringify(Id(n))}s(t)}}return"string"==typeof i?i:function(t){const e=t.reduce(((t,e)=>t+e.length),0),n=new Uint8Array(e);let r=0;for(const e of t)n.set(e,r),r+=e.length;return n}(i)}function Ff(t,e){const n="string"==typeof t.data?Uf(t.data,e):t.data;return[Yh({type:"attachment",length:n.length,filename:t.filename,content_type:t.contentType,attachment_type:t.attachmentType}),n]}const $f={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",statsd:"unknown"};function Bf(t){return $f[t]}function Vf(t){if(!t||!t.sdk)return;const{name:e,version:n}=t.sdk;return{name:e,version:n}}class Gf extends Error{constructor(t,e="warn"){super(t),this.message=t,this.name=new.target.prototype.constructor.name,Object.setPrototypeOf(this,new.target.prototype),this.logLevel=e}}const qf="7";function Kf(t,e={}){const n="string"==typeof e?e:e.tunnel,r="string"!=typeof e&&e._metadata?e._metadata.sdk:void 0;return n||`${function(t){return`${function(t){const e=t.protocol?`${t.protocol}:`:"",n=t.port?`:${t.port}`:"";return`${e}//${t.host}${n}${t.path?`/${t.path}`:""}/api/`}(t)}${t.projectId}/envelope/`}(t)}?${function(t,e){return n={sentry_key:t.publicKey,sentry_version:qf,...e&&{sentry_client:`${e.name}/${e.version}`}},Object.keys(n).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(n[t])}`)).join("&");var n}(t,r)}`}const Hf="Not capturing exception because it's already been captured.";class zf{constructor(t){if(this._options=t,this._integrations={},this._integrationsInitialized=!1,this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],t.dsn?this._dsn=function(t){const e="string"==typeof t?function(t){const e=Nf.exec(t);if(!e)return void wh((()=>{console.error(`Invalid Sentry Dsn: ${t}`)}));const[n,r,i="",s,o="",a]=e.slice(1);let c="",u=a;const l=u.split("/");if(l.length>1&&(c=l.slice(0,-1).join("/"),u=l.pop()),u){const t=u.match(/^\d+/);t&&(u=t[0])}return Df({host:s,pass:i,path:c,projectId:u,port:o,protocol:n,publicKey:r})}(t):Df(t);if(e&&function(t){if(!fh)return!0;const{port:e,projectId:n,protocol:r}=t;return!(["protocol","publicKey","host","projectId"].find((e=>!t[e]&&(bh.error(`Invalid Sentry Dsn: ${e} missing`),!0)))||(n.match(/^\d+$/)?function(t){return"http"===t||"https"===t}(r)?e&&isNaN(parseInt(e,10))&&(bh.error(`Invalid Sentry Dsn: Invalid port ${e}`),1):(bh.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),1):(bh.error(`Invalid Sentry Dsn: Invalid projectId ${n}`),1)))}(e))return e}(t.dsn):id&&bh.warn("No DSN provided, client will not send events."),this._dsn){const e=Kf(this._dsn,t);this._transport=t.transport({recordDroppedEvent:this.recordDroppedEvent.bind(this),...t.transportOptions,url:e})}}captureException(t,e,n){if(nd(t))return void(id&&bh.log(Hf));let r=e&&e.event_id;return this._process(this.eventFromException(t,e).then((t=>this._captureEvent(t,e,n))).then((t=>{r=t}))),r}captureMessage(t,e,n,r){let i=n&&n.event_id;const s=Ch(t)?t:String(t),o=Ah(t)?this.eventFromMessage(s,e,n):this.eventFromException(t,n);return this._process(o.then((t=>this._captureEvent(t,n,r))).then((t=>{i=t}))),i}captureEvent(t,e,n){if(e&&e.originalException&&nd(e.originalException))return void(id&&bh.log(Hf));let r=e&&e.event_id;return this._process(this._captureEvent(t,e,n).then((t=>{r=t}))),r}captureSession(t){"string"!=typeof t.release?id&&bh.warn("Discarded session because of missing or non-string release"):(this.sendSession(t),vd(t,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(t){const e=this._transport;return e?(this.metricsAggregator&&this.metricsAggregator.flush(),this._isClientDoneProcessing(t).then((n=>e.flush(t).then((t=>n&&t))))):od(!0)}close(t){return this.flush(t).then((t=>(this.getOptions().enabled=!1,this.metricsAggregator&&this.metricsAggregator.close(),t)))}getEventProcessors(){return this._eventProcessors}addEventProcessor(t){this._eventProcessors.push(t)}setupIntegrations(t){(t&&!this._integrationsInitialized||this._isEnabled()&&!this._integrationsInitialized)&&(this._integrations=function(t,e){const n={};return e.forEach((e=>{e&&cf(t,e,n)})),n}(this,this._options.integrations),this._integrationsInitialized=!0)}getIntegrationById(t){return this._integrations[t]}getIntegration(t){try{return this._integrations[t.id]||null}catch(e){return id&&bh.warn(`Cannot retrieve integration ${t.id} from the current Client`),null}}addIntegration(t){cf(this,t,this._integrations)}sendEvent(t,e={}){this.emit("beforeSendEvent",t,e);let n=function(t,e,n,r){const i=Vf(n),s=t.type&&"replay_event"!==t.type?t.type:"event";!function(t,e){e&&(t.sdk=t.sdk||{},t.sdk.name=t.sdk.name||e.name,t.sdk.version=t.sdk.version||e.version,t.sdk.integrations=[...t.sdk.integrations||[],...e.integrations||[]],t.sdk.packages=[...t.sdk.packages||[],...e.packages||[]])}(t,n&&n.sdk);const o=function(t,e,n,r){const i=t.sdkProcessingMetadata&&t.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:t.event_id,sent_at:(new Date).toISOString(),...e&&{sdk:e},...!!n&&r&&{dsn:xf(r)},...i&&{trace:Yh({...i})}}}(t,i,r,e);return delete t.sdkProcessingMetadata,Pf(o,[[{type:s},t]])}(t,this._dsn,this._options._metadata,this._options.tunnel);for(const t of e.attachments||[])n=Lf(n,Ff(t,this._options.transportOptions&&this._options.transportOptions.textEncoder));const r=this._sendEnvelope(n);r&&r.then((e=>this.emit("afterSendEvent",t,e)),null)}sendSession(t){const e=function(t,e,n,r){const i=Vf(n);return Pf({sent_at:(new Date).toISOString(),...i&&{sdk:i},...!!r&&e&&{dsn:xf(e)}},["aggregates"in t?[{type:"sessions"},t]:[{type:"session"},t.toJSON()]])}(t,this._dsn,this._options._metadata,this._options.tunnel);this._sendEnvelope(e)}recordDroppedEvent(t,e,n){if(this._options.sendClientReports){const n=`${t}:${e}`;id&&bh.log(`Adding outcome: "${n}"`),this._outcomes[n]=this._outcomes[n]+1||1}}captureAggregateMetrics(t){id&&bh.log(`Flushing aggregated metrics, number of metrics: ${t.length}`);const e=function(t,e,n,r){const i={sent_at:(new Date).toISOString()};n&&n.sdk&&(i.sdk={name:n.sdk.name,version:n.sdk.version}),r&&e&&(i.dsn=xf(e));const s=function(t){const e=function(t){let e="";for(const n of t){const t=Object.entries(n.tags),r=t.length>0?`|#${t.map((([t,e])=>`${t}:${e}`)).join(",")}`:"";e+=`${n.name}@${n.unit}:${n.metric}|${n.metricType}${r}|T${n.timestamp}\n`}return e}(t);return[{type:"statsd",length:e.length},e]}(t);return Pf(i,[s])}(t,this._dsn,this._options._metadata,this._options.tunnel);this._sendEnvelope(e)}on(t,e){this._hooks[t]||(this._hooks[t]=[]),this._hooks[t].push(e)}emit(t,...e){this._hooks[t]&&this._hooks[t].forEach((t=>t(...e)))}_updateSessionFromEvent(t,e){let n=!1,r=!1;const i=e.exception&&e.exception.values;if(i){r=!0;for(const t of i){const e=t.mechanism;if(e&&!1===e.handled){n=!0;break}}}const s="ok"===t.status;(s&&0===t.errors||s&&n)&&(vd(t,{...n&&{status:"crashed"},errors:t.errors||Number(r||n)}),this.captureSession(t))}_isClientDoneProcessing(t){return new cd((e=>{let n=0;const r=setInterval((()=>{0==this._numProcessing?(clearInterval(r),e(!0)):(n+=1,t&&n>=t&&(clearInterval(r),e(!1)))}),1)}))}_isEnabled(){return!1!==this.getOptions().enabled&&void 0!==this._transport}_prepareEvent(t,e,n,r=nf()){const i=this.getOptions(),s=Object.keys(this._integrations);return!e.integrations&&s.length>0&&(e.integrations=s),this.emit("preprocessEvent",t,e),function(t,e,n,r,i,s){const{normalizeDepth:o=3,normalizeMaxBreadth:a=1e3}=t,c={...e,event_id:e.event_id||n.event_id||Xh(),timestamp:e.timestamp||fd()},u=n.integrations||t.integrations.map((t=>t.name));!function(t,e){const{environment:n,release:r,dist:i,maxValueLength:s=250}=e;"environment"in t||(t.environment="environment"in e?n:md),void 0===t.release&&void 0!==r&&(t.release=r),void 0===t.dist&&void 0!==i&&(t.dist=i),t.message&&(t.message=Fh(t.message,s));const o=t.exception&&t.exception.values&&t.exception.values[0];o&&o.value&&(o.value=Fh(o.value,s));const a=t.request;a&&a.url&&(a.url=Fh(a.url,s))}(c,t),function(t,e){e.length>0&&(t.sdk=t.sdk||{},t.sdk.integrations=[...t.sdk.integrations||[],...e])}(c,u),void 0===e.type&&function(t,e){const n=gh._sentryDebugIds;if(!n)return;let r;const i=Nd.get(e);i?r=i:(r=new Map,Nd.set(e,r));const s=Object.keys(n).reduce(((t,i)=>{let s;const o=r.get(i);o?s=o:(s=e(i),r.set(i,s));for(let e=s.length-1;e>=0;e--){const r=s[e];if(r.filename){t[r.filename]=n[i];break}}return t}),{});try{t.exception.values.forEach((t=>{t.stacktrace.frames.forEach((t=>{t.filename&&(t.debug_id=s[t.filename])}))}))}catch(t){}}(c,t.stackParser);const l=function(t,e){if(!e)return t;const n=t?t.clone():new zd;return n.update(e),n}(r,n.captureContext);n.mechanism&&ed(c,n.mechanism);const h=i&&i.getEventProcessors?i.getEventProcessors():[],d=(Hd||(Hd=new zd),Hd).getScopeData();s&&qd(d,s.getScopeData()),l&&qd(d,l.getScopeData());const f=[...n.attachments||[],...d.attachments];return f.length&&(n.attachments=f),Gd(c,d),hd([...h,...ud(),...d.eventProcessors],c,n).then((t=>(t&&function(t){const e={};try{t.exception.values.forEach((t=>{t.stacktrace.frames.forEach((t=>{t.debug_id&&(t.abs_path?e[t.abs_path]=t.debug_id:t.filename&&(e[t.filename]=t.debug_id),delete t.debug_id)}))}))}catch(t){}if(0===Object.keys(e).length)return;t.debug_meta=t.debug_meta||{},t.debug_meta.images=t.debug_meta.images||[];const n=t.debug_meta.images;Object.keys(e).forEach((t=>{n.push({type:"sourcemap",code_file:t,debug_id:e[t]})}))}(t),"number"==typeof o&&o>0?function(t,e,n){if(!t)return null;const r={...t,...t.breadcrumbs&&{breadcrumbs:t.breadcrumbs.map((t=>({...t,...t.data&&{data:Id(t.data,e,n)}})))},...t.user&&{user:Id(t.user,e,n)},...t.contexts&&{contexts:Id(t.contexts,e,n)},...t.extra&&{extra:Id(t.extra,e,n)}};return t.contexts&&t.contexts.trace&&r.contexts&&(r.contexts.trace=t.contexts.trace,t.contexts.trace.data&&(r.contexts.trace.data=Id(t.contexts.trace.data,e,n))),t.spans&&(r.spans=t.spans.map((t=>{const r=Rd(t).data;return r&&(t.data=Id(r,e,n)),t}))),r}(t,o,a):t)))}(i,t,e,n,this,r).then((t=>{if(null===t)return t;const{propagationContext:e}=t.sdkProcessingMetadata||{};if((!t.contexts||!t.contexts.trace)&&e){const{traceId:r,spanId:i,parentSpanId:s,dsc:o}=e;t.contexts={trace:{trace_id:r,span_id:i,parent_span_id:s},...t.contexts};const a=o||Bd(r,this,n);t.sdkProcessingMetadata={dynamicSamplingContext:a,...t.sdkProcessingMetadata}}return t}))}_captureEvent(t,e={},n){return this._processEvent(t,e,n).then((t=>t.event_id),(t=>{if(id){const e=t;"log"===e.logLevel?bh.log(e.message):bh.warn(e)}}))}_processEvent(t,e,n){const r=this.getOptions(),{sampleRate:i}=r,s=Yf(t),o=Wf(t),a=t.type||"error",c=`before send for type \`${a}\``;if(o&&"number"==typeof i&&Math.random()>i)return this.recordDroppedEvent("sample_rate","error",t),ad(new Gf(`Discarding event because it's not included in the random sample (sampling rate = ${i})`,"log"));const u="replay_event"===a?"replay":a;return this._prepareEvent(t,e,n).then((n=>{if(null===n)throw this.recordDroppedEvent("event_processor",u,t),new Gf("An event processor returned `null`, will not send event.","log");if(e.data&&!0===e.data.__sentry__)return n;const i=function(t,e,n){const{beforeSend:r,beforeSendTransaction:i}=t;return Wf(e)&&r?r(e,n):Yf(e)&&i?i(e,n):e}(r,n,e);return function(t,e){const n=`${e} must return \`null\` or a valid event.`;if(xh(t))return t.then((t=>{if(!Rh(t)&&null!==t)throw new Gf(n);return t}),(t=>{throw new Gf(`${e} rejected with ${t}`)}));if(!Rh(t)&&null!==t)throw new Gf(n);return t}(i,c)})).then((r=>{if(null===r)throw this.recordDroppedEvent("before_send",u,t),new Gf(`${c} returned \`null\`, will not send event.`,"log");const i=n&&n.getSession();!s&&i&&this._updateSessionFromEvent(i,r);const o=r.transaction_info;if(s&&o&&r.transaction!==t.transaction){const t="custom";r.transaction_info={...o,source:t}}return this.sendEvent(r,e),r})).then(null,(t=>{if(t instanceof Gf)throw t;throw this.captureException(t,{data:{__sentry__:!0},originalException:t}),new Gf(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: ${t}`)}))}_process(t){this._numProcessing++,t.then((t=>(this._numProcessing--,t)),(t=>(this._numProcessing--,t)))}_sendEnvelope(t){if(this.emit("beforeEnvelope",t),this._isEnabled()&&this._transport)return this._transport.send(t).then(null,(t=>{id&&bh.error("Error while sending event:",t)}));id&&bh.error("Transport disabled")}_clearOutcomes(){const t=this._outcomes;return this._outcomes={},Object.keys(t).map((e=>{const[n,r]=e.split(":");return{reason:n,category:r,quantity:t[e]}}))}}function Wf(t){return void 0===t.type}function Yf(t){return"transaction"===t.type}const Jf="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__;function Xf(t,e){const n=Zf(t,e),r={type:e&&e.name,value:ep(e)};return n.length&&(r.stacktrace={frames:n}),void 0===r.type&&""===r.value&&(r.value="Unrecoverable error caught"),r}function Qf(t,e){return{exception:{values:[Xf(t,e)]}}}function Zf(t,e){const n=e.stacktrace||e.stack||"",r=function(t){if(t){if("number"==typeof t.framesToPop)return t.framesToPop;if(tp.test(t.message))return 1}return 0}(e);try{return t(n,r)}catch(t){}return[]}const tp=/Minified React error #\d+;/i;function ep(t){const e=t&&t.message;return e?e.error&&"string"==typeof e.error.message?e.error.message:e:"No error message"}function np(t,e,n,r,i){let s;if(Ih(e)&&e.error)return Qf(t,e.error);if(Oh(e)||Th(e,"DOMException")){const i=e;if("stack"in e)s=Qf(t,e);else{const e=i.name||(Oh(i)?"DOMError":"DOMException"),o=i.message?`${e}: ${i.message}`:e;s=rp(t,o,n,r),td(s,o)}return"code"in i&&(s.tags={...s.tags,"DOMException.code":`${i.code}`}),s}return Sh(e)?Qf(t,e):Rh(e)||Nh(e)?(s=function(t,e,n,r){const i=Ld(),s=i&&i.getOptions().normalizeDepth,o={exception:{values:[{type:Nh(e)?e.constructor.name:r?"UnhandledRejection":"Error",value:ip(e,{isUnhandledRejection:r})}]},extra:{__serialized__:Od(e,s)}};if(n){const e=Zf(t,n);e.length&&(o.exception.values[0].stacktrace={frames:e})}return o}(t,e,n,i),ed(s,{synthetic:!0}),s):(s=rp(t,e,n,r),td(s,`${e}`,void 0),ed(s,{synthetic:!0}),s)}function rp(t,e,n,r){const i={};if(r&&n){const r=Zf(t,n);r.length&&(i.exception={values:[{value:e,stacktrace:{frames:r}}]})}if(Ch(e)){const{__sentry_template_string__:t,__sentry_template_values__:n}=e;return i.logentry={message:t,params:n},i}return i.message=e,i}function ip(t,{isUnhandledRejection:e}){const n=function(t,e=40){const n=Object.keys(Hh(t));if(n.sort(),!n.length)return"[object has no keys]";if(n[0].length>=e)return Fh(n[0],e);for(let t=n.length;t>0;t--){const r=n.slice(0,t).join(", ");if(!(r.length>e))return t===n.length?r:Fh(r,e)}return""}(t),r=e?"promise rejection":"exception";return Ih(t)?`Event \`ErrorEvent\` captured as ${r} with message \`${t.message}\``:Nh(t)?`Event \`${function(t){try{const e=Object.getPrototypeOf(t);return e?e.constructor.name:void 0}catch(t){}}(t)}\` (type=${t.type}) captured as ${r}`:`Object captured as ${r} with keys: ${n}`}const sp=gh;let op=0;function ap(){return op>0}function cp(t,e={},n){if("function"!=typeof t)return t;try{const e=t.__sentry_wrapped__;if(e)return e;if(Kh(t))return t}catch(e){return t}const r=function(){const r=Array.prototype.slice.call(arguments);try{n&&"function"==typeof n&&n.apply(this,arguments);const i=r.map((t=>cp(t,e)));return t.apply(this,i)}catch(t){throw op++,setTimeout((()=>{op--})),function(...t){if(2===t.length){const[e,n]=t;if(!e)return ef().withScope(n);const r=ef();return r.withScope((()=>(r.getStackTop().scope=e,n(e))))}ef().withScope(t[0])}((n=>{var i;n.addEventProcessor((t=>(e.mechanism&&(td(t,void 0,void 0),ed(t,e.mechanism)),t.extra={...t.extra,arguments:r},t))),i=t,ef().captureException(i,function(t){if(t)return function(t){return t instanceof zd||"function"==typeof t}(t)||function(t){return Object.keys(t).some((t=>xd.includes(t)))}(t)?{captureContext:t}:t}(undefined))})),t}};try{for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(r[e]=t[e])}catch(t){}qh(r,t),Gh(t,"__sentry_wrapped__",r);try{Object.getOwnPropertyDescriptor(r,"name").configurable&&Object.defineProperty(r,"name",{get:()=>t.name})}catch(t){}return r}class up extends zf{constructor(t){const e=sp.SENTRY_SDK_SOURCE||"npm";t._metadata=t._metadata||{},t._metadata.sdk=t._metadata.sdk||{name:"sentry.javascript.browser",packages:[{name:`${e}:@sentry/browser`,version:Yd}],version:Yd},super(t),t.sendClientReports&&sp.document&&sp.document.addEventListener("visibilitychange",(()=>{"hidden"===sp.document.visibilityState&&this._flushOutcomes()}))}eventFromException(t,e){return function(t,e,n,r){const i=np(t,e,n&&n.syntheticException||void 0,r);return ed(i),i.level="error",n&&n.event_id&&(i.event_id=n.event_id),od(i)}(this._options.stackParser,t,e,this._options.attachStacktrace)}eventFromMessage(t,e="info",n){return function(t,e,n="info",r,i){const s=rp(t,e,r&&r.syntheticException||void 0,i);return s.level=n,r&&r.event_id&&(s.event_id=r.event_id),od(s)}(this._options.stackParser,t,e,n,this._options.attachStacktrace)}captureUserFeedback(t){if(!this._isEnabled())return void(Jf&&bh.warn("SDK not enabled, will not capture user feedback."));const e=function(t,{metadata:e,tunnel:n,dsn:r}){const i={event_id:t.event_id,sent_at:(new Date).toISOString(),...e&&e.sdk&&{sdk:{name:e.sdk.name,version:e.sdk.version}},...!!n&&!!r&&{dsn:xf(r)}},s=function(t){return[{type:"user_report"},t]}(t);return Pf(i,[s])}(t,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this._sendEnvelope(e)}_prepareEvent(t,e,n){return t.platform=t.platform||"javascript",super._prepareEvent(t,e,n)}_flushOutcomes(){const t=this._clearOutcomes();if(0===t.length)return void(Jf&&bh.log("No outcomes to send"));if(!this._dsn)return void(Jf&&bh.log("No dsn provided, will not send outcomes"));Jf&&bh.log("Sending outcomes:",t);const e=(n=t,Pf((r=this._options.tunnel&&xf(this._dsn))?{dsn:r}:{},[[{type:"client_report"},{timestamp:fd(),discarded_events:n}]]));var n,r;this._sendEnvelope(e)}}let lp=null;function hp(){lp=gh.onerror,gh.onerror=function(t,e,n,r,i){return Of("error",{column:r,error:i,line:n,msg:t,url:e}),!(!lp||lp.__SENTRY_LOADER__)&&lp.apply(this,arguments)},gh.onerror.__SENTRY_INSTRUMENTED__=!0}let dp=null;function fp(){dp=gh.onunhandledrejection,gh.onunhandledrejection=function(t){return Of("unhandledrejection",t),!(dp&&!dp.__SENTRY_LOADER__)||dp.apply(this,arguments)},gh.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}const pp="GlobalHandlers",gp=uf(pp,((t={})=>{const e={onerror:!0,onunhandledrejection:!0,...t};return{name:pp,setupOnce(){Error.stackTraceLimit=50},setup(t){e.onerror&&(function(t){!function(e){const n="error";Tf(n,(e=>{const{stackParser:n,attachStacktrace:r}=vp();if(Ld()!==t||ap())return;const{msg:i,url:s,line:o,column:a,error:c}=e,u=void 0===c&&kh(i)?function(t,e,n,r){const i=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i;let s=Ih(t)?t.message:t,o="Error";const a=s.match(i);a&&(o=a[1],s=a[2]);return mp({exception:{values:[{type:o,value:s}]}},e,n,r)}(i,s,o,a):mp(np(n,c||i,void 0,r,!1),s,o,a);u.level="error",Dd(u,{originalException:c,mechanism:{handled:!1,type:"onerror"}})})),If(n,hp)}()}(t),yp("onerror")),e.onunhandledrejection&&(function(t){!function(e){const n="unhandledrejection";Tf(n,(e=>{const{stackParser:n,attachStacktrace:r}=vp();if(Ld()!==t||ap())return;const i=function(t){if(Ah(t))return t;const e=t;try{if("reason"in e)return e.reason;if("detail"in e&&"reason"in e.detail)return e.detail.reason}catch(t){}return t}(e),s=Ah(i)?{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(i)}`}]}}:np(n,i,void 0,r,!0);s.level="error",Dd(s,{originalException:i,mechanism:{handled:!1,type:"onunhandledrejection"}})})),If(n,fp)}()}(t),yp("onunhandledrejection"))}}}));function mp(t,e,n,r){const i=t.exception=t.exception||{},s=i.values=i.values||[],o=s[0]=s[0]||{},a=o.stacktrace=o.stacktrace||{},c=a.frames=a.frames||[],u=isNaN(parseInt(r,10))?void 0:r,l=isNaN(parseInt(n,10))?void 0:n,h=kh(e)&&e.length>0?e:function(){try{return Lh.document.location.href}catch(t){return""}}();return 0===c.length&&c.push({colno:u,filename:h,function:"?",in_app:!0,lineno:l}),t}function yp(t){Jf&&bh.log(`Global Handler attached: ${t}`)}function vp(){const t=Ld();return t&&t.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}const _p=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],wp="TryCatch",bp=uf(wp,((t={})=>{const e={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...t};return{name:wp,setupOnce(){e.setTimeout&&Vh(sp,"setTimeout",Ep),e.setInterval&&Vh(sp,"setInterval",Ep),e.requestAnimationFrame&&Vh(sp,"requestAnimationFrame",Sp),e.XMLHttpRequest&&"XMLHttpRequest"in sp&&Vh(XMLHttpRequest.prototype,"send",Tp);const t=e.eventTarget;t&&(Array.isArray(t)?t:_p).forEach(Ip)}}}));function Ep(t){return function(...e){const n=e[0];return e[0]=cp(n,{mechanism:{data:{function:Td(t)},handled:!1,type:"instrument"}}),t.apply(this,e)}}function Sp(t){return function(e){return t.apply(this,[cp(e,{mechanism:{data:{function:"requestAnimationFrame",handler:Td(t)},handled:!1,type:"instrument"}})])}}function Tp(t){return function(...e){const n=this;return["onload","onerror","onprogress","onreadystatechange"].forEach((t=>{t in n&&"function"==typeof n[t]&&Vh(n,t,(function(e){const n={mechanism:{data:{function:t,handler:Td(e)},handled:!1,type:"instrument"}},r=Kh(e);return r&&(n.mechanism.data.handler=Td(r)),cp(e,n)}))})),t.apply(this,e)}}function Ip(t){const e=sp,n=e[t]&&e[t].prototype;n&&n.hasOwnProperty&&n.hasOwnProperty("addEventListener")&&(Vh(n,"addEventListener",(function(e){return function(n,r,i){try{"function"==typeof r.handleEvent&&(r.handleEvent=cp(r.handleEvent,{mechanism:{data:{function:"handleEvent",handler:Td(r),target:t},handled:!1,type:"instrument"}}))}catch(t){}return e.apply(this,[n,cp(r,{mechanism:{data:{function:"addEventListener",handler:Td(r),target:t},handled:!1,type:"instrument"}}),i])}})),Vh(n,"removeEventListener",(function(t){return function(e,n,r){const i=n;try{const n=i&&i.__sentry_wrapped__;n&&t.call(this,e,n,r)}catch(t){}return t.call(this,e,i,r)}})))}function Op(){"console"in gh&&vh.forEach((function(t){t in gh.console&&Vh(gh.console,t,(function(e){return _h[t]=e,function(...e){Of("console",{args:e,level:t});const n=_h[t];n&&n.apply(gh.console,e)}}))}))}const kp=gh,Cp=1e3;let Ap,Rp,Np;function xp(){if(!kp.document)return;const t=Of.bind(null,"dom"),e=Dp(t,!0);kp.document.addEventListener("click",e,!1),kp.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach((e=>{const n=kp[e]&&kp[e].prototype;n&&n.hasOwnProperty&&n.hasOwnProperty("addEventListener")&&(Vh(n,"addEventListener",(function(e){return function(n,r,i){if("click"===n||"keypress"==n)try{const r=this,s=r.__sentry_instrumentation_handlers__=r.__sentry_instrumentation_handlers__||{},o=s[n]=s[n]||{refCount:0};if(!o.handler){const r=Dp(t);o.handler=r,e.call(this,n,r,i)}o.refCount++}catch(t){}return e.call(this,n,r,i)}})),Vh(n,"removeEventListener",(function(t){return function(e,n,r){if("click"===e||"keypress"==e)try{const n=this,i=n.__sentry_instrumentation_handlers__||{},s=i[e];s&&(s.refCount--,s.refCount<=0&&(t.call(this,e,s.handler,r),s.handler=void 0,delete i[e]),0===Object.keys(i).length&&delete n.__sentry_instrumentation_handlers__)}catch(t){}return t.call(this,e,n,r)}})))}))}function Dp(t,e=!1){return n=>{if(!n||n._sentryCaptured)return;const r=function(t){try{return t.target}catch(t){return null}}(n);if(function(t,e){return"keypress"===t&&(!e||!e.tagName||"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName&&!e.isContentEditable)}(n.type,r))return;Gh(n,"_sentryCaptured",!0),r&&!r._sentryId&&Gh(r,"_sentryId",Xh());const i="keypress"===n.type?"input":n.type;(function(t){if(t.type!==Rp)return!1;try{if(!t.target||t.target._sentryId!==Np)return!1}catch(t){}return!0})(n)||(t({event:n,name:i,global:e}),Rp=n.type,Np=r?r._sentryId:void 0),clearTimeout(Ap),Ap=kp.setTimeout((()=>{Np=void 0,Rp=void 0}),Cp)}}const Pp=gh,Lp="__sentry_xhr_v3__";function jp(){if(!Pp.XMLHttpRequest)return;const t=XMLHttpRequest.prototype;Vh(t,"open",(function(t){return function(...e){const n=Date.now(),r=kh(e[0])?e[0].toUpperCase():void 0,i=function(t){if(kh(t))return t;try{return t.toString()}catch(t){}}(e[1]);if(!r||!i)return t.apply(this,e);this[Lp]={method:r,url:i,request_headers:{}},"POST"===r&&i.match(/sentry_key/)&&(this.__sentry_own_request__=!0);const s=()=>{const t=this[Lp];if(t&&4===this.readyState){try{t.status_code=this.status}catch(t){}Of("xhr",{args:[r,i],endTimestamp:Date.now(),startTimestamp:n,xhr:this})}};return"onreadystatechange"in this&&"function"==typeof this.onreadystatechange?Vh(this,"onreadystatechange",(function(t){return function(...e){return s(),t.apply(this,e)}})):this.addEventListener("readystatechange",s),Vh(this,"setRequestHeader",(function(t){return function(...e){const[n,r]=e,i=this[Lp];return i&&kh(n)&&kh(r)&&(i.request_headers[n.toLowerCase()]=r),t.apply(this,e)}})),t.apply(this,e)}})),Vh(t,"send",(function(t){return function(...e){const n=this[Lp];return n?(void 0!==e[0]&&(n.body=e[0]),Of("xhr",{args:[n.method,n.url],startTimestamp:Date.now(),xhr:this}),t.apply(this,e)):t.apply(this,e)}}))}function Up(){(function(){if("string"==typeof EdgeRuntime)return!0;if(!_f())return!1;if(wf(vf.fetch))return!0;let t=!1;const e=vf.document;if(e&&"function"==typeof e.createElement)try{const n=e.createElement("iframe");n.hidden=!0,e.head.appendChild(n),n.contentWindow&&n.contentWindow.fetch&&(t=wf(n.contentWindow.fetch)),e.head.removeChild(n)}catch(t){fh&&bh.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",t)}return t})()&&Vh(gh,"fetch",(function(t){return function(...e){const{method:n,url:r}=function(t){if(0===t.length)return{method:"GET",url:""};if(2===t.length){const[e,n]=t;return{url:Fp(e),method:Mp(n,"method")?String(n.method).toUpperCase():"GET"}}const e=t[0];return{url:Fp(e),method:Mp(e,"method")?String(e.method).toUpperCase():"GET"}}(e),i={args:e,fetchData:{method:n,url:r},startTimestamp:Date.now()};return Of("fetch",{...i}),t.apply(gh,e).then((t=>(Of("fetch",{...i,endTimestamp:Date.now(),response:t}),t)),(t=>{throw Of("fetch",{...i,endTimestamp:Date.now(),error:t}),t}))}}))}function Mp(t,e){return!!t&&"object"==typeof t&&!!t[e]}function Fp(t){return"string"==typeof t?t:t?Mp(t,"url")?t.url:t.toString?t.toString():"":""}const $p=["fatal","error","warning","log","info","debug"];function Bp(t){if(!t)return{};const e=t.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};const n=e[6]||"",r=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],search:n,hash:r,relative:e[5]+n+r}}const Vp="Breadcrumbs",Gp=uf(Vp,((t={})=>{const e={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...t};return{name:Vp,setup(t){var n;e.console&&function(t){const e="console";Tf(e,t),If(e,Op)}(function(t){return function(e){if(Ld()!==t)return;const n={category:"console",data:{arguments:e.args,logger:"console"},level:(r=e.level,"warn"===r?"warning":$p.includes(r)?r:"log"),message:$h(e.args," ")};var r;if("assert"===e.level){if(!1!==e.args[0])return;n.message=`Assertion failed: ${$h(e.args.slice(1)," ")||"console.assert"}`,n.data.arguments=e.args.slice(1)}Pd(n,{input:e.args,level:e.level})}}(t)),e.dom&&(n=function(t,e){return function(n){if(Ld()!==t)return;let r,i,s="object"==typeof e?e.serializeAttribute:void 0,o="object"==typeof e&&"number"==typeof e.maxStringLength?e.maxStringLength:void 0;o&&o>1024&&(Jf&&bh.warn(`\`dom.maxStringLength\` cannot exceed 1024, but a value of ${o} was configured. Sentry will use 1024 instead.`),o=1024),"string"==typeof s&&(s=[s]);try{const t=n.event,e=function(t){return!!t&&!!t.target}(t)?t.target:t;r=Uh(e,{keyAttrs:s,maxStringLength:o}),i=function(t){if(!Lh.HTMLElement)return null;let e=t;for(let t=0;t<5;t++){if(!e)return null;if(e instanceof HTMLElement&&e.dataset.sentryComponent)return e.dataset.sentryComponent;e=e.parentNode}return null}(e)}catch(t){r="<unknown>"}if(0===r.length)return;const a={category:`ui.${n.name}`,message:r};i&&(a.data={"ui.component_name":i}),Pd(a,{event:n.event,name:n.name,global:n.global})}}(t,e.dom),Tf("dom",n),If("dom",xp)),e.xhr&&function(t){Tf("xhr",t),If("xhr",jp)}(function(t){return function(e){if(Ld()!==t)return;const{startTimestamp:n,endTimestamp:r}=e,i=e.xhr[Lp];if(!n||!r||!i)return;const{method:s,url:o,status_code:a,body:c}=i;Pd({category:"xhr",data:{method:s,url:o,status_code:a},type:"http"},{xhr:e.xhr,input:c,startTimestamp:n,endTimestamp:r})}}(t)),e.fetch&&function(t){const e="fetch";Tf(e,t),If(e,Up)}(function(t){return function(e){if(Ld()!==t)return;const{startTimestamp:n,endTimestamp:r}=e;if(r&&(!e.fetchData.url.match(/sentry_key/)||"POST"!==e.fetchData.method))if(e.error)Pd({category:"fetch",data:e.fetchData,level:"error",type:"http"},{data:e.error,input:e.args,startTimestamp:n,endTimestamp:r});else{const t=e.response;Pd({category:"fetch",data:{...e.fetchData,status_code:t&&t.status},type:"http"},{input:e.args,response:t,startTimestamp:n,endTimestamp:r})}}}(t)),e.history&&Af(function(t){return function(e){if(Ld()!==t)return;let n=e.from,r=e.to;const i=Bp(sp.location.href);let s=n?Bp(n):void 0;const o=Bp(r);s&&s.path||(s=i),i.protocol===o.protocol&&i.host===o.host&&(r=o.relative),i.protocol===s.protocol&&i.host===s.host&&(n=s.relative),Pd({category:"navigation",data:{from:n,to:r}})}}(t)),e.sentry&&t.on&&t.on("beforeSendEvent",function(t){return function(e){Ld()===t&&Pd({category:"sentry."+("transaction"===e.type?"transaction":"event"),event_id:e.event_id,level:e.level,message:Zh(e)},{event:e})}}(t))}}}));function qp(t,e,n=250,r,i,s,o){if(!(s.exception&&s.exception.values&&o&&Dh(o.originalException,Error)))return;const a=s.exception.values.length>0?s.exception.values[s.exception.values.length-1]:void 0;var c,u;a&&(s.exception.values=(c=Kp(t,e,i,o.originalException,r,s.exception.values,a,0),u=n,c.map((t=>(t.value&&(t.value=Fh(t.value,u)),t)))))}function Kp(t,e,n,r,i,s,o,a){if(s.length>=n+1)return s;let c=[...s];if(Dh(r[i],Error)){Hp(o,a);const s=t(e,r[i]),u=c.length;zp(s,i,u,a),c=Kp(t,e,n,r[i],i,[s,...c],s,u)}return Array.isArray(r.errors)&&r.errors.forEach(((r,s)=>{if(Dh(r,Error)){Hp(o,a);const u=t(e,r),l=c.length;zp(u,`errors[${s}]`,l,a),c=Kp(t,e,n,r,i,[u,...c],u,l)}})),c}function Hp(t,e){t.mechanism=t.mechanism||{type:"generic",handled:!0},t.mechanism={...t.mechanism,is_exception_group:!0,exception_id:e}}function zp(t,e,n,r){t.mechanism=t.mechanism||{type:"generic",handled:!0},t.mechanism={...t.mechanism,type:"chained",source:e,exception_id:n,parent_id:r}}const Wp="LinkedErrors",Yp=uf(Wp,((t={})=>{const e=t.limit||5,n=t.key||"cause";return{name:Wp,preprocessEvent(t,r,i){const s=i.getOptions();qp(Xf,s.stackParser,s.maxValueLength,n,e,t,r)}}})),Jp="HttpContext",Xp=uf(Jp,(()=>({name:Jp,preprocessEvent(t){if(!sp.navigator&&!sp.location&&!sp.document)return;const e=t.request&&t.request.url||sp.location&&sp.location.href,{referrer:n}=sp.document||{},{userAgent:r}=sp.navigator||{},i={...t.request&&t.request.headers,...n&&{Referer:n},...r&&{"User-Agent":r}},s={...t.request,...e&&{url:e},headers:i};t.request=s}}))),Qp="Dedupe",Zp=uf(Qp,(()=>{let t;return{name:Qp,processEvent(e){if(e.type)return e;try{if(function(t,e){return!!e&&(!!function(t,e){const n=t.message,r=e.message;return!(!n&&!r)&&(!(n&&!r||!n&&r)&&(n===r&&(!!eg(t,e)&&!!tg(t,e))))}(t,e)||!!function(t,e){const n=ng(e),r=ng(t);return!(!n||!r)&&(n.type===r.type&&n.value===r.value&&(!!eg(t,e)&&!!tg(t,e)))}(t,e))}(e,t))return Jf&&bh.warn("Event dropped due to being a duplicate of previously captured event."),null}catch(t){}return t=e}}}));function tg(t,e){let n=rg(t),r=rg(e);if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;if(r.length!==n.length)return!1;for(let t=0;t<r.length;t++){const e=r[t],i=n[t];if(e.filename!==i.filename||e.lineno!==i.lineno||e.colno!==i.colno||e.function!==i.function)return!1}return!0}function eg(t,e){let n=t.fingerprint,r=e.fingerprint;if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;try{return!(n.join("")!==r.join(""))}catch(t){return!1}}function ng(t){return t.exception&&t.exception.values&&t.exception.values[0]}function rg(t){const e=t.exception;if(e)try{return e.values[0].stacktrace.frames}catch(t){return}}const ig="?";function sg(t,e,n,r){const i={filename:t,function:e,in_app:!0};return void 0!==n&&(i.lineno=n),void 0!==r&&(i.colno=r),i}const og=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,ag=/\((\S*)(?::(\d+))(?::(\d+))\)/,cg=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,ug=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,lg=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:[-a-z]+):.*?):(\d+)(?::(\d+))?\)?\s*$/i,hg=Ed([30,t=>{const e=og.exec(t);if(e){if(e[2]&&0===e[2].indexOf("eval")){const t=ag.exec(e[2]);t&&(e[2]=t[1],e[3]=t[2],e[4]=t[3])}const[t,n]=dg(e[1]||ig,e[2]);return sg(n,t,e[3]?+e[3]:void 0,e[4]?+e[4]:void 0)}}],[50,t=>{const e=cg.exec(t);if(e){if(e[3]&&e[3].indexOf(" > eval")>-1){const t=ug.exec(e[3]);t&&(e[1]=e[1]||"eval",e[3]=t[1],e[4]=t[2],e[5]="")}let t=e[3],n=e[1]||ig;return[n,t]=dg(n,t),sg(t,n,e[4]?+e[4]:void 0,e[5]?+e[5]:void 0)}}],[40,t=>{const e=lg.exec(t);return e?sg(e[2],e[1]||ig,+e[3],e[4]?+e[4]:void 0):void 0}]),dg=(t,e)=>{const n=-1!==t.indexOf("safari-extension"),r=-1!==t.indexOf("safari-web-extension");return n||r?[-1!==t.indexOf("@")?t.split("@")[0]:ig,n?`safari-extension:${e}`:`safari-web-extension:${e}`]:[t,e]};const fg=6e4;const pg=30;function gg(t,e,n=function(t){const e=[];function n(t){return e.splice(e.indexOf(t),1)[0]}return{$:e,add:function(r){if(!(void 0===t||e.length<t))return ad(new Gf("Not adding Promise because buffer limit was reached."));const i=r();return-1===e.indexOf(i)&&e.push(i),i.then((()=>n(i))).then(null,(()=>n(i).then(null,(()=>{})))),i},drain:function(t){return new cd(((n,r)=>{let i=e.length;if(!i)return n(!0);const s=setTimeout((()=>{t&&t>0&&n(!1)}),t);e.forEach((t=>{od(t).then((()=>{--i||(clearTimeout(s),n(!0))}),r)}))}))}}}(t.bufferSize||pg)){let r={};function i(i){const s=[];if(jf(i,((e,n)=>{const i=Bf(n);if(function(t,e,n=Date.now()){return function(t,e){return t[e]||t.all||0}(t,e)>n}(r,i)){const r=mg(e,n);t.recordDroppedEvent("ratelimit_backoff",i,r)}else s.push(e)})),0===s.length)return od();const o=Pf(i[0],s),a=e=>{jf(o,((n,r)=>{const i=mg(n,r);t.recordDroppedEvent(e,Bf(r),i)}))};return n.add((()=>e({body:Mf(o,t.textEncoder)}).then((t=>(void 0!==t.statusCode&&(t.statusCode<200||t.statusCode>=300)&&id&&bh.warn(`Sentry responded with status code ${t.statusCode} to sent event.`),r=function(t,{statusCode:e,headers:n},r=Date.now()){const i={...t},s=n&&n["x-sentry-rate-limits"],o=n&&n["retry-after"];if(s)for(const t of s.trim().split(",")){const[e,n]=t.split(":",2),s=parseInt(e,10),o=1e3*(isNaN(s)?60:s);if(n)for(const t of n.split(";"))i[t]=r+o;else i.all=r+o}else o?i.all=r+function(t,e=Date.now()){const n=parseInt(`${t}`,10);if(!isNaN(n))return 1e3*n;const r=Date.parse(`${t}`);return isNaN(r)?fg:r-e}(o,r):429===e&&(i.all=r+6e4);return i}(r,t),t)),(t=>{throw a("network_error"),t})))).then((t=>t),(t=>{if(t instanceof Gf)return id&&bh.error("Skipped sending event because buffer is full."),a("queue_overflow"),od();throw t}))}return i.__sentry__baseTransport__=!0,{send:i,flush:t=>n.drain(t)}}function mg(t,e){if("event"===e||"transaction"===e)return Array.isArray(t)?t[1]:void 0}let yg;function vg(t,e=function(){if(yg)return yg;if(wf(sp.fetch))return yg=sp.fetch.bind(sp);const t=sp.document;let e=sp.fetch;if(t&&"function"==typeof t.createElement)try{const n=t.createElement("iframe");n.hidden=!0,t.head.appendChild(n);const r=n.contentWindow;r&&r.fetch&&(e=r.fetch),t.head.removeChild(n)}catch(t){Jf&&bh.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",t)}return yg=e.bind(sp)}()){let n=0,r=0;return gg(t,(function(i){const s=i.body.length;n+=s,r++;const o={body:i.body,method:"POST",referrerPolicy:"origin",headers:t.headers,keepalive:n<=6e4&&r<15,...t.fetchOptions};try{return e(t.url,o).then((t=>(n-=s,r--,{statusCode:t.status,headers:{"x-sentry-rate-limits":t.headers.get("X-Sentry-Rate-Limits"),"retry-after":t.headers.get("Retry-After")}})))}catch(t){return yg=void 0,n-=s,r--,ad(t)}}))}function _g(t){return gg(t,(function(e){return new cd(((n,r)=>{const i=new XMLHttpRequest;i.onerror=r,i.onreadystatechange=()=>{4===i.readyState&&n({statusCode:i.status,headers:{"x-sentry-rate-limits":i.getResponseHeader("X-Sentry-Rate-Limits"),"retry-after":i.getResponseHeader("Retry-After")}})},i.open("POST",t.url);for(const e in t.headers)Object.prototype.hasOwnProperty.call(t.headers,e)&&i.setRequestHeader(e,t.headers[e]);i.send(e.body)}))}))}const wg=[new ff,new yf,new bp,new Gp,new gp,new Yp,new Zp,new Xp];var bg,Eg=o(5248);o(9282),function(t){t.KindleCloudReader="kindle-cloud-reader",t.ChatGPT="chat-gpt"}(bg||(bg={}));var Sg,Tg,Ig=o(6153),Og=o(9862),kg=o(6322);!function(t){t.HTML="html",t.URL="url"}(Sg||(Sg={})),function(t){t.EXTENSION="extension",t.APP="app"}(Tg||(Tg={}));const Cg={"save-to-app":0},Ag=t=>{const e=Cg[t];return Math.random()<e};function Rg(t){return!!t&&!Array.isArray(t)&&"object"==typeof t}class Ng extends Error{constructor(){super("Unable to transform response from server")}}function xg(t,e){let n;try{n=function(t,e){if("error"in t){const n=e.transformer.deserialize(t.error);return{ok:!1,error:{...t,error:n}}}return{ok:!0,result:{...t.result,...(!t.result.type||"data"===t.result.type)&&{type:"data",data:e.transformer.deserialize(t.result.data)}}}}(t,e)}catch(t){throw new Ng}if(!(n.ok||Rg(n.error.error)&&"number"==typeof n.error.error.code))throw new Ng;if(n.ok&&!Rg(n.result))throw new Ng;return n}class Dg extends Error{static from(t,e={}){const n=t;return function(t){return t instanceof Dg||t instanceof Error&&"TRPCClientError"===t.name}(n)?(e.meta&&(n.meta={...n.meta,...e.meta}),n):Rg(r=n)&&Rg(r.error)&&"number"==typeof r.error.code&&"string"==typeof r.error.message?new Dg(n.error.message,{...e,result:n}):n instanceof Error?new Dg(n.message,{...e,cause:n}):new Dg("Unknown error",{...e,cause:n});var r}constructor(t,e){const n=e?.cause;super(t,{cause:n}),this.meta=e?.meta,this.cause=n,this.shape=e?.result?.error,this.data=e?.result?.error.data,this.name="TRPCClientError",Object.setPrototypeOf(this,Dg.prototype)}}function Pg(t){const e=Object.create(null);for(const n in t)e[t[n]]=n;return e}const Lg={PARSE_ERROR:-32700,BAD_REQUEST:-32600,INTERNAL_SERVER_ERROR:-32603,NOT_IMPLEMENTED:-32603,UNAUTHORIZED:-32001,FORBIDDEN:-32003,NOT_FOUND:-32004,METHOD_NOT_SUPPORTED:-32005,TIMEOUT:-32008,CONFLICT:-32009,PRECONDITION_FAILED:-32012,PAYLOAD_TOO_LARGE:-32013,UNPROCESSABLE_CONTENT:-32022,TOO_MANY_REQUESTS:-32029,CLIENT_CLOSED_REQUEST:-32099};Pg(Lg),Pg(Lg);const jg=t=>"function"==typeof t;function Ug(t){return{url:t.url.toString().replace(/\/$/,""),fetch:t.fetch,AbortController:(e=t.AbortController,e||("undefined"!=typeof window&&window.AbortController?window.AbortController:"undefined"!=typeof globalThis&&globalThis.AbortController?globalThis.AbortController:null))};var e}const Mg={query:"GET",mutation:"POST"};function Fg(t){return"input"in t?t.runtime.transformer.serialize(t.input):function(t){const e={};for(let n=0;n<t.length;n++){const r=t[n];e[n]=r}return e}(t.inputs.map((e=>t.runtime.transformer.serialize(e))))}const $g=t=>{let e=t.url+"/"+t.path;const n=[];if("inputs"in t&&n.push("batch=1"),"query"===t.type){const e=Fg(t);void 0!==e&&n.push(`input=${encodeURIComponent(JSON.stringify(e))}`)}return n.length&&(e+="?"+n.join("&")),e},Bg=t=>{if("query"===t.type)return;const e=Fg(t);return void 0!==e?JSON.stringify(e):void 0},Vg=t=>qg({...t,contentTypeHeader:"application/json",getUrl:$g,getBody:Bg});async function Gg(t,e){const n=t.getUrl(t),r=t.getBody(t),{type:i}=t,s=await t.headers();if("subscription"===i)throw new Error("Subscriptions should use wsLink");const o={...t.contentTypeHeader?{"content-type":t.contentTypeHeader}:{},...t.batchModeHeader?{"trpc-batch-mode":t.batchModeHeader}:{},...s};return function(t){if(t)return t;if("undefined"!=typeof window&&jg(window.fetch))return window.fetch;if("undefined"!=typeof globalThis&&jg(globalThis.fetch))return globalThis.fetch;throw new Error("No fetch implementation found")}(t.fetch)(n,{method:Mg[i],signal:e?.signal,body:r,headers:o})}function qg(t){const e=t.AbortController?new t.AbortController:null,n={};let r=!1;return{promise:new Promise(((i,s)=>{Gg(t,e).then((t=>(n.response=t,r=!0,t.json()))).then((t=>{n.responseJSON=t,i({json:t,meta:n})})).catch((t=>{r=!0,s(Dg.from(t,{meta:n}))}))})),cancel:()=>{r||e?.abort()}}}function Kg(t){return t}function Hg(t){const e={subscribe(e){let n=null,r=!1,i=!1,s=!1;function o(){null!==n?i||(i=!0,"function"==typeof n?n():n&&n.unsubscribe()):s=!0}return n=t({next(t){r||e.next?.(t)},error(t){r||(r=!0,e.error?.(t),o())},complete(){r||(r=!0,e.complete?.(),o())}}),s&&o(),{unsubscribe:o}},pipe(...t){return(0===(n=t).length?Kg:1===n.length?n[0]:function(t){return n.reduce(((t,e)=>e(t)),t)})(e);var n}};return e}const zg=()=>{throw new Error("Something went wrong. Please submit an issue at https://github.com/trpc/trpc/issues/new")};function Wg(t){let e=null,n=null;function r(){const r=function(e){const n=[[]];let r=0;for(;;){const i=e[r];if(!i)break;const s=n[n.length-1];if(i.aborted){i.reject?.(new Error("Aborted")),r++;continue}const o=t.validate(s.concat(i).map((t=>t.key)));o?(s.push(i),r++):0!==s.length?n.push([]):(i.reject?.(new Error("Input is too big for a single dispatch")),r++)}return n}(e);clearTimeout(n),n=null,e=null;for(const e of r){if(!e.length)continue;const n={items:e,cancel:zg};for(const t of e)t.batch=n;const r=(t,e)=>{const r=n.items[t];r.resolve?.(e),r.batch=null,r.reject=null,r.resolve=null},{promise:i,cancel:s}=t.fetch(n.items.map((t=>t.key)),r);n.cancel=s,i.then((t=>{for(let e=0;e<t.length;e++){const n=t[e];r(e,n)}for(const t of n.items)t.reject?.(new Error("Missing result")),t.batch=null})).catch((t=>{for(const e of n.items)e.reject?.(t),e.batch=null}))}}return{load:function(t){const i={aborted:!1,key:t,batch:null,resolve:zg,reject:zg},s=new Promise(((t,n)=>{i.reject=n,i.resolve=t,e||(e=[]),e.push(i)}));return n||(n=setTimeout(r)),{promise:s,cancel:()=>{i.aborted=!0,i.batch?.items.every((t=>t.aborted))&&(i.batch.cancel(),i.batch=null)}}}}}function Yg(t){return function(e){const n=Ug(e),r=e.maxURLLength??1/0;return i=>{const s=s=>({validate:t=>{if(r===1/0)return!0;const e=t.map((t=>t.path)).join(","),o=t.map((t=>t.input));return $g({...n,runtime:i,type:s,path:e,inputs:o}).length<=r},fetch:t({...n,runtime:i,type:s,opts:e})}),o=Wg(s("query")),a=Wg(s("mutation")),c={query:o,subscription:Wg(s("subscription")),mutation:a};return({op:t})=>Hg((e=>{const n=c[t.type],{promise:r,cancel:s}=n.load(t);let o;return r.then((t=>{o=t;const n=xg(t.json,i);n.ok?(e.next({context:t.meta,result:n.result}),e.complete()):e.error(Dg.from(n.error,{meta:t.meta}))})).catch((t=>{e.error(Dg.from(t,{meta:o?.meta}))})),()=>{s()}}))}}}function Jg(t){return e=>{const n=Ug(e);return r=>({op:i})=>Hg((s=>{const{path:o,input:a,type:c}=i,{promise:u,cancel:l}=t.requester({...n,runtime:r,type:c,path:o,input:a,headers:()=>e.headers?"function"==typeof e.headers?e.headers({op:i}):e.headers:{}});let h;return u.then((t=>{h=t.meta;const e=xg(t.json,r);e.ok?(s.next({context:t.meta,result:e.result}),s.complete()):s.error(Dg.from(e.error,{meta:h}))})).catch((t=>{s.error(Dg.from(t,{meta:h}))})),()=>{l()}}))}}Yg((t=>e=>{const n=e.map((t=>t.path)).join(","),r=e.map((t=>t.input)),{promise:i,cancel:s}=Vg({...t,path:n,inputs:r,headers:()=>t.opts.headers?"function"==typeof t.opts.headers?t.opts.headers({opList:e}):t.opts.headers:{}});return{promise:i.then((t=>(Array.isArray(t.json)?t.json:e.map((()=>t.json))).map((e=>({meta:t.meta,json:e}))))),cancel:s}})),Jg({requester:Vg}),Yg((t=>{const e=function(t){if(t)return t;if("undefined"!=typeof window&&window.TextDecoder)return new window.TextDecoder;if("undefined"!=typeof globalThis&&globalThis.TextDecoder)return new globalThis.TextDecoder;throw new Error("No TextDecoder implementation found")}(t.opts.textDecoder);return(n,r)=>{const i=n.map((t=>t.path)).join(","),s=n.map((t=>t.input)),{cancel:o,promise:a}=((t,e)=>{const n=t.AbortController?new t.AbortController:null;return{cancel:()=>n?.abort(),promise:Gg({...t,contentTypeHeader:"application/json",batchModeHeader:"stream",getUrl:$g,getBody:Bg},n).then((async r=>{if(!r.body)throw new Error("Received response without body");const i={response:r};return async function(t){const e=t.parse??JSON.parse;await async function(t,e,n){let r="";const i=t=>{const i=n.decode(t).split("\n");if(1===i.length)r+=i[0];else if(i.length>1){e(r+i[0]);for(let t=1;t<i.length-1;t++)e(i[t]);r=i[i.length-1]}};"getReader"in t?await async function(t,e){const n=t.getReader();let r=await n.read();for(;!r.done;)e(r.value),r=await n.read()}(t,i):await function(t,e){return new Promise((n=>{t.on("data",e),t.on("end",n)}))}(t,i),e(r)}(t.readableStream,(n=>{if(t.signal?.aborted)return;if(!n||"}"===n)return;const r=n.indexOf(":"),i=n.substring(2,r-1),s=n.substring(r+1);t.onSingle(Number(i),e(s))}),t.textDecoder)}({readableStream:r.body,onSingle:e,parse:t=>({json:JSON.parse(t),meta:i}),signal:n?.signal,textDecoder:t.textDecoder})}))}})({...t,textDecoder:e,path:i,inputs:s,headers:()=>t.opts.headers?"function"==typeof t.opts.headers?t.opts.headers({opList:n}):t.opts.headers:{}},((t,e)=>{r(t,e)}));return{promise:a.then((()=>[])),cancel:o}}}));const Xg=t=>{if("input"in t){if(!(t.input instanceof FormData))throw new Error("Input is not FormData");return t.input}};var Qg;function Zg(t){let e;try{const n=new URL(t).hostname;e=n.includes(".amazon.")?Qg.KindleCloudReader:n.includes("docs.google.com")?Qg.GoogleDocs:n.includes("chat.openai.")?Qg.ChatGPT:t.includes("extension://")&&t.includes("pdf.js")?Qg.PdfReader:t.includes("extension://")&&t.includes("epub_reader")?Qg.EpubReader:Qg.WebsiteStandard}catch(n){console.warn("Error parsing url string, assuming website standard: ",t,n),e=Qg.WebsiteStandard}return e}Jg({requester:t=>{if("mutation"!==t.type)throw new Error("We only handle mutations with formdata");return qg({...t,getUrl:()=>`${t.url}/${t.path}`,getBody:Xg})}}),function(t){t.PdfReader="pdf-reader",t.EpubReader="epub-reader",t.ChatGPT="chat-gpt",t.KindleCloudReader="kindle-cloud-reader",t.GoogleDocs="google-docs",t.WebsiteStandard="website-standard"}(Qg||(Qg={})),console.log("Extension id: ",chrome.runtime.getURL(""));let tm=chrome.runtime.getManifest();tm.version_name&&function(t={}){void 0===t.defaultIntegrations&&(t.defaultIntegrations=wg),void 0===t.release&&("string"==typeof __SENTRY_RELEASE__&&(t.release=__SENTRY_RELEASE__),sp.SENTRY_RELEASE&&sp.SENTRY_RELEASE.id&&(t.release=sp.SENTRY_RELEASE.id)),void 0===t.autoSessionTracking&&(t.autoSessionTracking=!0),void 0===t.sendClientReports&&(t.sendClientReports=!0);const e={...t,stackParser:(n=t.stackParser||hg,Array.isArray(n)?Ed(...n):n),integrations:af(t),transport:t.transport||(_f()?vg:_g)};var n;!function(t,e){!0===e.debug&&(id?bh.enable():wh((()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")})));const n=ef();n.getScope().update(e.initialScope);const r=new t(e);n.bindClient(r)}(up,e),t.autoSessionTracking&&(void 0!==sp.document?(Ud({ignoreDuration:!0}),$d(),Af((({from:t,to:e})=>{void 0!==t&&t!==e&&(Ud({ignoreDuration:!0}),$d())}))):Jf&&bh.warn("Session tracking in non-browser environment with @sentry/browser is not supported."))}({dsn:"https://d3073b94b3fc4016be99a150f304263e@o1133756.ingest.sentry.io/4503942946095104",tracesSampleRate:1,release:tm.version_name??"dev",beforeSend(t){var e=t.exception&&t.exception.values&&t.exception.values[0].stacktrace;return e&&e.frames&&e.frames.forEach((function(t){const e=t.filename?t.filename.split("/"):void 0;if(e){const n=e[e.length-1];t.filename="app:///"+n}})),t}});const em=Og.Mw;let nm=at({apiKey:"AIzaSyCc9UtV_eOVOGEak-hTImETXHlczjp_D70",authDomain:"spreed-9532e.firebaseapp.com",databaseURL:"https://spreed-9532e.firebaseio.com",projectId:"spreed-9532e",storageBucket:"spreed-9532e.appspot.com",messagingSenderId:"120403148976",appId:"1:120403148976:web:b7eedd8197342ceb6efb75"}),rm=function(t,e){const n="string"==typeof t?t:"(default)",r=rt("object"==typeof t?t:ct(),"firestore").getImmediate({identifier:n});if(!r._initialized){const t=c("firestore");t&&Sl(r,...t)}return r}(nm);!1===em&&Sl(rm,"localhost",8080);let im=function(t=ct(),e){const n=rt(t=y(t),hh).getImmediate({identifier:e}),r=c("storage");return r&&dh(n,...r),n}(nm);!1===em&&dh(im,"localhost",9199),chrome.storage.onChanged.addListener((function(t,e){for(let[e,{oldValue:n,newValue:r}]of Object.entries(t));}));const sm=new Ig.gx;function om(n){chrome.tabs.query({currentWindow:!0,active:!0},(async function(r){if(chrome.runtime.lastError)throw chrome.runtime.lastError.message;var i=r[0];if(void 0!==i.url&&void 0!==i.id){const t=i,r=await(0,e.initializeBackgroundStorage)();await r.setSetting(r.ACTIVE_TAB_ID,t.id),n(t)}else console.error("Active tab does not have a URL or id. Stopping execution.",i),(0,t.pushEvent)("error","getting-active-tab-no-url-or-id",`${!!i.url} - ${!!i.id}`)}))}function am(){Tm((async function(t){const n=await(0,e.initializeBackgroundStorage)();await n.setSetting(n.READER_WINDOW_ID,t?t.id:void 0),console.log("opened new reader window with id: ",t?t.id:void 0)}))}async function cm(){const t=await(0,e.initializeBackgroundStorage)(),n=await t.getSettingFromStorage(t.READER_WINDOW_ID);"number"==typeof n?chrome.windows.get(n,(function(t){chrome.runtime.lastError||void 0===t?am():(console.log("reader window already opened with id, sending message to refresh: ",n,t),chrome.runtime.sendMessage({action:"reloadReader"},(function(t){chrome.windows.update(n,{focused:!0})})))})):am()}async function um(t){await mm(t)}chrome.runtime.onInstalled.addListener((function(t){chrome.runtime.OnInstalledReason.INSTALL===t.reason?chrome.tabs.create({url:"start.html"}):(chrome.runtime.OnInstalledReason.UPDATE,t.reason)})),chrome.runtime.setUninstallURL("https://swiftread.com/uninstalled"),chrome.tabs.onActivated.addListener((async function(t){const n=t.tabId,r=await(0,e.initializeBackgroundStorage)();await r.setSetting(r.ACTIVE_TAB_ID,n)}));let lm=function(t){hm(t.id)},hm=async function(e){(0,t.pushEvent)("content-extractor","run-kindle-cloud"),console.log("---running kindle cloud reader scripts---"),await chrome.scripting.executeScript({target:{tabId:e},files:["jquery.js"]}),await chrome.scripting.executeScript({target:{tabId:e},files:["src/settings_store.js"]}),await chrome.scripting.executeScript({target:{tabId:e},files:["src/analytics_m.js"]}),await chrome.scripting.executeScript({target:{tabId:e},files:["dist/non_app/content_builders/kindle_cr/index.js"]})},dm=function(t){fm(t.id)},fm=async function(e){(0,t.pushEvent)("content-extractor","run-google-doc"),await chrome.scripting.executeScript({target:{tabId:e},files:["jquery.js"]}),await chrome.scripting.executeScript({target:{tabId:e},files:["src/settings_store.js"]}),await chrome.scripting.executeScript({target:{tabId:e},files:["dist/non_app/content_builders/google_docs/index.js"]})},pm=async function(e){const n=e.id;(0,t.pushEvent)("content-extractor","run-chat-gpt"),await chrome.scripting.executeScript({target:{tabId:n},files:["dist/non_app/content_builders/chat_gpt/index.js"]})};async function gm(n,r,i){await(0,e.initializeBackgroundStorage)(),console.log("attempting to auto extract content:"),console.log("tab:",n),console.log("domain:",r),console.log("pollDomain:",i);const s=n.url,o=await Zg(s);if(o===Qg.KindleCloudReader)await um(n),!0===await(0,Eg.qo)()?(console.log("on amazon cloud reader..."),lm(n)):await _m("kindle_cloud_extract",n.url+", "+n.title);else if(o===Qg.GoogleDocs)await um(n),!0===await(0,Eg.qo)()?dm(n):await _m("google_docs_extract",n.url+", "+n.title);else if(o===Qg.ChatGPT)await um(n),pm(n);else if(o===Qg.PdfReader)chrome.runtime.sendMessage({action:"openReader",sourceType:"pdf"},(function(t){}));else if(o===Qg.EpubReader)chrome.runtime.sendMessage({action:"openReader",sourceType:"epub"},(function(t){}));else if(void 0===i){await um(n),(0,t.pushEvent)("content-extractor","run-misc"),console.log("executing jquery then extractor scripts...");try{await chrome.scripting.executeScript({target:{tabId:n.id},files:["jquery.js"]}),await chrome.scripting.executeScript({target:{tabId:n.id},files:["src/readability.js"]}),await chrome.scripting.executeScript({target:{tabId:n.id},files:["extractor.js"]}),n&&n.url.includes("swiftread.com/reading-speed-test")&&(console.log("SwiftRead executed on reading speed test"),chrome.scripting.executeScript({target:{tabId:n.id},files:["src/content-script-swiftread.js"]}))}catch(t){console.error(`failed to execute scripts for auto-extraction: ${t}`)}}}async function mm(n){const r=await(0,e.initializeBackgroundStorage)(),i=n.id;await r.setSetting(r.CURRENT_TAB_ID,i);let s,o,a,c=n.url;if(s=n.title,await r.setSetting(r.CURRENT_TITLE,s),o=new URL(c),await r.setSetting(r.CURRENT_URL,o.toString()),a=o.hostname,await r.setSetting(r.CURRENT_DOMAIN,a),!o){const e="Active tab was supposed to have URL but does not.";throw console.error(e),(0,t.pushEvent)("error","null-url-in-autoExtractContent",JSON.stringify(n)),new Error(e)}return console.log("Set current page metadata from active tab:",c,a,s,i),{url:o,domain:a,title:s,tabId:i}}async function ym(e,n){let r,i=null;console.log("---autoExtractContent---"),void 0===n?om((async function(n){console.log("get active tab in auto extract content:",n);try{const{url:t,domain:e}=await mm(n);i=t,r=e}catch(e){console.error(e),console.error(n),(0,t.pushEvent)("error","error-in-active-tab-autoExtractContent",JSON.stringify(e))}gm(n,r,e)})):(console.log("get specific tab in auto extract content:",n),chrome.tabs.get(n,(async function(n){if(chrome.runtime.lastError){var s=chrome.runtime.lastError.message;return void(0,t.pushEvent)("error","could-not-get-specific-tabId-in-autoExtractContent",s)}if(void 0===n.url)return void(0,t.pushEvent)("error","null-tab-url-in-autoExtractContent",JSON.stringify(n));const o=n;try{const{url:t,domain:e}=await mm(o);i=t,r=e}catch(e){console.error(e),console.error(o),(0,t.pushEvent)("error","error-in-specific-tab-autoExtractContent",JSON.stringify(e))}gm(o,r,e)})))}async function vm(){console.log("auto extract called"),await ym()}async function _m(n,r=null){(0,t.pushEvent)("in-app-upgrade-redirect",n,r);const i=await(0,e.initializeBackgroundStorage)(),s=await i.getSettingFromStorage(i.OPENED_PRO_WINDOW_ID),o=await i.getSettingFromStorage(i.OPENED_PRO_TAB_ID);if(null!==s&&null!==o)try{chrome.windows.update(s,{focused:!0},(function(t){void 0===t||chrome.runtime.lastError?(chrome.runtime.lastError&&console.error(chrome.runtime.lastError.message),wm(n)):chrome.tabs.update(o,{active:!0},(function(t){(void 0===t||chrome.runtime.lastError)&&(chrome.runtime.lastError&&console.error(chrome.runtime.lastError.message),wm(n))}))}))}catch(t){console.warn(t),wm(n)}else console.log("redirecting to new pro page"),wm(n)}function wm(t){chrome.tabs.create({url:"https://swiftread.com/pro?utm_source=extension&utm_medium=internal&utm_campaign=pro_feature_"+t},(async function(t){chrome.windows.update(t.windowId,{focused:!0});const n=await(0,e.initializeBackgroundStorage)();await n.setSetting(n.OPENED_PRO_WINDOW_ID,t.windowId),await n.setSetting(n.OPENED_PRO_TAB_ID,t.id)}))}const bm=()=>{var t=window.getSelection();return null!==t&&t.rangeCount>0?t.toString():""},Em=()=>{};async function Sm(t,n,r){console.log("BG: extracted html received char length:",t.length);const i=await(0,e.initializeBackgroundStorage)();if(n&&!0===n)await i.setSetting(i.KEEP_RAW,!0),await i.setSetting(i.SELECTED_TEXT,t);else{let e=function(t,e=!1){let n=["H1","H2","H3","H4","H5","H6","U","I","B","P","EM","DEL","SMALL","OL","UL","LI"];if(!0===e){const e=/<\/?((\w+)\s?.*?)>/gi,r=[...t.matchAll(e)];let i="",s=0;for(let e=0;e<r.length;e++){const o=r[e];if("number"!=typeof o.index)continue;const a=o[2],c=o[1];o.index>s&&(i+=t.slice(s,o.index)),i+=o[0].replace(c,n.includes(a.toUpperCase())?a:"span"),s=o.index+o[0].length}return s<t.length&&(i+=t.slice(s,t.length)),i=i.replaceAll("<span>",""),i=i.replaceAll("</span>",""),i}{var r=document.createElement("DIV");r.innerHTML=t;let e=r.textContent||r.innerText||"";return e=e.replace(/\</g,"&lt;"),e=e.replace(/\>/g,"&gt;"),e}}(t,!0);await i.setSetting(i.KEEP_RAW,!1),await i.setSetting(i.SELECTED_TEXT,e)}r&&"kindle-cloud-reader"===r&&console.log("Extracted text received from Kindle Cloud Reader, num characters:",t.length)}async function Tm(t){const n=await chrome.tabs.query({active:!0,currentWindow:!0});if(!n||0===n.length)return void console.error("No active tab found");const r=n[0],i=await chrome.windows.get(r.windowId),s=await(0,e.initializeBackgroundStorage)(),o=await s.getSettingFromStorage(s.READER_WINDOW_WIDTH),a=await s.getSettingFromStorage(s.READER_WINDOW_HEIGHT),c=await s.getSettingFromStorage(s.READER_WINDOW_X)??i.left??0,u=await s.getSettingFromStorage(s.READER_WINDOW_Y)??i.top??0;console.log("Opening reader with width, height, x, y: ",o,a,c,u),async function(t,n,r,i,s,o,a){const c=await chrome.windows.create({url:"app.html",width:Math.round(r),height:Math.round(i),top:o,left:s,type:"popup"}).catch((async t=>{console.warn(t),console.log("Resetting SwiftRead window dimensions and trying to open again...");const n=await(0,e.initializeBackgroundStorage)();await n.removeSetting(n.READER_WINDOW_WIDTH),await n.removeSetting(n.READER_WINDOW_HEIGHT),await n.removeSetting(n.READER_WINDOW_X),await n.removeSetting(n.READER_WINDOW_Y),Tm(a)}));a&&a(c)}(0,0,o,a,c,u,t)}chrome.commands.onCommand.addListener((async function(t){const n=await(0,e.initializeBackgroundStorage)();if("open-spreed"===t)om((async function(t){const e=Zg(t.url);if(e===Qg.PdfReader)console.log("SwiftRead not run. Page like PDF reader detected, which should have its own command listener.");else if(e===Qg.EpubReader)console.log("SwiftRead not run. Page like ePub reader detected, which should have its own command listener.");else{console.log("Open spreed hotkey pressed..."),console.log("check injecting into all frames first...");try{const e=await(async t=>new Promise(((e,n)=>{chrome.scripting.executeScript({func:Em,target:{tabId:t.id,allFrames:!0}}).then((t=>{e(!0)})).catch((t=>{e(!1)})),setTimeout((()=>{e(!1)}),200)})))(t),r=await chrome.scripting.executeScript({func:bm,target:{tabId:t.id,allFrames:e}});if(console.log("selectedTextPerFrame: ",r),r&&r.length>0){const e=r[0].result;"string"==typeof e&&e.length>0?(await n.setSetting(n.OPEN_MODE,3),await n.setSetting(n.KEEP_RAW,!0),await n.setSetting(n.SELECTED_TEXT,e),await mm(t),cm()):(await n.setSetting(n.OPEN_MODE,1),await vm())}}catch(t){console.error(t),console.error('WARNING: SwiftRead not run. Try selecting text, right-clicking, then clicking "SwiftRead selected text". ')}}}));else if("save-to-app"===t){if(!Ag("save-to-app"))return;await n.setSetting(n.OPEN_MODE,13),await n.setSetting(n.SAVE_TO_APP_ON_READER_OPEN,!0),await vm()}})),chrome.runtime.onMessage.addListener((function(n,r,i){return(async()=>{const s=await(0,Eg.f0)(),o=await(0,e.initializeBackgroundStorage)();if("openSpreedWithPasted"==n.action)await o.setSetting(o.OPEN_MODE,6),await o.setSetting(o.KEEP_RAW,!0),await o.setSetting(o.SELECTED_TEXT,n.pastedText),await o.removeSetting(o.CURRENT_DOMAIN),await o.removeSetting(o.CURRENT_URL),await o.removeSetting(o.CURRENT_TITLE),await cm(),i({success:!0});else if("extractor"==n.action)await Sm(n.html,n.keepRaw,n.source),i({success:!0});else if("openSpreedFromMenu"==n.action)console.log("Open reader from browser menu event received"),await o.setSetting(o.OPEN_MODE,8),await vm(),i({success:!0});else if("autoExtractContent"==n.action){let a,c;!0===n.hasOwnProperty("pollDomain")&&(a=n.pollDomain),!0===n.hasOwnProperty("tabId")&&(c=n.tabId),await ym(a,c),i({success:!0})}else if("getWPMSpeed"==n.action){const u=await s.getSettingFromStorage(s.SETTING_WPM),l=await s.getSettingFromStorage(s.SETTING_CHUNK_SIZE);i({wpm:u,chunkSize:l})}else if("getCurrentTab"==n.action)i({success:!0,tab:r.tab});else if("userIsPRO"==n.action){const h=await(0,Eg.qo)();i({success:!0,isPRO:h})}else if("getUserLicense"==n.action){const d=await(0,Eg.U5)();i({success:!0,licenseKey:d})}else if("redirectToPaid"==n.action)await _m(n.featureName),i({success:!0});else if("pushEvent"==n.action){let f=null,p=null;!0===n.hasOwnProperty("eventLabel")&&(f=n.eventLabel),!0===n.hasOwnProperty("eventValue")&&(p=n.eventValue),(0,t.pushEvent)(n.eventCategory,n.eventAction,f,p),i({success:!0})}else if("openReader"==n.action)console.log("OpenReader event received:",n),await cm(),i({success:!0});else if("setVarsForPageTurn"==n.action)console.log("setVarsForPageTurn request:",n),n.hasOwnProperty("currentDomain")&&n.currentDomain?(await o.setSetting(o.CURRENT_DOMAIN,n.currentDomain),await o.setSetting(o.CURRENT_URL,n.currentDomain)):n.hasOwnProperty("currentDomain")&&!n.currentDomain&&(await o.removeSetting(o.CURRENT_DOMAIN),await o.removeSetting(o.CURRENT_URL)),n.hasOwnProperty("currentTabId")&&n.currentTabId?await o.setSetting(o.CURRENT_TAB_ID,n.currentTabId):n.hasOwnProperty("currentTabId")&&!n.currentTabId&&await o.removeSetting(o.CURRENT_TAB_ID),i({success:!0});else if("storeLocationString"==n.action)await o.setSetting(o.LOCATION_STRING,n.locationString),i({success:!0});else if("gdocsPageTurn"==n.action)"left"===n.direction?chrome.scripting.executeScript({target:{tabId:n.tabId},files:["src/pageTurnDirection_left.js"]}):"right"===n.direction&&chrome.scripting.executeScript({target:{tabId:n.tabId},files:["src/pageTurnDirection_right.js"]}),fm(n.tabId),i({success:!0});else if("kindlePageTurn"==n.action)"left"===n.direction?chrome.scripting.executeScript({target:{tabId:n.tabId},files:["src/pageTurnDirection_left.js"]}):"right"===n.direction&&chrome.scripting.executeScript({target:{tabId:n.tabId},files:["src/pageTurnDirection_right.js"]}),hm(n.tabId),i({success:!0});else if("openWithFirebaseDocument"===n.action){console.log("openWithFirebaseDocument called:",n);try{let g=zl(kl(rm,n.collection,n.id),(async t=>{const e=t.data();if(e){if(e.hasOwnProperty(n.field)){console.log(`${n.collection}, document ${n.id}, updated for field '${n.field}', sending content...`);const t=n.reload??!1,r=e[n.field];if(n.source!==bg.KindleCloudReader)return console.error(`Extracting for ${n.source} not implemented for openWithFirebaseDocument`),void(n.source===bg.KindleCloudReader&&n.tabId&&chrome.tabs.sendMessage(n.tabId,{action:"clearLoadingIndicator"}));if(await Sm(r,!0,"kindle-cloud-reader"),!1===t){if(""===r)return n.source===bg.KindleCloudReader&&n.tabId&&chrome.tabs.sendMessage(n.tabId,{action:"clearLoadingIndicator"}),void console.error("No next detected on this page. Please turn to a page with text then try again.\n\nIf you think this is an error, email help@swiftread.com");console.log("opening new swiftread window..."),await cm()}else console.log("reloading existing swiftread window..."),chrome.runtime.sendMessage({action:"reloadReader"},(function(t){}));n.source===bg.KindleCloudReader&&n.tabId&&chrome.tabs.sendMessage(n.tabId,{action:"clearLoadingIndicator"}),g(),i({success:!0})}}else console.error(`Firebase document ${n.collection}, ${n.id} does not exist`),n.source===bg.KindleCloudReader&&n.tabId&&chrome.tabs.sendMessage(n.tabId,{action:"clearLoadingIndicator"})})),m=setTimeout((()=>{g(),i({success:!1}),clearTimeout(m)}),15e3)}catch(y){console.error(y),(0,t.pushEvent)("error","open-with-firebase-document",n.source+", "+y),i({success:!1})}}else if("localStorageWithFirebaseDocument"===n.action){console.log("localStorageWithFirebaseDocument called:");try{let v=zl(kl(rm,n.collection,n.id),(async t=>{const r=t.data();if(r){if(r.hasOwnProperty(n.field)){console.log(`${n.collection}, document ${n.id}, updated for field '${n.field}', sending content...`);const t=r[n.field];(await(0,e.initializeBackgroundStorage)()).setSetting(n.localStorageVarName,t),console.log(`${t.length} characters stored in chrome local storage ${n.localStorageVarName} `),v(),i({success:!0})}}else console.error(`Firebase document ${n.collection}, ${n.id} does not exist`)})),_=setTimeout((()=>{v(),i({success:!1}),clearTimeout(_)}),15e3)}catch(w){console.error("Error in when opening Firebase document. Report to help@swiftread.com.\n"+n.source+", "+w),(0,t.pushEvent)("error","localStorage-with-firebase-document",n.source+", "+w),i({success:!1})}}else if("logToServer"===n.action){const b={name:n.name,payload:void 0};n.hasOwnProperty("payload")&&(b.payload=JSON.stringify(n.payload));const E=await fetch(`${Og.Bc}log`,{method:"POST",body:JSON.stringify(b),headers:{"Content-Type":"application/json"}}),S=await E.json();200!==E.status?console.error(S):i(S)}else if("getListenAudio"===n.action){const T=n.listenResponse;try{let I=zl(kl(rm,T.collection,T.id),(async t=>{const e=t.data();if(!e)throw`Listen ${T.id} exists but does not have any data`;if(e.hasOwnProperty("audioUrl")&&e.hasOwnProperty("timepointsUrl")){console.log(`Listen ${T.id} has both audioUrl and timepointsUrl now, sending...`);const t=e.audioDownloadUrl,r=e.timepointsDownloadUrl;if(void 0===t||void 0===r)chrome.runtime.sendMessage({action:"forceUpdateAudio",listenId:T.id,wordIndex:n.wordIndex,spreedTabId:n.spreedTabId},(function(t){i({success:!1})}));else{let e;console.log("fetching timepoints url...");const s=await fetch(r);200===s.status?(console.log("response successful, getting json response..."),e=await s.json(),e&&0===Object.keys(e).length&&(console.log(`timepoints retrieved but empty for listen ${T.id}.force updating...`),chrome.runtime.sendMessage({action:"forceUpdateAudio",listenId:T.id,wordIndex:n.wordIndex,spreedTabId:n.spreedTabId},(function(t){i({success:!1})}))),console.log("sending message to return audio and timepoints"),chrome.runtime.sendMessage({action:"returnListenAudio",audioUrl:t,timepointsUrl:r,timepoints:e,wordIndex:n.wordIndex,spreedTabId:n.spreedTabId},(function(t){}))):404===s.status?(console.log(`timepoints do not exsit at timepoints url for ${T.id}.force updating...`),chrome.runtime.sendMessage({action:"forceUpdateAudio",listenId:T.id,wordIndex:n.wordIndex,spreedTabId:n.spreedTabId},(function(t){i({success:!1})}))):(console.error("Error in fetch timepoints, attempting to force update... ",s),chrome.runtime.sendMessage({action:"forceUpdateAudio",listenId:T.id,wordIndex:n.wordIndex,spreedTabId:n.spreedTabId},(function(t){i({success:!1})}))),I(),i({success:!0})}}else console.log(`Listen ${T.id} does not have both audioUrl and timepointsUrl yet...`)})),O=setTimeout((()=>{I(),i({success:!1}),clearTimeout(O)}),15e3)}catch(k){const C="Error in when getting audio data. Report to help@swiftread.com.\n response: "+JSON.stringify(n.listenResponse)+", "+k;console.error(C),(0,t.pushEvent)("error","getListenAudio",JSON.stringify(n.listenResponse)+", "+k),i({success:!1})}}else if("gotPageSource"===n.action)r.tab&&r.tab.id?chrome.tabs.sendMessage(r.tab.id,n,(function(t){i({success:!0})})):(console.warn("ignoring storedPageSource message because sender tab is undefined"),i({success:!1}));else if("getCommand"===n.action){const A={"open-spreed":"&#8997;V","save-toa--":"&#8997;X"},R=n.commandId,N=(await chrome.commands.getAll()).filter((t=>t.name===R));if(N.length>0){const x=N[0];i({success:!0,hasCommand:!0,commandHTMLString:x.shortcut})}else i({success:!0,hasCommand:!1,commandHTMLString:A[R]})}else if("setMetadata"==n.action)if(n.hasOwnProperty("metadata")&&n.metadata){const D=n.metadata;D.title&&await o.setSetting(o.CURRENT_TITLE,D.title),D.url&&await o.setSetting(o.CURRENT_URL,D.url),D.domain&&await o.setSetting(o.CURRENT_DOMAIN,D.domain),console.log("Set metadata event received:",D),i({success:!0})}else i({success:!1});else if("authAppUser"===n.action){if(!Ag("save-to-app"))return void i({success:!1,error:"Feature not enabled"});try{const P=n.windowId;let L=null;try{L=await sm.session()}catch(j){console.warn(j)}if(null===L){if(console.log("No session found, redirecting to sign in page..."),!await sm.signInToApp())throw new Error("Sign in was not completed in time. Please try again.");P&&chrome.windows.update(P,{focused:!0});try{L=await sm.session()}catch(U){console.warn(U)}}console.log("Session found? ",void 0!==L),i({success:!0,session:L})}catch(M){console.error("Error authing user to app:",M),i({success:!1,error:"While authing user to app: "+M.message??M})}}else if("saveToApp"===n.action){if(!Ag("save-to-app"))return void i({success:!1,error:"Feature not enabled"});console.log("saveToApp action detected");const F=await(0,e.initializeBackgroundStorage)();await F.setSetting(F.SAVE_TO_APP_ON_READER_OPEN,!0),await F.setSetting(F.OPEN_MODE,12),await vm(),i({success:!0})}else if("importToApp"===n.action){if(!Ag("save-to-app"))return void i({success:!1,error:"Feature not enabled"});const $=n.data,B=n.url,V=n.title;try{if(!$)throw new Error("No data provided to importToApp");if(console.log("importToApp action detected"),!await sm.session())throw new Error("Please sign in to save content to the app.");console.log("Session found, continuing...");const G=await async function(t,e,n,r){const i=await e.session();if(!i)throw new Error("No session found");const s=e.client,o=`${i.user.id}/${Date.now()}`;console.log("[IMPORT] Uploading imported content to:",o);const{data:a,error:c}=await s.storage.from("imports").upload(o,n);if(c)throw new Error("While uploading data to storage: "+c.message);let u;console.log("[IMPORT] Upload successful");try{const e=await t.import.imported.mutate({source:r.source,importsFile:a.path,importType:r.importType,url:r.url,title:r.title});u=e?.contentId,console.log("[IMPORT] Imported content id: ",u)}catch(t){throw t instanceof Dg?(console.error("TRPC client error: ",t),new Error("While sending request to app API: "+t.message)):(console.error("Unknown error: ",t),t)}return u}(kg.u,sm,$,{source:Tg.EXTENSION,importType:Sg.HTML,url:B,title:V});i({success:!0,contentId:G})}catch(q){console.error("Error importing content to app:",q),i({success:!1,error:q.message??q})}}else if("saveToAppAllowed"===n.action){function K(t){return Zg(t)!==Qg.KindleCloudReader}n.hasOwnProperty("url")?i({success:!0,allowed:K(n.url)}):om((async function(t){i({success:!0,allowed:K(t.url)})}))}else if("getConstants"===n.action)i({success:!0,APP_URL:Og.FX});else if("isFeatureEnabled"===n.action){const H=n.featureId,z=Ag(H);console.log(`Feature ${H} enabled? ${z}`),i({success:!0,result:z})}})(),!0}));const Im="swiftread";chrome.contextMenus.remove(Im,(function(){chrome.runtime.lastError&&console.log(`Context menu item "${Im}" not found, creating new one`),chrome.contextMenus.create({id:Im,title:"SwiftRead this page"})}));const Om="swiftread-selected";for(var km=["selection"],Cm=0;Cm<km.length;Cm++){var Am=km[Cm];chrome.contextMenus.remove(Om,(function(){chrome.runtime.lastError&&console.log(`Context menu item "${Om}" not found, creating new one`),chrome.contextMenus.create({id:Om,title:"SwiftRead selected text",contexts:[Am]})}))}chrome.contextMenus.onClicked.addListener((function(t){t.menuItemId===Om?async function(t){const n=await(0,Eg.qo)();om((async function(r){console.log("open with selection for tab:",r);const i=Zg(r.url);if(r.url&&i===Qg.PdfReader&&!n)console.log("Right-click SwiftRead run on PDF reader, user not on PRO. Redirecting."),await _m("pdf_reader");else if(r.url&&i===Qg.EpubReader&&!n)console.log("Right-click SwiftRead run on ePub reader, user not on PRO. Redirecting."),await _m("epub_reader");else{const n=await(0,e.initializeBackgroundStorage)();await n.setSetting(n.OPEN_MODE,4),await n.setSetting(n.KEEP_RAW,!0),await n.setSetting(n.SELECTED_TEXT,t.selectionText),await mm(r),await cm()}}))}(t):(async()=>{const t=await(0,e.initializeBackgroundStorage)();await t.setSetting(t.OPEN_MODE,11),await vm()})()})),chrome.fileBrowserHandler&&chrome.fileBrowserHandler.onExecute.addListener(((t,e)=>{if("open-as-pdf"===t){const t=e.entries;for(const e of t)chrome.tabs.create({url:chrome.runtime.getURL("/data/pdf.js/web/viewer.html?file="+encodeURIComponent(e.toURL()))})}}))})()})();
//# sourceMappingURL=index.js.map